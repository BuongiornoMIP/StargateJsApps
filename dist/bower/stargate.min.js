/*!
 * StargateJS Apps
 * v0.10.1
 * Copyright 2015 DMobileLab. http://buongiorno.com/
 * See LICENSE in this repository for license information
 */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.Stargate=t()}(this,function(){function e(e){p.type=e.type,p.networkState=navigator.connection.type,"function"==typeof f&&f(p)}function t(){document.addEventListener("offline",e,!1),document.addEventListener("online",e,!1)}function n(){p.networkState=navigator.connection.type,"none"===navigator.connection.type?p.type="offline":p.type="online"}function r(e){if("android"==window.device.platform.toLowerCase())window.navigator.app.loadUrl(e);else if("ios"==window.device.platform.toLowerCase()&&-1!==e.indexOf("file:///")){var t=e.split("?")[0];h("Without qs",t),window.resolveLocalFileSystemURL(t,function(e){var t=e.toInternalURL()+"?hybrid=1";h("Redirect to",t),window.location.href=t},m)}else window.location.href=e}function i(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.AppIsDebug?new Promise(function(e,t){window.cordova.plugins.AppIsDebug.get(function(t){e(t)},function(e){m("getAppIsDebug(): "+e,e),t(new Error(e))})}):(m("getAppIsDebug(): plugin not available!"),Promise.resolve({}))}function o(){return window.cordova.file?s.file.readFileAsJSON(window.cordova.file.applicationDirectory+"www/manifest.json"):window.hostedwebapp?new Promise(function(e,t){window.hostedwebapp.getManifest(function(t){e(t)},function(e){m(e),t(new Error(e))})}):(m("getManifest() no available reading mechanism!"),Promise.resolve({}))}var a={},s={};!function(e){function t(e,n,r){this.level=t.levels[e.toUpperCase()],this.styles=r||{background:"white",color:"black"},this.tag="%c "+n+" ",this.isstaging="1"==="IS_STAGING = 1".slice(-1),this.styleString="background:"+this.styles.background+";color:"+this.styles.color+";";var i=function(){if(arguments.length<1)return"";for(var e=Array.prototype.slice.call(arguments[0]),t="",n=0;n<e.length;n++)"object"==typeof e[n]?t+=" "+JSON.stringify(e[n]):t+=" "+e[n];return t},o=window.console.log.bind(window.console,this.tag,this.styleString),a=window.console.info.bind(window.console,this.tag,this.styleString),s=window.console.error.bind(window.console,this.tag,this.styleString),c=window.console.warn.bind(window.console,this.tag,this.styleString);this.isstaging||(o=function(){window.console.log("[D] [Stargate] "+i.apply(null,arguments))},a=function(){window.console.log("[I] [Stargate] "+i.apply(null,arguments))},s=function(){window.console.log("[E] [Stargate] "+i.apply(null,arguments))},c=function(){window.console.log("[W] [Stargate] "+i.apply(null,arguments))}),Object.defineProperties(this,{__d:{value:o,writable:!1,enumerable:!1,configurable:!1},__i:{value:a,writable:!1,enumerable:!1,configurable:!1},__e:{value:s,writable:!1,enumerable:!1,configurable:!1},__w:{value:c,writable:!1,enumerable:!1,configurable:!1}})}function n(e){var t=0;return{next:function(n){return n&&(t=0),t<e.length?{value:e[t++],done:!1}:{done:!0}}}}function r(e,t){e=e.split("?")[0].slice(0),e+="?";var n="";for(var r in t)n+=encodeURIComponent(r)+"="+encodeURIComponent(t[r])+"&";return n.length>0&&(n=n.substring(0,n.length-1)),e+n}function i(e){e=encodeURI(e);var t="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n="responseType"in t;t.open("GET",e,!0),n&&(t.responseType="json");var r=new Promise(function(e,r){t.onreadystatechange=function(){if(4===t.readyState)try{var i=n?t.response:JSON.parse(t.responseText);e(i)}catch(e){r(e)}}});return t.setRequestHeader("Content-type","application/json; charset=UTF-8"),t.send(),r}function o(e){var t=this;if(t.timeout=3e3,t.called=!1,window.document){var n=Date.now();t.scriptTag=window.document.createElement("script"),e+="&callback=window.__jsonpHandler_"+n,t.scriptTag.src=e,t.scriptTag.type="text/javascript",t.scriptTag.async=!0,t.prom=new Promise(function(e,r){var i="__jsonpHandler_"+n;window[i]=function(n){t.called=!0,e(n),t.scriptTag.parentElement.removeChild(t.scriptTag),delete window[i]},setTimeout(function(){t.called||(r("Timeout jsonp request "+n),t.scriptTag.parentElement.removeChild(t.scriptTag),delete window[i])},t.timeout)}),window.document.getElementsByTagName("head")[0].appendChild(t.scriptTag)}}function a(e,t){var n=t||function(){};return new Promise(function(t,r){function i(){var n;switch(e.responseType){case"blob":n=new Blob([this.response],{type:e.mimeType||"image/jpeg"});break;case"arraybuffer":n=this.response;break;default:n=this.response,t(n)}}var o=new XMLHttpRequest;o.open("GET",e.url,!0),o.responseType=e.responseType||"blob",e.withCredentials&&(o.withCredentials=e.withCredentials);var a=r,s=r;o.addEventListener("progress",n,!1),o.addEventListener("load",i,!1),o.addEventListener("error",s,!1),o.addEventListener("abort",a,!1),o.send(null)})}function s(e,t){var n=Object.prototype.toString.apply({});if(e.toString()!==n||t.toString()!==n)throw new Error("Cannot merge different type");var r={};for(var i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);for(var o in t)t.hasOwnProperty(i)&&(r[o]=t[o]);return r}function c(e){return{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}function u(e){e=e.slice(0),e=decodeURIComponent(e);var t=e.split("?")[1];return t?t.split("&").reduce(function(e,t){var n=t.split("="),r=n[0],i=n[1];return e[r]=i,e},{}):{}}t.levels={ALL:5,ERROR:4,WARN:3,INFO:2,DEBUG:1,OFF:0},t.prototype.e=function(){0!==this.level&&this.level>=t.levels.ERROR&&this.__e(arguments)},t.prototype.i=function(){0!==this.level&&this.level>=t.levels.WARN&&this.__i(arguments)},t.prototype.w=function(){0!==this.level&&this.level>=t.levels.INFO&&this.__w(arguments)},t.prototype.d=function(){0!==this.level&&this.level>=t.levels.DEBUG&&this.__d(arguments)},t.prototype.setLevel=function(e){this.level=t.levels[e]};var l={Iterator:n,Logger:t,composeApiString:r,getJSON:i,jsonpRequest:o,getImageRaw:a,extend:s,getType:c,dequerify:u};e?e.Utils=l:window.Utils=l}(s),function(e,t){function n(e){var t=e.map(function(e){return{fullPath:e.fullPath,path:e.toURL(),internalURL:e.toInternalURL(),isFile:e.isFile,isDirectory:e.isDirectory}});return 1==t.length?t[0]:t}var r={},i=new t.Logger("ALL","[File - module]");r.LOG=i,window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,r.ERROR_MAP={1:"NOT_FOUND_ERR",2:"SECURITY_ERR",3:"ABORT_ERR",4:"NOT_READABLE_ERR",5:"ENCODING_ERR",6:"NO_MODIFICATION_ALLOWED_ERR",7:"INVALID_STATE_ERR",8:"SYNTAX_ERR",9:"INVALID_MODIFICATION_ERR",10:"QUOTA_EXCEEDED_ERR",11:"TYPE_MISMATCH_ERR",12:"PATH_EXISTS_ERR"},r.currentFileTransfer=null,r.resolveFS=function(e){return new Promise(function(t,n){window.resolveLocalFileSystemURL(e,t,n)})},r.appendToFile=function(e,t,i,o){return i=void 0!==arguments[2]&&arguments[2],o=void 0===arguments[3]?"text/plain":arguments[3],r.resolveFS(e).then(function(e){return new Promise(function(r,a){e.createWriter(function(s){i||s.seek(s.length);var c;c=t instanceof Blob?t:new Blob([t],{type:o}),s.write(c),s.onerror=a,s.onabort=a,s.onwriteend=function(){r(n([e]))}},a)})})},r.readFileAsHTML=function(e){return r.readFile(e).then(function(e){return(new window.DOMParser).parseFromString(e,"text/html")})},r.readFileAsJSON=function(e){return r.readFile(e).then(function(e){try{return Promise.resolve(window.JSON.parse(e))}catch(e){return Promise.reject(e)}})},r.removeFile=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,n){e.remove(function(e){t(null===e||"OK"===e)},n)})})},r.removeDir=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,n){e.removeRecursively(function(e){t(null===e||"OK"===e)},n)})})},r._promiseZip=function(e,t,n){return i.d("PROMISEZIP:",arguments),new Promise(function(r,i){window.zip.unzip(e,t,function(e){0===e?r(!0):i(e)},n)})},r.download=function(e,t,i,o){var a=this;this.ft=new window.FileTransfer,this.ft.onprogress=o,r.currentFileTransfer=a.ft,a.promise=new Promise(function(r,o){a.ft.download(window.encodeURI(e),t+i,function(e){r(n([e])),a.ft=null},function(e){o(e),a.ft=null},!0)})},r.createDir=function(e,t){return r.resolveFS(e).then(function(e){return new Promise(function(r,i){e.getDirectory(t,{create:!0},function(e){r(n([e]))},i)})})},r.fileExists=function(e){return new Promise(function(t){window.resolveLocalFileSystemURL(e,function(e){t(e.isFile)},function(e){t(1!==e.code)})})},r.dirExists=function(e){return new Promise(function(t){window.resolveLocalFileSystemURL(e,function(e){t(e.isDirectory)},function(e){t(1!=e.code)})})},r.requestFileSystem=function(e,t){return new Promise(function(n,r){window.requestFileSystem(e,t,n,r)})},r.readDir=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,r){e.createReader().readEntries(function(e){i.d("readDir:",e),t(n(e))},r)})})},r.readFile=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,n){e.file(function(e){var r=new FileReader;r.onerror=n,r.onabort=n,r.onloadend=function(){var e=this.result;t(e)},r.readAsText(e)})})})},r.createFile=function(e,t){return r.resolveFS(e).then(function(e){return new Promise(function(r,i){e.getFile(t,{create:!0},function(e){r(n([e]))},i)})})},r.write=function(e,t){return r.fileExists(e).then(function(n){if(!n){var i=e.split("/"),o=i.slice(0,i.length-1).join("/"),a=i[i.length-1];return r.createFile(o,a).then(function(e){return r.appendToFile(e.path,t,!0)})}return r.appendToFile(e,t,!0)})},r.moveDir=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),o=t.replace(n,"");return i.d("moveDir:",o,n),Promise.all([r.resolveFS(e),r.resolveFS(o)]).then(function(e){return i.d("moveDir: resolved entries",e),new Promise(function(t,r){e[0].moveTo(e[1],n,t,r)})})},r.copyFile=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),o=t.replace(n,"");return Promise.all([r.resolveFS(e),r.resolveFS(o)]).then(function(e){return i.d("copyFileTo",e),new Promise(function(t,r){e[0].copyTo(e[1],n,t,r)})})},r.copyDir=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),o=t.replace(n,"");return Promise.all([r.resolveFS(e),r.resolveFS(o)]).then(function(r){return i.d("copyDir",e,"in",t),new Promise(function(e,t){r[0].copyTo(r[1],n,e,t)})})},r.getMetadata=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,n){e.getMetadata(t,n)})})},e?e.file=r:window.file=r}(s,s.Utils),function(e,t,n){"use strict";function r(){}function i(t){if(t&&(L=O(L,t)),N.d("Initialized called with:",L),!e)return Promise.reject("Missing file module!");try{b=window.cordova.file.applicationStorageDirectory,S=window.cordova.file.cacheDirectory,A=window.cordova.file.tempDirectory,_=window.cordova.file.applicationDirectory+"www/",I=window.cordova.file.applicationDirectory+"www/js/stargate.js",P=window.cordova.file.dataDirectory}catch(e){return N.e(e),Promise.reject(e)}"ios"==window.device.platform.toLowerCase()&&(b+="Documents/"),"android"==window.device.platform.toLowerCase()&&(A=S),k.SDK_DIR=b+"scripts/",k.SDK_RELATIVE_DIR="../../scripts/",k.GAMEOVER_RELATIVE_DIR="../../gameover_template/",k.GAMES_DIR=b+"games/",k.BASE_DIR=b,k.CACHE_DIR=S,k.TEMP_DIR=A,k.CORDOVAJS=_+"cordova.js",k.CORDOVA_PLUGINS_JS=_+"cordova_plugins.js",k.STARGATEJS=_+"js/stargate.js",k.DATA_DIR=P,k.GAMEOVER_DIR=k.BASE_DIR+"gameover_template/",k.WWW_DIR=_,N.i("cordova JS dir to include",k.CORDOVAJS),n.game._public.BASE_DIR=k.BASE_DIR,n.game._public.OFFLINE_INDEX=k.WWW_DIR+"index.html";var r={"0000":{"0000":{data:{},UpdatedAt:new Date(0)}}},i=e.createDir(k.BASE_DIR,"games"),a=e.createDir(k.BASE_DIR,"scripts"),u=e.fileExists(k.BASE_DIR+"offlineData.json").then(function(t){return t?Promise.resolve():e.write(k.BASE_DIR+"offlineData.json",JSON.stringify(T))}),l=e.fileExists(k.BASE_DIR+"userData.json").then(function(t){return t?Promise.resolve():e.write(k.BASE_DIR+"userData.json",JSON.stringify(r))});return Promise.all([i,a,u,l]).then(function(e){return N.d("GamesDir, ScriptsDir, offlineData.json, userData.json created",e),o()}).then(s).then(c)}function o(){return Promise.all([e.dirExists(k.BASE_DIR+"gameover_template"),e.dirExists(k.SDK_DIR+"plugins"),e.fileExists(k.SDK_DIR+"cordova.js"),e.fileExists(k.SDK_DIR+"cordova_plugins.js"),e.fileExists(k.SDK_DIR+"gamesFixes.js")]).then(function(t){var n=[];return t[0]||n.push(e.copyDir(k.WWW_DIR+"gameover_template",k.BASE_DIR+"gameover_template")),t[1]||n.push(e.copyDir(k.WWW_DIR+"plugins",k.SDK_DIR+"plugins")),t[2]||n.push(e.copyFile(k.CORDOVAJS,k.SDK_DIR+"cordova.js")),t[3]||n.push(e.copyFile(k.CORDOVA_PLUGINS_JS,k.SDK_DIR+"cordova_plugins.js")),t[4]||n.push(e.copyFile(k.WWW_DIR+"js/gamesFixes.js",k.SDK_DIR+"gamesFixes.js")),Promise.all(n)})}function a(e,t){return new Promise(function(n,r){var i=new XMLHttpRequest;i.open("HEAD",e,!0),i.addEventListener("error",r,!1),i.addEventListener("abort",r,!1),i.addEventListener("loadend",function(){n(i.getResponseHeader(t))}),i.send(null)})}function s(){var t=new Date,n=D(L.sdk_url,{v:t.getTime()});return""===L.sdk_url||void 0===L.sdk_url||null===L.sdk_url?(N.d("sdk_url is not a valid one"),Promise.resolve("sdk_url is not a valid one")):e.fileExists(k.SDK_DIR+"gfsdk.min.js").then(function(t){var r=[];return t||(N.d("isSdkDownloaded",t,"get SDK",n),r.push(new e.download(n,k.SDK_DIR,"gfsdk.min.js").promise)),Promise.all(r)}).then(function(){return Promise.all([a(n,"Last-Modified"),e.getMetadata(k.SDK_DIR+"gfsdk.min.js")])}).then(function(t){var r=t[1],i=t[0],o=[],a=new Date(r.modificationTime),s=new Date(i);return a<s&&(N.d("updating sdk",n,"localModification date:",a,"remoteModification date:",s),o.push(new e.download(n,k.SDK_DIR,"gfsdk.min.js").promise)),Promise.all(o)})}function c(){return""===L.newton_url||void 0===L.newton_url||null===L.newton_url?(N.d("newton_url is not a valid one"),Promise.resolve("newton_url is not a valid one")):e.fileExists(k.SDK_DIR+"newton.min.js").then(function(t){return t?(N.d("isNewtonDownloaded",t),t):(N.d("isNewtonDownloaded",t,"get Newton",L.newton_url),new e.download(L.newton_url,k.SDK_DIR,"newton.min.js").promise)})}function u(e,t){N.d("Playing this",e);var n=!!window.webview,r=e.internalURL+"?hybrid=1";"ios"===window.device.platform.toLowerCase()?n?(N.d("Play ios in other webview",e.path),window.webview.Show(e.path,console.log.bind(console),console.warn.bind(console),t)):(N.d("Play ios in the same webview",e),window.location.replace(r)):n?(N.d("Play android second webview",e.path),window.webview.Show(r,console.log.bind(console),console.warn.bind(console),t)):(N.d("Play android same webview",e.path),window.navigator.app.loadUrl(encodeURI(r)))}function l(t){return N.d("_getIndexHtmlById",k.GAMES_DIR+t),e.readDir(k.GAMES_DIR+t).then(function(e){return N.d("_getIndexHtmlById readDir",e),e.filter(function(e){return w(e.path)})})}function d(e){N.d("_removeRemoteSDK");for(var t,n=e.querySelectorAll("script"),r=0;r<n.length;r++)if(-1!==n[r].src.indexOf("gfsdk")){t=n[r],N.d("_removeRemoteSDK",t),t.parentNode.removeChild(t);break}return e}function f(e,t){e=d(e);var n,r,i=!1===Array.isArray(t)?[t]:t;N.d("injectScripts",i);var o=document.createElement("meta");o.httpEquiv="Content-Security-Policy",o.content="default-src * data: content: cdvfile: file: http: https: gap: blob: https://ssl.gstatic.com 'unsafe-inline' 'unsafe-eval';style-src * cdvfile: http: https: 'unsafe-inline';",e.head.insertBefore(o,e.getElementsByTagName("meta")[0]);var a=e.createElement("script");a.id="__root__",e.head.insertBefore(a,e.head.firstElementChild);for(var s=e.createDocumentFragment(),c=0;c<i.length;c++)i[c].endsWith(".css")?(N.d("css inject:",i[c]),r=e.createElement("link"),r.rel="stylesheet",r.href=i[c],e.head.insertBefore(r,e.getElementsByTagName("link")[0])):(n=e.createElement("script"),n.src=i[c],s.appendChild(n));return e.head.insertBefore(s,e.head.getElementsByTagName("script")[0]),N.d("Cleaned dom:",e),e}function p(e){var t=[];t.push(e.querySelector("link[href='/gmenu/frame.css']")),t.push(e.querySelector("iframe#menu")),t.push(e.querySelector("script[src='/gmenu/toggle.js']"));for(var n=e.querySelectorAll("script"),r=n.length-1;r>=0;r--)if(-1!==n[r].innerHTML.indexOf("function open")){t.push(n[r]);break}for(var i=0;i<t.length;i++)t[i]&&t[i].parentNode.removeChild(t[i]);return e}function g(t,n){var r;return l(t).then(function(t){return r=t[0].path,N.d("injectScripts",r),e.readFileAsHTML(t[0].path)}).then(function(e){function t(t){e.head.appendChild(t)}var r=e.querySelector("meta[name=viewport]");r&&(r.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui");var i=e.body.querySelectorAll("meta"),o=e.body.querySelectorAll("link"),a=e.body.querySelectorAll("style"),s=e.body.querySelectorAll("title");return i=[].slice.call(i),o=[].slice.call(o),a=[].slice.call(a),s=[].slice.call(s),i.concat(o).concat(a).concat(s).map(t),e.body.innerHTML=e.body.innerHTML.trim(),N.d("_injectScripts"),N.d(e),f(e,n)}).then(p).then(function(e){var t=[].slice.call(e.querySelector("html").attributes),n=t.map(function(e){return e.name+'="'+e.value+'"'}).join(" "),r="<!DOCTYPE html><html "+n+">"+e.documentElement.innerHTML+"</html>";return N.d("Serialized dom",r),r}).then(function(t){return N.d("Write dom:",r,t),e.write(r,t)})}function w(e){return new RegExp(/.*\.html?$/i).test(e)}function h(n){var r=n.url.replace("[WSIZE]",n.size.width).replace("[HSIZE]",n.size.height).split("?")[0],i=k.GAMES_DIR+n.gameId,o=n.type+"_"+n.size.width+"x"+n.size.height+("_"+n.size.ratio||"")+".jpeg";return N.d("request Image to",r,"coverImageUrl",o,"imagesFolder",i),"xhr"===n.method?Promise.all([e.createFile(i,o),t.getImageRaw({url:r})]).then(function(t){var n=t[0],r=t[1];return e.appendToFile(n.path,r,!0,"image/jpeg")}):new e.download(r,i,o,function(){}).promise}function m(){return N.i("readUserJson",k.BASE_DIR+"user.json"),e.readFileAsJSON(k.BASE_DIR+"user.json")}function v(e){return m().then(function(t){if(!t.ponyUrl)throw N.w("ponyUrl in user check undefined!",t.ponyUrl),new Error("Not premium user");var n=t.ponyUrl.split("&_PONY=")[1];N.d("PONYVALUE",n);var r=D(L.gamifive_info_api,{content_id:e,format:"jsonp"});return r+=t.ponyUrl,N.d("Call game_info api: ",r),new R(r).prom}).then(function(t){if(403===t.status||200!==t.status)throw new Error("Error retrieving game_info",t);return N.d("Save game_Info: ","OK"),y({content_id:e,gamifive_info:t.game_info})})}function y(t){return e.readFileAsJSON(k.BASE_DIR+"offlineData.json").then(function(e){return e.GamifiveInfo[t.content_id]=t.gamifive_info,e}).then(function(t){return N.d("writing offlineData.json",t),e.write(k.BASE_DIR+"offlineData.json",JSON.stringify(t))})}var b,S,A,_,P,I,E=t.Logger,D=t.composeApiString,R=t.jsonpRequest,O=t.extend,k={},L={sdk_url:"",dixie_url:"",api:"",ga_for_game_url:"",gamifive_info_api:"",bundle_games:[]},C=!1,T={GaForGame:{},GamifiveInfo:{},queues:{}},j={content_id:"",formats:"html5applications",sort:"-born_date",category:"b940b384ff0565b06dde433e05dc3c93",publisher:"",size:6,offset:0,label:"",label_slug:"",access_type:"",real_customer_id:"xx_gameasy",lang:"en",use_cs_id:"",white_label:"xx_gameasy",main_domain:"http://www2.gameasy.com/ww",fw:"gameasy",vh:"ww.gameasy.com",check_compatibility_header:0},N=new E("ALL","[Game - module]",{background:"black",color:"#5aa73a"});r.prototype.download=function(t,n){function r(e){return function(t){var n=Math.round(t.loaded/t.total*100);c({percentage:n,type:e})}}function i(){u({type:"download"});var n=e.requestFileSystem(1,m);return N.d("Get GameInfo, fly my minipony!"),n.then(function(e){return N.i("Space is ok, can download:",m,e),v(y)}).then(function(n){return N.d("Ga for game and gamifive info stored!",n),N.d("Start Download:",t.id,t.response_api_dld.binary_url),new e.download(t.response_api_dld.binary_url,k.TEMP_DIR,y+".zip",r("download")).promise}).then(function(n){return u({type:"unzip"}),N.d("unzip:",t.id,k.TEMP_DIR+y),e._promiseZip(n.path,k.TEMP_DIR+y,r("unzip"))}).then(function(n){N.d("Unzip ended",n),l({type:"unzip"});var r=t.response_api_dld.url_download,i=r.substring(r.lastIndexOf("game"),r.length).split("/"),o=r.split("/"),a=o.slice(o.lastIndexOf("game"),o.length);i=[];for(var s=0;s<a.length;s++)"game"===a[s]||w(a[s])||i.push(a[s]);N.d("Folders before index",i),i.unshift(y);var c=k.TEMP_DIR+i.join("/");return N.d("Folders on disk",c),N.d("Copy game folder in games/",c,k.GAMES_DIR+y),e.moveDir(c,k.GAMES_DIR+y)}).then(function(t){return N.d("Remove zip from:",k.TEMP_DIR+y+".zip","last operation result",t),e.removeFile(k.TEMP_DIR+y+".zip")}).then(function(){return N.d("Save meta.json for:",t.id),h({gameId:t.id,size:{width:"500",height:"500",ratio:"1"},url:t.images.cover.ratio_1,type:"cover",method:"xhr"})}).then(function(n){return N.d("Save meta.json for:",t.id),N.d("Download image result",n),t.images.cover.ratio_1=n.internalURL,e.createFile(k.GAMES_DIR+y,"meta.json").then(function(n){return e.write(n.path,JSON.stringify(t))})}).then(function(e){return N.d("result last operation:save meta.json",e),N.d("InjectScripts in game:",t.id,_),g(t.id,[k.SDK_RELATIVE_DIR+"gamesFixes.js",k.GAMEOVER_RELATIVE_DIR+"gameover.css",k.SDK_RELATIVE_DIR+"cordova.js",k.SDK_RELATIVE_DIR+"cordova_plugins.js",k.SDK_RELATIVE_DIR+"newton.min.js",k.SDK_RELATIVE_DIR+"gfsdk.min.js"])}).then(function(e){return N.d("injectScripts result",e),l({type:"download"}),C=!1,t.id}).catch(function(e){throw N.e(e,"Cleaning...game not downloaded",t.id),C=!1,o.remove(t.id),l({type:"error",description:e}),e})}var o=this;t=JSON.parse(JSON.stringify(t));var a;if(this.isDownloading())return a={type:"error",description:"AlreadyDownloading"},n.onEnd(a),Promise.reject(a);if(!t.hasOwnProperty("response_api_dld")||200!==t.response_api_dld.status)return a={type:"error",description:"response_api_dld.status not equal 200 or undefined"},n.onEnd(a),Promise.reject(a);var s=this.isGameDownloaded(t.id);n=n||{};var c=n.onProgress?n.onProgress:function(){},u=n.onStart?n.onStart:function(){},l=n.onEnd?n.onEnd:function(){},d=t.size.replace("KB","").replace("MB","").replace(",",".").trim(),f={KB:1,MB:2,GB:3,TB:5},p=t.size.indexOf("MB")>-1,m=d*Math.pow(1024,p?f.MB:f.KB),y=t.id;return s.then(function(e){return N.d("Exists",e),e?(C=!1,Promise.reject({12:"AlreadyExists",gameID:t.id})):(C=!0,i())})},r.prototype.play=function(t){N.d("Play",t);var n=k.GAMES_DIR+t;return e.readDir(n).then(function(e){return e.filter(function(e){return w(e.path)})}).then(function(e){u(e[0],!1)})},r.prototype.remove=function(t){N.d("Removing game",t);var n=e.dirExists(k.CACHE_DIR+t+".zip"),r=e.dirExists(k.GAMES_DIR+t);return Promise.all([n,r]).then(function(n){var r=[];return n[0]&&(N.d("Removed in cache",n[0]),r.push(e.removeFile(k.CACHE_DIR+t+".zip"))),n[1]&&(N.d("Removed",n[1]),r.push(e.removeDir(k.GAMES_DIR+t))),0===r.length&&N.i("Nothing to remove",r),r})},r.prototype.isDownloading=function(){return C},r.prototype.abortDownload=function(){return this.isDownloading()?(N.d("Abort last download"),e.currentFileTransfer&&(e.currentFileTransfer.abort(),e.currentFileTransfer=null,C=!1),!0):(N.w("There's not a download operation to abort"),!1)},r.prototype.list=function(){return N.d("Get games list"),e.readDir(k.GAMES_DIR).then(function(e){return(Array.isArray(e)?e:[e]).filter(function(e){if(e.isDirectory)return e})}).then(function(t){var n=t.map(function(t){return e.readFileAsJSON(t.path+"meta.json")});return Promise.all(n).then(function(e){return e})})},r.prototype.buildGameOver=function(t){var n=k.GAMES_DIR+t.content_id+"/meta.json";return t.hasOwnProperty("content_id")?(N.d("Read meta.json:",n),N.d("GAMEOVER_TEMPLATE path",k.GAMEOVER_DIR+"gameover.html"),Promise.all([e.readFileAsJSON(n),e.readFile(k.GAMEOVER_DIR+"gameover.html")]).then(function(e){var n=e[1],r=e[0];return N.i("Meta JSON:",r),n.replace("{{score}}",t.score).replace("{{game_title}}",r.title).replace("{{game_title}}",r.title).replace("{{url_share}}",r.url_share).replace("{{url_cover}}",r.images.cover.ratio_1)})):Promise.reject("Missing content_id key!")},r.prototype.isGameDownloaded=function(t){return e.dirExists(k.GAMES_DIR+t)},r.prototype.removeAll=function(){return e.removeDir(k.GAMES_DIR).then(function(t){return N.d("All games deleted!",t),e.createDir(k.BASE_DIR,"games")})},r.prototype.getBundleGameObjects=function(){var e=this;if(L.bundle_games.length>0){N.d("Games bundle in configuration",L.bundle_games);var t,n=L.bundle_games.map(function(t){return e.isGameDownloaded(t)}),r=Promise.all(n).then(function(e){N.d("alreadyDownloaded",e);for(var t=0;t<e.length;t++)e[t]&&L.bundle_games.splice(t,1);return L.bundle_games}).then(function(e){return e.join(",")});return r.then(function(e){j.content_id=e;var t=D(L.api,j);return N.d("Request bundle games meta info:",t),new R(t).prom}).then(function(e){N.d("Games bundle response:",e),t=e;var n=e.map(function(e){return new R(e.url_api_dld).prom});return N.d("jsonpRequests",n),Promise.all(n)}).then(function(e){N.d("RESULTS",e);for(var n=0;n<e.length;n++)t[n].response_api_dld=e[n];return N.d("GameObjects",t),t}).catch(function(e){N.e("Games bundle meta fail:",e)})}return N.w("Bundle_games array is empty!"),Promise.reject("bundle_games array is empty!")},r.prototype.needsUpdate=function(n){var r="";return e.readFileAsJSON(k.GAMES_DIR+n+"/meta.json").then(function(e){return r=e.response_api_dld.binary_md5,t.getJSON(e.url_api_dld)}).then(function(e){if(200===e.status)return e.binary_md5!==r;throw new Error("ResponseStatus "+e.status)})};var U={};n.game={},U.initialize=i,n.game._protected=U,n.game._public=new r}(s.file,s.Utils,s),function(e){"use strict";function t(){this.events={}}t.prototype.on=function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)},t.prototype.trigger=function(e,t){!this.events[e]||this.events[e]<1||this.events[e].map(function(e){e.call(null,t||{})})},t.prototype.remove=function(e,t){if(this.events[e]){var n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}},e.EventBus=t}(s),function(e){function t(e,t,n,r,i){return function(){if("function"==typeof e&&(e=e.call(null)),e)return t.apply(n||null,arguments);switch(r=r||"NoMessage",i){case"warn":console.warn(r);break;case"error":console.error(r);break;case"info":console.info(r);break;default:console.log(r)}}}e.Decorators={requireCondition:t}}(s),function(e,t,n){function r(){this.LOG=new e.Logger("OFF","ADMANAGER")}function i(e,t){return e.some(function(e){return t===e})}function o(){return"undefined"!==window.admob}/(android)/i.test(navigator.userAgent)||/(ipod|iphone|ipad)/i.test(navigator.userAgent);var a,s=["ios","android"];r.prototype.initialize=function(t){return a=window.device.platform.toLowerCase(),i(s,a)?(this.AD_TYPE=window.admob.AD_TYPE,this.AD_SIZE=window.admob.AD_SIZE,this.LOG=new e.Logger("all","[AdManager]"),this.LOG.i("initialize admob with",a,t[a]),this.setOptions(t[a]),Promise.resolve("OK")):Promise.reject([a,"Unsupported"].join(" "))},r.prototype.createBanner=function(t){this.LOG.i("createBanner");var n=this;return t=e.extend(n.options,t||{}),new Promise(function(e,n){window.admob.createBannerView(t,e,n)})},r.prototype.removeBanner=function(){return window.admob.destroyBannerView(),Promise.resolve("OK")},r.prototype.showBanner=function(){return new Promise(function(e,t){window.admob.showBannerAd(!0,e,t)})},r.prototype.showBannerAtGivenXY=function(){this.LOG.d("NotImplemented")},r.prototype.showBannerAtSelectedPosition=function(){this.LOG.d("NotImplemented")},r.prototype.hideBanner=function(){return new Promise(function(e,t){window.admob.showBannerAd(!1,e,t)})},r.prototype.prepareInterstitial=function(t){var n=this;return new Promise(function(r,i){window.admob.requestInterstitialAd(e.extend(n.options,t||{}),r,i)})},r.prototype.showInterstitial=function(){return new Promise(function(e,t){window.admob.showInterstitialAd(e,t)})},r.prototype.registerAdEvents=function(e){this.LOG.d("NotImplemented",e)},r.prototype.setOptions=function(e){this.options=e||{},window.admob.setOptions(e||{})};for(var c in r.prototype)r.prototype.hasOwnProperty(c)&&(r.prototype[c]=t.requireCondition(o,r.prototype[c],r.prototype,"try cordova plugin add cordova-admob:plugin not installed","warn"));n.AdManager=new r}(s.Utils,s.Decorators,s);var c=function(){var e={},t=!1;e.init=function(){if(H.hasOwnProperty("webappsfixes")&&"object"==typeof H.webappsfixes){t=!0;for(var e in H.webappsfixes)if(H.webappsfixes.hasOwnProperty(e))if(n.hasOwnProperty(e)&&"function"==typeof n[e]){h("[webappsFixes] applying fix: "+e);var r=n[e](H.webappsfixes[e]);r&&m("[webappsFixes] fix '"+e+"' failed: "+r)}else m("[webappsFixes] fix implementation not found for: "+e)}return t};var n={};return n.gamifiveSearchBox=function(e){if(!window.cordova||!window.cordova.plugins||!window.cordova.plugins.Keyboard)return"missing ionic-plugin-keyboard";if(e.platforms){if(S()&&!e.platforms.ios)return void h("[webappsFixes] [gamifiveSearchBox] fix disabled on iOS");if(b()&&!e.platforms.android)return void h("[webappsFixes] [gamifiveSearchBox] fix disabled on Android")}return window.addEventListener("native.keyboardshow",function(){setTimeout(function(){0===document.querySelectorAll("input:focus").length&&(h("[webappsFixes] [gamifiveSearchBox] keyboard show on null input: hiding"),cordova.plugins.Keyboard.close())},1)},!1),h("[webappsFixes] [gamifiveSearchBox] listening on event native.keyboardshow"),""},e}();s.statusbar=function(){var e={};return e.initialize=function(e){if(void 0===window.StatusBar)return m("[StatusBar] missing cordova plugin");if(!e||e.constructor!==Object||0===Object.keys(e).length){if(!H.statusbar)return;e=H.statusbar}if(void 0!==e.hideOnUrlPattern&&e.hideOnUrlPattern.constructor===Array){for(var t=document.location.href,n=!1,r=0;r<e.hideOnUrlPattern.length;r++){if(new RegExp(e.hideOnUrlPattern[r]).test(t)){n=!0;break}}n?window.StatusBar.hide():window.StatusBar.show()}e.color&&window.StatusBar.backgroundColorByHexString(e.color)},e.setVisibility=function(e,t,n){return void 0===window.StatusBar?(m("[StatusBar] missing cordova plugin"),n("missing cordova plugin")):e?(window.StatusBar.show(),t("statusbar shown")):(window.StatusBar.hide(),t("statusbar hided"))},e}(),a.setStatusbarVisibility=function(e,t,n){return I?E?s.statusbar.setVisibility(e,t,n):(n("Stargate closed, wait for Stargate.initialize to complete!"),!1):n("Stargate not initialized, call Stargate.initialize first!")},window.pubKey="",window.forge="",a.conf={},a.conf.getWebappStartUrl=function(){return I?u(H.webapp_start_url):m("Stargate not initialized, call Stargate.initialize first!")};var u=function(e,t){var n=URI(e).addSearch("hybrid","1").addSearch("stargateVersion",l());if(t&&"object"==typeof t)for(var r in t)t.hasOwnProperty(r)&&n.addSearch(r,t[r]);return String(n)},l=function(){return H.stargate_version_to_load?H.stargate_version_to_load:(v("getStargateVersionToLoad() stargate_version_to_load must be set on manifest!"),g)};a.conf.getWebappOrigin=function(){var e=/http:\/\/[\w]{3,4}\..*\.[\w]{2,}/;return void 0===H.webapp_start_url?(h("Stargate is initialized? Please call this method after it"),""):e.exec(H.webapp_start_url)[0]},a.conf.getManifestValue=function(e){return I?H[e]:m("Stargate not initialized, call Stargate.initialize first!")};var d;a.initialize=function(e,t,n,r){return"function"==typeof t&&void 0===n&&void 0===r&&(r=t),void 0===r&&(h("Callback success not setted. \n You can use 'then'"),r=function(){}),"function"!=typeof r?(v("Stargate.initialize() callback is not a function!"),Promise.reject(new Error("Stargate.initialize() callback is not a function!"))):(P=q(),I?(v("Stargate.initialize() already called, executing callback."),r&&r(P),d):("object"!=typeof e&&(e={}),e.hybrid_conf&&(j="object"==typeof e.hybrid_conf?e.hybrid_conf:JSON.parse(decodeURIComponent(e.hybrid_conf))),e.modules?e.modules.constructor!==Array?m("initialize() configurations.modules is not an array"):N=e.modules:N=["mfp","iapbase","appsflyer","game"],e.modules_conf&&("object"!=typeof e.modules_conf?m("initialize() configurations.modules_conf is not an object"):U=e.modules_conf),e.country&&("mfp"in j?j.mfp.country=e.country:j.mfp={country:e.country}),P?(h("initialize() starting up, configuration: ",j),D=r,
d=new Promise(function(e,t){var n=function(){K(e,t),document.removeEventListener("deviceready",n,!1)};document.addEventListener("deviceready",n,!1)}),I=!0,d):(h("version 0.10.1 running outside hybrid "),r&&r(P),d=Promise.resolve(P),I=!0,d)))},a.isInitialized=function(){return I},a.isOpen=function(){return E},a.isHybrid=function(){return q()},a.openUrl=function(e){return I?E?window.cordova&&window.cordova.InAppBrowser&&window.cordova.InAppBrowser.open?(h("[openUrl] opening: "+e),window.open(e,"_system"),!0):(m("Missing cordova plugin InAppBrowser"),!1):(m("Stargate closed, wait for Stargate.initialize to complete!"),!1):m("Stargate not initialized, call Stargate.initialize first!")},a.googleLogin=function(e,t){if(!I)return t("Stargate not initialized, call Stargate.initialize first!");m("unimplemented"),t("unimplemented")};var f,p={type:"unknown",networkState:"unknown"};a.addListener=function(e,t){"connectionchange"==e&&"function"==typeof t&&(h("onConnectionChange registered"),f=t)},a.checkConnection=function(){var e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];return I?E?void 0===navigator.connection||"function"!=typeof navigator.connection.getInfo?(t("Missing cordova plugin"),console.warn("Cordova Network Information module missing"),!1):(e(p),p):(t("Stargate closed, wait for Stargate.initialize to complete!"),!1):(t("Stargate not initialized, call Stargate.initialize first!"),!1)},a.getDeviceID=function(e,t){return I?E?void e({deviceID:y.uuid}):(t("Stargate closed, wait for Stargate.initialize to complete!"),!1):t("Stargate not initialized, call Stargate.initialize first!")},a.goToLocalIndex=function(){if("undefined"!==window.cordova.file.applicationDirectory){r(window.cordova.file.applicationDirectory+"www/index.html"+"?hybrid=1")}else m("Missing cordova-plugin-file. Install it with: cordova plugin add cordova-plugin-file")},a.goToWebIndex=function(){var e=a.conf.getWebappStartUrl()+"";h("Redirect to",e),r(e)},a.getVersion=function(){return"0.10.1"},a.getAppInformation=function(){return M};var g="2",w=function(){for(var e=Array.prototype.slice.call(arguments),t="",n=0;n<e.length;n++)"object"==typeof e[n]?t+=" "+JSON.stringify(e[n]):t+=" "+e[n];return t},h=console.log.bind(window.console,"[Stargate] "),m=console.error.bind(window.console,"[Stargate] "),v=console.warn.bind(window.console,"[Stargate] ");h=function(){console.log("[I] [Stargate] "+w.apply(null,arguments))},m=function(){console.log("[E] [Stargate] "+w.apply(null,arguments))},v=function(){console.log("[W] [Stargate] "+w.apply(null,arguments))};var y={available:!1,cordova:"",manufacturer:"",model:"",platform:"",uuid:"",version:""},b=function(){return"Android"==y.platform},S=function(){return"iOS"==y.platform},A=function(){if(void 0===window.device)return m("Missing cordova device plugin");for(var e in y)window.device.hasOwnProperty(e)&&(y[e]=window.device[e]);return!0},_=function(e){h("launchUrl: "+e),document.location.href=e},P=!1,I=!1,E=!1,D=null,R="",O="",k="",L=!1,C=0,T={full:1,light:2,1:"full",2:"light"},j={},N=[],U={},M={cordova:null,manufacturer:null,model:null,platform:null,deviceId:null,version:null,packageVersion:null,packageName:null,packageBuild:null,stargate:null,stargateModules:null,stargateError:null},z=function(){window.Cookies.set("hybrid","1");var e=x();e&&window.Cookies.set("hybrid","1",{domain:e}),window.localStorage.getItem("hybrid")||window.localStorage.setItem("hybrid",1)},x=function(){var e=new RegExp(/(^https?:\/\/)(.*)/),t=e.exec(window.location.origin);return!!t&&t[t.length-1].split(".").filter(function(e){return!("www"===e||"www2"===e)}).join(".")},F=function(){var e=l();window.Cookies.set("stargateVersion",e);var t=x();t&&window.Cookies.set("stargateVersion",e,{domain:t}),window.localStorage.getItem("stargateVersion")||window.localStorage.setItem("stargateVersion",e)},B=function(){Z("leavesplash")||navigator.splashscreen.hide(),W(!1),"undefined"!=typeof SpinnerDialog&&SpinnerDialog.hide()},G=function(e){if(h("onPluginReady() start"),document.title=H.title,S()&&void 0!==window.cordova&&window.cordova.require){var n=window.cordova.require("cordova/exec");n.setJsToNativeBridgeMode&&n.jsToNativeModes&&n.jsToNativeModes.IFRAME_NAV&&n.setJsToNativeBridgeMode(n.jsToNativeModes.IFRAME_NAV)}if(t(),F(),X("mfp")&&Z("mfp")){var r=Y("mfp");["motime_apikey","namespace","label","country"].forEach(function(e){!r.hasOwnProperty(e)&&H.hasOwnProperty(e)&&(r[e]=H[e])}),ee.check(r)}X("deltadna")&&window.deltadna.startSDK(H.deltadna.environmentKey,H.deltadna.collectApi,H.deltadna.engageApi,se,ce,H.deltadna.settings),s.statusbar.initialize(Y("statusbar")),Z("iapbase")?(oe.initialize(Y("iapbase")),C=T.full):Z("iap")?(oe.initialize(Y("iap"))&&h("Init IAP done."),C=T.full):Z("iaplight")&&(ie.initialize(Y("iaplight")),C=T.light),X("appsflyer")&&Z("appsflyer")&&de.init(Y("appsflyer")),c.init(),le.initialize(),$.initialize();var i=[];Z("game")&&X("game")&&s.game&&i.push(s.game._protected.initialize(Y("game"))),Z("adv")&&s.AdManager&&i.push(s.AdManager.initialize(Y("adv"))),Z("globalization")&&i.push(ae.initialize()),Promise.all(i).then(function(){V(e)}).catch(function(t){m("onPluginReady() error: ",t),V(e,t)})},V=function(e,t){h("onStargateReady() start"),B(),E=!0,h("version 0.10.1 ready;  running in package version: "+R),M={cordova:y.cordova,manufacturer:y.manufacturer,model:y.model,platform:y.platform,deviceId:y.uuid,version:y.version,packageVersion:R,packageName:k,packageBuild:O,stargate:"0.10.1"},N&&N.constructor===Array&&(M.stargateModules=N.join(", ")),t&&t instanceof Error&&(M.stargateError=t.toString()),window.navigator&&window.navigator.connection&&window.navigator.connection.type&&(M.connectionType=window.navigator.connection.type),D(!0),h("Stargate.initialize() done"),e(!0)},K=function(e,t){h("onDeviceReady() start"),z(),A(),n(),Promise.all([cordova.getAppVersion.getVersionNumber(),o(),cordova.getAppVersion.getPackageName(),cordova.getAppVersion.getVersionCode(),i()]).then(function(t){R=t[0],"object"!=typeof t[1]&&(t[1]=JSON.parse(t[1])),k=t[2],O=t[3],t[4]&&"object"==typeof t[4]&&t[4].debug&&(L=!0),H=t[1].stargateConf,G(e)}).catch(function(e){m("onDeviceReady() error: "+e),t("onDeviceReady() error: "+e)})},q=function(){return J(document.location.href)},J=function(e){var t=window.URI(e),n=t.protocol();return"file"===n||"cdvfile"===n||(!!t.hasQuery("hybrid")||(!!window.Cookies.get("hybrid")||(!!window.localStorage.getItem("hybrid")||null!==window.navigator.userAgent.match(/Crosswalk\//)&&(v("Activated isHybrid from Crosswalk UA"),!0))))},W=function(e){e?ne():re()},H={features:{}},Y=function(e){if(!e)return m("getModuleConf() invalid module requested");if(e in U)return U[e];var t={iapbase:"IAP",iap:"IAP"},n=e;return t[e]&&(n=t[e]),j&&n in j?j[n]:(h("getModuleConf(): no configuration for module: "+e+" ("+t+")"),{})},X=function(e){return void 0!==H.features[e]&&H.features[e]},Z=function(e){return!(!N||N.constructor!==Array)&&N.indexOf(e)>-1},Q=function(){var e={},t=function(e){var t=["message","subject","files","chooserTitle"],n={url:e.url};return t.forEach(function(t){t in e&&(n[t]=e[t])}),n},n=function(e){if(S()){if("facebook"===e)return"com.apple.social.facebook";if("twitter"===e)return"com.apple.social.twitter"}return e},r=function(e,n,r){var i=t(e),o=function(e){h("[share] Share completed? "+e.completed),h("[share] Shared to app: "+e.app),n(e)},a=function(e){m("[share] Sharing failed with message: "+e),r(e)};window.plugins.socialsharing.shareWithOptions(i,o,a)},i=function(e,t,n){var r=function(e){h("[share] Facebook share completed, result: ",e),t(e)},i=function(e){m("[share] Facebook sharing failed with message: "+e),n(e)};window.plugins.socialsharing.shareViaFacebook("",null,e.url,r,i)},o=function(e,t,n){var r=function(e){h("[share] Twitter share completed, result: ",e),t(e)},i=function(e){m("[share] Twitter sharing failed with message: "+e),n(e)},o="";"message"in e&&(o=e.message),window.plugins.socialsharing.shareViaTwitter(o,null,e.url,r,i)},a=function(e,t,n){var r=function(e){h("[share] Whatsapp share completed, result: ",e),t(e)},i=function(e){m("[share] Whatsapp sharing failed with message: "+e),n(e)},o="";"message"in e&&(o=e.message),window.plugins.socialsharing.shareViaWhatsApp(o,null,e.url,r,i)};return e.canShareVia=function(e,t){var r=n(e);return new Promise(function(n){window.plugins.socialsharing.canShareVia(r,null,null,null,t,function(t){h("[share] canShareVia "+e+" ("+r+") result true: ",t),n({network:e,available:!0})},function(t){h("[share] canShareVia "+e+" ("+r+") result false: ",t),n({network:e,available:!1})})})},e.socialShare=function(e,t,n){return"object"!=typeof e&&(e={},v("[share] parameter options must be object!")),e.type||(e.type="chooser"),window.plugins&&window.plugins.socialsharing?e.url?(h("[share] Sharing url: "+e.url+" on: "+e.type,e),"chooser"==e.type?r(e,t,n):"facebook"==e.type?i(e,t,n):"twitter"==e.type?o(e,t,n):"whatsapp"==e.type?a(e,t,n):(m("[share] type not valid"),n("type not valid"))):(m("[share] missing parameter url"),n("missing parameter url")):(m("[share] missing cordova plugin"),n("missing cordova plugin"))},e}();a.socialShare=function(e){return I?E?new Promise(function(t,n){Q.socialShare(e,t,n)}):Promise.reject("Stargate closed, wait for Stargate.initialize to complete!"):Promise.reject("Stargate not initialized, call Stargate.initialize first!")},a.socialShareAvailable=function(e){return I?E?window.plugins&&window.plugins.socialsharing?e.socials&&"object"==typeof e.socials?e.url?new Promise(function(t,n){var r=[];["facebook","whatsapp","twitter","instagram"].forEach(function(t){e.socials[t]&&r.push(Q.canShareVia(t,e.url))}),Promise.all(r).then(function(e){var n={};e.forEach(function(e){n[e.network]=e.available}),t(n)},function(e){m(e),n(e)})}):(m("[share] missing parameter url"),Promise.reject("missing parameter url")):(m("[share] missing object parameter socials"),Promise.reject("missing object parameter socials")):(m("[share] missing cordova plugin"),Promise.reject("missing cordova plugin")):Promise.reject("Stargate closed, wait for Stargate.initialize to complete!"):Promise.reject("Stargate not initialized, call Stargate.initialize first!")};var $=function(){var e=["fc5413366b9d3f40","188b6b1d46296303"],t={},n=null,r=function(){g().then(function(e){p&&p.type&&"online"===p.type?(h("[push] going to url: ",e),_(e)):m("[push] i'm offline not going to url")}).catch(function(e){m("[push] error reading url: "+e)})},i=function(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.notification&&window.cordova.plugins.notification.local},o=[],a=!1,c=!1,l=function(){c||i()&&(c=!0,window.cordova.plugins.notification.local.on("click",function(e){a?r():o.push(e)}))},d=function(){if(window.cordova){var e=window.cordova.require("cordova/channel");2===e.onPluginsReady.state?l():e.onPluginsReady.subscribe(function(){l()})}};d();var f=function(){var e=window.cordova.file.applicationStorageDirectory;return S()&&(e+="Documents/"),e},g=function(){return s.file.fileExists(f()+"SGpushUrl").then(function(e){return e?s.file.readFileAsJSON(f()+"SGpushUrl").then(function(e){return e.url}):Promise.reject("file not found")})},w=function(e){var t={url:u(e,{source:"localpush"})};return s.file.createFile(f(),"SGpushUrl").then(function(e){return h("[push] writing offline data",t,"in: ",e.path),s.file.write(e.path,JSON.stringify(t))}).catch(function(e){m("[push] error sg create SGpushUrl file",e)})},b=function(){var t=y.uuid;return e.indexOf(t)>-1};t.initialize=function(){return i()?null!==n?n:n=new Promise(function(e){for(c||d();o.length>0;){var t=o.pop();h("[push] processing queued event: ",t),r()}a=!0,e()}):Promise.reject(" not available, missing cordova plugin.")},t.setScheduledNotify=function(e){if(null===n)return Promise.reject("Not initialized");if("object"!=typeof e)return Promise.reject("[push] params must be an object");for(var t=["title","text","date","deeplink"],r=0;r<t.length;r++)if(!e[t[r]])return Promise.reject("[push] params."+t[r]+" required!");b()&&(v("[push] overriding push schedulation for test device"),e.date=(new Date).getTime()+12e4);var i=function(){return w(e.deeplink).then(function(){return window.cordova.plugins.notification.local.schedule({id:1,title:e.title,text:e.text,at:e.date,icon:"res://icon",smallIcon:"res://ic_notification"}),!0})};return n.then(i)};var A=function(e){return function(){return I?E?e.apply(null,arguments):Promise.reject("Stargate closed, wait for Stargate.initialize to complete!"):Promise.reject("Stargate not initialized, call Stargate.initialize first!")}};return t.public={initialize:A(t.initialize),setScheduledNotify:A(t.setScheduledNotify)},t.__clean__=function(){n=null},t}();a.push=$.public;var ee=function(){var e={};return e.check=function(t){["motime_apikey","namespace","label","country"].forEach(function(e){return t.hasOwnProperty(e)?t[e]?void 0:m("[MFP] Configuration: '"+e+"' not valid!"):m("[MFP] Configuration '"+e+"' not defined!")}),e.get(t)},e.getContents=function(e,t,n,r){var i={};return i.api_country=n,i.country=e,i.fpnamespace=t,r&&(i.extData=r),JSON.stringify(i)},e.getPonyValue=function(e){try{return-1===e.indexOf("=")?e:e.split("=")[1]}catch(e){m(e)}return""},e.setSession=function(t,n){var r,i=a.conf.getWebappStartUrl();r=n?new URI(n):new URI(i),n||(n=i);var o=r.hostname(),s=URITemplate(H.api.mfpSetUriTemplate).expand({protocol:r.protocol(),hostname:o,url:n,domain:o,_PONY:e.getPonyValue(t),hybrid:"1",stargateVersion:l()});h("[MobileFingerPrint] going to url: ",s),_(s)},e.get=function(t){var n=URITemplate(H.api.mfpGetUriTemplate).expand({apikey:t.motime_apikey,contents_inapp:e.getContents(t.country,t.namespace,t.label),country:t.country,expire:""});window.aja().url(n).type("jsonp").on("success",function(n){h("[MobileFingerPrint] get() response: ",n);var r="";if(n.content.inappInfo){var i,o=JSON.parse(n.content.inappInfo);if(o.extData&&(o.extData.ponyUrl&&(r=o.extData.ponyUrl),o.extData.return_url&&(i=o.extData.return_url),o.extData.session_mfp&&fe.track({page:"hybrid_initialize",action:"MFP_get",session_mfp:o.extData.session_mfp})),t.cbOnMfpOkPreSession&&"function"==typeof t.cbOnMfpOkPreSession){(0,t.cbOnMfpOkPreSession)()}e.setSession(r,i)}else if(h("[MobileFingerPrint] get(): Empty session"),t.cbOnMfpEmptySession&&"function"==typeof t.cbOnMfpEmptySession){var a=t.cbOnMfpEmptySession;a()}}).on("error",function(e){m("[MobileFingerPrint] get() error: ",e)}).go()},{setSession:e.setSession,check:e.check}}(),te=function(){"use strict";function e(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function t(e,t){return e<<t|e>>>32-t}function n(n,r,i,o,a,s){return e(t(e(e(r,n),e(o,s)),a),i)}function r(e,t,r,i,o,a,s){return n(t&r|~t&i,e,t,o,a,s)}function i(e,t,r,i,o,a,s){return n(t&i|r&~i,e,t,o,a,s)}function o(e,t,r,i,o,a,s){return n(t^r^i,e,t,o,a,s)}function a(e,t,r,i,o,a,s){return n(r^(t|~i),e,t,o,a,s)}function s(t,n){t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;var s,c,u,l,d,f=1732584193,p=-271733879,g=-1732584194,w=271733878;for(s=0;s<t.length;s+=16)c=f,u=p,l=g,d=w,f=r(f,p,g,w,t[s],7,-680876936),w=r(w,f,p,g,t[s+1],12,-389564586),g=r(g,w,f,p,t[s+2],17,606105819),p=r(p,g,w,f,t[s+3],22,-1044525330),f=r(f,p,g,w,t[s+4],7,-176418897),w=r(w,f,p,g,t[s+5],12,1200080426),g=r(g,w,f,p,t[s+6],17,-1473231341),p=r(p,g,w,f,t[s+7],22,-45705983),f=r(f,p,g,w,t[s+8],7,1770035416),w=r(w,f,p,g,t[s+9],12,-1958414417),g=r(g,w,f,p,t[s+10],17,-42063),p=r(p,g,w,f,t[s+11],22,-1990404162),f=r(f,p,g,w,t[s+12],7,1804603682),w=r(w,f,p,g,t[s+13],12,-40341101),g=r(g,w,f,p,t[s+14],17,-1502002290),p=r(p,g,w,f,t[s+15],22,1236535329),f=i(f,p,g,w,t[s+1],5,-165796510),w=i(w,f,p,g,t[s+6],9,-1069501632),g=i(g,w,f,p,t[s+11],14,643717713),p=i(p,g,w,f,t[s],20,-373897302),f=i(f,p,g,w,t[s+5],5,-701558691),w=i(w,f,p,g,t[s+10],9,38016083),g=i(g,w,f,p,t[s+15],14,-660478335),p=i(p,g,w,f,t[s+4],20,-405537848),f=i(f,p,g,w,t[s+9],5,568446438),w=i(w,f,p,g,t[s+14],9,-1019803690),g=i(g,w,f,p,t[s+3],14,-187363961),p=i(p,g,w,f,t[s+8],20,1163531501),f=i(f,p,g,w,t[s+13],5,-1444681467),w=i(w,f,p,g,t[s+2],9,-51403784),g=i(g,w,f,p,t[s+7],14,1735328473),p=i(p,g,w,f,t[s+12],20,-1926607734),f=o(f,p,g,w,t[s+5],4,-378558),w=o(w,f,p,g,t[s+8],11,-2022574463),g=o(g,w,f,p,t[s+11],16,1839030562),p=o(p,g,w,f,t[s+14],23,-35309556),f=o(f,p,g,w,t[s+1],4,-1530992060),w=o(w,f,p,g,t[s+4],11,1272893353),g=o(g,w,f,p,t[s+7],16,-155497632),p=o(p,g,w,f,t[s+10],23,-1094730640),f=o(f,p,g,w,t[s+13],4,681279174),w=o(w,f,p,g,t[s],11,-358537222),g=o(g,w,f,p,t[s+3],16,-722521979),p=o(p,g,w,f,t[s+6],23,76029189),f=o(f,p,g,w,t[s+9],4,-640364487),w=o(w,f,p,g,t[s+12],11,-421815835),g=o(g,w,f,p,t[s+15],16,530742520),p=o(p,g,w,f,t[s+2],23,-995338651),f=a(f,p,g,w,t[s],6,-198630844),w=a(w,f,p,g,t[s+7],10,1126891415),g=a(g,w,f,p,t[s+14],15,-1416354905),p=a(p,g,w,f,t[s+5],21,-57434055),f=a(f,p,g,w,t[s+12],6,1700485571),w=a(w,f,p,g,t[s+3],10,-1894986606),g=a(g,w,f,p,t[s+10],15,-1051523),p=a(p,g,w,f,t[s+1],21,-2054922799),f=a(f,p,g,w,t[s+8],6,1873313359),w=a(w,f,p,g,t[s+15],10,-30611744),g=a(g,w,f,p,t[s+6],15,-1560198380),p=a(p,g,w,f,t[s+13],21,1309151649),f=a(f,p,g,w,t[s+4],6,-145523070),w=a(w,f,p,g,t[s+11],10,-1120210379),g=a(g,w,f,p,t[s+2],15,718787259),p=a(p,g,w,f,t[s+9],21,-343485551),f=e(f,c),p=e(p,u),g=e(g,l),w=e(w,d);return[f,p,g,w]}function c(e){var t,n="";for(t=0;t<32*e.length;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function u(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;for(t=0;t<8*e.length;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function l(e){return c(s(u(e),8*e.length))}function d(e,t){var n,r,i=u(e),o=[],a=[];for(o[15]=a[15]=void 0,i.length>16&&(i=s(i,8*e.length)),n=0;n<16;n+=1)o[n]=909522486^i[n],a[n]=1549556828^i[n];return r=s(o.concat(u(t)),512+8*t.length),c(s(a.concat(r),640))}function f(e){var t,n,r="0123456789abcdef",i="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),i+=r.charAt(t>>>4&15)+r.charAt(15&t);return i}function p(e){return unescape(encodeURIComponent(e))}function g(e){return l(p(e))}function w(e){return f(g(e))}function h(e,t){return d(p(e),p(t))}function m(e,t){return f(h(e,t))}function v(e,t,n){return t?n?h(t,e):m(t,e):n?g(e):w(e)}return v}(),ne=function(e){if(void 0===window.SpinnerDialog)return m("startLoading(): SpinnerDialog cordova plugin missing!");"object"!=typeof e&&(e={});var t=null;return e.hasOwnProperty("message")&&(t=e.message),window.SpinnerDialog.show(null,t),!0},re=function(){return void 0===window.SpinnerDialog?m("startLoading(): SpinnerDialog cordova plugin missing!"):(window.SpinnerDialog.hide(),!0)};window.startLoading=ne,window.stopLoading=re,a.inAppPurchaseSubscription=function(e,t,n,r){return I?E?(W(!0),void 0!==r&&(oe.returnUrl=r),void 0!==n&&(oe.subscribeMethod=n),oe.callbackSuccess=e,oe.callbackError=t,oe.inappPurchaseCalled=!0,oe.lastCreateUserProduct&&oe.lastCreateUserToken?(oe.createUser(oe.lastCreateUserProduct,oe.lastCreateUserToken),!0):(oe.doRefresh(),window.store.order(oe.id),!0)):(t("Stargate closed, wait for Stargate.initialize to complete!"),!1):(t("Stargate not initialized, call Stargate.initialize first!"),!1)},a.inAppRestore=function(e,t,n,r){return I?E?(void 0!==n&&(oe.subscribeMethod=n),void 0!==r&&(oe.returnUrl=r),oe.callbackSuccess=e,oe.callbackError=t,oe.inappPurchaseCalled=!0,void oe.doRefresh(!0)):t("Stargate closed, wait for Stargate.initialize to complete!"):t("Stargate not initialized, call Stargate.initialize first!")},a.inAppProductInfo=function(e){if(e.productId||(e.productId=oe.id),"function"!=typeof e.callbackListingSuccess&&(e.callbackListingSuccess=function(){}),"function"!=typeof e.callbackPurchaseSuccess&&(e.callbackPurchaseSuccess=function(){}),"function"!=typeof e.callbackError&&(e.callbackError=function(){}),!e.subscriptionUrl)return m("[IAP] inAppProductInfo(): options.subscriptionUrl invalid"),!1;if(!I)return e.callbackError("Stargate not initialized, call Stargate.initialize first!"),!1;if(!E)return e.callbackError("Stargate closed, wait for Stargate.initialize to complete!"),!1;if(oe.subscribeMethod=e.subscriptionUrl,oe.requestedListingProductId=e.productId,oe.callbackListingSuccess=e.callbackListingSuccess,oe.callbackPurchaseSuccess=e.callbackPurchaseSuccess,oe.callbackListingError=e.callbackError,oe.inappProductInfoCalled=!0,oe.productsInfo[e.productId])try{oe.callbackListingSuccess(oe.productsInfo[e.productId])}catch(e){m("[IAP] inAppProductInfo(): error on callbackListingSuccess!")}return oe.lastCreateUserProduct&&oe.lastCreateUserToken?(oe.createUser(oe.lastCreateUserProduct,oe.lastCreateUserToken),!0):(oe.doRefresh(!0),!0)};var ie=function(){var e={},t=null,n=[],r=[];e.initialize=function(e){return window.inAppPurchase?null!==t?t:((e.productsIdAndroid||e.productsIdIos)&&(b()?n=e.productsIdAndroid:S()&&(n=e.productsIdIos)),n?n&&n.constructor!==Array?Promise.reject("parameter error, productsId(Android|Ios) must be an array"):0===n.length?Promise.reject("parameter error, productsId(Android|Ios) must contains at least a productid"):t=window.inAppPurchase.getProducts(n).then(function(e){return r=e,h("[IAPlight] getProducts ok",e),e}).catch(function(e){m("[IAPlight] getProducts KO",e)}):Promise.reject("missing parameter productsId(Android|Ios)")):Promise.reject("inAppPurchase not available, missing cordova plugin.")},e.subscribe=function(n){if(null===t)return Promise.reject("Not initialized");var r=function(){return window.inAppPurchase.subscribe(n).then(function(t){return h("[IAPlight] subscribe ok",t),S()?e.getActiveSubscriptionsInfo().then(function(e){return e[n]}):t}).catch(function(e){throw m("[IAPlight] subscribe KO: "+e,e),m})};return t.then(r)},e.getExpireDate=function(e){if(null===t)return Promise.reject("Not initialized");var n=function(){return window.inAppPurchase.getReceiptBundle().then(function(t){h("[IAPlight] getExpireDate getReceiptBundle ok",t);var n={};return t.inAppPurchases&&t.inAppPurchases.constructor===Array&&t.inAppPurchases.forEach(function(t){if(t.productId==e){if(!n.subscriptionExpirationDate)return void(n=t);if(new Date(n.subscriptionExpirationDate)<new Date(t.subscriptionExpirationDate))return void(n=t)}}),n}).then(function(e){if(!e.subscriptionExpirationDate)return null;h("[IAPlight] getExpireDate lastPurchase ok",e);var t=new Date(e.subscriptionExpirationDate);return"[object Date]"!==Object.prototype.toString.call(t)?(m("[IAPlight] getReceiptBundle invalid date: "+e.subscriptionExpirationDate+" Date.toString:"+t),null):isNaN(t.getTime())?null:t}).catch(function(e){throw m("[IAPlight] getReceiptBundle KO: "+e,e),m})};return t.then(n)},e.isSubscribed=function(n){if(null===t)return Promise.reject("Not initialized");var r=function(){return e.getActiveSubscriptionsInfo().then(function(e){return!!e[n]})};return t.then(r)},e.restore=function(){if(null===t)return Promise.reject("Not initialized");var e=function(){return window.inAppPurchase.restorePurchases().then(function(e){return h("[IAPlight] restore restorePurchases ok",e),e}).catch(function(e){m("[IAPlight] restore restorePurchases KO: "+e,e)})};return t.then(e)},e.getProductInfo=function(e){return null===t?Promise.reject("Not initialized"):t.then(function(){var t={};return r.forEach(function(n){n.productId==e&&(t=n)}),h("[IAPlight] getProductInfo(): product found:",t),t})};var i=function(e){var t=new Date(e);return"[object Date]"!==Object.prototype.toString.call(t)?(m("[IAPlight] isValidDateAndNotExpired() invalid date: "+e+" Date.toString:"+t),!1):!isNaN(t.getTime())&&(null!==t&&new Date<t)};e.getActiveSubscriptionsInfo=function(){if(null===t)return Promise.reject("Not initialized");var n=function(){return b()?e.restore().then(function(e){var t={};return e&&e.constructor===Array&&e.forEach(function(e){var n=JSON.parse(e.receipt);n.packageName==k&&0===n.purchaseState&&(t[e.productId]=n)}),t}):S()?window.inAppPurchase.getReceiptBundle().then(function(e){var t={};return h("[IAPlight] getActiveSubscriptionsInfo getReceiptBundle ok",e),e.inAppPurchases&&e.inAppPurchases.constructor===Array&&e.inAppPurchases.forEach(function(e){if(i(e.subscriptionExpirationDate)){if(!(e.productId in t))return void(t[e.productId]=e);if(new Date(t[e.productId].subscriptionExpirationDate)<new Date(e.subscriptionExpirationDate))return void(t[e.productId]=e)}}),t}).catch(function(e){throw m("[IAPlight] getReceiptBundle KO: "+e,e),m}):Promise.reject("Unsupported platform!")};return t.then(n)};var o=function(e){return function(){return I?E?e.apply(null,arguments):Promise.reject("Stargate closed, wait for Stargate.initialize to complete!"):Promise.reject("Stargate not initialized, call Stargate.initialize first!")}};return e.public={initialize:o(e.initialize),restore:o(e.restore),getProductInfo:o(e.getProductInfo),subscribe:o(e.subscribe),isSubscribed:o(e.isSubscribed),getActiveSubscriptionsInfo:o(e.getActiveSubscriptionsInfo)},e.__clean__=function(){t=null},e}();a.iaplight=ie.public;var oe={id:"",alias:"",type:"",verbosity:"",paymethod:"",subscribeMethod:"",returnUrl:"",callbackSuccess:function(){h("[IAP] Undefined callbackSuccess")},callbackError:function(){h("[IAP] Undefined callbackError")},callbackListingSuccess:function(){h("[IAP] Undefined callbackListingSuccess")},callbackListingError:function(){h("[IAP] Undefined callbackListingError")},callbackPurchaseSuccess:function(){h("[IAP] Undefined callbackPurchaseSuccess")},requestedListingProductId:"",inappPurchaseCalled:!1,inappProductInfoCalled:!1,lastCreateUserProduct:null,lastCreateUserToken:null,refreshDone:!1,lastCreateuserUrl:"",lastCreateuserData:"",createUserAttempt:0,maxCreateUserAttempt:6,refreshInProgress:!1,productsInfo:{},initialize:function(e){return window.store?(oe.returnUrl=document.location.href,e.id?oe.id=e.id:b()?oe.id=e.id_android:S()&&(oe.id=e.id_ios),oe.id?(e.alias&&(oe.alias=e.alias),e.type&&(oe.type=e.type),e.api_createuser&&(oe.subscribeMethod=e.api_createuser),oe.verbosity="INFO",oe.paymethod=b()?"gwallet":"itunes",h("IAP initialize id: "+oe.id),b()&&oe.getGoogleAccount(),window.store.verbosity=window.store[oe.verbosity],window.store.register({id:oe.id,alias:oe.alias,type:window.store[oe.type]}),window.store.when(oe.alias).approved(function(e){oe.onPurchaseApproved(e)}),window.store.when(oe.alias).verified(function(e){oe.onPurchaseVerified(e)}),window.store.when(oe.alias).updated(function(e){oe.onProductUpdate(e)}),window.store.when(oe.alias).owned(function(e){oe.onProductOwned(e)}),window.store.when(oe.alias).cancelled(function(e){oe.onCancelledProduct(e)}),window.store.when(oe.alias).error(function(e){oe.error(JSON.stringify(e))}),window.store.ready(function(){oe.onStoreReady()}),window.store.when("order "+oe.id).approved(function(e){oe.onOrderApproved(e)}),window.store.when("product").updated(function(e){oe.saveProductInfo(e)}),!0):(m("[IAP] Configuration error, missing product id!"),!1)):(m("[IAP] Store not available, missing cordova plugin."),!1)},saveProductInfo:function(e){return oe.refreshInProgress=!1,"object"!=typeof e?void m("[IAP] saveProductInfo() got invalid data"):"id"in e?(oe.productsInfo[e.id]=e,void(oe.requestedListingProductId===e.id&&oe.callbackListingSuccess(e))):void m("[IAP] saveProductInfo() got invalid data, id undefined")},doRefresh:function(e){oe.refreshInProgress&&v("[IAP] doRefresh() refresh in progress, skipping..."),oe.refreshDone&&!e||(window.store.refresh(),oe.refreshDone=!0,oe.refreshInProgress=!0,h("[IAP] doRefresh() refreshing..."))},getPassword:function(e){return te("iap."+e+".playme").substr(0,8)},getGoogleAccount:function(){window.accountmanager.getAccounts(oe.checkGoogleAccount,oe.error,"com.google")},checkGoogleAccount:function(e){if(e){h("[IAP] accounts"),h(e);for(var t in e)return window.localStorage.setItem("googleAccount",e[t].email),e[t].email}},onProductUpdate:function(e){h("IAP> Product updated."),h(JSON.stringify(e)),h(e.owned?"[IAP] Subscribed!":"[IAP] Not Subscribed")},onPurchaseApproved:function(e){h("IAP> Purchase approved."),h(JSON.stringify(e)),e.finish()},onPurchaseVerified:function(e){h("subscription verified ",e)},onStoreReady:function(){h("\\o/ STORE READY \\o/")},onProductOwned:function(e){if(h("[IAP] > Product Owned."),!e.transaction.id&&S())return m("[IAP] > no transaction id"),!1;if(window.localStorage.setItem("product",e),S()&&window.localStorage.setItem("transaction_id",e.transaction.id),b()){var t=e.transaction.purchaseToken+"|"+k+"|"+oe.id;h("[IAP] Purchase Token: "+t),window.localStorage.getItem("user_account")||oe.createUser(e,t)}else window.storekit.loadReceipts(function(t){window.localStorage.getItem("user_account")||(t.appStoreReceipt?(h("[IAP] appStoreReceipt: "+t.appStoreReceipt),oe.createUser(e,t.appStoreReceipt)):h("[IAP] appStoreReceipt empty, ignoring request"))})},onCancelledProduct:function(e){W(!1),oe.callbackError({iap_cancelled:1,return_url:oe.returnUrl}),h("[IAP] > Purchase cancelled ##################################",e)},onOrderApproved:function(e){h("[IAP] ORDER APPROVED "+oe.id),e.finish()},error:function(e){W(!1),m("[IAP] error: "+e),oe.callbackError({iap_error:1,return_url:oe.returnUrl})},getRandomEmail:function(){return"fake"+Math.floor(9e3*Math.random()+1e3).toString()+Date.now()+"@example.com"},createUser:function(e,t){if(h("[IAP] createUser start "),!oe.inappProductInfoCalled&&!oe.inappPurchaseCalled)return oe.lastCreateUserProduct=e,void(oe.lastCreateUserToken=t);if(!oe.subscribeMethod)return void m("[IAP] createUser configuration error: missing api url.");var n=oe.getRandomEmail(),r=1;b()&&window.localStorage.getItem("googleAccount")&&(n=window.localStorage.getItem("googleAccount"),r=0),window.localStorage.setItem("user_account",n);var i=oe.subscribeMethod,o={paymethod:oe.paymethod,user_account:n,email_is_fake:r,purchase_token:t,return_url:oe.returnUrl,inapp_pwd:oe.getPassword(t),hybrid:1};oe.lastCreateuserUrl=i,oe.lastCreateuserData=o;var a=function(e){if(oe.createUserAttempt<=oe.maxCreateUserAttempt)m("[IAP] createUser failed "+oe.createUserAttempt+" times, trying again... last error: "+JSON.stringify(e)),u();else{m("[IAP] createUser onCreateError: removing user_account"),window.localStorage.removeItem("user_account");var t={iap_error:"1",return_url:oe.returnUrl};W(!1),oe.inappPurchaseCalled?oe.callbackError(t):oe.inappProductInfoCalled&&oe.callbackListingError(t)}},s=function(e){h("[IAP] createUser success ",e);try{e.device_id=y.uuid,window.localStorage.getItem("transaction_id")&&(e.transaction_id=window.localStorage.getItem("transaction_id")),W(!1),oe.callbackSuccess(e),oe.inappPurchaseCalled?oe.callbackSuccess(e):oe.inappProductInfoCalled&&oe.callbackPurchaseSuccess(e)}catch(e){a(e)}},c=10,u=function(){setTimeout(function(){oe.createUserAttempt=oe.createUserAttempt+1,h("[IAP] createUser attempt: "+oe.createUserAttempt+" with timeout: "+c+"sec."),h("[IAP] POST createUser: "+oe.lastCreateuserUrl+" params: "+JSON.stringify(oe.lastCreateuserData)+" timeout: "+1e3*c),window.aja().method("POST").url(oe.lastCreateuserUrl).cache(!1).timeout(1e3*c).data(oe.lastCreateuserData).on("success",function(e){s(e)}).on("error",function(e){a(e)}).on("4xx",function(e){a(e)}).on("5xx",function(e){a(e)}).on("timeout",function(){a("timeout")}).on("end",function(){h("[IAP] createUser end"),W(!1)}).go(),c+=5},10)};oe.createUserAttempt=0,u()}},ae=function(){var e={},t={},n={},r=!1;return e.initialize=function(){if("object"!=typeof window.navigator||"object"!=typeof window.navigator.globalization)return m("[globalization] missing cordova plugin!"),!1;var e=new Promise(function(e){navigator.globalization.getPreferredLanguage(function(n){if("object"!=typeof n)return m("[globalization] initialize getPreferredLanguage result error: invalid type",n),void e({error:"invalid type"});h("[globalization] initialize getPreferredLanguage result ok: ",n),t=n,e(n)},function(t){m("[globalization] initialize getPreferredLanguage result error: ",t),e({error:t})})}),i=new Promise(function(e){navigator.globalization.getLocaleName(function(t){
if("object"!=typeof t)return m("[globalization] initialize getLocaleName result error: invalid type",t),void e({error:"invalid type"});h("[globalization] initialize getLocaleName result ok: ",t),n=t,e(t)},function(t){m("[globalization] initialize getLocaleName result error: ",t),e({error:t})})});return Promise.all([e,i]).then(function(e){return r=!0,e})},e.getPreferredLanguage=function(){return r?t:(m("[globalization] getPreferredLanguage: not initialized!"),!1)},e.getLocaleName=function(){return r?n:(m("[globalization] getLocaleName: not initialized!"),!1)},e}();a.facebookLogin=function(e,t,n){if(!I)return n("Stargate not initialized, call Stargate.initialize first!");facebookConnectPlugin.login(e.split(","),function(e){h("[facebook] got userdata: ",e),facebookConnectPlugin.getAccessToken(function(e){t({accessToken:e})},function(e){n({error:e})})},function(e){m("Got FB login error:",e),n({error:e})})},a.facebookShare=function(e,t,n){if(!I)return n("Stargate not initialized, call Stargate.initialize first!");var r={method:"share",href:e};facebookConnectPlugin.showDialog(r,function(e){t({message:e})},function(e){m("Got FB share error:",e),n({error:e})})};var se=function(){deltadna.registerPushCallback(ue)},ce=function(e){m("[DeltaDNA] error: "+e)},ue=function(e){return b()&&e.payload&&e.payload.url&&!e.foreground?_(e.payload.url):S()&&e.url?_(e.url):void 0},le=function(){var e={},t={},n=function(n){h("[CodePush] syncStatus: "+e.syncStatus[n]),t[n]&&Array===t[n].constructor&&t[n].forEach(function(e){e(n)})};e.syncStatus={0:"UP_TO_DATE",1:"UPDATE_INSTALLED",2:"UPDATE_IGNORED",3:"ERROR",4:"IN_PROGRESS",5:"CHECKING_FOR_UPDATE",6:"AWAITING_USER_ACTION",7:"DOWNLOADING_PACKAGE",8:"INSTALLING_UPDATE",AWAITING_USER_ACTION:6,CHECKING_FOR_UPDATE:5,DOWNLOADING_PACKAGE:7,ERROR:3,INSTALLING_UPDATE:8,IN_PROGRESS:4,UPDATE_IGNORED:2,UPDATE_INSTALLED:1,UP_TO_DATE:0},e.registerForNotification=function(e,n){return e?"function"!=typeof n?(m("[CodePush] registerForNotification: callback is not a function"),!1):(t[e]||(t[e]=[]),t[e].push(n),!0):(m("[CodePush] registerForNotification: undefined status requested"),!1)};var r=function(e){e&&h("[CodePush] Downloading "+e.receivedBytes+" of "+e.totalBytes)};return e.initialize=function(){if(void 0===window.codePush)return m("[CodePush] missing cordova plugin!"),!1;e.syncStatus=window.SyncStatus,window.codePush.sync(n,null,r)},e}(),de=function(){var e,t={};return t.init=function(t){if(!window.plugins||!window.plugins.appsFlyer)return m("[appsflyer] missing cordova plugin");if(void 0===H.appsflyer_devkey)return m("[appsflyer] missing manifest configuration: appsflyer_devkey");var n={devKey:H.appsflyer_devkey,isDebug:!1,onInstallConversionDataListener:!0};if(S()){if(void 0===H.appstore_appid)return m("[appsflyer] missing manifest configuration: appstore_appid");n.appId=H.appstore_appid}var r=function(n){if("function"!=typeof e)return console.log("[Stargate] [appsflyer] callback not set!");if(window.localStorage.getItem("appsflyerSetSessionDone"))return e(null),!0;try{"string"==typeof n&&(n=JSON.parse(n)),n.type&&"onInstallConversionDataLoaded"==n.type&&n.data&&(n=n.data),e(n),console.log("[Stargate] [appsflyer] parameters sent to webapp callback: "+JSON.stringify(n))}catch(e){console.error("[Stargate] [appsflyer] callback error: "+e,e)}if(console.log("[Stargate] [appsflyer] configuration:",t),!window.localStorage.getItem("appsflyerSetSessionDone")&&t.autologin){var r="af_sub1";t.fieldPony&&(r=t.fieldPony);var i="";if(t.fieldReturnUrl&&(i=t.fieldReturnUrl),window.localStorage.setItem("appsflyerSetSessionDone",1),"object"==typeof n&&n[r]){var o=null;return i&&n[i]&&(o=n[i]),void window.setTimeout(function(){if(console.log("[Stargate] [appsflyer] perform autologin"),t.cbOnAfOkPreSession&&"function"==typeof t.cbOnAfOkPreSession){(0,t.cbOnAfOkPreSession)()}ee.setSession(n[r],o)},100)}}if(t.cbOnAfEmptySession&&"function"==typeof t.cbOnAfEmptySession){(0,t.cbOnAfEmptySession)()}},i=function(e){console.error("[Stargate] [appsflyer] plugin error: "+e,e)};window.plugins.appsFlyer.initSdk(n,r,i)},t.setCallback=function(t){e=t},t}();a.setConversionDataCallback=function(e){de.setCallback(e)};var fe=function(){var e,t={};return t.track=function(t){if("function"!=typeof e)return h("[analytics] callback not set!");try{e(t)}catch(e){m("[analytics] callback error: "+e,e)}},t.setCallback=function(t){e=t},t}();a.setAnalyticsCallback=function(e){fe.setCallback(e)};var pe={AdMobSupport:!1,MoPubSupport:!1,AdPosition:{NO_CHANGE:0,TOP_LEFT:1,TOP_CENTER:2,TOP_RIGHT:3,LEFT:4,CENTER:5,RIGHT:6,BOTTOM_LEFT:7,BOTTOM_CENTER:8,BOTTOM_RIGHT:9,POS_XY:10},AdSize:{SMART_BANNER:"SMART_BANNER",BANNER:"BANNER",MEDIUM_RECTANGLE:"MEDIUM_RECTANGLE",FULL_BANNER:"FULL_BANNER",LEADERBOARD:"LEADERBOARD",SKYSCRAPER:"SKYSCRAPER"},DefaultOptions:null,initialize:function(e,t,n){return e&&(pe.DefaultOptions=e),AdMob&&(pe.AdMobSupport=!0,pe.initAdMob(e,t,n)),MoPub&&(pe.MoPubSupport=!0),!0},isAdMobSupported:function(){return pe.AdMobSupport},isMoPubSupported:function(){return pe.MoPubSupport},getUserAgent:function(){return/(android)/i.test(navigator.userAgent)?"android":/(ipod|iphone|ipad)/i.test(navigator.userAgent)?"ios":"other"},initAdMob:function(e,t,n){var r={adSize:"BANNER",position:8,bgColor:"black",isTesting:!1,autoShow:!0};AdMob.setOptions(r,t,n)},registerAdEvents:function(e){document.addEventListener("onAdFailLoad",e),document.addEventListener("onAdLoaded",e),document.addEventListener("onAdPresent",e),document.addEventListener("onAdLeaveApp",e),document.addEventListener("onAdDismiss",e)},manageAdEvents:function(e){console.log("error: "+e.error+", reason: "+e.reason+", adNetwork:"+e.adNetwork+", adType:"+e.adType+", adEvent:"+e.adEvent)},createBanner:function(e,t,n){var r={},i=[],o=pe.getUserAgent();e||pe.isObjEmpty(pe.DefaultOptions)||(e=pe.DefaultOptions),Array.isArray(e)?i=e:i.push(e),i.forEach(function(e){if("default"==e.device||e.device==o){var i=pe.getAdSize().toLowerCase();e.overlap&&(r.overlap=e.overlap),e.offsetTopBar&&(r.offsetTopBar=e.offsetTopBar),r.adSize=pe.getAdSize(),i&&(r.adId=e[i]),e.position&&(r.position=pe.AdPosition[e.position]),e.width&&(r.width=e.width),e.height&&(r.height=e.height),e.autoShow&&(r.autoShow=e.autoShow),"admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?(e.width&&e.height&&(r.adSize="CUSTOM"),AdMob.createBanner(r,t,n)):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.createBanner(r,t,n)}})},showBannerAtSelectedPosition:function(e){var t=[],n=pe.getUserAgent();e||pe.isObjEmpty(pe.DefaultOptions)||(e=pe.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){"default"!=e.device&&e.device!=n||("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showBanner(e.position):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showBanner(e.position))})},showBannerAtGivenXY:function(e){var t=[],n=pe.getUserAgent();e||pe.isObjEmpty(pe.DefaultOptions)||(e=pe.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){"default"!=e.device&&e.device!=n||("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showBannerAtXY(e.x,e.y):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showBannerAtXY(e.x,e.y))})},hideBanner:function(e){var t=[],n=pe.getUserAgent();e||pe.isObjEmpty(pe.DefaultOptions)||(e=pe.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){"default"!=e.device&&e.device!=n||("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.hideBanner():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.hideBanner())})},removeBanner:function(e){var t=[],n=pe.getUserAgent();e||pe.isObjEmpty(pe.DefaultOptions)||(e=pe.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){"default"!=e.device&&e.device!=n||("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.removeBanner():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.removeBanner())})},prepareInterstitial:function(e,t,n){var r={},i=[],o=pe.getUserAgent();e||pe.isObjEmpty(pe.DefaultOptions)||(e=pe.DefaultOptions),Array.isArray(e)?i=e:i.push(e),i.forEach(function(e){"default"!=e.device&&e.device!=o||(e.interstitial&&(r.adId=e.interstitial),e.autoShow&&(r.autoShow=e.autoShow),"admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.prepareInterstitial(r):"mopub"==e.network.toLowerCase()&&MoPub.prepareInterstitial(r,t,n))})},showInterstitial:function(e){var t=[],n=pe.getUserAgent();e||pe.isObjEmpty(pe.DefaultOptions)||(e=pe.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){"default"!=e.device&&e.device!=n||("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showInterstitial():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showInterstitial())})},isObjEmpty:function(e){return 0===Object.keys(e).length},getAdSize:function(){var e=screen.height,t=screen.width;return t>=728&&e>=90?pe.AdSize.LEADERBOARD:t>=468&&e>=60?pe.AdSize.BANNER:t>=320&&e>=50?pe.AdSize.BANNER:void 0}};return a.game=s.game._public,a.file=s.file,a.AdManager=s.AdManager,a});