/*!
 * StargateJS Apps
 * v0.4.5
 * Copyright 2015 DMobileLab. http://buongiorno.com/
 * See LICENSE in this repository for license information
 */
<<<<<<< HEAD
!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof module&&module.exports?module.exports=n():e.Stargate=n()}(this,function(){function e(e){m.type=e.type,m.networkState=navigator.connection.type,"function"==typeof g&&g(m)}function n(){document.addEventListener("offline",e,!1),document.addEventListener("online",e,!1)}function t(){m.networkState=navigator.connection.type,"none"===navigator.connection.type?m.type="offline":m.type="online"}function r(e){if("android"==window.device.platform.toLowerCase())window.navigator.app.loadUrl(e);else if("ios"==window.device.platform.toLowerCase()&&-1!==e.indexOf("file:///")){var n=e.split("?")[0];y("Without qs",n),window.resolveLocalFileSystemURL(n,function(e){var n=e.toInternalURL()+"?hybrid=1";y("Redirect to",n),window.location.href=n},_)}else window.location.href=e}function i(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.AppIsDebug?new Promise(function(e,n){window.cordova.plugins.AppIsDebug.get(function(n){e(n)},function(e){_("getAppIsDebug(): "+e,e),n(new Error(e))})}):(_("getAppIsDebug(): plugin not available!"),Promise.resolve({}))}function o(){return window.cordova.file?l.file.readFileAsJSON(window.cordova.file.applicationDirectory+"www/manifest.json"):window.hostedwebapp?new Promise(function(e,n){window.hostedwebapp.getManifest(function(n){e(n)},function(e){_(e),n(new Error(e))})}):(_("getManifest() no available reading mechanism!"),Promise.resolve({}))}function a(){this.initialize=function(e,n,t){_("unimplemented"),t("unimplemented")},this.createBanner=function(e,n,t){_("unimplemented"),t("unimplemented")},this.hideBanner=function(e,n,t){_("unimplemented"),t("unimplemented")},this.removeBanner=function(e,n,t){_("unimplemented"),t("unimplemented")},this.showBannerAtSelectedPosition=function(e,n,t){_("unimplemented"),t("unimplemented")},this.showBannerAtGivenXY=function(e,n,t){_("unimplemented"),t("unimplemented")},this.registerAdEvents=function(e,n,t){_("unimplemented"),t("unimplemented")},this.prepareInterstitial=function(e,n,t){_("unimplemented"),t("unimplemented")},this.showInterstitial=function(e,n,t){_("unimplemented"),t("unimplemented")}}var s="0.4.4",c={},l={};!function(e){function n(e,t,r){this.level=n.levels[e.toUpperCase()],this.styles=r||{background:"white",color:"black"},this.tag="%c "+t+" ",this.isstaging="1"==="IS_STAGING = 1".slice(-1),this.styleString="background:"+this.styles.background+";color:"+this.styles.color+";";var i=function(){if(arguments.length<1)return"";for(var e=Array.prototype.slice.call(arguments[0]),n="",t=0;t<e.length;t++)n+="object"==typeof e[t]?" "+JSON.stringify(e[t]):" "+e[t];return n},o=window.console.log.bind(window.console,this.tag,this.styleString),a=window.console.info.bind(window.console,this.tag,this.styleString),s=window.console.error.bind(window.console,this.tag,this.styleString),c=window.console.warn.bind(window.console,this.tag,this.styleString);this.isstaging||(o=function(){window.console.log("[D] [Stargate] "+i.apply(null,arguments))},a=function(){window.console.log("[I] [Stargate] "+i.apply(null,arguments))},s=function(){window.console.log("[E] [Stargate] "+i.apply(null,arguments))},c=function(){window.console.log("[W] [Stargate] "+i.apply(null,arguments))}),Object.defineProperties(this,{__d:{value:o,writable:!1,enumerable:!1,configurable:!1},__i:{value:a,writable:!1,enumerable:!1,configurable:!1},__e:{value:s,writable:!1,enumerable:!1,configurable:!1},__w:{value:c,writable:!1,enumerable:!1,configurable:!1}})}function t(e){var n=0;return{next:function(t){return t&&(n=0),n<e.length?{value:e[n++],done:!1}:{done:!0}}}}function r(e,n){e+="?";var t="";for(var r in n)t+=encodeURIComponent(r)+"="+encodeURIComponent(n[r])+"&";return t.length>0&&(t=t.substring(0,t.length-1)),e+t}function i(e){e=encodeURI(e);var n="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t="responseType"in n;n.open("GET",e,!0),t&&(n.responseType="json");var r=new Promise(function(e,r){n.onreadystatechange=function(){if(4===n.readyState)try{var i=t?n.response:JSON.parse(n.responseText);e(i)}catch(o){r(o)}}});return n.setRequestHeader("Content-type","application/json; charset=UTF-8"),n.send(),r}function o(e){var n=this;if(n.timeout=3e3,n.called=!1,window.document){var t=Date.now();n.scriptTag=window.document.createElement("script"),e+="&callback=window.__jsonpHandler_"+t,n.scriptTag.src=e,n.scriptTag.type="text/javascript",n.scriptTag.async=!0,n.prom=new Promise(function(e,r){var i="__jsonpHandler_"+t;window[i]=function(t){n.called=!0,e(t),n.scriptTag.parentElement.removeChild(n.scriptTag),delete window[i]},setTimeout(function(){n.called||(r("Timeout jsonp request "+t),n.scriptTag.parentElement.removeChild(n.scriptTag),delete window[i])},n.timeout)}),window.document.getElementsByTagName("head")[0].appendChild(n.scriptTag)}}function a(e,n){var t=n||function(){};return new Promise(function(n,r){function i(){var t;switch(e.responseType){case"blob":t=new Blob([this.response],{type:e.mimeType||"image/jpeg"});break;case"arraybuffer":t=this.response;break;default:t=this.response,n(t)}}var o=new XMLHttpRequest;o.open("GET",e.url,!0),o.responseType=e.responseType||"blob",o.withCredentials=!0;var a=r,s=r;o.addEventListener("progress",t,!1),o.addEventListener("load",i,!1),o.addEventListener("error",s,!1),o.addEventListener("abort",a,!1),o.send(null)})}function s(e,n){var t=Object.prototype.toString.apply({});if(e.toString()!==t||n.toString()!==t)throw new Error("Cannot merge different type");var r={};for(var i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);for(var o in n)n.hasOwnProperty(i)&&(r[o]=n[o]);return r}n.levels={ALL:5,ERROR:4,WARN:3,INFO:2,DEBUG:1,OFF:0},n.prototype.e=function(){0!==this.level&&this.level>=n.levels.ERROR&&this.__e(arguments)},n.prototype.i=function(){0!==this.level&&this.level>=n.levels.WARN&&this.__i(arguments)},n.prototype.w=function(){0!==this.level&&this.level>=n.levels.INFO&&this.__w(arguments)},n.prototype.d=function(){0!==this.level&&this.level>=n.levels.DEBUG&&this.__d(arguments)},n.prototype.setLevel=function(e){this.level=n.levels[e]};var c={Iterator:t,Logger:n,composeApiString:r,getJSON:i,jsonpRequest:o,getImageRaw:a,extend:s};e?e.Utils=c:window.Utils=c}(l),function(e,n){function t(e){var n=e.map(function(e){return{fullPath:e.fullPath,path:e.toURL(),internalURL:e.toInternalURL(),isFile:e.isFile,isDirectory:e.isDirectory}});return 1==n.length?n[0]:n}var r={},i=new n.Logger("ALL","[File - module]");r.LOG=i,window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,r.ERROR_MAP={1:"NOT_FOUND_ERR",2:"SECURITY_ERR",3:"ABORT_ERR",4:"NOT_READABLE_ERR",5:"ENCODING_ERR",6:"NO_MODIFICATION_ALLOWED_ERR",7:"INVALID_STATE_ERR",8:"SYNTAX_ERR",9:"INVALID_MODIFICATION_ERR",10:"QUOTA_EXCEEDED_ERR",11:"TYPE_MISMATCH_ERR",12:"PATH_EXISTS_ERR"},r.currentFileTransfer=null,r.resolveFS=function(e){return new Promise(function(n,t){window.resolveLocalFileSystemURL(e,n,t)})},r.appendToFile=function(e,n,i,o){return i=void 0===arguments[2]?!1:arguments[2],o=void 0===arguments[3]?"text/plain":arguments[3],r.resolveFS(e).then(function(e){return new Promise(function(r,a){e.createWriter(function(s){i||s.seek(s.length);var c;c=n instanceof Blob?n:new Blob([n],{type:o}),s.write(c),s.onerror=a,s.onabort=a,s.onwriteend=function(){r(t([e]))}},a)})})},r.readFileAsHTML=function(e){return r.readFile(e).then(function(e){return(new window.DOMParser).parseFromString(e,"text/html")})},r.readFileAsJSON=function(e){return r.readFile(e).then(function(e){try{return Promise.resolve(window.JSON.parse(e))}catch(n){return Promise.reject(n)}})},r.removeFile=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(n,t){e.remove(function(e){n(null===e||"OK"===e)},t)})})},r.removeDir=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(n,t){e.removeRecursively(function(e){n(null===e||"OK"===e)},t)})})},r._promiseZip=function(e,n,t){return i.d("PROMISEZIP:",arguments),new Promise(function(r,i){window.zip.unzip(e,n,function(e){0===e?r(!0):i(e)},t)})},r.download=function(e,n,i,o){var a=this;this.ft=new window.FileTransfer,this.ft.onprogress=o,r.currentFileTransfer=a.ft,a.promise=new Promise(function(r,o){a.ft.download(window.encodeURI(e),n+i,function(e){r(t([e])),a.ft=null},function(e){o(e),a.ft=null},!0)})},r.createDir=function(e,n){return r.resolveFS(e).then(function(e){return new Promise(function(r,i){e.getDirectory(n,{create:!0},function(e){r(t([e]))},i)})})},r.fileExists=function(e){return new Promise(function(n){window.resolveLocalFileSystemURL(e,function(e){n(e.isFile)},function(e){n(1!==e.code)})})},r.dirExists=function(e){return new Promise(function(n){window.resolveLocalFileSystemURL(e,function(e){n(e.isDirectory)},function(e){n(1!=e.code)})})},r.requestFileSystem=function(e,n){return new Promise(function(t,r){window.requestFileSystem(e,n,t,r)})},r.readDir=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(n,r){var o=e.createReader();o.readEntries(function(e){i.d("readDir:",e),n(t(e))},r)})})},r.readFile=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(n,t){e.file(function(e){var r=new FileReader;r.onerror=t,r.onabort=t,r.onloadend=function(){var e=this.result;n(e)},r.readAsText(e)})})})},r.createFile=function(e,n){return r.resolveFS(e).then(function(e){return new Promise(function(r,i){e.getFile(n,{create:!0},function(e){r(t([e]))},i)})})},r.write=function(e,n){return r.appendToFile(e,n,!0)},r.moveDir=function(e,n){var t=n.substring(n.lastIndexOf("/")+1),o=n.replace(t,"");return i.d("moveDir:",o,t),Promise.all([r.resolveFS(e),r.resolveFS(o)]).then(function(e){return i.d("moveDir: resolved entries",e),new Promise(function(n,r){e[0].moveTo(e[1],t,n,r)})})},r.copyFile=function(e,n){var t=n.substring(n.lastIndexOf("/")+1),o=n.replace(t,"");return Promise.all([r.resolveFS(e),r.resolveFS(o)]).then(function(e){return i.d("copyFileTo",e),new Promise(function(n,r){e[0].copyTo(e[1],t,n,r)})})},r.copyDir=function(e,n){var t=n.substring(n.lastIndexOf("/")+1),o=n.replace(t,"");return Promise.all([r.resolveFS(e),r.resolveFS(o)]).then(function(r){return i.d("copyDir",e,"in",n),new Promise(function(e,n){r[0].copyTo(r[1],t,e,n)})})},e?e.file=r:window.file=r}(l,l.Utils),function(e,n,t){"use strict";function r(){}function i(n){if(n&&(E=D(E,n)),C.d("Initialized called with:",E),!e)return Promise.reject("Missing file module!");try{w=window.cordova.file.applicationStorageDirectory,h=window.cordova.file.cacheDirectory,v=window.cordova.file.tempDirectory,y=window.cordova.file.applicationDirectory+"www/",S=window.cordova.file.applicationDirectory+"www/js/stargate.js",_=window.cordova.file.dataDirectory}catch(r){return C.e(r),Promise.reject(r)}"ios"==window.device.platform.toLowerCase()&&(w+="Documents/"),"android"==window.device.platform.toLowerCase()&&(v=h),A.SDK_DIR=w+"scripts/",A.SDK_RELATIVE_DIR="../../scripts/",A.GAMEOVER_RELATIVE_DIR="../../gameover_template/",A.GAMES_DIR=w+"games/",A.BASE_DIR=w,A.CACHE_DIR=h,A.TEMP_DIR=v,A.CORDOVAJS=y+"cordova.js",A.CORDOVA_PLUGINS_JS=y+"cordova_plugins.js",A.STARGATEJS=y+"js/stargate.js",A.DATA_DIR=_,A.GAMEOVER_DIR=A.BASE_DIR+"gameover_template/",A.WWW_DIR=y,C.i("cordova JS dir to include",A.CORDOVAJS),t.game._public.BASE_DIR=A.BASE_DIR,t.game._public.OFFLINE_INDEX=A.WWW_DIR+"index.html";var i=e.createDir(A.BASE_DIR,"games"),s=e.createDir(A.BASE_DIR,"scripts"),c=e.fileExists(A.BASE_DIR+"offlineData.json").then(function(n){return n?(C.i("offlineData.json already exists"),n):(C.i("creating offlineData.json"),e.createFile(A.BASE_DIR,"offlineData.json").then(function(n){return C.d("offlineData",n),e.write(n.path,JSON.stringify(k))}))});return Promise.all([i,s,c]).then(function(e){return C.d("GamesDir, ScriptsDir, offlineData.json created",e),o()}).then(a)}function o(){return Promise.all([e.dirExists(A.BASE_DIR+"gameover_template"),e.dirExists(A.SDK_DIR+"plugins"),e.fileExists(A.SDK_DIR+"cordova.js"),e.fileExists(A.SDK_DIR+"cordova_plugins.js"),e.fileExists(A.SDK_DIR+"stargate.js"),e.fileExists(A.SDK_DIR+"gamesFixes.js")]).then(function(n){var t=[];return n[0]||t.push(e.copyDir(A.WWW_DIR+"gameover_template",A.BASE_DIR+"gameover_template")),n[1]||t.push(e.copyDir(A.WWW_DIR+"plugins",A.SDK_DIR+"plugins")),n[2]||t.push(e.copyFile(A.CORDOVAJS,A.SDK_DIR+"cordova.js")),n[3]||t.push(e.copyFile(A.CORDOVA_PLUGINS_JS,A.SDK_DIR+"cordova_plugins.js")),n[4]||t.push(e.copyFile(A.STARGATEJS,A.SDK_DIR+"stargate.js")),n[5]||t.push(e.copyFile(A.WWW_DIR+"js/gamesFixes.js",A.SDK_DIR+"gamesFixes.js")),Promise.all(t)})}function a(){return Promise.all([e.fileExists(A.SDK_DIR+"dixie.js"),e.fileExists(A.SDK_DIR+"gfsdk.min.js")]).then(function(n){var t=n[0],r=n[1],i=[];return r||""===E.sdk_url||(C.d("get SDK"),i.push(new e.download(E.sdk_url,A.SDK_DIR,"gfsdk.min.js").promise)),t||""===E.dixie_url||(C.d("get dixie"),i.push(new e.download(E.dixie_url,A.SDK_DIR,"dixie.js").promise)),Promise.all(i)})}function s(n){return C.d("_getIndexHtmlById",A.GAMES_DIR+n),e.readDir(A.GAMES_DIR+n).then(function(e){return C.d("_getIndexHtmlById readDir",e),e.filter(function(e){var n=new RegExp(/index\.html$/i);return n.test(e.path)})})}function c(e){C.d("_removeRemoteSDK");for(var n,t=e.querySelectorAll("script"),r=0;r<t.length;r++)if(-1!==t[r].src.indexOf("gfsdk")){n=t[r],C.d("_removeRemoteSDK",n),n.parentNode.removeChild(n);break}return e}function l(e,n){e=c(e);var t,r,i=Array.isArray(n)===!1?[n]:n;C.d("injectScripts",i);var o=document.createElement("meta");o.httpEquiv="Content-Security-Policy",o.content="default-src * data: content: cdvfile: file: http: https: gap: https://ssl.gstatic.com 'unsafe-inline' 'unsafe-eval';style-src * cdvfile: http: https: 'unsafe-inline';",e.head.insertBefore(o,e.getElementsByTagName("meta")[0]);var a=e.createElement("script");a.id="__root__",e.head.insertBefore(a,e.head.firstElementChild);for(var s=e.createDocumentFragment(),l=0;l<i.length;l++)i[l].endsWith(".css")?(C.d("css inject:",i[l]),r=e.createElement("link"),r.rel="stylesheet",r.href=i[l],e.head.insertBefore(r,e.getElementsByTagName("link")[0])):(t=e.createElement("script"),t.src=i[l],s.appendChild(t));return e.head.insertBefore(s,e.head.getElementsByTagName("script")[0]),C.d("Cleaned dom:",e),e}function u(e){var n=[];n.push(e.querySelector("link[href='/gmenu/frame.css']")),n.push(e.querySelector("iframe#menu")),n.push(e.querySelector("script[src='/gmenu/toggle.js']"));for(var t=e.querySelectorAll("script"),r=t.length-1;r>=0;r--)if(-1!==t[r].innerHTML.indexOf("function open")){n.push(t[r]);break}for(var i=0;i<n.length;i++)n[i]&&n[i].parentNode.removeChild(n[i]);return e}function d(n,t){var r;return s(n).then(function(n){return r=n[0].path,C.d("injectScripts",r),e.readFileAsHTML(n[0].path)}).then(function(e){function n(n){e.head.appendChild(n)}var r=e.body.querySelectorAll("meta"),i=e.body.querySelectorAll("link"),o=e.body.querySelectorAll("style"),a=e.body.querySelectorAll("title");r=[].slice.call(r),i=[].slice.call(i),o=[].slice.call(o),a=[].slice.call(a);var s=r.concat(i).concat(o).concat(a);return s.map(n),e.body.innerHTML=e.body.innerHTML.trim(),C.d("_injectScripts"),C.d(e),l(e,t)}).then(u).then(function(e){var n=[].slice.call(e.querySelector("html").attributes),t=n.map(function(e){return e.name+'="'+e.value+'"'}).join(" "),r="<!DOCTYPE html><html "+t+">"+e.documentElement.innerHTML+"</html>";return C.d("Serialized dom",r),r}).then(function(n){return C.d("Write dom:",r,n),e.write(r,n)})}function f(e){var n=new RegExp(/index\.html$/i);return n.test(e)}function p(t){var r=t.url.replace("[WSIZE]",t.size.width).replace("[HSIZE]",t.size.height).split("?")[0],i=A.GAMES_DIR+t.gameId,o=t.type+"_"+t.size.width+"x"+t.size.height+("_"+t.size.ratio||"")+".jpeg";return C.d("request Image to",r,"coverImageUrl",o,"imagesFolder",i),"xhr"===t.method?Promise.all([e.createFile(i,o),n.getImageRaw({url:r})]).then(function(n){var t=n[0],r=n[1];return e.appendToFile(t.path,r,!0,"image/jpeg")}):new e.download(r,i,o,function(){}).promise}function g(e){var n=I(E.ga_for_game_url,T),t=new R(n).prom;return t.then(function(t){C.d("apiGaForGames:",n,"ga_for_game:",t);var r=I(E.gamifive_info_api,{content_id:e,_PONY:t._PONYVALUE,format:"jsonp"});return C.d("gamifive_info_api",r),[new R(r).prom,t]}).then(function(n){return n[0].then(function(t){return C.d("gamifiveInfo:",t,"ga_for_game",n[1]),m({content_id:e,ga_for_game:n[1],gamifive_info:t.game_info})})})}function m(n){return e.readFileAsJSON(A.BASE_DIR+"offlineData.json").then(function(e){return e.GaForGame[n.content_id]=n.ga_for_game,e.GamifiveInfo[n.content_id]=n.gamifive_info,e}).then(function(n){return C.d("writing offlineData.json",n),e.write(A.BASE_DIR+"offlineData.json",JSON.stringify(n))})}var w,h,v,y,_,S,b=n.Logger,I=n.composeApiString,R=n.jsonpRequest,D=n.extend,A={},E={sdk_url:"",dixie_url:"",api:"",ga_for_game_url:"",gamifive_info_api:"",bundle_games:[]},P=!1,k={GaForGame:{},GamifiveInfo:{},queues:{}},T={print_json_response:1},O={content_id:"",formats:"html5applications",sort:"-born_date",category:"b940b384ff0565b06dde433e05dc3c93",publisher:"",size:6,offset:0,label:"",label_slug:"",access_type:"",real_customer_id:"xx_gameasy",lang:"en",use_cs_id:"",white_label:"xx_gameasy",main_domain:"http://www2.gameasy.com/ww",fw:"gameasy",vh:"ww.gameasy.com",check_compatibility_header:0},C=new b("ALL","[Game - module]",{background:"black",color:"#5aa73a"});r.prototype.download=function(n,t){function r(e){return function(n){var t=Math.round(n.loaded/n.total*100);c({percentage:t,type:e})}}function i(){return l({type:"download"}),C.d("Get ga_for_game and gamifive info, fly my minipony!"),g(m).then(function(t){return C.d("Ga for game and gamifive info stored!",t),C.d("Start Download:",n.id,n.response_api_dld.binary_url),new e.download(n.response_api_dld.binary_url,A.TEMP_DIR,m+".zip",r("download")).promise}).then(function(t){return l({type:"unzip"}),C.d("unzip:",n.id,A.TEMP_DIR+m),e._promiseZip(t.path,A.TEMP_DIR+m,r("unzip"))}).then(function(t){C.d("Unzip ended",t),u({type:"unzip"});var r=n.response_api_dld.url_download,i=r.substring(r.lastIndexOf("game"),r.length).split("/"),o="";return C.d("Get the right index folder of the game",i),i.length>2&&f(i[i.length-1])?(o=A.TEMP_DIR+[m,i[i.length-2]].join("/"),C.d("More than one level folders before index.html",i,o)):(o=A.TEMP_DIR+m,C.d("One level folder before index.html",i,o)),C.d("Copy game folder in games/",o,A.GAMES_DIR+m),e.moveDir(o,A.GAMES_DIR+m)}).then(function(n){return C.d("Remove zip from:",A.TEMP_DIR+m+".zip","last operation result",n),e.removeFile(A.TEMP_DIR+m+".zip")}).then(function(){C.d("Save meta.json for:",n.id);var e={gameId:n.id,size:{width:"240",height:"170",ratio:"1_4"},url:n.images.cover.ratio_1_4,type:"cover",method:"xhr"};return p(e)}).then(function(t){return C.d("Save meta.json for:",n.id),C.d("Download image result",t),n.images.cover.ratio_1_4=t.internalURL,e.createFile(A.GAMES_DIR+m,"meta.json").then(function(t){return e.write(t.path,JSON.stringify(n))})}).then(function(e){return C.d("result last operation:save meta.json",e),C.d("InjectScripts in game:",n.id,y),d(n.id,[A.SDK_RELATIVE_DIR+"gamesFixes.js",A.GAMEOVER_RELATIVE_DIR+"gameover.css",A.SDK_RELATIVE_DIR+"cordova.js",A.SDK_RELATIVE_DIR+"cordova_plugins.js",A.SDK_RELATIVE_DIR+"dixie.js",A.SDK_RELATIVE_DIR+"stargate.js",A.SDK_RELATIVE_DIR+"gfsdk.min.js"])}).then(function(e){return C.d("injectScripts result",e),u({type:"download"}),P=!1,n.id})["catch"](function(e){throw C.e(e,"Cleaning...game not downloaded",n.id),P=!1,s.remove(n.id),u({type:"error",description:e}),e})}var o;if(this.isDownloading())return o={type:"error",description:"AlreadyDownloading"},t.onEnd(o),Promise.reject(o);if(!n.hasOwnProperty("response_api_dld")||200!==n.response_api_dld.status)return o={type:"error",description:"response_api_dld.status not equal 200 or undefined"},t.onEnd(o),Promise.reject(o);var a=this.isGameDownloaded(n.id),s=this;t=t?t:{};var c=t.onProgress?t.onProgress:function(){},l=t.onStart?t.onStart:function(){},u=t.onEnd?t.onEnd:function(){},m=n.id;return a.then(function(e){return C.d("Exists",e),e?(P=!1,Promise.reject({12:"AlreadyExists",gameID:n.id})):(P=!0,i())})},r.prototype.play=function(n){C.d("Play",n);var t=A.GAMES_DIR+n;return e.readDir(t).then(function(e){return e.filter(function(e){var n=new RegExp(/index\.html$/i);return n.test(e.path)})}).then(function(e){C.d(e);var n=e[0].internalURL+"?hybrid=1";"ios"==window.device.platform.toLowerCase()?(C.d("Play ios",n),window.location.href=n):(C.d("Play android",n),window.navigator.app.loadUrl(encodeURI(n)))})},r.prototype.remove=function(n){C.d("Removing game",n);var t=e.dirExists(A.CACHE_DIR+n+".zip"),r=e.dirExists(A.GAMES_DIR+n);return Promise.all([t,r]).then(function(t){var r=[];return t[0]&&(C.d("Removed in cache",t[0]),r.push(e.removeFile(A.CACHE_DIR+n+".zip"))),t[1]&&(C.d("Removed",t[1]),r.push(e.removeDir(A.GAMES_DIR+n))),0===r.length&&C.i("Nothing to remove",r),r})},r.prototype.isDownloading=function(){return P},r.prototype.abortDownload=function(){return this.isDownloading()?(C.d("Abort last download"),e.currentFileTransfer&&(e.currentFileTransfer.abort(),e.currentFileTransfer=null),!0):(C.w("There's not a download operation to abort"),!1)},r.prototype.list=function(){return C.d("Get games list"),e.readDir(A.GAMES_DIR).then(function(e){var n=Array.isArray(e)?e:[e];return n.filter(function(e){return e.isDirectory?e:void 0})}).then(function(n){var t=n.map(function(n){return e.readFileAsJSON(n.path+"meta.json")});return Promise.all(t).then(function(e){return e})})},r.prototype.buildGameOver=function(n){var t=A.GAMES_DIR+n.content_id+"/meta.json";return n.hasOwnProperty("content_id")?(C.d("Read meta.json:",t),C.d("GAMEOVER_TEMPLATE path",A.GAMEOVER_DIR+"gameover.html"),Promise.all([e.readFileAsJSON(t),e.readFile(A.GAMEOVER_DIR+"gameover.html")]).then(function(e){var t=e[1],r=e[0];return C.i("Meta JSON:",r),t.replace("{{score}}",n.score).replace("{{url_share}}",r.url_share).replace("{{url_cover}}",r.images.cover.ratio_1_4).replace("{{startpage_url}}",A.WWW_DIR+"index.html")})):Promise.reject("Missing content_id key!")},r.prototype.isGameDownloaded=function(n){return e.dirExists(A.GAMES_DIR+n)},r.prototype.removeAll=function(){return e.removeDir(A.GAMES_DIR).then(function(n){return C.d("All games deleted!",n),e.createDir(A.BASE_DIR,"games")})},r.prototype.getBundleGameObjects=function(){var e=this;if(E.bundle_games.length>0){C.d("Games bundle in configuration",E.bundle_games);var n,t=E.bundle_games.map(function(n){return e.isGameDownloaded(n)}),r=Promise.all(t).then(function(e){C.d("alreadyDownloaded",e);for(var n=0;n<e.length;n++)e[n]&&E.bundle_games.splice(n,1);return E.bundle_games}).then(function(e){return e.join(",")});return r.then(function(e){O.content_id=e;var n=I(E.api,O);return C.d("Request bundle games meta info:",n),new R(n).prom}).then(function(e){C.d("Games bundle response:",e),n=e;var t=e.map(function(e){return new R(e.url_api_dld).prom});return C.d("jsonpRequests",t),Promise.all(t)}).then(function(e){C.d("RESULTS",e);for(var t=0;t<e.length;t++)n[t].response_api_dld=e[t];return C.d("GameObjects",n),n})["catch"](function(e){C.e("Games bundle meta fail:",e)})}return C.w("Bundle_games array is empty!"),Promise.reject("bundle_games array is empty!")},r.prototype.needsUpdate=function(t){var r="";return e.readFileAsJSON(A.GAMES_DIR+t+"/meta.json").then(function(e){return r=e.response_api_dld.binary_md5,n.getJSON(e.url_api_dld)}).then(function(e){if(200===e.status)return e.binary_md5!==r;throw new Error("ResponseStatus "+e.status)})};var U={};t.game={},U.initialize=i,t.game._protected=U,t.game._public=new r}(l.file,l.Utils,l),function(e){function n(e,n,t,r,i){return function(){if("function"==typeof e&&(e=e.call(null)),e)return n.apply(t||null,arguments);switch(r=r||"NoMessage",i){case"warn":console.warn(r);break;case"error":console.error(r);break;case"info":console.info(r);break;default:console.log(r)}}}e.Decorators={requireCondition:n}}(l),function(e,n,t){function r(){c.i(o,a)}function i(){return window.plugins&&"undefined"!=typeof window.plugins.AdMob}var o={NO_CHANGE:0,TOP_LEFT:1,TOP_CENTER:2,TOP_RIGHT:3,LEFT:4,CENTER:5,RIGHT:6,BOTTOM_LEFT:7,BOTTOM_CENTER:8,BOTTOM_RIGHT:9,POS_XY:10},a={SMART_BANNER:"SMART_BANNER",BANNER:"BANNER",MEDIUM_RECTANGLE:"MEDIUM_RECTANGLE",FULL_BANNER:"FULL_BANNER",LEADERBOARD:"LEADERBOARD",SKYSCRAPER:"SKYSCRAPER"},s={},c=new e.Logger("all","[Admanager]");s=/(android)/i.test(navigator.userAgent)?{banner:"ca-app-pub-6869992474017983/9375997553",interstitial:"ca-app-pub-6869992474017983/1657046752"}:/(ipod|iphone|ipad)/i.test(navigator.userAgent)?{banner:"ca-app-pub-6869992474017983/4806197152",interstitial:"ca-app-pub-6869992474017983/7563979554"}:{banner:"ca-app-pub-6869992474017983/8878394753",interstitial:"ca-app-pub-6869992474017983/1355127956"},r.prototype.createBannerView=function(){c.d("NotImplemented")},r.prototype.requestInterstitialAd=function(){c.d("NotImplemented")},r.prototype.showAd=function(){c.d("NotImplemented")},r.prototype.createBannerView=n.requireCondition(i,r.prototype.createBannerView,r.prototype,"cordova-plugin-admob not installed","warn"),t.Admanager=new r}(l.Utils,l.Decorators,l);var u=function(){var e={},n=!1;e.init=function(){if(X.hasOwnProperty("webappsfixes")&&"object"==typeof X.webappsfixes){n=!0;for(var e in X.webappsfixes)if(X.webappsfixes.hasOwnProperty(e))if(t.hasOwnProperty(e)&&"function"==typeof t[e]){y("[webappsFixes] applying fix: "+e);var r=t[e](X.webappsfixes[e]);r&&_("[webappsFixes] fix '"+e+"' failed: "+r)}else _("[webappsFixes] fix implementation not found for: "+e)}return n};var t={};return t.gamifiveSearchBox=function(e){if(!window.cordova||!window.cordova.plugins||!window.cordova.plugins.Keyboard)return"missing ionic-plugin-keyboard";if(e.platforms){if(D()&&!e.platforms.ios)return void y("[webappsFixes] [gamifiveSearchBox] fix disabled on iOS");if(R()&&!e.platforms.android)return void y("[webappsFixes] [gamifiveSearchBox] fix disabled on Android")}return window.addEventListener("native.keyboardshow",function(){setTimeout(function(){0===document.querySelectorAll("input:focus").length&&(y("[webappsFixes] [gamifiveSearchBox] keyboard show on null input: hiding"),cordova.plugins.Keyboard.close())},1)},!1),y("[webappsFixes] [gamifiveSearchBox] listening on event native.keyboardshow"),""},e}();window.pubKey="",window.forge="";var d;c.initializeOffline=function(e){return d?d:("object"!=typeof e&&(e={}),e.hasOwnProperty("hideSplashScreen")||(e.hideSplashScreen=!0),k=!0,d=new Promise(function(n){document.addEventListener("deviceready",function(){G(),A(),t(),Promise.all([cordova.getAppVersion.getVersionNumber(),o()]).then(function(t){C=t[0],"object"!=typeof t[1]&&(t[1]=JSON.parse(t[1])),b=t[1].start_url,X=t[1].stargateConf,e.hideSplashScreen&&(navigator.splashscreen.hide(),Y(!1)),T=!0,y("Stargate.initializeOffline() done"),n(!0)})["catch"](function(e){_("initializeOffline() error: "+e)})})}))},c.conf={},c.conf.getWebappStartUrl=function(){if(!k)return _("Stargate not initialized, call Stargate.initialize first!");if(!T)return _("Stargate closed, wait for Stargate.initialize to complete!");var e=URI(X.webapp_start_url).addSearch("hybrid","1").addSearch("stargateVersion",f());return String(e)};var f=function(){return X.stargate_version_to_load?X.stargate_version_to_load:(S("getStargateVersionToLoad() stargate_version_to_load must be set on manifest!"),w)};c.conf.getWebappOrigin=function(){var e=/http:\/\/[\w]{3,4}\..*\.[\w]{2,}/;return"undefined"==typeof X.webapp_start_url?(y("Stargate is initialized? Please call this method after it"),""):e.exec(X.webapp_start_url)[0]};var p;c.initialize=function(e,n,t,r){return"function"==typeof n&&"undefined"==typeof t&&"undefined"==typeof r&&(r=n),"undefined"==typeof r&&(y("Callback success not setted. \n You can use 'then'"),r=function(){}),"function"!=typeof r?(S("Stargate.initialize() callback is not a function!"),Promise.reject(new Error("Stargate.initialize() callback is not a function!"))):(P=K(),k?(S("Stargate.initialize() already called, executing callback."),r&&r(P),p):("object"!=typeof e&&(e={}),e.hybrid_conf&&(L="object"==typeof e.hybrid_conf?e.hybrid_conf:JSON.parse(decodeURIComponent(e.hybrid_conf))),e.modules?e.modules.constructor!==Array?_("initialize() configurations.modules is not an array"):j=e.modules:j=["mfp","iapbase","appsflyer","game"],e.modules_conf&&("object"!=typeof e.modules_conf?_("initialize() configurations.modules_conf is not an object"):N=e.modules_conf),e.country&&("mfp"in L?L.mfp.country=e.country:L.mfp={country:e.country}),P?(y("initialize() starting up, configuration: ",L),O=r,p=new Promise(function(e,n){document.addEventListener("deviceready",function(){W(e,n)},!1)}),k=!0,p):(y("version "+s+" running outside hybrid; loaded from server version: v"+f()),r&&r(P),p=Promise.resolve(P),k=!0,p)))},c.isInitialized=function(){return k},c.isOpen=function(){return T},c.isHybrid=function(){return K()},c.openUrl=function(e){return k?void window.open(e,"_system"):_("Stargate not initialized, call Stargate.initialize first!")},c.googleLogin=function(e,n){return k?(_("unimplemented"),void n("unimplemented")):n("Stargate not initialized, call Stargate.initialize first!")};var g,m={type:"unknown",networkState:"unknown"};c.addListener=function(e,n){"connectionchange"==e&&"function"==typeof n&&(y("onConnectionChange registered"),g=n)},c.checkConnection=function(){var e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0],n=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];return k?T?"undefined"==typeof navigator.connection||"function"!=typeof navigator.connection.getInfo?(n("Missing cordova plugin"),console.warn("Cordova Network Information module missing"),!1):(e(m),m):(n("Stargate closed, wait for Stargate.initialize to complete!"),!1):(n("Stargate not initialized, call Stargate.initialize first!"),!1)},c.getDeviceID=function(e,n){if(!k)return n("Stargate not initialized, call Stargate.initialize first!");if(!T)return n("Stargate closed, wait for Stargate.initialize to complete!"),!1;var t=I.uuid;e({deviceID:t})},c.goToLocalIndex=function(){if("undefined"!==window.cordova.file.applicationDirectory){var e="?hybrid=1",n=window.cordova.file.applicationDirectory+"www/index.html";r(n+e)}else _("Missing cordova-plugin-file. Install it with: cordova plugin add cordova-plugin-file")},c.goToWebIndex=function(){var e=c.conf.getWebappStartUrl()+"";y("Redirect to",e),r(e)},c.setStatusbarVisibility=function(e,n,t){return k?T?"undefined"==typeof window.StatusBar?(_("[StatusBar] missing cordova plugin"),t("missing cordova plugin")):e?(window.StatusBar.show(),n("statusbar shown")):(window.StatusBar.hide(),n("statusbar hided")):(t("Stargate closed, wait for Stargate.initialize to complete!"),!1):t("Stargate not initialized, call Stargate.initialize first!")},c.getVersion=function(){return s},c.getAppInformation=function(){return M},c.ad=new a;var w="2",h="1"==="IS_STAGING = 1".slice(-1),v=function(){for(var e=Array.prototype.slice.call(arguments),n="",t=0;t<e.length;t++)n+="object"==typeof e[t]?" "+JSON.stringify(e[t]):" "+e[t];return n},y=console.log.bind(window.console,"[Stargate] "),_=console.error.bind(window.console,"[Stargate] "),S=console.warn.bind(window.console,"[Stargate] ");h||(y=function(){console.log("[I] [Stargate] "+v.apply(null,arguments))},_=function(){console.log("[E] [Stargate] "+v.apply(null,arguments))},S=function(){console.log("[W] [Stargate] "+v.apply(null,arguments))});var b,I={available:!1,cordova:"",manufacturer:"",model:"",platform:"",uuid:"",version:""},R=function(){return"Android"==I.platform},D=function(){return"iOS"==I.platform},A=function(){if("undefined"==typeof window.device)return _("Missing cordova device plugin");for(var e in I)window.device.hasOwnProperty(e)&&(I[e]=window.device[e]);return!0},E=function(e){y("launchUrl: "+e),document.location.href=e},P=!1,k=!1,T=!1,O=null,C="",U="",x="",F=!1,L={},j=[],N={},M={
cordova:null,manufacturer:null,model:null,platform:null,deviceId:null,version:null,packageVersion:null,packageName:null,packageBuild:null,stargate:null,stargateModules:null,stargateError:null},z=function(){if("undefined"==typeof window.StatusBar)return _("[StatusBar] missing cordova plugin");if("undefined"!=typeof X.statusbar&&"undefined"!=typeof X.statusbar.hideOnUrlPattern&&X.statusbar.hideOnUrlPattern.constructor===Array){for(var e=document.location.href,n=!1,t=0;t<X.statusbar.hideOnUrlPattern.length;t++){var r=new RegExp(X.statusbar.hideOnUrlPattern[t]);if(r.test(e)){n=!0;break}}n?window.StatusBar.hide():window.StatusBar.show()}},G=function(){window.Cookies.set("hybrid","1"),window.localStorage.getItem("hybrid")||window.localStorage.setItem("hybrid",1)},B=function(){window.Cookies.set("stargateVersion",f()),window.localStorage.getItem("stargateVersion")||window.localStorage.setItem("stargateVersion",f())},V=function(){Q("leavesplash")||navigator.splashscreen.hide(),Y(!1),"undefined"!=typeof SpinnerDialog&&SpinnerDialog.hide()},q=function(e){if(y("onPluginReady() start"),document.title=X.title,D()&&"undefined"!=typeof window.cordova&&cordova.require){var t=cordova.require("cordova/exec");t.setJsToNativeBridgeMode(t.jsToNativeModes.IFRAME_NAV)}if(n(),B(),z(),$("mfp")&&Q("mfp")){var r=Z("mfp"),i=["motime_apikey","namespace","label"];i.forEach(function(e){!r.hasOwnProperty(e)&&X.hasOwnProperty(e)&&(r[e]=X[e])}),ne.check(r)}$("deltadna")&&window.deltadna.startSDK(X.deltadna.environmentKey,X.deltadna.collectApi,X.deltadna.engageApi,ae,se,X.deltadna.settings),Q("iapbase")?oe.initialize(Z("iapbase")):Q("iap")&&oe.initialize(Z("iap"))&&y("Init IAP done."),$("appsflyer")&&Q("appsflyer")&&le.init(Z("appsflyer")),u.init();var o=[];Q("game")&&$("game")&&l.game&&o.push(l.game._protected.initialize(Z("game"))),Promise.all(o).then(function(){J(e)})["catch"](function(n){_("onPluginReady() error: ",n),J(e,n)})},J=function(e,n){y("onStargateReady() start"),V(),T=!0,y("version "+s+" ready;  running in package version: "+C),M={cordova:I.cordova,manufacturer:I.manufacturer,model:I.model,platform:I.platform,deviceId:I.uuid,version:I.version,packageVersion:C,packageName:x,packageBuild:U,stargate:s},j&&j.constructor===Array&&(M.stargateModules=j.join(", ")),n&&n instanceof Error&&(M.stargateError=n.toString()),O(!0),y("Stargate.initialize() done"),e(!0)},W=function(e,n){y("onDeviceReady() start"),G(),A(),t(),Promise.all([cordova.getAppVersion.getVersionNumber(),o(),cordova.getAppVersion.getPackageName(),cordova.getAppVersion.getVersionCode(),i()]).then(function(t){C=t[0],"object"!=typeof t[1]&&(t[1]=JSON.parse(t[1])),x=t[2],U=t[3],t[4]&&"object"==typeof t[4]&&t[4].debug&&(F=!0),b=t[1].start_url,X=t[1].stargateConf,q(e,n)})["catch"](function(e){_("onDeviceReady() error: "+e),n("onDeviceReady() error: "+e)})},K=function(){var e=window.URI(document.location.href);return e.hasQuery("hybrid")?!0:window.Cookies.get("hybrid")?!0:window.localStorage.getItem("hybrid")?!0:!1},H=!1,Y=function(e){e?(H=!0,re()):(H=!1,ie())},X={features:{}},Z=function(e){if(!e)return _("getModuleConf() invalid module requested");if(e in N)return N[e];var n={iapbase:"IAP",iap:"IAP"},t=e;return n[e]&&(t=n[e]),t in L?L[t]:(y("getModuleConf(): no configuration for module: "+e+" ("+n+")"),{})},$=function(e){return"undefined"!=typeof X.features[e]&&X.features[e]},Q=function(e){return j&&j.constructor===Array?j.indexOf(e)>-1:!1},ee=function(){var e={},n=function(e){var n=["message","subject","files","chooserTitle"],t={url:e.url};return n.forEach(function(n){n in e&&(t[n]=e[n])}),t},t=function(e,t,r){var i=n(e),o=function(e){y("[share] Share completed? "+e.completed),y("[share] Shared to app: "+e.app),t(e)},a=function(e){_("[share] Sharing failed with message: "+e),r(e)};window.plugins.socialsharing.shareWithOptions(i,o,a)},r=function(e,n,t){var r=function(e){y("[share] Facebook share completed, result: ",e),n(e)},i=function(e){_("[share] Facebook sharing failed with message: "+e),t(e)};window.plugins.socialsharing.shareViaFacebook("",null,e.url,r,i)},i=function(e,n,t){var r=function(e){y("[share] Twitter share completed, result: ",e),n(e)},i=function(e){_("[share] Twitter sharing failed with message: "+e),t(e)},o="";"message"in e&&(o=e.message),window.plugins.socialsharing.shareViaTwitter(o,null,e.url,r,i)},o=function(e,n,t){var r=function(e){y("[share] Whatsapp share completed, result: ",e),n(e)},i=function(e){_("[share] Whatsapp sharing failed with message: "+e),t(e)},o="";"message"in e&&(o=e.message),window.plugins.socialsharing.shareViaWhatsApp(o,null,e.url,r,i)};return e.socialShare=function(e,n,a){return"object"!=typeof e&&(e={},S("[share] parameter options must be object!")),e.type||(e.type="chooser"),window.plugins&&window.plugins.socialsharing?e.url?"chooser"==e.type?t(e,n,a):"facebook"==e.type?r(e,n,a):"twitter"==e.type?i(e,n,a):"whatsapp"==e.type?o(e,n,a):(_("[share] type not valid"),a("type not valid")):(_("[share] missing parameter url"),a("missing parameter url")):(_("[share] missing cordova plugin"),a("missing cordova plugin"))},e}();c.socialShare=function(e){if(!k)return Promise.reject("Stargate not initialized, call Stargate.initialize first!");if(!T)return Promise.reject("Stargate closed, wait for Stargate.initialize to complete!");var n=new Promise(function(n,t){ee.socialShare(e,n,t)});return n};var ne=function(){var e={};return e.check=function(n){var t=["motime_apikey","namespace","label","country"];t.forEach(function(e){return n.hasOwnProperty(e)?n[e]?void 0:_("[MFP] Configuration: '"+e+"' not valid!"):_("[MFP] Configuration '"+e+"' not defined!")}),e.get(n)},e.getContents=function(e,n,t,r){var i={};i.api_country=t,i.country=e,i.fpnamespace=n,r&&(i.extData=r);var o=JSON.stringify(i);return o},e.getPonyValue=function(e){try{return e.split("=")[1]}catch(n){_(n)}return""},e.setSession=function(n){var t=b;window.localStorage.getItem("appUrl")&&(t=window.localStorage.getItem("appUrl"));var r=new URI(b),i=r.hostname(),o=URITemplate(X.api.mfpSetUriTemplate).expand({protocol:r.protocol(),hostname:i,url:t,domain:i,_PONY:e.getPonyValue(n)});y("[MobileFingerPrint] going to url: ",o),E(o)},e.get=function(n){var t="",r=URITemplate(X.api.mfpGetUriTemplate).expand({apikey:n.motime_apikey,contents_inapp:e.getContents(n.country,n.namespace,n.label),country:n.country,expire:t});window.aja().url(r).type("jsonp").on("success",function(n){y("[MobileFingerPrint] get() response: ",n);var t="";if(n.content.inappInfo){var r=JSON.parse(n.content.inappInfo);r.extData&&(r.extData.ponyUrl&&(t=r.extData.ponyUrl),r.extData.return_url&&window.localStorage.setItem("appUrl",r.extData.return_url),r.extData.session_mfp&&ue.track({page:"hybrid_initialize",action:"MFP_get",session_mfp:r.extData.session_mfp})),e.setSession(t)}else y("[MobileFingerPrint] get(): Empty session")}).on("error",function(e){_("[MobileFingerPrint] get() error: ",e)}).go()},{check:e.check}}(),te=function(){"use strict";function e(e,n){var t=(65535&e)+(65535&n),r=(e>>16)+(n>>16)+(t>>16);return r<<16|65535&t}function n(e,n){return e<<n|e>>>32-n}function t(t,r,i,o,a,s){return e(n(e(e(r,t),e(o,s)),a),i)}function r(e,n,r,i,o,a,s){return t(n&r|~n&i,e,n,o,a,s)}function i(e,n,r,i,o,a,s){return t(n&i|r&~i,e,n,o,a,s)}function o(e,n,r,i,o,a,s){return t(n^r^i,e,n,o,a,s)}function a(e,n,r,i,o,a,s){return t(r^(n|~i),e,n,o,a,s)}function s(n,t){n[t>>5]|=128<<t%32,n[(t+64>>>9<<4)+14]=t;var s,c,l,u,d,f=1732584193,p=-271733879,g=-1732584194,m=271733878;for(s=0;s<n.length;s+=16)c=f,l=p,u=g,d=m,f=r(f,p,g,m,n[s],7,-680876936),m=r(m,f,p,g,n[s+1],12,-389564586),g=r(g,m,f,p,n[s+2],17,606105819),p=r(p,g,m,f,n[s+3],22,-1044525330),f=r(f,p,g,m,n[s+4],7,-176418897),m=r(m,f,p,g,n[s+5],12,1200080426),g=r(g,m,f,p,n[s+6],17,-1473231341),p=r(p,g,m,f,n[s+7],22,-45705983),f=r(f,p,g,m,n[s+8],7,1770035416),m=r(m,f,p,g,n[s+9],12,-1958414417),g=r(g,m,f,p,n[s+10],17,-42063),p=r(p,g,m,f,n[s+11],22,-1990404162),f=r(f,p,g,m,n[s+12],7,1804603682),m=r(m,f,p,g,n[s+13],12,-40341101),g=r(g,m,f,p,n[s+14],17,-1502002290),p=r(p,g,m,f,n[s+15],22,1236535329),f=i(f,p,g,m,n[s+1],5,-165796510),m=i(m,f,p,g,n[s+6],9,-1069501632),g=i(g,m,f,p,n[s+11],14,643717713),p=i(p,g,m,f,n[s],20,-373897302),f=i(f,p,g,m,n[s+5],5,-701558691),m=i(m,f,p,g,n[s+10],9,38016083),g=i(g,m,f,p,n[s+15],14,-660478335),p=i(p,g,m,f,n[s+4],20,-405537848),f=i(f,p,g,m,n[s+9],5,568446438),m=i(m,f,p,g,n[s+14],9,-1019803690),g=i(g,m,f,p,n[s+3],14,-187363961),p=i(p,g,m,f,n[s+8],20,1163531501),f=i(f,p,g,m,n[s+13],5,-1444681467),m=i(m,f,p,g,n[s+2],9,-51403784),g=i(g,m,f,p,n[s+7],14,1735328473),p=i(p,g,m,f,n[s+12],20,-1926607734),f=o(f,p,g,m,n[s+5],4,-378558),m=o(m,f,p,g,n[s+8],11,-2022574463),g=o(g,m,f,p,n[s+11],16,1839030562),p=o(p,g,m,f,n[s+14],23,-35309556),f=o(f,p,g,m,n[s+1],4,-1530992060),m=o(m,f,p,g,n[s+4],11,1272893353),g=o(g,m,f,p,n[s+7],16,-155497632),p=o(p,g,m,f,n[s+10],23,-1094730640),f=o(f,p,g,m,n[s+13],4,681279174),m=o(m,f,p,g,n[s],11,-358537222),g=o(g,m,f,p,n[s+3],16,-722521979),p=o(p,g,m,f,n[s+6],23,76029189),f=o(f,p,g,m,n[s+9],4,-640364487),m=o(m,f,p,g,n[s+12],11,-421815835),g=o(g,m,f,p,n[s+15],16,530742520),p=o(p,g,m,f,n[s+2],23,-995338651),f=a(f,p,g,m,n[s],6,-198630844),m=a(m,f,p,g,n[s+7],10,1126891415),g=a(g,m,f,p,n[s+14],15,-1416354905),p=a(p,g,m,f,n[s+5],21,-57434055),f=a(f,p,g,m,n[s+12],6,1700485571),m=a(m,f,p,g,n[s+3],10,-1894986606),g=a(g,m,f,p,n[s+10],15,-1051523),p=a(p,g,m,f,n[s+1],21,-2054922799),f=a(f,p,g,m,n[s+8],6,1873313359),m=a(m,f,p,g,n[s+15],10,-30611744),g=a(g,m,f,p,n[s+6],15,-1560198380),p=a(p,g,m,f,n[s+13],21,1309151649),f=a(f,p,g,m,n[s+4],6,-145523070),m=a(m,f,p,g,n[s+11],10,-1120210379),g=a(g,m,f,p,n[s+2],15,718787259),p=a(p,g,m,f,n[s+9],21,-343485551),f=e(f,c),p=e(p,l),g=e(g,u),m=e(m,d);return[f,p,g,m]}function c(e){var n,t="";for(n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function l(e){var n,t=[];for(t[(e.length>>2)-1]=void 0,n=0;n<t.length;n+=1)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function u(e){return c(s(l(e),8*e.length))}function d(e,n){var t,r,i=l(e),o=[],a=[];for(o[15]=a[15]=void 0,i.length>16&&(i=s(i,8*e.length)),t=0;16>t;t+=1)o[t]=909522486^i[t],a[t]=1549556828^i[t];return r=s(o.concat(l(n)),512+8*n.length),c(s(a.concat(r),640))}function f(e){var n,t,r="0123456789abcdef",i="";for(t=0;t<e.length;t+=1)n=e.charCodeAt(t),i+=r.charAt(n>>>4&15)+r.charAt(15&n);return i}function p(e){return unescape(encodeURIComponent(e))}function g(e){return u(p(e))}function m(e){return f(g(e))}function w(e,n){return d(p(e),p(n))}function h(e,n){return f(w(e,n))}function v(e,n,t){return n?t?w(n,e):h(n,e):t?g(e):m(e)}return v}(),re=function(e){if("undefined"==typeof window.SpinnerDialog)return _("startLoading(): SpinnerDialog cordova plugin missing!");"object"!=typeof e&&(e={});var n=null;return e.hasOwnProperty("message")&&(n=e.message),window.SpinnerDialog.show(null,n),!0},ie=function(){return"undefined"==typeof window.SpinnerDialog?_("startLoading(): SpinnerDialog cordova plugin missing!"):(window.SpinnerDialog.hide(),!0)};window.startLoading=re,window.stopLoading=ie;var oe={id:"",alias:"",type:"",verbosity:"",paymethod:"",subscribeMethod:"",returnUrl:"",callbackSuccess:function(){y("[IAP] Undefined callbackSuccess")},callbackError:function(){y("[IAP] Undefined callbackError")},callbackListingSuccess:function(){y("[IAP] Undefined callbackListingSuccess")},callbackListingError:function(){y("[IAP] Undefined callbackListingError")},callbackPurchaseSuccess:function(){y("[IAP] Undefined callbackPurchaseSuccess")},requestedListingProductId:"",inappPurchaseCalled:!1,inappProductInfoCalled:!1,lastCreateUserProduct:null,lastCreateUserToken:null,refreshDone:!1,lastCreateuserUrl:"",lastCreateuserData:"",createUserAttempt:0,maxCreateUserAttempt:6,refreshInProgress:!1,productsInfo:{},initialize:function(e){return window.store?(oe.returnUrl=document.location.href,e.id?oe.id=e.id:R()?oe.id=e.id_android:D()&&(oe.id=e.id_ios),oe.id?(e.alias&&(oe.alias=e.alias),e.type&&(oe.type=e.type),e.api_createuser&&(oe.subscribeMethod=e.api_createuser),oe.verbosity="INFO",oe.paymethod=R()?"gwallet":"itunes",y("IAP initialize id: "+oe.id),R()&&oe.getGoogleAccount(),window.store.verbosity=window.store[oe.verbosity],window.store.register({id:oe.id,alias:oe.alias,type:window.store[oe.type]}),window.store.when(oe.alias).approved(function(e){oe.onPurchaseApproved(e)}),window.store.when(oe.alias).verified(function(e){oe.onPurchaseVerified(e)}),window.store.when(oe.alias).updated(function(e){oe.onProductUpdate(e)}),window.store.when(oe.alias).owned(function(e){oe.onProductOwned(e)}),window.store.when(oe.alias).cancelled(function(e){oe.onCancelledProduct(e)}),window.store.when(oe.alias).error(function(e){oe.error(JSON.stringify(e))}),window.store.ready(function(){oe.onStoreReady()}),window.store.when("order "+oe.id).approved(function(e){oe.onOrderApproved(e)}),window.store.when("product").updated(function(e){oe.saveProductInfo(e)}),!0):(_("[IAP] Configuration error, missing product id!"),!1)):(_("[IAP] Store not available, missing cordova plugin."),!1)},saveProductInfo:function(e){return oe.refreshInProgress=!1,"object"!=typeof e?void _("[IAP] saveProductInfo() got invalid data"):"id"in e?(oe.productsInfo[e.id]=e,void(oe.requestedListingProductId===e.id&&oe.callbackListingSuccess(e))):void _("[IAP] saveProductInfo() got invalid data, id undefined")},doRefresh:function(e){oe.refreshInProgress&&S("[IAP] doRefresh() refresh in progress, skipping..."),(!oe.refreshDone||e)&&(window.store.refresh(),oe.refreshDone=!0,oe.refreshInProgress=!0,y("[IAP] doRefresh() refreshing..."))},getPassword:function(e){return te("iap."+e+".playme").substr(0,8)},getGoogleAccount:function(){window.accountmanager.getAccounts(oe.checkGoogleAccount,oe.error,"com.google")},checkGoogleAccount:function(e){if(e){y("[IAP] accounts"),y(e);for(var n in e)return window.localStorage.setItem("googleAccount",e[n].email),e[n].email}},onProductUpdate:function(e){y("IAP> Product updated."),y(JSON.stringify(e)),y(e.owned?"[IAP] Subscribed!":"[IAP] Not Subscribed")},onPurchaseApproved:function(e){y("IAP> Purchase approved."),y(JSON.stringify(e)),e.finish()},onPurchaseVerified:function(e){y("subscription verified ",e)},onStoreReady:function(){y("\\o/ STORE READY \\o/")},onProductOwned:function(e){if(y("[IAP] > Product Owned."),!e.transaction.id&&D())return _("[IAP] > no transaction id"),!1;if(window.localStorage.setItem("product",e),D()&&window.localStorage.setItem("transaction_id",e.transaction.id),R()){var n=e.transaction.purchaseToken+"|"+x+"|"+oe.id;y("[IAP] Purchase Token: "+n),window.localStorage.getItem("user_account")||oe.createUser(e,n)}else window.storekit.loadReceipts(function(n){window.localStorage.getItem("user_account")||(n.appStoreReceipt?(y("[IAP] appStoreReceipt: "+n.appStoreReceipt),oe.createUser(e,n.appStoreReceipt)):y("[IAP] appStoreReceipt empty, ignoring request"))})},onCancelledProduct:function(e){Y(!1),oe.callbackError({iap_cancelled:1,return_url:oe.returnUrl}),y("[IAP] > Purchase cancelled ##################################",e)},onOrderApproved:function(e){y("[IAP] ORDER APPROVED "+oe.id),e.finish()},error:function(e){Y(!1),_("[IAP] error: "+e),oe.callbackError({iap_error:1,return_url:oe.returnUrl})},createUser:function(e,n){if(y("[IAP] createUser start "),!oe.inappProductInfoCalled&&!oe.inappPurchaseCalled)return oe.lastCreateUserProduct=e,void(oe.lastCreateUserToken=n);if(!oe.subscribeMethod)return void _("[IAP] createUser configuration error: missing api url.");window.localStorage.setItem("user_account",R()?window.localStorage.getItem("googleAccount")?window.localStorage.getItem("googleAccount"):n+"@google.com":e.transaction.id+"@itunes.com");var t=oe.subscribeMethod,r={paymethod:oe.paymethod,user_account:window.localStorage.getItem("user_account"),purchase_token:n,return_url:oe.returnUrl,inapp_pwd:oe.getPassword(n),hybrid:1};oe.lastCreateuserUrl=t,oe.lastCreateuserData=r;var i=function(e){if(oe.createUserAttempt<=oe.maxCreateUserAttempt)_("[IAP] createUser failed "+oe.createUserAttempt+" times, trying again... last error: "+JSON.stringify(e)),s();else{_("[IAP] createUser onCreateError: removing user_account"),window.localStorage.removeItem("user_account");var n={iap_error:"1",return_url:oe.returnUrl};Y(!1),oe.inappPurchaseCalled?oe.callbackError(n):oe.inappProductInfoCalled&&oe.callbackListingError(n)}},o=function(e){y("[IAP] createUser success ",e);try{e.device_id=I.uuid,window.localStorage.getItem("transaction_id")&&(e.transaction_id=window.localStorage.getItem("transaction_id")),Y(!1),oe.callbackSuccess(e),oe.inappPurchaseCalled?oe.callbackSuccess(e):oe.inappProductInfoCalled&&oe.callbackPurchaseSuccess(e)}catch(n){i(n)}},a=10,s=function(){setTimeout(function(){oe.createUserAttempt=oe.createUserAttempt+1,y("[IAP] createUser attempt: "+oe.createUserAttempt+" with timeout: "+a+"sec."),y("[IAP] POST createUser: "+oe.lastCreateuserUrl+" params: "+JSON.stringify(oe.lastCreateuserData)+" timeout: "+1e3*a),window.aja().method("POST").url(oe.lastCreateuserUrl).cache(!1).timeout(1e3*a).data(oe.lastCreateuserData).on("success",function(e){o(e)}).on("error",function(e){i(e)}).on("4xx",function(e){i(e)}).on("5xx",function(e){i(e)}).on("timeout",function(){i("timeout")}).on("end",function(){y("[IAP] createUser end"),Y(!1)}).go(),a+=5},10)};oe.createUserAttempt=0,s()}};c.inAppPurchaseSubscription=function(e,n,t,r){return k?T?(Y(!0),"undefined"!=typeof r&&(oe.returnUrl=r),"undefined"!=typeof t&&(oe.subscribeMethod=t),oe.callbackSuccess=e,oe.callbackError=n,oe.inappPurchaseCalled=!0,oe.lastCreateUserProduct&&oe.lastCreateUserToken?(oe.createUser(oe.lastCreateUserProduct,oe.lastCreateUserToken),!0):(oe.doRefresh(),window.store.order(oe.id),!0)):(n("Stargate closed, wait for Stargate.initialize to complete!"),!1):(n("Stargate not initialized, call Stargate.initialize first!"),!1)},c.inAppRestore=function(e,n,t,r){return k?T?("undefined"!=typeof t&&(oe.subscribeMethod=t),"undefined"!=typeof r&&(oe.returnUrl=r),oe.callbackSuccess=e,oe.callbackError=n,oe.inappPurchaseCalled=!0,void oe.doRefresh(!0)):n("Stargate closed, wait for Stargate.initialize to complete!"):n("Stargate not initialized, call Stargate.initialize first!")},c.inAppProductInfo=function(e){if(e.productId||(e.productId=oe.id),"function"!=typeof e.callbackListingSuccess&&(e.callbackListingSuccess=function(){}),"function"!=typeof e.callbackPurchaseSuccess&&(e.callbackPurchaseSuccess=function(){}),"function"!=typeof e.callbackError&&(e.callbackError=function(){}),!e.subscriptionUrl)return _("[IAP] inAppProductInfo(): options.subscriptionUrl invalid"),!1;if(!k)return e.callbackError("Stargate not initialized, call Stargate.initialize first!"),!1;if(!T)return e.callbackError("Stargate closed, wait for Stargate.initialize to complete!"),!1;if(oe.subscribeMethod=e.subscriptionUrl,oe.requestedListingProductId=e.productId,oe.callbackListingSuccess=e.callbackListingSuccess,oe.callbackPurchaseSuccess=e.callbackPurchaseSuccess,oe.callbackListingError=e.callbackError,oe.inappProductInfoCalled=!0,oe.productsInfo[e.productId])try{oe.callbackListingSuccess(oe.productsInfo[e.productId])}catch(n){_("[IAP] inAppProductInfo(): error on callbackListingSuccess!")}return oe.lastCreateUserProduct&&oe.lastCreateUserToken?(oe.createUser(oe.lastCreateUserProduct,oe.lastCreateUserToken),!0):(oe.doRefresh(!0),!0)},c.facebookLogin=function(e,n,t){return k?void facebookConnectPlugin.login(e.split(","),function(e){y("[facebook] got userdata: ",e),facebookConnectPlugin.getAccessToken(function(e){n({accessToken:e})},function(e){t({error:e})})},function(e){_("Got FB login error:",e),t({error:e})}):t("Stargate not initialized, call Stargate.initialize first!")},c.facebookShare=function(e,n,t){if(!k)return t("Stargate not initialized, call Stargate.initialize first!");var r={method:"share",href:e};facebookConnectPlugin.showDialog(r,function(e){n({message:e})},function(e){_("Got FB share error:",e),t({error:e})})};var ae=function(){deltadna.registerPushCallback(ce)},se=function(e){_("[DeltaDNA] error: "+e)},ce=function(e){return R()&&e.payload&&e.payload.url&&!e.foreground?E(e.payload.url):D()&&e.url?E(e.url):void 0},le=function(){var e,n={},t={};return n.init=function(){if(!window.plugins||!window.plugins.appsFlyer)return _("[appsflyer] missing cordova plugin");if("undefined"==typeof X.appstore_appid)return _("[appsflyer] missing manifest configuration: appstore_appid");if("undefined"==typeof X.appsflyer_devkey)return _("[appsflyer] missing manifest configuration: appsflyer_devkey");var n=[X.appsflyer_devkey];D()&&n.push(X.appstore_appid),document.addEventListener("onInstallConversionDataLoaded",function(n){if(t=n.detail,"function"!=typeof e)return y("[appsflyer] callback not set!");try{e(t),y("[appsflyer] parameters sent to webapp callback: "+JSON.stringify(t))}catch(r){_("[appsflyer] callback error: "+r,r)}},!1),window.plugins.appsFlyer.initSdk(n)},n.setCallback=function(n){e=n},n}();c.setConversionDataCallback=function(e){le.setCallback(e)};var ue=function(){var e,n={};return n.track=function(n){if("function"!=typeof e)return y("[analytics] callback not set!");try{e(n)}catch(t){_("[analytics] callback error: "+t,t)}},n.setCallback=function(n){e=n},n}();c.setAnalyticsCallback=function(e){ue.setCallback(e)};return c.game=l.game._public,c.file=l.file,c});
=======
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.Stargate=t()}(this,function(){function e(e){g.type=e.type,g.networkState=navigator.connection.type,"function"==typeof f&&f(g)}function t(){document.addEventListener("offline",e,!1),document.addEventListener("online",e,!1)}function n(){g.networkState=navigator.connection.type,"none"===navigator.connection.type?g.type="offline":g.type="online"}function r(e){if("android"==window.device.platform.toLowerCase())window.navigator.app.loadUrl(e);else if("ios"==window.device.platform.toLowerCase()&&-1!==e.indexOf("file:///")){var t=e.split("?")[0];v("Without qs",t),window.resolveLocalFileSystemURL(t,function(e){var t=e.toInternalURL()+"?hybrid=1";v("Redirect to",t),window.location.href=t},_)}else window.location.href=e}function o(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.AppIsDebug?new Promise(function(e,t){window.cordova.plugins.AppIsDebug.get(function(t){e(t)},function(e){_("getAppIsDebug(): "+e,e),t(new Error(e))})}):(_("getAppIsDebug(): plugin not available!"),Promise.resolve({}))}function i(){return window.cordova.file?l.file.readFileAsJSON(window.cordova.file.applicationDirectory+"www/manifest.json"):window.hostedwebapp?new Promise(function(e,t){window.hostedwebapp.getManifest(function(t){e(t)},function(e){_(e),t(new Error(e))})}):(_("getManifest() no available reading mechanism!"),Promise.resolve({}))}var a="0.4.5",s={},l={};!function(e){function t(e,n,r){this.level=t.levels[e.toUpperCase()],this.styles=r||{background:"white",color:"black"},this.tag="%c "+n+" ",this.isstaging="1"==="IS_STAGING = 1".slice(-1),this.styleString="background:"+this.styles.background+";color:"+this.styles.color+";";var o=function(){if(arguments.length<1)return"";for(var e=Array.prototype.slice.call(arguments[0]),t="",n=0;n<e.length;n++)t+="object"==typeof e[n]?" "+JSON.stringify(e[n]):" "+e[n];return t},i=window.console.log.bind(window.console,this.tag,this.styleString),a=window.console.info.bind(window.console,this.tag,this.styleString),s=window.console.error.bind(window.console,this.tag,this.styleString),l=window.console.warn.bind(window.console,this.tag,this.styleString);this.isstaging||(i=function(){window.console.log("[D] [Stargate] "+o.apply(null,arguments))},a=function(){window.console.log("[I] [Stargate] "+o.apply(null,arguments))},s=function(){window.console.log("[E] [Stargate] "+o.apply(null,arguments))},l=function(){window.console.log("[W] [Stargate] "+o.apply(null,arguments))}),Object.defineProperties(this,{__d:{value:i,writable:!1,enumerable:!1,configurable:!1},__i:{value:a,writable:!1,enumerable:!1,configurable:!1},__e:{value:s,writable:!1,enumerable:!1,configurable:!1},__w:{value:l,writable:!1,enumerable:!1,configurable:!1}})}function n(e){var t=0;return{next:function(n){return n&&(t=0),t<e.length?{value:e[t++],done:!1}:{done:!0}}}}function r(e,t){e+="?";var n="";for(var r in t)n+=encodeURIComponent(r)+"="+encodeURIComponent(t[r])+"&";return n.length>0&&(n=n.substring(0,n.length-1)),e+n}function o(e){e=encodeURI(e);var t="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n="responseType"in t;t.open("GET",e,!0),n&&(t.responseType="json");var r=new Promise(function(e,r){t.onreadystatechange=function(){if(4===t.readyState)try{var o=n?t.response:JSON.parse(t.responseText);e(o)}catch(i){r(i)}}});return t.setRequestHeader("Content-type","application/json; charset=UTF-8"),t.send(),r}function i(e){var t=this;if(t.timeout=3e3,t.called=!1,window.document){var n=Date.now();t.scriptTag=window.document.createElement("script"),e+="&callback=window.__jsonpHandler_"+n,t.scriptTag.src=e,t.scriptTag.type="text/javascript",t.scriptTag.async=!0,t.prom=new Promise(function(e,r){var o="__jsonpHandler_"+n;window[o]=function(n){t.called=!0,e(n),t.scriptTag.parentElement.removeChild(t.scriptTag),delete window[o]},setTimeout(function(){t.called||(r("Timeout jsonp request "+n),t.scriptTag.parentElement.removeChild(t.scriptTag),delete window[o])},t.timeout)}),window.document.getElementsByTagName("head")[0].appendChild(t.scriptTag)}}function a(e,t){var n=t||function(){};return new Promise(function(t,r){function o(){var n;switch(e.responseType){case"blob":n=new Blob([this.response],{type:e.mimeType||"image/jpeg"});break;case"arraybuffer":n=this.response;break;default:n=this.response,t(n)}}var i=new XMLHttpRequest;i.open("GET",e.url,!0),i.responseType=e.responseType||"blob",e.withCredentials&&(i.withCredentials=e.withCredentials);var a=r,s=r;i.addEventListener("progress",n,!1),i.addEventListener("load",o,!1),i.addEventListener("error",s,!1),i.addEventListener("abort",a,!1),i.send(null)})}function s(e,t){var n=Object.prototype.toString.apply({});if(e.toString()!==n||t.toString()!==n)throw new Error("Cannot merge different type");var r={};for(var o in e)e.hasOwnProperty(o)&&(r[o]=e[o]);for(var i in t)t.hasOwnProperty(o)&&(r[i]=t[i]);return r}t.levels={ALL:5,ERROR:4,WARN:3,INFO:2,DEBUG:1,OFF:0},t.prototype.e=function(){0!==this.level&&this.level>=t.levels.ERROR&&this.__e(arguments)},t.prototype.i=function(){0!==this.level&&this.level>=t.levels.WARN&&this.__i(arguments)},t.prototype.w=function(){0!==this.level&&this.level>=t.levels.INFO&&this.__w(arguments)},t.prototype.d=function(){0!==this.level&&this.level>=t.levels.DEBUG&&this.__d(arguments)},t.prototype.setLevel=function(e){this.level=t.levels[e]};var l={Iterator:n,Logger:t,composeApiString:r,getJSON:o,jsonpRequest:i,getImageRaw:a,extend:s};e?e.Utils=l:window.Utils=l}(l),function(e,t){function n(e){var t=e.map(function(e){return{fullPath:e.fullPath,path:e.toURL(),internalURL:e.toInternalURL(),isFile:e.isFile,isDirectory:e.isDirectory}});return 1==t.length?t[0]:t}var r={},o=new t.Logger("ALL","[File - module]");r.LOG=o,window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,r.ERROR_MAP={1:"NOT_FOUND_ERR",2:"SECURITY_ERR",3:"ABORT_ERR",4:"NOT_READABLE_ERR",5:"ENCODING_ERR",6:"NO_MODIFICATION_ALLOWED_ERR",7:"INVALID_STATE_ERR",8:"SYNTAX_ERR",9:"INVALID_MODIFICATION_ERR",10:"QUOTA_EXCEEDED_ERR",11:"TYPE_MISMATCH_ERR",12:"PATH_EXISTS_ERR"},r.currentFileTransfer=null,r.resolveFS=function(e){return new Promise(function(t,n){window.resolveLocalFileSystemURL(e,t,n)})},r.appendToFile=function(e,t,o,i){return o=void 0===arguments[2]?!1:arguments[2],i=void 0===arguments[3]?"text/plain":arguments[3],r.resolveFS(e).then(function(e){return new Promise(function(r,a){e.createWriter(function(s){o||s.seek(s.length);var l;l=t instanceof Blob?t:new Blob([t],{type:i}),s.write(l),s.onerror=a,s.onabort=a,s.onwriteend=function(){r(n([e]))}},a)})})},r.readFileAsHTML=function(e){return r.readFile(e).then(function(e){return(new window.DOMParser).parseFromString(e,"text/html")})},r.readFileAsJSON=function(e){return r.readFile(e).then(function(e){try{return Promise.resolve(window.JSON.parse(e))}catch(t){return Promise.reject(t)}})},r.removeFile=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,n){e.remove(function(e){t(null===e||"OK"===e)},n)})})},r.removeDir=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,n){e.removeRecursively(function(e){t(null===e||"OK"===e)},n)})})},r._promiseZip=function(e,t,n){return o.d("PROMISEZIP:",arguments),new Promise(function(r,o){window.zip.unzip(e,t,function(e){0===e?r(!0):o(e)},n)})},r.download=function(e,t,o,i){var a=this;this.ft=new window.FileTransfer,this.ft.onprogress=i,r.currentFileTransfer=a.ft,a.promise=new Promise(function(r,i){a.ft.download(window.encodeURI(e),t+o,function(e){r(n([e])),a.ft=null},function(e){i(e),a.ft=null},!0)})},r.createDir=function(e,t){return r.resolveFS(e).then(function(e){return new Promise(function(r,o){e.getDirectory(t,{create:!0},function(e){r(n([e]))},o)})})},r.fileExists=function(e){return new Promise(function(t){window.resolveLocalFileSystemURL(e,function(e){t(e.isFile)},function(e){t(1!==e.code)})})},r.dirExists=function(e){return new Promise(function(t){window.resolveLocalFileSystemURL(e,function(e){t(e.isDirectory)},function(e){t(1!=e.code)})})},r.requestFileSystem=function(e,t){return new Promise(function(n,r){window.requestFileSystem(e,t,n,r)})},r.readDir=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,r){var i=e.createReader();i.readEntries(function(e){o.d("readDir:",e),t(n(e))},r)})})},r.readFile=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,n){e.file(function(e){var r=new FileReader;r.onerror=n,r.onabort=n,r.onloadend=function(){var e=this.result;t(e)},r.readAsText(e)})})})},r.createFile=function(e,t){return r.resolveFS(e).then(function(e){return new Promise(function(r,o){e.getFile(t,{create:!0},function(e){r(n([e]))},o)})})},r.write=function(e,t){return r.appendToFile(e,t,!0)},r.moveDir=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),i=t.replace(n,"");return o.d("moveDir:",i,n),Promise.all([r.resolveFS(e),r.resolveFS(i)]).then(function(e){return o.d("moveDir: resolved entries",e),new Promise(function(t,r){e[0].moveTo(e[1],n,t,r)})})},r.copyFile=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),i=t.replace(n,"");return Promise.all([r.resolveFS(e),r.resolveFS(i)]).then(function(e){return o.d("copyFileTo",e),new Promise(function(t,r){e[0].copyTo(e[1],n,t,r)})})},r.copyDir=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),i=t.replace(n,"");return Promise.all([r.resolveFS(e),r.resolveFS(i)]).then(function(r){return o.d("copyDir",e,"in",t),new Promise(function(e,t){r[0].copyTo(r[1],n,e,t)})})},e?e.file=r:window.file=r}(l,l.Utils),function(e,t,n){"use strict";function r(){}function o(t){if(t&&(I=A(I,t)),C.d("Initialized called with:",I),!e)return Promise.reject("Missing file module!");try{w=window.cordova.file.applicationStorageDirectory,h=window.cordova.file.cacheDirectory,v=window.cordova.file.tempDirectory,_=window.cordova.file.applicationDirectory+"www/",S=window.cordova.file.applicationDirectory+"www/js/stargate.js",y=window.cordova.file.dataDirectory}catch(r){return C.e(r),Promise.reject(r)}"ios"==window.device.platform.toLowerCase()&&(w+="Documents/"),"android"==window.device.platform.toLowerCase()&&(v=h),D.SDK_DIR=w+"scripts/",D.SDK_RELATIVE_DIR="../../scripts/",D.GAMEOVER_RELATIVE_DIR="../../gameover_template/",D.GAMES_DIR=w+"games/",D.BASE_DIR=w,D.CACHE_DIR=h,D.TEMP_DIR=v,D.CORDOVAJS=_+"cordova.js",D.CORDOVA_PLUGINS_JS=_+"cordova_plugins.js",D.STARGATEJS=_+"js/stargate.js",D.DATA_DIR=y,D.GAMEOVER_DIR=D.BASE_DIR+"gameover_template/",D.WWW_DIR=_,C.i("cordova JS dir to include",D.CORDOVAJS),n.game._public.BASE_DIR=D.BASE_DIR,n.game._public.OFFLINE_INDEX=D.WWW_DIR+"index.html";var o=e.createDir(D.BASE_DIR,"games"),s=e.createDir(D.BASE_DIR,"scripts"),l=e.fileExists(D.BASE_DIR+"offlineData.json").then(function(t){return t?(C.i("offlineData.json already exists"),t):(C.i("creating offlineData.json"),e.createFile(D.BASE_DIR,"offlineData.json").then(function(t){return C.d("offlineData",t),e.write(t.path,JSON.stringify(T))}))});return Promise.all([o,s,l]).then(function(e){return C.d("GamesDir, ScriptsDir, offlineData.json created",e),i()}).then(a)}function i(){return Promise.all([e.dirExists(D.BASE_DIR+"gameover_template"),e.dirExists(D.SDK_DIR+"plugins"),e.fileExists(D.SDK_DIR+"cordova.js"),e.fileExists(D.SDK_DIR+"cordova_plugins.js"),e.fileExists(D.SDK_DIR+"stargate.js"),e.fileExists(D.SDK_DIR+"gamesFixes.js")]).then(function(t){var n=[];return t[0]||n.push(e.copyDir(D.WWW_DIR+"gameover_template",D.BASE_DIR+"gameover_template")),t[1]||n.push(e.copyDir(D.WWW_DIR+"plugins",D.SDK_DIR+"plugins")),t[2]||n.push(e.copyFile(D.CORDOVAJS,D.SDK_DIR+"cordova.js")),t[3]||n.push(e.copyFile(D.CORDOVA_PLUGINS_JS,D.SDK_DIR+"cordova_plugins.js")),t[4]||n.push(e.copyFile(D.STARGATEJS,D.SDK_DIR+"stargate.js")),t[5]||n.push(e.copyFile(D.WWW_DIR+"js/gamesFixes.js",D.SDK_DIR+"gamesFixes.js")),Promise.all(n)})}function a(){return Promise.all([e.fileExists(D.SDK_DIR+"dixie.js"),e.fileExists(D.SDK_DIR+"gfsdk.min.js")]).then(function(t){var n=t[0],r=t[1],o=[];return r||""===I.sdk_url||(C.d("get SDK"),o.push(new e.download(I.sdk_url,D.SDK_DIR,"gfsdk.min.js").promise)),n||""===I.dixie_url||(C.d("get dixie"),o.push(new e.download(I.dixie_url,D.SDK_DIR,"dixie.js").promise)),Promise.all(o)})}function s(t){return C.d("_getIndexHtmlById",D.GAMES_DIR+t),e.readDir(D.GAMES_DIR+t).then(function(e){return C.d("_getIndexHtmlById readDir",e),e.filter(function(e){var t=new RegExp(/index\.html$/i);return t.test(e.path)})})}function l(e){C.d("_removeRemoteSDK");for(var t,n=e.querySelectorAll("script"),r=0;r<n.length;r++)if(-1!==n[r].src.indexOf("gfsdk")){t=n[r],C.d("_removeRemoteSDK",t),t.parentNode.removeChild(t);break}return e}function c(e,t){e=l(e);var n,r,o=Array.isArray(t)===!1?[t]:t;C.d("injectScripts",o);var i=document.createElement("meta");i.httpEquiv="Content-Security-Policy",i.content="default-src * data: content: cdvfile: file: http: https: gap: https://ssl.gstatic.com 'unsafe-inline' 'unsafe-eval';style-src * cdvfile: http: https: 'unsafe-inline';",e.head.insertBefore(i,e.getElementsByTagName("meta")[0]);var a=e.createElement("script");a.id="__root__",e.head.insertBefore(a,e.head.firstElementChild);for(var s=e.createDocumentFragment(),c=0;c<o.length;c++)o[c].endsWith(".css")?(C.d("css inject:",o[c]),r=e.createElement("link"),r.rel="stylesheet",r.href=o[c],e.head.insertBefore(r,e.getElementsByTagName("link")[0])):(n=e.createElement("script"),n.src=o[c],s.appendChild(n));return e.head.insertBefore(s,e.head.getElementsByTagName("script")[0]),C.d("Cleaned dom:",e),e}function u(e){var t=[];t.push(e.querySelector("link[href='/gmenu/frame.css']")),t.push(e.querySelector("iframe#menu")),t.push(e.querySelector("script[src='/gmenu/toggle.js']"));for(var n=e.querySelectorAll("script"),r=n.length-1;r>=0;r--)if(-1!==n[r].innerHTML.indexOf("function open")){t.push(n[r]);break}for(var o=0;o<t.length;o++)t[o]&&t[o].parentNode.removeChild(t[o]);return e}function d(t,n){var r;return s(t).then(function(t){return r=t[0].path,C.d("injectScripts",r),e.readFileAsHTML(t[0].path)}).then(function(e){function t(t){e.head.appendChild(t)}var r=e.body.querySelectorAll("meta"),o=e.body.querySelectorAll("link"),i=e.body.querySelectorAll("style"),a=e.body.querySelectorAll("title");r=[].slice.call(r),o=[].slice.call(o),i=[].slice.call(i),a=[].slice.call(a);var s=r.concat(o).concat(i).concat(a);return s.map(t),e.body.innerHTML=e.body.innerHTML.trim(),C.d("_injectScripts"),C.d(e),c(e,n)}).then(u).then(function(e){var t=[].slice.call(e.querySelector("html").attributes),n=t.map(function(e){return e.name+'="'+e.value+'"'}).join(" "),r="<!DOCTYPE html><html "+n+">"+e.documentElement.innerHTML+"</html>";return C.d("Serialized dom",r),r}).then(function(t){return C.d("Write dom:",r,t),e.write(r,t)})}function p(e){var t=new RegExp(/index\.html$/i);return t.test(e)}function f(n){var r=n.url.replace("[WSIZE]",n.size.width).replace("[HSIZE]",n.size.height).split("?")[0],o=D.GAMES_DIR+n.gameId,i=n.type+"_"+n.size.width+"x"+n.size.height+("_"+n.size.ratio||"")+".jpeg";return C.d("request Image to",r,"coverImageUrl",i,"imagesFolder",o),"xhr"===n.method?Promise.all([e.createFile(o,i),t.getImageRaw({url:r})]).then(function(t){var n=t[0],r=t[1];return e.appendToFile(n.path,r,!0,"image/jpeg")}):new e.download(r,o,i,function(){}).promise}function g(e){var t=R(I.ga_for_game_url,O),n=new b(t).prom;return n.then(function(n){C.d("apiGaForGames:",t,"ga_for_game:",n);var r=R(I.gamifive_info_api,{content_id:e,_PONY:n._PONYVALUE,format:"jsonp"});return C.d("gamifive_info_api",r),[new b(r).prom,n]}).then(function(t){return t[0].then(function(n){return C.d("gamifiveInfo:",n,"ga_for_game",t[1]),m({content_id:e,ga_for_game:t[1],gamifive_info:n.game_info})})})}function m(t){return e.readFileAsJSON(D.BASE_DIR+"offlineData.json").then(function(e){return e.GaForGame[t.content_id]=t.ga_for_game,e.GamifiveInfo[t.content_id]=t.gamifive_info,e}).then(function(t){return C.d("writing offlineData.json",t),e.write(D.BASE_DIR+"offlineData.json",JSON.stringify(t))})}var w,h,v,_,y,S,E=t.Logger,R=t.composeApiString,b=t.jsonpRequest,A=t.extend,D={},I={sdk_url:"",dixie_url:"",api:"",ga_for_game_url:"",gamifive_info_api:"",bundle_games:[]},P=!1,T={GaForGame:{},GamifiveInfo:{},queues:{}},O={print_json_response:1},L={content_id:"",formats:"html5applications",sort:"-born_date",category:"b940b384ff0565b06dde433e05dc3c93",publisher:"",size:6,offset:0,label:"",label_slug:"",access_type:"",real_customer_id:"xx_gameasy",lang:"en",use_cs_id:"",white_label:"xx_gameasy",main_domain:"http://www2.gameasy.com/ww",fw:"gameasy",vh:"ww.gameasy.com",check_compatibility_header:0},C=new E("ALL","[Game - module]",{background:"black",color:"#5aa73a"});r.prototype.download=function(t,n){function r(e){return function(t){var n=Math.round(t.loaded/t.total*100);l({percentage:n,type:e})}}function o(){return c({type:"download"}),C.d("Get ga_for_game and gamifive info, fly my minipony!"),g(m).then(function(n){return C.d("Ga for game and gamifive info stored!",n),C.d("Start Download:",t.id,t.response_api_dld.binary_url),new e.download(t.response_api_dld.binary_url,D.TEMP_DIR,m+".zip",r("download")).promise}).then(function(n){return c({type:"unzip"}),C.d("unzip:",t.id,D.TEMP_DIR+m),e._promiseZip(n.path,D.TEMP_DIR+m,r("unzip"))}).then(function(n){C.d("Unzip ended",n),u({type:"unzip"});var r=t.response_api_dld.url_download,o=r.substring(r.lastIndexOf("game"),r.length).split("/"),i="";return C.d("Get the right index folder of the game",o),o.length>2&&p(o[o.length-1])?(i=D.TEMP_DIR+[m,o[o.length-2]].join("/"),C.d("More than one level folders before index.html",o,i)):(i=D.TEMP_DIR+m,C.d("One level folder before index.html",o,i)),C.d("Copy game folder in games/",i,D.GAMES_DIR+m),e.moveDir(i,D.GAMES_DIR+m)}).then(function(t){return C.d("Remove zip from:",D.TEMP_DIR+m+".zip","last operation result",t),e.removeFile(D.TEMP_DIR+m+".zip")}).then(function(){C.d("Save meta.json for:",t.id);var e={gameId:t.id,size:{width:"240",height:"170",ratio:"1_4"},url:t.images.cover.ratio_1_4,type:"cover",method:"xhr"};return f(e)}).then(function(n){return C.d("Save meta.json for:",t.id),C.d("Download image result",n),t.images.cover.ratio_1_4=n.internalURL,e.createFile(D.GAMES_DIR+m,"meta.json").then(function(n){return e.write(n.path,JSON.stringify(t))})}).then(function(e){return C.d("result last operation:save meta.json",e),C.d("InjectScripts in game:",t.id,_),d(t.id,[D.SDK_RELATIVE_DIR+"gamesFixes.js",D.GAMEOVER_RELATIVE_DIR+"gameover.css",D.SDK_RELATIVE_DIR+"cordova.js",D.SDK_RELATIVE_DIR+"cordova_plugins.js",D.SDK_RELATIVE_DIR+"dixie.js",D.SDK_RELATIVE_DIR+"stargate.js",D.SDK_RELATIVE_DIR+"gfsdk.min.js"])}).then(function(e){return C.d("injectScripts result",e),u({type:"download"}),P=!1,t.id})["catch"](function(e){throw C.e(e,"Cleaning...game not downloaded",t.id),P=!1,s.remove(t.id),u({type:"error",description:e}),e})}var i;if(this.isDownloading())return i={type:"error",description:"AlreadyDownloading"},n.onEnd(i),Promise.reject(i);if(!t.hasOwnProperty("response_api_dld")||200!==t.response_api_dld.status)return i={type:"error",description:"response_api_dld.status not equal 200 or undefined"},n.onEnd(i),Promise.reject(i);var a=this.isGameDownloaded(t.id),s=this;n=n?n:{};var l=n.onProgress?n.onProgress:function(){},c=n.onStart?n.onStart:function(){},u=n.onEnd?n.onEnd:function(){},m=t.id;return a.then(function(e){return C.d("Exists",e),e?(P=!1,Promise.reject({12:"AlreadyExists",gameID:t.id})):(P=!0,o())})},r.prototype.play=function(t){C.d("Play",t);var n=D.GAMES_DIR+t;return e.readDir(n).then(function(e){return e.filter(function(e){var t=new RegExp(/index\.html$/i);return t.test(e.path)})}).then(function(e){C.d(e);var t=e[0].internalURL+"?hybrid=1";"ios"==window.device.platform.toLowerCase()?(C.d("Play ios",t),window.location.href=t):(C.d("Play android",t),window.navigator.app.loadUrl(encodeURI(t)))})},r.prototype.remove=function(t){C.d("Removing game",t);var n=e.dirExists(D.CACHE_DIR+t+".zip"),r=e.dirExists(D.GAMES_DIR+t);return Promise.all([n,r]).then(function(n){var r=[];return n[0]&&(C.d("Removed in cache",n[0]),r.push(e.removeFile(D.CACHE_DIR+t+".zip"))),n[1]&&(C.d("Removed",n[1]),r.push(e.removeDir(D.GAMES_DIR+t))),0===r.length&&C.i("Nothing to remove",r),r})},r.prototype.isDownloading=function(){return P},r.prototype.abortDownload=function(){return this.isDownloading()?(C.d("Abort last download"),e.currentFileTransfer&&(e.currentFileTransfer.abort(),e.currentFileTransfer=null),!0):(C.w("There's not a download operation to abort"),!1)},r.prototype.list=function(){return C.d("Get games list"),e.readDir(D.GAMES_DIR).then(function(e){var t=Array.isArray(e)?e:[e];return t.filter(function(e){return e.isDirectory?e:void 0})}).then(function(t){var n=t.map(function(t){return e.readFileAsJSON(t.path+"meta.json")});return Promise.all(n).then(function(e){return e})})},r.prototype.buildGameOver=function(t){var n=D.GAMES_DIR+t.content_id+"/meta.json";return t.hasOwnProperty("content_id")?(C.d("Read meta.json:",n),C.d("GAMEOVER_TEMPLATE path",D.GAMEOVER_DIR+"gameover.html"),Promise.all([e.readFileAsJSON(n),e.readFile(D.GAMEOVER_DIR+"gameover.html")]).then(function(e){var n=e[1],r=e[0];return C.i("Meta JSON:",r),n.replace("{{score}}",t.score).replace("{{url_share}}",r.url_share).replace("{{url_cover}}",r.images.cover.ratio_1_4).replace("{{startpage_url}}",D.WWW_DIR+"index.html")})):Promise.reject("Missing content_id key!")},r.prototype.isGameDownloaded=function(t){return e.dirExists(D.GAMES_DIR+t)},r.prototype.removeAll=function(){return e.removeDir(D.GAMES_DIR).then(function(t){return C.d("All games deleted!",t),e.createDir(D.BASE_DIR,"games")})},r.prototype.getBundleGameObjects=function(){var e=this;if(I.bundle_games.length>0){C.d("Games bundle in configuration",I.bundle_games);var t,n=I.bundle_games.map(function(t){return e.isGameDownloaded(t)}),r=Promise.all(n).then(function(e){C.d("alreadyDownloaded",e);for(var t=0;t<e.length;t++)e[t]&&I.bundle_games.splice(t,1);return I.bundle_games}).then(function(e){return e.join(",")});return r.then(function(e){L.content_id=e;var t=R(I.api,L);return C.d("Request bundle games meta info:",t),new b(t).prom}).then(function(e){C.d("Games bundle response:",e),t=e;var n=e.map(function(e){return new b(e.url_api_dld).prom});return C.d("jsonpRequests",n),Promise.all(n)}).then(function(e){C.d("RESULTS",e);for(var n=0;n<e.length;n++)t[n].response_api_dld=e[n];return C.d("GameObjects",t),t})["catch"](function(e){C.e("Games bundle meta fail:",e)})}return C.w("Bundle_games array is empty!"),Promise.reject("bundle_games array is empty!")},r.prototype.needsUpdate=function(n){var r="";return e.readFileAsJSON(D.GAMES_DIR+n+"/meta.json").then(function(e){return r=e.response_api_dld.binary_md5,t.getJSON(e.url_api_dld)}).then(function(e){if(200===e.status)return e.binary_md5!==r;throw new Error("ResponseStatus "+e.status)})};var N={};n.game={},N.initialize=o,n.game._protected=N,n.game._public=new r}(l.file,l.Utils,l),function(e){function t(e,t,n,r,o){return function(){if("function"==typeof e&&(e=e.call(null)),e)return t.apply(n||null,arguments);switch(r=r||"NoMessage",o){case"warn":console.warn(r);break;case"error":console.error(r);break;case"info":console.info(r);break;default:console.log(r)}}}e.Decorators={requireCondition:t}}(l),function(e,t,n){function r(){l.i(i,a)}function o(){return window.plugins&&"undefined"!=typeof window.plugins.AdMob}var i={NO_CHANGE:0,TOP_LEFT:1,TOP_CENTER:2,TOP_RIGHT:3,LEFT:4,CENTER:5,RIGHT:6,BOTTOM_LEFT:7,BOTTOM_CENTER:8,BOTTOM_RIGHT:9,POS_XY:10},a={SMART_BANNER:"SMART_BANNER",BANNER:"BANNER",MEDIUM_RECTANGLE:"MEDIUM_RECTANGLE",FULL_BANNER:"FULL_BANNER",LEADERBOARD:"LEADERBOARD",SKYSCRAPER:"SKYSCRAPER"},s={},l=new e.Logger("all","[AdManager]");s=/(android)/i.test(navigator.userAgent)?{banner:"ca-app-pub-6869992474017983/9375997553",interstitial:"ca-app-pub-6869992474017983/1657046752"}:/(ipod|iphone|ipad)/i.test(navigator.userAgent)?{banner:"ca-app-pub-6869992474017983/4806197152",interstitial:"ca-app-pub-6869992474017983/7563979554"}:{banner:"ca-app-pub-6869992474017983/8878394753",interstitial:"ca-app-pub-6869992474017983/1355127956"},r.prototype.createBanner=function(){l.d("NotImplemented")},r.prototype.removeBanner=function(){l.d("NotImplemented")},r.prototype.showBanner=function(){l.d("NotImplemented")},r.prototype.showBannerAtGivenXY=function(){l.d("NotImplemented")},r.prototype.showBannerAtSelectedPosition=function(){l.d("NotImplemented")},r.prototype.hideBanner=function(){l.d("NotImplemented")},r.prototype.prepareInterstitial=function(){l.d("NotImplemented")},r.prototype.showInterstitial=function(){l.d("NotImplemented")},r.prototype.prepareRewardVideoAd=function(){l.d("NotImplemented")},r.prototype.registerAdEvents=function(){l.d("NotImplemented")},r.prototype.showRewardVideoAd=function(){l.d("NotImplemented")},r.prototype.setOptions=function(){l.d("NotImplemented")};for(var c in r.prototype)r.prototype.hasOwnProperty(c)&&(r.prototype[c]=t.requireCondition(o,r.prototype[c],r.prototype,"cordova-plugin-admob not installed","warn"));n.AdManager=new r}(l.Utils,l.Decorators,l);var c=function(){var e={},t=!1;e.init=function(){if(Y.hasOwnProperty("webappsfixes")&&"object"==typeof Y.webappsfixes){t=!0;for(var e in Y.webappsfixes)if(Y.webappsfixes.hasOwnProperty(e))if(n.hasOwnProperty(e)&&"function"==typeof n[e]){v("[webappsFixes] applying fix: "+e);var r=n[e](Y.webappsfixes[e]);r&&_("[webappsFixes] fix '"+e+"' failed: "+r)}else _("[webappsFixes] fix implementation not found for: "+e)}return t};var n={};return n.gamifiveSearchBox=function(e){if(!window.cordova||!window.cordova.plugins||!window.cordova.plugins.Keyboard)return"missing ionic-plugin-keyboard";if(e.platforms){if(b()&&!e.platforms.ios)return void v("[webappsFixes] [gamifiveSearchBox] fix disabled on iOS");if(R()&&!e.platforms.android)return void v("[webappsFixes] [gamifiveSearchBox] fix disabled on Android")}return window.addEventListener("native.keyboardshow",function(){setTimeout(function(){0===document.querySelectorAll("input:focus").length&&(v("[webappsFixes] [gamifiveSearchBox] keyboard show on null input: hiding"),cordova.plugins.Keyboard.close())},1)},!1),v("[webappsFixes] [gamifiveSearchBox] listening on event native.keyboardshow"),""},e}();window.pubKey="",window.forge="";var u;s.initializeOffline=function(e){return u?u:("object"!=typeof e&&(e={}),e.hasOwnProperty("hideSplashScreen")||(e.hideSplashScreen=!0),P=!0,u=new Promise(function(t){document.addEventListener("deviceready",function(){B(),A(),n(),Promise.all([cordova.getAppVersion.getVersionNumber(),i()]).then(function(n){L=n[0],"object"!=typeof n[1]&&(n[1]=JSON.parse(n[1])),S=n[1].start_url,Y=n[1].stargateConf,e.hideSplashScreen&&(navigator.splashscreen.hide(),H(!1)),T=!0,v("Stargate.initializeOffline() done"),t(!0)})["catch"](function(e){_("initializeOffline() error: "+e)})})}))},s.conf={},s.conf.getWebappStartUrl=function(){if(!P)return _("Stargate not initialized, call Stargate.initialize first!");if(!T)return _("Stargate closed, wait for Stargate.initialize to complete!");var e=URI(Y.webapp_start_url).addSearch("hybrid","1").addSearch("stargateVersion",d());return String(e)};var d=function(){return Y.stargate_version_to_load?Y.stargate_version_to_load:(y("getStargateVersionToLoad() stargate_version_to_load must be set on manifest!"),m)};s.conf.getWebappOrigin=function(){var e=/http:\/\/[\w]{3,4}\..*\.[\w]{2,}/;return"undefined"==typeof Y.webapp_start_url?(v("Stargate is initialized? Please call this method after it"),""):e.exec(Y.webapp_start_url)[0]};var p;s.initialize=function(e,t,n,r){return"function"==typeof t&&"undefined"==typeof n&&"undefined"==typeof r&&(r=t),"undefined"==typeof r&&(v("Callback success not setted. \n You can use 'then'"),r=function(){}),"function"!=typeof r?(y("Stargate.initialize() callback is not a function!"),Promise.reject(new Error("Stargate.initialize() callback is not a function!"))):(I=J(),P?(y("Stargate.initialize() already called, executing callback."),r&&r(I),p):("object"!=typeof e&&(e={}),e.hybrid_conf&&(M="object"==typeof e.hybrid_conf?e.hybrid_conf:JSON.parse(decodeURIComponent(e.hybrid_conf))),e.modules?e.modules.constructor!==Array?_("initialize() configurations.modules is not an array"):k=e.modules:k=["mfp","iapbase","appsflyer","game"],e.modules_conf&&("object"!=typeof e.modules_conf?_("initialize() configurations.modules_conf is not an object"):j=e.modules_conf),e.country&&("mfp"in M?M.mfp.country=e.country:M.mfp={country:e.country}),I?(v("initialize() starting up, configuration: ",M),O=r,p=new Promise(function(e,t){document.addEventListener("deviceready",function(){K(e,t)},!1)}),P=!0,p):(v("version "+a+" running outside hybrid; loaded from server version: v"+d()),r&&r(I),p=Promise.resolve(I),P=!0,p)))},s.isInitialized=function(){return P},s.isOpen=function(){return T},s.isHybrid=function(){return J()},s.openUrl=function(e){return P?void window.open(e,"_system"):_("Stargate not initialized, call Stargate.initialize first!")},s.googleLogin=function(e,t){return P?(_("unimplemented"),void t("unimplemented")):t("Stargate not initialized, call Stargate.initialize first!")};var f,g={type:"unknown",networkState:"unknown"};s.addListener=function(e,t){"connectionchange"==e&&"function"==typeof t&&(v("onConnectionChange registered"),f=t)},s.checkConnection=function(){var e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];return P?T?"undefined"==typeof navigator.connection||"function"!=typeof navigator.connection.getInfo?(t("Missing cordova plugin"),console.warn("Cordova Network Information module missing"),!1):(e(g),g):(t("Stargate closed, wait for Stargate.initialize to complete!"),!1):(t("Stargate not initialized, call Stargate.initialize first!"),!1)},s.getDeviceID=function(e,t){if(!P)return t("Stargate not initialized, call Stargate.initialize first!");if(!T)return t("Stargate closed, wait for Stargate.initialize to complete!"),!1;var n=E.uuid;e({deviceID:n})},s.goToLocalIndex=function(){if("undefined"!==window.cordova.file.applicationDirectory){var e="?hybrid=1",t=window.cordova.file.applicationDirectory+"www/index.html";r(t+e)}else _("Missing cordova-plugin-file. Install it with: cordova plugin add cordova-plugin-file")},s.goToWebIndex=function(){var e=s.conf.getWebappStartUrl()+"";v("Redirect to",e),r(e)},s.setStatusbarVisibility=function(e,t,n){return P?T?"undefined"==typeof window.StatusBar?(_("[StatusBar] missing cordova plugin"),n("missing cordova plugin")):e?(window.StatusBar.show(),t("statusbar shown")):(window.StatusBar.hide(),t("statusbar hided")):(n("Stargate closed, wait for Stargate.initialize to complete!"),!1):n("Stargate not initialized, call Stargate.initialize first!")},s.getVersion=function(){return a},s.getAppInformation=function(){return x};var m="2",w="1"==="IS_STAGING = 1".slice(-1),h=function(){for(var e=Array.prototype.slice.call(arguments),t="",n=0;n<e.length;n++)t+="object"==typeof e[n]?" "+JSON.stringify(e[n]):" "+e[n];return t},v=console.log.bind(window.console,"[Stargate] "),_=console.error.bind(window.console,"[Stargate] "),y=console.warn.bind(window.console,"[Stargate] ");w||(v=function(){console.log("[I] [Stargate] "+h.apply(null,arguments))},_=function(){console.log("[E] [Stargate] "+h.apply(null,arguments))},y=function(){console.log("[W] [Stargate] "+h.apply(null,arguments))});var S,E={available:!1,cordova:"",manufacturer:"",model:"",platform:"",uuid:"",version:""},R=function(){return"Android"==E.platform},b=function(){return"iOS"==E.platform},A=function(){if("undefined"==typeof window.device)return _("Missing cordova device plugin");for(var e in E)window.device.hasOwnProperty(e)&&(E[e]=window.device[e]);return!0},D=function(e){v("launchUrl: "+e),document.location.href=e},I=!1,P=!1,T=!1,O=null,L="",C="",N="",F=!1,M={},k=[],j={},x={cordova:null,manufacturer:null,model:null,platform:null,deviceId:null,version:null,
packageVersion:null,packageName:null,packageBuild:null,stargate:null,stargateModules:null,stargateError:null},U=function(){if("undefined"==typeof window.StatusBar)return _("[StatusBar] missing cordova plugin");if("undefined"!=typeof Y.statusbar&&"undefined"!=typeof Y.statusbar.hideOnUrlPattern&&Y.statusbar.hideOnUrlPattern.constructor===Array){for(var e=document.location.href,t=!1,n=0;n<Y.statusbar.hideOnUrlPattern.length;n++){var r=new RegExp(Y.statusbar.hideOnUrlPattern[n]);if(r.test(e)){t=!0;break}}t?window.StatusBar.hide():window.StatusBar.show()}},B=function(){window.Cookies.set("hybrid","1"),window.localStorage.getItem("hybrid")||window.localStorage.setItem("hybrid",1)},G=function(){window.Cookies.set("stargateVersion",d()),window.localStorage.getItem("stargateVersion")||window.localStorage.setItem("stargateVersion",d())},z=function(){$("leavesplash")||navigator.splashscreen.hide(),H(!1),"undefined"!=typeof SpinnerDialog&&SpinnerDialog.hide()},V=function(e){if(v("onPluginReady() start"),document.title=Y.title,b()&&"undefined"!=typeof window.cordova&&cordova.require){var n=cordova.require("cordova/exec");n.setJsToNativeBridgeMode(n.jsToNativeModes.IFRAME_NAV)}if(t(),G(),U(),Z("mfp")&&$("mfp")){var r=X("mfp"),o=["motime_apikey","namespace","label"];o.forEach(function(e){!r.hasOwnProperty(e)&&Y.hasOwnProperty(e)&&(r[e]=Y[e])}),Q.check(r)}Z("deltadna")&&window.deltadna.startSDK(Y.deltadna.environmentKey,Y.deltadna.collectApi,Y.deltadna.engageApi,oe,ie,Y.deltadna.settings),$("iapbase")?re.initialize(X("iapbase")):$("iap")&&re.initialize(X("iap"))&&v("Init IAP done."),Z("appsflyer")&&$("appsflyer")&&se.init(X("appsflyer")),c.init();var i=[];$("game")&&Z("game")&&l.game&&i.push(l.game._protected.initialize(X("game"))),Promise.all(i).then(function(){q(e)})["catch"](function(t){_("onPluginReady() error: ",t),q(e,t)})},q=function(e,t){v("onStargateReady() start"),z(),T=!0,v("version "+a+" ready;  running in package version: "+L),x={cordova:E.cordova,manufacturer:E.manufacturer,model:E.model,platform:E.platform,deviceId:E.uuid,version:E.version,packageVersion:L,packageName:N,packageBuild:C,stargate:a},k&&k.constructor===Array&&(x.stargateModules=k.join(", ")),t&&t instanceof Error&&(x.stargateError=t.toString()),O(!0),v("Stargate.initialize() done"),e(!0)},K=function(e,t){v("onDeviceReady() start"),B(),A(),n(),Promise.all([cordova.getAppVersion.getVersionNumber(),i(),cordova.getAppVersion.getPackageName(),cordova.getAppVersion.getVersionCode(),o()]).then(function(n){L=n[0],"object"!=typeof n[1]&&(n[1]=JSON.parse(n[1])),N=n[2],C=n[3],n[4]&&"object"==typeof n[4]&&n[4].debug&&(F=!0),S=n[1].start_url,Y=n[1].stargateConf,V(e,t)})["catch"](function(e){_("onDeviceReady() error: "+e),t("onDeviceReady() error: "+e)})},J=function(){var e=window.URI(document.location.href);return e.hasQuery("hybrid")?!0:window.Cookies.get("hybrid")?!0:!!window.localStorage.getItem("hybrid")},W=!1,H=function(e){e?(W=!0,te()):(W=!1,ne())},Y={features:{}},X=function(e){if(!e)return _("getModuleConf() invalid module requested");if(e in j)return j[e];var t={iapbase:"IAP",iap:"IAP"},n=e;return t[e]&&(n=t[e]),n in M?M[n]:(v("getModuleConf(): no configuration for module: "+e+" ("+t+")"),{})},Z=function(e){return"undefined"!=typeof Y.features[e]&&Y.features[e]},$=function(e){return k&&k.constructor===Array?k.indexOf(e)>-1:!1};!function(e){function t(e,n,r){this.level=t.levels[e.toUpperCase()],this.styles=r||{background:"white",color:"black"},this.tag="%c "+n+" ",this.isstaging="1"==="IS_STAGING = 1".slice(-1),this.styleString="background:"+this.styles.background+";color:"+this.styles.color+";";var o=function(){if(arguments.length<1)return"";for(var e=Array.prototype.slice.call(arguments[0]),t="",n=0;n<e.length;n++)t+="object"==typeof e[n]?" "+JSON.stringify(e[n]):" "+e[n];return t},i=window.console.log.bind(window.console,this.tag,this.styleString),a=window.console.info.bind(window.console,this.tag,this.styleString),s=window.console.error.bind(window.console,this.tag,this.styleString),l=window.console.warn.bind(window.console,this.tag,this.styleString);this.isstaging||(i=function(){window.console.log("[D] [Stargate] "+o.apply(null,arguments))},a=function(){window.console.log("[I] [Stargate] "+o.apply(null,arguments))},s=function(){window.console.log("[E] [Stargate] "+o.apply(null,arguments))},l=function(){window.console.log("[W] [Stargate] "+o.apply(null,arguments))}),Object.defineProperties(this,{__d:{value:i,writable:!1,enumerable:!1,configurable:!1},__i:{value:a,writable:!1,enumerable:!1,configurable:!1},__e:{value:s,writable:!1,enumerable:!1,configurable:!1},__w:{value:l,writable:!1,enumerable:!1,configurable:!1}})}function n(e){var t=0;return{next:function(n){return n&&(t=0),t<e.length?{value:e[t++],done:!1}:{done:!0}}}}function r(e,t){e+="?";var n="";for(var r in t)n+=encodeURIComponent(r)+"="+encodeURIComponent(t[r])+"&";return n.length>0&&(n=n.substring(0,n.length-1)),e+n}function o(e){e=encodeURI(e);var t="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n="responseType"in t;t.open("GET",e,!0),n&&(t.responseType="json");var r=new Promise(function(e,r){t.onreadystatechange=function(){if(4===t.readyState)try{var o=n?t.response:JSON.parse(t.responseText);e(o)}catch(i){r(i)}}});return t.setRequestHeader("Content-type","application/json; charset=UTF-8"),t.send(),r}function i(e){var t=this;if(t.timeout=3e3,t.called=!1,window.document){var n=Date.now();t.scriptTag=window.document.createElement("script"),e+="&callback=window.__jsonpHandler_"+n,t.scriptTag.src=e,t.scriptTag.type="text/javascript",t.scriptTag.async=!0,t.prom=new Promise(function(e,r){var o="__jsonpHandler_"+n;window[o]=function(n){t.called=!0,e(n),t.scriptTag.parentElement.removeChild(t.scriptTag),delete window[o]},setTimeout(function(){t.called||(r("Timeout jsonp request "+n),t.scriptTag.parentElement.removeChild(t.scriptTag),delete window[o])},t.timeout)}),window.document.getElementsByTagName("head")[0].appendChild(t.scriptTag)}}function a(e,t){var n=t||function(){};return new Promise(function(t,r){function o(){var n;switch(e.responseType){case"blob":n=new Blob([this.response],{type:e.mimeType||"image/jpeg"});break;case"arraybuffer":n=this.response;break;default:n=this.response,t(n)}}var i=new XMLHttpRequest;i.open("GET",e.url,!0),i.responseType=e.responseType||"blob",e.withCredentials&&(i.withCredentials=e.withCredentials);var a=r,s=r;i.addEventListener("progress",n,!1),i.addEventListener("load",o,!1),i.addEventListener("error",s,!1),i.addEventListener("abort",a,!1),i.send(null)})}function s(e,t){var n=Object.prototype.toString.apply({});if(e.toString()!==n||t.toString()!==n)throw new Error("Cannot merge different type");var r={};for(var o in e)e.hasOwnProperty(o)&&(r[o]=e[o]);for(var i in t)t.hasOwnProperty(o)&&(r[i]=t[i]);return r}t.levels={ALL:5,ERROR:4,WARN:3,INFO:2,DEBUG:1,OFF:0},t.prototype.e=function(){0!==this.level&&this.level>=t.levels.ERROR&&this.__e(arguments)},t.prototype.i=function(){0!==this.level&&this.level>=t.levels.WARN&&this.__i(arguments)},t.prototype.w=function(){0!==this.level&&this.level>=t.levels.INFO&&this.__w(arguments)},t.prototype.d=function(){0!==this.level&&this.level>=t.levels.DEBUG&&this.__d(arguments)},t.prototype.setLevel=function(e){this.level=t.levels[e]};var l={Iterator:n,Logger:t,composeApiString:r,getJSON:o,jsonpRequest:i,getImageRaw:a,extend:s};e?e.Utils=l:window.Utils=l}(l),function(e,t){function n(e){var t=e.map(function(e){return{fullPath:e.fullPath,path:e.toURL(),internalURL:e.toInternalURL(),isFile:e.isFile,isDirectory:e.isDirectory}});return 1==t.length?t[0]:t}var r={},o=new t.Logger("ALL","[File - module]");r.LOG=o,window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,r.ERROR_MAP={1:"NOT_FOUND_ERR",2:"SECURITY_ERR",3:"ABORT_ERR",4:"NOT_READABLE_ERR",5:"ENCODING_ERR",6:"NO_MODIFICATION_ALLOWED_ERR",7:"INVALID_STATE_ERR",8:"SYNTAX_ERR",9:"INVALID_MODIFICATION_ERR",10:"QUOTA_EXCEEDED_ERR",11:"TYPE_MISMATCH_ERR",12:"PATH_EXISTS_ERR"},r.currentFileTransfer=null,r.resolveFS=function(e){return new Promise(function(t,n){window.resolveLocalFileSystemURL(e,t,n)})},r.appendToFile=function(e,t,o,i){return o=void 0===arguments[2]?!1:arguments[2],i=void 0===arguments[3]?"text/plain":arguments[3],r.resolveFS(e).then(function(e){return new Promise(function(r,a){e.createWriter(function(s){o||s.seek(s.length);var l;l=t instanceof Blob?t:new Blob([t],{type:i}),s.write(l),s.onerror=a,s.onabort=a,s.onwriteend=function(){r(n([e]))}},a)})})},r.readFileAsHTML=function(e){return r.readFile(e).then(function(e){return(new window.DOMParser).parseFromString(e,"text/html")})},r.readFileAsJSON=function(e){return r.readFile(e).then(function(e){try{return Promise.resolve(window.JSON.parse(e))}catch(t){return Promise.reject(t)}})},r.removeFile=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,n){e.remove(function(e){t(null===e||"OK"===e)},n)})})},r.removeDir=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,n){e.removeRecursively(function(e){t(null===e||"OK"===e)},n)})})},r._promiseZip=function(e,t,n){return o.d("PROMISEZIP:",arguments),new Promise(function(r,o){window.zip.unzip(e,t,function(e){0===e?r(!0):o(e)},n)})},r.download=function(e,t,o,i){var a=this;this.ft=new window.FileTransfer,this.ft.onprogress=i,r.currentFileTransfer=a.ft,a.promise=new Promise(function(r,i){a.ft.download(window.encodeURI(e),t+o,function(e){r(n([e])),a.ft=null},function(e){i(e),a.ft=null},!0)})},r.createDir=function(e,t){return r.resolveFS(e).then(function(e){return new Promise(function(r,o){e.getDirectory(t,{create:!0},function(e){r(n([e]))},o)})})},r.fileExists=function(e){return new Promise(function(t){window.resolveLocalFileSystemURL(e,function(e){t(e.isFile)},function(e){t(1!==e.code)})})},r.dirExists=function(e){return new Promise(function(t){window.resolveLocalFileSystemURL(e,function(e){t(e.isDirectory)},function(e){t(1!=e.code)})})},r.requestFileSystem=function(e,t){return new Promise(function(n,r){window.requestFileSystem(e,t,n,r)})},r.readDir=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,r){var i=e.createReader();i.readEntries(function(e){o.d("readDir:",e),t(n(e))},r)})})},r.readFile=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(t,n){e.file(function(e){var r=new FileReader;r.onerror=n,r.onabort=n,r.onloadend=function(){var e=this.result;t(e)},r.readAsText(e)})})})},r.createFile=function(e,t){return r.resolveFS(e).then(function(e){return new Promise(function(r,o){e.getFile(t,{create:!0},function(e){r(n([e]))},o)})})},r.write=function(e,t){return r.appendToFile(e,t,!0)},r.moveDir=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),i=t.replace(n,"");return o.d("moveDir:",i,n),Promise.all([r.resolveFS(e),r.resolveFS(i)]).then(function(e){return o.d("moveDir: resolved entries",e),new Promise(function(t,r){e[0].moveTo(e[1],n,t,r)})})},r.copyFile=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),i=t.replace(n,"");return Promise.all([r.resolveFS(e),r.resolveFS(i)]).then(function(e){return o.d("copyFileTo",e),new Promise(function(t,r){e[0].copyTo(e[1],n,t,r)})})},r.copyDir=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),i=t.replace(n,"");return Promise.all([r.resolveFS(e),r.resolveFS(i)]).then(function(r){return o.d("copyDir",e,"in",t),new Promise(function(e,t){r[0].copyTo(r[1],n,e,t)})})},e?e.file=r:window.file=r}(l,l.Utils),function(e,t,n){"use strict";function r(){}function o(t){if(t&&(I=A(I,t)),C.d("Initialized called with:",I),!e)return Promise.reject("Missing file module!");try{w=window.cordova.file.applicationStorageDirectory,h=window.cordova.file.cacheDirectory,v=window.cordova.file.tempDirectory,_=window.cordova.file.applicationDirectory+"www/",S=window.cordova.file.applicationDirectory+"www/js/stargate.js",y=window.cordova.file.dataDirectory}catch(r){return C.e(r),Promise.reject(r)}"ios"==window.device.platform.toLowerCase()&&(w+="Documents/"),"android"==window.device.platform.toLowerCase()&&(v=h),D.SDK_DIR=w+"scripts/",D.SDK_RELATIVE_DIR="../../scripts/",D.GAMEOVER_RELATIVE_DIR="../../gameover_template/",D.GAMES_DIR=w+"games/",D.BASE_DIR=w,D.CACHE_DIR=h,D.TEMP_DIR=v,D.CORDOVAJS=_+"cordova.js",D.CORDOVA_PLUGINS_JS=_+"cordova_plugins.js",D.STARGATEJS=_+"js/stargate.js",D.DATA_DIR=y,D.GAMEOVER_DIR=D.BASE_DIR+"gameover_template/",D.WWW_DIR=_,C.i("cordova JS dir to include",D.CORDOVAJS),n.game._public.BASE_DIR=D.BASE_DIR,n.game._public.OFFLINE_INDEX=D.WWW_DIR+"index.html";var o=e.createDir(D.BASE_DIR,"games"),s=e.createDir(D.BASE_DIR,"scripts"),l=e.fileExists(D.BASE_DIR+"offlineData.json").then(function(t){return t?(C.i("offlineData.json already exists"),t):(C.i("creating offlineData.json"),e.createFile(D.BASE_DIR,"offlineData.json").then(function(t){return C.d("offlineData",t),e.write(t.path,JSON.stringify(T))}))});return Promise.all([o,s,l]).then(function(e){return C.d("GamesDir, ScriptsDir, offlineData.json created",e),i()}).then(a)}function i(){return Promise.all([e.dirExists(D.BASE_DIR+"gameover_template"),e.dirExists(D.SDK_DIR+"plugins"),e.fileExists(D.SDK_DIR+"cordova.js"),e.fileExists(D.SDK_DIR+"cordova_plugins.js"),e.fileExists(D.SDK_DIR+"stargate.js"),e.fileExists(D.SDK_DIR+"gamesFixes.js")]).then(function(t){var n=[];return t[0]||n.push(e.copyDir(D.WWW_DIR+"gameover_template",D.BASE_DIR+"gameover_template")),t[1]||n.push(e.copyDir(D.WWW_DIR+"plugins",D.SDK_DIR+"plugins")),t[2]||n.push(e.copyFile(D.CORDOVAJS,D.SDK_DIR+"cordova.js")),t[3]||n.push(e.copyFile(D.CORDOVA_PLUGINS_JS,D.SDK_DIR+"cordova_plugins.js")),t[4]||n.push(e.copyFile(D.STARGATEJS,D.SDK_DIR+"stargate.js")),t[5]||n.push(e.copyFile(D.WWW_DIR+"js/gamesFixes.js",D.SDK_DIR+"gamesFixes.js")),Promise.all(n)})}function a(){return Promise.all([e.fileExists(D.SDK_DIR+"dixie.js"),e.fileExists(D.SDK_DIR+"gfsdk.min.js")]).then(function(t){var n=t[0],r=t[1],o=[];return r||""===I.sdk_url||(C.d("get SDK"),o.push(new e.download(I.sdk_url,D.SDK_DIR,"gfsdk.min.js").promise)),n||""===I.dixie_url||(C.d("get dixie"),o.push(new e.download(I.dixie_url,D.SDK_DIR,"dixie.js").promise)),Promise.all(o)})}function s(t){return C.d("_getIndexHtmlById",D.GAMES_DIR+t),e.readDir(D.GAMES_DIR+t).then(function(e){return C.d("_getIndexHtmlById readDir",e),e.filter(function(e){var t=new RegExp(/index\.html$/i);return t.test(e.path)})})}function l(e){C.d("_removeRemoteSDK");for(var t,n=e.querySelectorAll("script"),r=0;r<n.length;r++)if(-1!==n[r].src.indexOf("gfsdk")){t=n[r],C.d("_removeRemoteSDK",t),t.parentNode.removeChild(t);break}return e}function c(e,t){e=l(e);var n,r,o=Array.isArray(t)===!1?[t]:t;C.d("injectScripts",o);var i=document.createElement("meta");i.httpEquiv="Content-Security-Policy",i.content="default-src * data: content: cdvfile: file: http: https: gap: https://ssl.gstatic.com 'unsafe-inline' 'unsafe-eval';style-src * cdvfile: http: https: 'unsafe-inline';",e.head.insertBefore(i,e.getElementsByTagName("meta")[0]);var a=e.createElement("script");a.id="__root__",e.head.insertBefore(a,e.head.firstElementChild);for(var s=e.createDocumentFragment(),c=0;c<o.length;c++)o[c].endsWith(".css")?(C.d("css inject:",o[c]),r=e.createElement("link"),r.rel="stylesheet",r.href=o[c],e.head.insertBefore(r,e.getElementsByTagName("link")[0])):(n=e.createElement("script"),n.src=o[c],s.appendChild(n));return e.head.insertBefore(s,e.head.getElementsByTagName("script")[0]),C.d("Cleaned dom:",e),e}function u(e){var t=[];t.push(e.querySelector("link[href='/gmenu/frame.css']")),t.push(e.querySelector("iframe#menu")),t.push(e.querySelector("script[src='/gmenu/toggle.js']"));for(var n=e.querySelectorAll("script"),r=n.length-1;r>=0;r--)if(-1!==n[r].innerHTML.indexOf("function open")){t.push(n[r]);break}for(var o=0;o<t.length;o++)t[o]&&t[o].parentNode.removeChild(t[o]);return e}function d(t,n){var r;return s(t).then(function(t){return r=t[0].path,C.d("injectScripts",r),e.readFileAsHTML(t[0].path)}).then(function(e){function t(t){e.head.appendChild(t)}var r=e.body.querySelectorAll("meta"),o=e.body.querySelectorAll("link"),i=e.body.querySelectorAll("style"),a=e.body.querySelectorAll("title");r=[].slice.call(r),o=[].slice.call(o),i=[].slice.call(i),a=[].slice.call(a);var s=r.concat(o).concat(i).concat(a);return s.map(t),e.body.innerHTML=e.body.innerHTML.trim(),C.d("_injectScripts"),C.d(e),c(e,n)}).then(u).then(function(e){var t=[].slice.call(e.querySelector("html").attributes),n=t.map(function(e){return e.name+'="'+e.value+'"'}).join(" "),r="<!DOCTYPE html><html "+n+">"+e.documentElement.innerHTML+"</html>";return C.d("Serialized dom",r),r}).then(function(t){return C.d("Write dom:",r,t),e.write(r,t)})}function p(e){var t=new RegExp(/index\.html$/i);return t.test(e)}function f(n){var r=n.url.replace("[WSIZE]",n.size.width).replace("[HSIZE]",n.size.height).split("?")[0],o=D.GAMES_DIR+n.gameId,i=n.type+"_"+n.size.width+"x"+n.size.height+("_"+n.size.ratio||"")+".jpeg";return C.d("request Image to",r,"coverImageUrl",i,"imagesFolder",o),"xhr"===n.method?Promise.all([e.createFile(o,i),t.getImageRaw({url:r})]).then(function(t){var n=t[0],r=t[1];return e.appendToFile(n.path,r,!0,"image/jpeg")}):new e.download(r,o,i,function(){}).promise}function g(e){var t=R(I.ga_for_game_url,O),n=new b(t).prom;return n.then(function(n){C.d("apiGaForGames:",t,"ga_for_game:",n);var r=R(I.gamifive_info_api,{content_id:e,_PONY:n._PONYVALUE,format:"jsonp"});return C.d("gamifive_info_api",r),[new b(r).prom,n]}).then(function(t){return t[0].then(function(n){return C.d("gamifiveInfo:",n,"ga_for_game",t[1]),m({content_id:e,ga_for_game:t[1],gamifive_info:n.game_info})})})}function m(t){return e.readFileAsJSON(D.BASE_DIR+"offlineData.json").then(function(e){return e.GaForGame[t.content_id]=t.ga_for_game,e.GamifiveInfo[t.content_id]=t.gamifive_info,e}).then(function(t){return C.d("writing offlineData.json",t),e.write(D.BASE_DIR+"offlineData.json",JSON.stringify(t))})}var w,h,v,_,y,S,E=t.Logger,R=t.composeApiString,b=t.jsonpRequest,A=t.extend,D={},I={sdk_url:"",dixie_url:"",api:"",ga_for_game_url:"",gamifive_info_api:"",bundle_games:[]},P=!1,T={GaForGame:{},GamifiveInfo:{},queues:{}},O={print_json_response:1},L={content_id:"",formats:"html5applications",sort:"-born_date",category:"b940b384ff0565b06dde433e05dc3c93",publisher:"",size:6,offset:0,label:"",label_slug:"",access_type:"",real_customer_id:"xx_gameasy",lang:"en",use_cs_id:"",white_label:"xx_gameasy",main_domain:"http://www2.gameasy.com/ww",fw:"gameasy",vh:"ww.gameasy.com",check_compatibility_header:0},C=new E("ALL","[Game - module]",{background:"black",color:"#5aa73a"});r.prototype.download=function(t,n){function r(e){return function(t){var n=Math.round(t.loaded/t.total*100);l({percentage:n,type:e})}}function o(){return c({type:"download"}),C.d("Get ga_for_game and gamifive info, fly my minipony!"),g(m).then(function(n){return C.d("Ga for game and gamifive info stored!",n),C.d("Start Download:",t.id,t.response_api_dld.binary_url),new e.download(t.response_api_dld.binary_url,D.TEMP_DIR,m+".zip",r("download")).promise}).then(function(n){return c({type:"unzip"}),C.d("unzip:",t.id,D.TEMP_DIR+m),e._promiseZip(n.path,D.TEMP_DIR+m,r("unzip"))}).then(function(n){C.d("Unzip ended",n),u({type:"unzip"});var r=t.response_api_dld.url_download,o=r.substring(r.lastIndexOf("game"),r.length).split("/"),i="";return C.d("Get the right index folder of the game",o),o.length>2&&p(o[o.length-1])?(i=D.TEMP_DIR+[m,o[o.length-2]].join("/"),C.d("More than one level folders before index.html",o,i)):(i=D.TEMP_DIR+m,C.d("One level folder before index.html",o,i)),C.d("Copy game folder in games/",i,D.GAMES_DIR+m),e.moveDir(i,D.GAMES_DIR+m)}).then(function(t){return C.d("Remove zip from:",D.TEMP_DIR+m+".zip","last operation result",t),e.removeFile(D.TEMP_DIR+m+".zip")}).then(function(){C.d("Save meta.json for:",t.id);var e={gameId:t.id,size:{width:"240",height:"170",ratio:"1_4"},url:t.images.cover.ratio_1_4,type:"cover",method:"xhr"};return f(e)}).then(function(n){return C.d("Save meta.json for:",t.id),C.d("Download image result",n),t.images.cover.ratio_1_4=n.internalURL,e.createFile(D.GAMES_DIR+m,"meta.json").then(function(n){return e.write(n.path,JSON.stringify(t))})}).then(function(e){return C.d("result last operation:save meta.json",e),C.d("InjectScripts in game:",t.id,_),d(t.id,[D.SDK_RELATIVE_DIR+"gamesFixes.js",D.GAMEOVER_RELATIVE_DIR+"gameover.css",D.SDK_RELATIVE_DIR+"cordova.js",D.SDK_RELATIVE_DIR+"cordova_plugins.js",D.SDK_RELATIVE_DIR+"dixie.js",D.SDK_RELATIVE_DIR+"stargate.js",D.SDK_RELATIVE_DIR+"gfsdk.min.js"])}).then(function(e){return C.d("injectScripts result",e),u({type:"download"}),P=!1,t.id})["catch"](function(e){throw C.e(e,"Cleaning...game not downloaded",t.id),P=!1,s.remove(t.id),u({type:"error",description:e}),e})}var i;if(this.isDownloading())return i={type:"error",description:"AlreadyDownloading"},n.onEnd(i),Promise.reject(i);if(!t.hasOwnProperty("response_api_dld")||200!==t.response_api_dld.status)return i={type:"error",description:"response_api_dld.status not equal 200 or undefined"},n.onEnd(i),Promise.reject(i);var a=this.isGameDownloaded(t.id),s=this;n=n?n:{};var l=n.onProgress?n.onProgress:function(){},c=n.onStart?n.onStart:function(){},u=n.onEnd?n.onEnd:function(){},m=t.id;return a.then(function(e){return C.d("Exists",e),e?(P=!1,Promise.reject({12:"AlreadyExists",gameID:t.id})):(P=!0,o())})},r.prototype.play=function(t){C.d("Play",t);var n=D.GAMES_DIR+t;return e.readDir(n).then(function(e){return e.filter(function(e){var t=new RegExp(/index\.html$/i);return t.test(e.path)})}).then(function(e){C.d(e);var t=e[0].internalURL+"?hybrid=1";"ios"==window.device.platform.toLowerCase()?(C.d("Play ios",t),window.location.href=t):(C.d("Play android",t),window.navigator.app.loadUrl(encodeURI(t)))})},r.prototype.remove=function(t){C.d("Removing game",t);var n=e.dirExists(D.CACHE_DIR+t+".zip"),r=e.dirExists(D.GAMES_DIR+t);return Promise.all([n,r]).then(function(n){var r=[];return n[0]&&(C.d("Removed in cache",n[0]),r.push(e.removeFile(D.CACHE_DIR+t+".zip"))),n[1]&&(C.d("Removed",n[1]),r.push(e.removeDir(D.GAMES_DIR+t))),0===r.length&&C.i("Nothing to remove",r),r})},r.prototype.isDownloading=function(){return P},r.prototype.abortDownload=function(){return this.isDownloading()?(C.d("Abort last download"),e.currentFileTransfer&&(e.currentFileTransfer.abort(),e.currentFileTransfer=null),!0):(C.w("There's not a download operation to abort"),!1)},r.prototype.list=function(){return C.d("Get games list"),e.readDir(D.GAMES_DIR).then(function(e){var t=Array.isArray(e)?e:[e];return t.filter(function(e){return e.isDirectory?e:void 0})}).then(function(t){var n=t.map(function(t){return e.readFileAsJSON(t.path+"meta.json")});return Promise.all(n).then(function(e){return e})})},r.prototype.buildGameOver=function(t){var n=D.GAMES_DIR+t.content_id+"/meta.json";return t.hasOwnProperty("content_id")?(C.d("Read meta.json:",n),C.d("GAMEOVER_TEMPLATE path",D.GAMEOVER_DIR+"gameover.html"),Promise.all([e.readFileAsJSON(n),e.readFile(D.GAMEOVER_DIR+"gameover.html")]).then(function(e){var n=e[1],r=e[0];return C.i("Meta JSON:",r),n.replace("{{score}}",t.score).replace("{{url_share}}",r.url_share).replace("{{url_cover}}",r.images.cover.ratio_1_4).replace("{{startpage_url}}",D.WWW_DIR+"index.html")})):Promise.reject("Missing content_id key!")},r.prototype.isGameDownloaded=function(t){return e.dirExists(D.GAMES_DIR+t)},r.prototype.removeAll=function(){return e.removeDir(D.GAMES_DIR).then(function(t){return C.d("All games deleted!",t),e.createDir(D.BASE_DIR,"games")})},r.prototype.getBundleGameObjects=function(){var e=this;if(I.bundle_games.length>0){C.d("Games bundle in configuration",I.bundle_games);var t,n=I.bundle_games.map(function(t){return e.isGameDownloaded(t)}),r=Promise.all(n).then(function(e){C.d("alreadyDownloaded",e);for(var t=0;t<e.length;t++)e[t]&&I.bundle_games.splice(t,1);return I.bundle_games}).then(function(e){return e.join(",")});return r.then(function(e){L.content_id=e;var t=R(I.api,L);return C.d("Request bundle games meta info:",t),new b(t).prom}).then(function(e){C.d("Games bundle response:",e),t=e;var n=e.map(function(e){return new b(e.url_api_dld).prom});return C.d("jsonpRequests",n),Promise.all(n)}).then(function(e){C.d("RESULTS",e);for(var n=0;n<e.length;n++)t[n].response_api_dld=e[n];return C.d("GameObjects",t),t})["catch"](function(e){C.e("Games bundle meta fail:",e)})}return C.w("Bundle_games array is empty!"),Promise.reject("bundle_games array is empty!")},r.prototype.needsUpdate=function(n){var r="";return e.readFileAsJSON(D.GAMES_DIR+n+"/meta.json").then(function(e){return r=e.response_api_dld.binary_md5,t.getJSON(e.url_api_dld)}).then(function(e){if(200===e.status)return e.binary_md5!==r;throw new Error("ResponseStatus "+e.status)})};var N={};n.game={},N.initialize=o,n.game._protected=N,n.game._public=new r}(l.file,l.Utils,l),function(e){function t(e,t,n,r,o){return function(){if("function"==typeof e&&(e=e.call(null)),e)return t.apply(n||null,arguments);switch(r=r||"NoMessage",o){case"warn":console.warn(r);break;case"error":console.error(r);break;case"info":console.info(r);break;default:console.log(r)}}}e.Decorators={requireCondition:t}}(l),function(e,t,n){function r(){l.i(i,a)}function o(){return window.plugins&&"undefined"!=typeof window.plugins.AdMob}var i={NO_CHANGE:0,TOP_LEFT:1,TOP_CENTER:2,TOP_RIGHT:3,LEFT:4,CENTER:5,RIGHT:6,BOTTOM_LEFT:7,BOTTOM_CENTER:8,BOTTOM_RIGHT:9,POS_XY:10},a={SMART_BANNER:"SMART_BANNER",BANNER:"BANNER",MEDIUM_RECTANGLE:"MEDIUM_RECTANGLE",FULL_BANNER:"FULL_BANNER",LEADERBOARD:"LEADERBOARD",SKYSCRAPER:"SKYSCRAPER"},s={},l=new e.Logger("all","[AdManager]");s=/(android)/i.test(navigator.userAgent)?{banner:"ca-app-pub-6869992474017983/9375997553",interstitial:"ca-app-pub-6869992474017983/1657046752"}:/(ipod|iphone|ipad)/i.test(navigator.userAgent)?{banner:"ca-app-pub-6869992474017983/4806197152",interstitial:"ca-app-pub-6869992474017983/7563979554"}:{banner:"ca-app-pub-6869992474017983/8878394753",interstitial:"ca-app-pub-6869992474017983/1355127956"},r.prototype.createBanner=function(){l.d("NotImplemented")},r.prototype.removeBanner=function(){l.d("NotImplemented")},r.prototype.showBanner=function(){l.d("NotImplemented")},r.prototype.showBannerAtGivenXY=function(){l.d("NotImplemented")},r.prototype.showBannerAtSelectedPosition=function(){l.d("NotImplemented")},r.prototype.hideBanner=function(){l.d("NotImplemented")},r.prototype.prepareInterstitial=function(){l.d("NotImplemented")},r.prototype.showInterstitial=function(){l.d("NotImplemented")},r.prototype.prepareRewardVideoAd=function(){l.d("NotImplemented")},r.prototype.registerAdEvents=function(){l.d("NotImplemented")},r.prototype.showRewardVideoAd=function(){l.d("NotImplemented")},r.prototype.setOptions=function(){l.d("NotImplemented")};for(var c in r.prototype)r.prototype.hasOwnProperty(c)&&(r.prototype[c]=t.requireCondition(o,r.prototype[c],r.prototype,"cordova-plugin-admob not installed","warn"));n.AdManager=new r}(l.Utils,l.Decorators,l);var Q=function(){var e={};return e.check=function(t){var n=["motime_apikey","namespace","label","country"];n.forEach(function(e){return t.hasOwnProperty(e)?t[e]?void 0:_("[MFP] Configuration: '"+e+"' not valid!"):_("[MFP] Configuration '"+e+"' not defined!")}),e.get(t)},e.getContents=function(e,t,n,r){var o={};o.api_country=n,o.country=e,o.fpnamespace=t,r&&(o.extData=r);var i=JSON.stringify(o);return i},e.getPonyValue=function(e){try{return e.split("=")[1]}catch(t){_(t)}return""},e.setSession=function(t){var n=S;window.localStorage.getItem("appUrl")&&(n=window.localStorage.getItem("appUrl"));var r=new URI(S),o=r.hostname(),i=URITemplate(Y.api.mfpSetUriTemplate).expand({protocol:r.protocol(),hostname:o,url:n,domain:o,_PONY:e.getPonyValue(t)});v("[MobileFingerPrint] going to url: ",i),D(i)},e.get=function(t){var n="",r=URITemplate(Y.api.mfpGetUriTemplate).expand({apikey:t.motime_apikey,contents_inapp:e.getContents(t.country,t.namespace,t.label),country:t.country,expire:n});window.aja().url(r).type("jsonp").on("success",function(t){v("[MobileFingerPrint] get() response: ",t);var n="";if(t.content.inappInfo){var r=JSON.parse(t.content.inappInfo);r.extData&&(r.extData.ponyUrl&&(n=r.extData.ponyUrl),r.extData.return_url&&window.localStorage.setItem("appUrl",r.extData.return_url),r.extData.session_mfp&&le.track({page:"hybrid_initialize",action:"MFP_get",session_mfp:r.extData.session_mfp})),e.setSession(n)}else v("[MobileFingerPrint] get(): Empty session")}).on("error",function(e){_("[MobileFingerPrint] get() error: ",e)}).go()},{check:e.check}}(),ee=function(){"use strict";function e(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function t(e,t){return e<<t|e>>>32-t}function n(n,r,o,i,a,s){return e(t(e(e(r,n),e(i,s)),a),o)}function r(e,t,r,o,i,a,s){return n(t&r|~t&o,e,t,i,a,s)}function o(e,t,r,o,i,a,s){return n(t&o|r&~o,e,t,i,a,s)}function i(e,t,r,o,i,a,s){return n(t^r^o,e,t,i,a,s)}function a(e,t,r,o,i,a,s){return n(r^(t|~o),e,t,i,a,s)}function s(t,n){t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;var s,l,c,u,d,p=1732584193,f=-271733879,g=-1732584194,m=271733878;for(s=0;s<t.length;s+=16)l=p,c=f,u=g,d=m,p=r(p,f,g,m,t[s],7,-680876936),m=r(m,p,f,g,t[s+1],12,-389564586),g=r(g,m,p,f,t[s+2],17,606105819),f=r(f,g,m,p,t[s+3],22,-1044525330),p=r(p,f,g,m,t[s+4],7,-176418897),m=r(m,p,f,g,t[s+5],12,1200080426),g=r(g,m,p,f,t[s+6],17,-1473231341),f=r(f,g,m,p,t[s+7],22,-45705983),p=r(p,f,g,m,t[s+8],7,1770035416),m=r(m,p,f,g,t[s+9],12,-1958414417),g=r(g,m,p,f,t[s+10],17,-42063),f=r(f,g,m,p,t[s+11],22,-1990404162),p=r(p,f,g,m,t[s+12],7,1804603682),m=r(m,p,f,g,t[s+13],12,-40341101),g=r(g,m,p,f,t[s+14],17,-1502002290),f=r(f,g,m,p,t[s+15],22,1236535329),p=o(p,f,g,m,t[s+1],5,-165796510),m=o(m,p,f,g,t[s+6],9,-1069501632),g=o(g,m,p,f,t[s+11],14,643717713),f=o(f,g,m,p,t[s],20,-373897302),p=o(p,f,g,m,t[s+5],5,-701558691),m=o(m,p,f,g,t[s+10],9,38016083),g=o(g,m,p,f,t[s+15],14,-660478335),f=o(f,g,m,p,t[s+4],20,-405537848),p=o(p,f,g,m,t[s+9],5,568446438),m=o(m,p,f,g,t[s+14],9,-1019803690),g=o(g,m,p,f,t[s+3],14,-187363961),f=o(f,g,m,p,t[s+8],20,1163531501),p=o(p,f,g,m,t[s+13],5,-1444681467),m=o(m,p,f,g,t[s+2],9,-51403784),g=o(g,m,p,f,t[s+7],14,1735328473),f=o(f,g,m,p,t[s+12],20,-1926607734),p=i(p,f,g,m,t[s+5],4,-378558),m=i(m,p,f,g,t[s+8],11,-2022574463),g=i(g,m,p,f,t[s+11],16,1839030562),f=i(f,g,m,p,t[s+14],23,-35309556),p=i(p,f,g,m,t[s+1],4,-1530992060),m=i(m,p,f,g,t[s+4],11,1272893353),g=i(g,m,p,f,t[s+7],16,-155497632),f=i(f,g,m,p,t[s+10],23,-1094730640),p=i(p,f,g,m,t[s+13],4,681279174),m=i(m,p,f,g,t[s],11,-358537222),g=i(g,m,p,f,t[s+3],16,-722521979),f=i(f,g,m,p,t[s+6],23,76029189),p=i(p,f,g,m,t[s+9],4,-640364487),m=i(m,p,f,g,t[s+12],11,-421815835),g=i(g,m,p,f,t[s+15],16,530742520),f=i(f,g,m,p,t[s+2],23,-995338651),p=a(p,f,g,m,t[s],6,-198630844),m=a(m,p,f,g,t[s+7],10,1126891415),g=a(g,m,p,f,t[s+14],15,-1416354905),f=a(f,g,m,p,t[s+5],21,-57434055),p=a(p,f,g,m,t[s+12],6,1700485571),m=a(m,p,f,g,t[s+3],10,-1894986606),g=a(g,m,p,f,t[s+10],15,-1051523),f=a(f,g,m,p,t[s+1],21,-2054922799),p=a(p,f,g,m,t[s+8],6,1873313359),m=a(m,p,f,g,t[s+15],10,-30611744),g=a(g,m,p,f,t[s+6],15,-1560198380),f=a(f,g,m,p,t[s+13],21,1309151649),p=a(p,f,g,m,t[s+4],6,-145523070),m=a(m,p,f,g,t[s+11],10,-1120210379),g=a(g,m,p,f,t[s+2],15,718787259),f=a(f,g,m,p,t[s+9],21,-343485551),p=e(p,l),f=e(f,c),g=e(g,u),m=e(m,d);return[p,f,g,m]}function l(e){var t,n="";for(t=0;t<32*e.length;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function c(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;for(t=0;t<8*e.length;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function u(e){return l(s(c(e),8*e.length))}function d(e,t){var n,r,o=c(e),i=[],a=[];for(i[15]=a[15]=void 0,o.length>16&&(o=s(o,8*e.length)),n=0;16>n;n+=1)i[n]=909522486^o[n],a[n]=1549556828^o[n];return r=s(i.concat(c(t)),512+8*t.length),l(s(a.concat(r),640))}function p(e){var t,n,r="0123456789abcdef",o="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),o+=r.charAt(t>>>4&15)+r.charAt(15&t);
return o}function f(e){return unescape(encodeURIComponent(e))}function g(e){return u(f(e))}function m(e){return p(g(e))}function w(e,t){return d(f(e),f(t))}function h(e,t){return p(w(e,t))}function v(e,t,n){return t?n?w(t,e):h(t,e):n?g(e):m(e)}return v}(),te=function(e){if("undefined"==typeof window.SpinnerDialog)return _("startLoading(): SpinnerDialog cordova plugin missing!");"object"!=typeof e&&(e={});var t=null;return e.hasOwnProperty("message")&&(t=e.message),window.SpinnerDialog.show(null,t),!0},ne=function(){return"undefined"==typeof window.SpinnerDialog?_("startLoading(): SpinnerDialog cordova plugin missing!"):(window.SpinnerDialog.hide(),!0)};window.startLoading=te,window.stopLoading=ne;var re={id:"",alias:"",type:"",verbosity:"",paymethod:"",subscribeMethod:"",returnUrl:"",callbackSuccess:function(){v("[IAP] Undefined callbackSuccess")},callbackError:function(){v("[IAP] Undefined callbackError")},callbackListingSuccess:function(){v("[IAP] Undefined callbackListingSuccess")},callbackListingError:function(){v("[IAP] Undefined callbackListingError")},callbackPurchaseSuccess:function(){v("[IAP] Undefined callbackPurchaseSuccess")},requestedListingProductId:"",inappPurchaseCalled:!1,inappProductInfoCalled:!1,lastCreateUserProduct:null,lastCreateUserToken:null,refreshDone:!1,lastCreateuserUrl:"",lastCreateuserData:"",createUserAttempt:0,maxCreateUserAttempt:6,refreshInProgress:!1,productsInfo:{},initialize:function(e){return window.store?(re.returnUrl=document.location.href,e.id?re.id=e.id:R()?re.id=e.id_android:b()&&(re.id=e.id_ios),re.id?(e.alias&&(re.alias=e.alias),e.type&&(re.type=e.type),e.api_createuser&&(re.subscribeMethod=e.api_createuser),re.verbosity="INFO",re.paymethod=R()?"gwallet":"itunes",v("IAP initialize id: "+re.id),R()&&re.getGoogleAccount(),window.store.verbosity=window.store[re.verbosity],window.store.register({id:re.id,alias:re.alias,type:window.store[re.type]}),window.store.when(re.alias).approved(function(e){re.onPurchaseApproved(e)}),window.store.when(re.alias).verified(function(e){re.onPurchaseVerified(e)}),window.store.when(re.alias).updated(function(e){re.onProductUpdate(e)}),window.store.when(re.alias).owned(function(e){re.onProductOwned(e)}),window.store.when(re.alias).cancelled(function(e){re.onCancelledProduct(e)}),window.store.when(re.alias).error(function(e){re.error(JSON.stringify(e))}),window.store.ready(function(){re.onStoreReady()}),window.store.when("order "+re.id).approved(function(e){re.onOrderApproved(e)}),window.store.when("product").updated(function(e){re.saveProductInfo(e)}),!0):(_("[IAP] Configuration error, missing product id!"),!1)):(_("[IAP] Store not available, missing cordova plugin."),!1)},saveProductInfo:function(e){return re.refreshInProgress=!1,"object"!=typeof e?void _("[IAP] saveProductInfo() got invalid data"):"id"in e?(re.productsInfo[e.id]=e,void(re.requestedListingProductId===e.id&&re.callbackListingSuccess(e))):void _("[IAP] saveProductInfo() got invalid data, id undefined")},doRefresh:function(e){re.refreshInProgress&&y("[IAP] doRefresh() refresh in progress, skipping..."),re.refreshDone&&!e||(window.store.refresh(),re.refreshDone=!0,re.refreshInProgress=!0,v("[IAP] doRefresh() refreshing..."))},getPassword:function(e){return ee("iap."+e+".playme").substr(0,8)},getGoogleAccount:function(){window.accountmanager.getAccounts(re.checkGoogleAccount,re.error,"com.google")},checkGoogleAccount:function(e){if(e){v("[IAP] accounts"),v(e);for(var t in e)return window.localStorage.setItem("googleAccount",e[t].email),e[t].email}},onProductUpdate:function(e){v("IAP> Product updated."),v(JSON.stringify(e)),v(e.owned?"[IAP] Subscribed!":"[IAP] Not Subscribed")},onPurchaseApproved:function(e){v("IAP> Purchase approved."),v(JSON.stringify(e)),e.finish()},onPurchaseVerified:function(e){v("subscription verified ",e)},onStoreReady:function(){v("\\o/ STORE READY \\o/")},onProductOwned:function(e){if(v("[IAP] > Product Owned."),!e.transaction.id&&b())return _("[IAP] > no transaction id"),!1;if(window.localStorage.setItem("product",e),b()&&window.localStorage.setItem("transaction_id",e.transaction.id),R()){var t=e.transaction.purchaseToken+"|"+N+"|"+re.id;v("[IAP] Purchase Token: "+t),window.localStorage.getItem("user_account")||re.createUser(e,t)}else window.storekit.loadReceipts(function(t){window.localStorage.getItem("user_account")||(t.appStoreReceipt?(v("[IAP] appStoreReceipt: "+t.appStoreReceipt),re.createUser(e,t.appStoreReceipt)):v("[IAP] appStoreReceipt empty, ignoring request"))})},onCancelledProduct:function(e){H(!1),re.callbackError({iap_cancelled:1,return_url:re.returnUrl}),v("[IAP] > Purchase cancelled ##################################",e)},onOrderApproved:function(e){v("[IAP] ORDER APPROVED "+re.id),e.finish()},error:function(e){H(!1),_("[IAP] error: "+e),re.callbackError({iap_error:1,return_url:re.returnUrl})},createUser:function(e,t){if(v("[IAP] createUser start "),!re.inappProductInfoCalled&&!re.inappPurchaseCalled)return re.lastCreateUserProduct=e,void(re.lastCreateUserToken=t);if(!re.subscribeMethod)return void _("[IAP] createUser configuration error: missing api url.");window.localStorage.setItem("user_account",R()?window.localStorage.getItem("googleAccount")?window.localStorage.getItem("googleAccount"):t+"@google.com":e.transaction.id+"@itunes.com");var n=re.subscribeMethod,r={paymethod:re.paymethod,user_account:window.localStorage.getItem("user_account"),purchase_token:t,return_url:re.returnUrl,inapp_pwd:re.getPassword(t),hybrid:1};re.lastCreateuserUrl=n,re.lastCreateuserData=r;var o=function(e){if(re.createUserAttempt<=re.maxCreateUserAttempt)_("[IAP] createUser failed "+re.createUserAttempt+" times, trying again... last error: "+JSON.stringify(e)),s();else{_("[IAP] createUser onCreateError: removing user_account"),window.localStorage.removeItem("user_account");var t={iap_error:"1",return_url:re.returnUrl};H(!1),re.inappPurchaseCalled?re.callbackError(t):re.inappProductInfoCalled&&re.callbackListingError(t)}},i=function(e){v("[IAP] createUser success ",e);try{e.device_id=E.uuid,window.localStorage.getItem("transaction_id")&&(e.transaction_id=window.localStorage.getItem("transaction_id")),H(!1),re.callbackSuccess(e),re.inappPurchaseCalled?re.callbackSuccess(e):re.inappProductInfoCalled&&re.callbackPurchaseSuccess(e)}catch(t){o(t)}},a=10,s=function(){setTimeout(function(){re.createUserAttempt=re.createUserAttempt+1,v("[IAP] createUser attempt: "+re.createUserAttempt+" with timeout: "+a+"sec."),v("[IAP] POST createUser: "+re.lastCreateuserUrl+" params: "+JSON.stringify(re.lastCreateuserData)+" timeout: "+1e3*a),window.aja().method("POST").url(re.lastCreateuserUrl).cache(!1).timeout(1e3*a).data(re.lastCreateuserData).on("success",function(e){i(e)}).on("error",function(e){o(e)}).on("4xx",function(e){o(e)}).on("5xx",function(e){o(e)}).on("timeout",function(){o("timeout")}).on("end",function(){v("[IAP] createUser end"),H(!1)}).go(),a+=5},10)};re.createUserAttempt=0,s()}};s.inAppPurchaseSubscription=function(e,t,n,r){return P?T?(H(!0),"undefined"!=typeof r&&(re.returnUrl=r),"undefined"!=typeof n&&(re.subscribeMethod=n),re.callbackSuccess=e,re.callbackError=t,re.inappPurchaseCalled=!0,re.lastCreateUserProduct&&re.lastCreateUserToken?(re.createUser(re.lastCreateUserProduct,re.lastCreateUserToken),!0):(re.doRefresh(),window.store.order(re.id),!0)):(t("Stargate closed, wait for Stargate.initialize to complete!"),!1):(t("Stargate not initialized, call Stargate.initialize first!"),!1)},s.inAppRestore=function(e,t,n,r){return P?T?("undefined"!=typeof n&&(re.subscribeMethod=n),"undefined"!=typeof r&&(re.returnUrl=r),re.callbackSuccess=e,re.callbackError=t,re.inappPurchaseCalled=!0,void re.doRefresh(!0)):t("Stargate closed, wait for Stargate.initialize to complete!"):t("Stargate not initialized, call Stargate.initialize first!")},s.inAppProductInfo=function(e){if(e.productId||(e.productId=re.id),"function"!=typeof e.callbackListingSuccess&&(e.callbackListingSuccess=function(){}),"function"!=typeof e.callbackPurchaseSuccess&&(e.callbackPurchaseSuccess=function(){}),"function"!=typeof e.callbackError&&(e.callbackError=function(){}),!e.subscriptionUrl)return _("[IAP] inAppProductInfo(): options.subscriptionUrl invalid"),!1;if(!P)return e.callbackError("Stargate not initialized, call Stargate.initialize first!"),!1;if(!T)return e.callbackError("Stargate closed, wait for Stargate.initialize to complete!"),!1;if(re.subscribeMethod=e.subscriptionUrl,re.requestedListingProductId=e.productId,re.callbackListingSuccess=e.callbackListingSuccess,re.callbackPurchaseSuccess=e.callbackPurchaseSuccess,re.callbackListingError=e.callbackError,re.inappProductInfoCalled=!0,re.productsInfo[e.productId])try{re.callbackListingSuccess(re.productsInfo[e.productId])}catch(t){_("[IAP] inAppProductInfo(): error on callbackListingSuccess!")}return re.lastCreateUserProduct&&re.lastCreateUserToken?(re.createUser(re.lastCreateUserProduct,re.lastCreateUserToken),!0):(re.doRefresh(!0),!0)},s.facebookLogin=function(e,t,n){return P?void facebookConnectPlugin.login(e.split(","),function(e){v("[facebook] got userdata: ",e),facebookConnectPlugin.getAccessToken(function(e){t({accessToken:e})},function(e){n({error:e})})},function(e){_("Got FB login error:",e),n({error:e})}):n("Stargate not initialized, call Stargate.initialize first!")},s.facebookShare=function(e,t,n){if(!P)return n("Stargate not initialized, call Stargate.initialize first!");var r={method:"share",href:e};facebookConnectPlugin.showDialog(r,function(e){t({message:e})},function(e){_("Got FB share error:",e),n({error:e})})};var oe=function(){deltadna.registerPushCallback(ae)},ie=function(e){_("[DeltaDNA] error: "+e)},ae=function(e){return R()&&e.payload&&e.payload.url&&!e.foreground?D(e.payload.url):b()&&e.url?D(e.url):void 0},se=function(){var e,t={},n={};return t.init=function(){if(!window.plugins||!window.plugins.appsFlyer)return _("[appsflyer] missing cordova plugin");if("undefined"==typeof Y.appstore_appid)return _("[appsflyer] missing manifest configuration: appstore_appid");if("undefined"==typeof Y.appsflyer_devkey)return _("[appsflyer] missing manifest configuration: appsflyer_devkey");var t=[Y.appsflyer_devkey];b()&&t.push(Y.appstore_appid),document.addEventListener("onInstallConversionDataLoaded",function(t){if(n=t.detail,"function"!=typeof e)return v("[appsflyer] callback not set!");try{e(n),v("[appsflyer] parameters sent to webapp callback: "+JSON.stringify(n))}catch(r){_("[appsflyer] callback error: "+r,r)}},!1),window.plugins.appsFlyer.initSdk(t)},t.setCallback=function(t){e=t},t}();s.setConversionDataCallback=function(e){se.setCallback(e)};var le=function(){var e,t={};return t.track=function(t){if("function"!=typeof e)return v("[analytics] callback not set!");try{e(t)}catch(n){_("[analytics] callback error: "+n,n)}},t.setCallback=function(t){e=t},t}();s.setAnalyticsCallback=function(e){le.setCallback(e)};var ce={AdMobSupport:!1,MoPubSupport:!1,AdPosition:{NO_CHANGE:0,TOP_LEFT:1,TOP_CENTER:2,TOP_RIGHT:3,LEFT:4,CENTER:5,RIGHT:6,BOTTOM_LEFT:7,BOTTOM_CENTER:8,BOTTOM_RIGHT:9,POS_XY:10},AdSize:{SMART_BANNER:"SMART_BANNER",BANNER:"BANNER",MEDIUM_RECTANGLE:"MEDIUM_RECTANGLE",FULL_BANNER:"FULL_BANNER",LEADERBOARD:"LEADERBOARD",SKYSCRAPER:"SKYSCRAPER"},DefaultOptions:null,initialize:function(e,t,n){return e&&(ce.DefaultOptions=e),AdMob&&(ce.AdMobSupport=!0,ce.initAdMob(e,t,n)),MoPub&&(ce.MoPubSupport=!0),!0},isAdMobSupported:function(){return ce.AdMobSupport},isMoPubSupported:function(){return ce.MoPubSupport},getUserAgent:function(){return/(android)/i.test(navigator.userAgent)?"android":/(ipod|iphone|ipad)/i.test(navigator.userAgent)?"ios":"other"},initAdMob:function(e,t,n){var r={adSize:"BANNER",position:8,bgColor:"black",isTesting:!1,autoShow:!0};AdMob.setOptions(r,t,n)},registerAdEvents:function(e){document.addEventListener("onAdFailLoad",e),document.addEventListener("onAdLoaded",e),document.addEventListener("onAdPresent",e),document.addEventListener("onAdLeaveApp",e),document.addEventListener("onAdDismiss",e)},manageAdEvents:function(e){console.log("error: "+e.error+", reason: "+e.reason+", adNetwork:"+e.adNetwork+", adType:"+e.adType+", adEvent:"+e.adEvent)},createBanner:function(e,t,n){var r={},o=[],i=ce.getUserAgent();e||ce.isObjEmpty(ce.DefaultOptions)||(e=ce.DefaultOptions),Array.isArray(e)?o=e:o.push(e),o.forEach(function(e){if("default"==e.device||e.device==i){var o=ce.getAdSize().toLowerCase();e.overlap&&(r.overlap=e.overlap),e.offsetTopBar&&(r.offsetTopBar=e.offsetTopBar),r.adSize=ce.getAdSize(),o&&(r.adId=e[o]),e.position&&(r.position=ce.AdPosition[e.position]),e.width&&(r.width=e.width),e.height&&(r.height=e.height),e.autoShow&&(r.autoShow=e.autoShow),"admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?(e.width&&e.height&&(r.adSize="CUSTOM"),AdMob.createBanner(r,t,n)):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.createBanner(r,t,n)}})},showBannerAtSelectedPosition:function(e){var t=[],n=ce.getUserAgent();e||ce.isObjEmpty(ce.DefaultOptions)||(e=ce.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){"default"!=e.device&&e.device!=n||("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showBanner(e.position):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showBanner(e.position))})},showBannerAtGivenXY:function(e){var t=[],n=ce.getUserAgent();e||ce.isObjEmpty(ce.DefaultOptions)||(e=ce.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){"default"!=e.device&&e.device!=n||("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showBannerAtXY(e.x,e.y):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showBannerAtXY(e.x,e.y))})},hideBanner:function(e){var t=[],n=ce.getUserAgent();e||ce.isObjEmpty(ce.DefaultOptions)||(e=ce.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){"default"!=e.device&&e.device!=n||("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.hideBanner():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.hideBanner())})},removeBanner:function(e){var t=[],n=ce.getUserAgent();e||ce.isObjEmpty(ce.DefaultOptions)||(e=ce.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){"default"!=e.device&&e.device!=n||("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.removeBanner():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.removeBanner())})},prepareInterstitial:function(e,t,n){var r={},o=[],i=ce.getUserAgent();e||ce.isObjEmpty(ce.DefaultOptions)||(e=ce.DefaultOptions),Array.isArray(e)?o=e:o.push(e),o.forEach(function(e){"default"!=e.device&&e.device!=i||(e.interstitial&&(r.adId=e.interstitial),e.autoShow&&(r.autoShow=e.autoShow),"admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.prepareInterstitial(r):"mopub"==e.network.toLowerCase()&&MoPub.prepareInterstitial(r,t,n))})},showInterstitial:function(e){var t=[],n=ce.getUserAgent();e||ce.isObjEmpty(ce.DefaultOptions)||(e=ce.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){"default"!=e.device&&e.device!=n||("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showInterstitial():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showInterstitial())})},isObjEmpty:function(e){return 0===Object.keys(e).length},getAdSize:function(){var e=screen.height,t=screen.width;return t>=728&&e>=90?ce.AdSize.LEADERBOARD:t>=468&&e>=60?ce.AdSize.BANNER:t>=320&&e>=50?ce.AdSize.BANNER:void 0}};return s.game=l.game._public,s.file=l.file,s.AdManager=l.AdManager,s});
>>>>>>> hotfix-starturl
