/*!
 * StargateJS Apps
 * v0.2.8
 * Copyright 2015 DMobileLab. http://buongiorno.com/
 * See LICENSE in this repository for license information
 */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.Stargate=t()}(this,function(){function e(e){f.type=e.type,f.networkState=navigator.connection.type,"function"==typeof d&&d(f)}function t(){f.networkState=navigator.connection.type,"none"===navigator.connection.type?f.type="offline":f.type="online"}function n(){return window.cordova.file?a.file.readFileAsJSON(window.cordova.file.applicationDirectory+"www/manifest.json"):window.hostedwebapp?new Promise(function(e,t){window.hostedwebapp.getManifest(function(t){e(t)},function(e){w(e),t(new Error(e))})}):Promise.reject(new Error("getManifest() no available reading mechanism!"))}function r(){this.initialize=function(e,t,n){w("unimplemented"),n("unimplemented")},this.createBanner=function(e,t,n){w("unimplemented"),n("unimplemented")},this.hideBanner=function(e,t,n){w("unimplemented"),n("unimplemented")},this.removeBanner=function(e,t,n){w("unimplemented"),n("unimplemented")},this.showBannerAtSelectedPosition=function(e,t,n){w("unimplemented"),n("unimplemented")},this.showBannerAtGivenXY=function(e,t,n){w("unimplemented"),n("unimplemented")},this.registerAdEvents=function(e,t,n){w("unimplemented"),n("unimplemented")},this.prepareInterstitial=function(e,t,n){w("unimplemented"),n("unimplemented")},this.showInterstitial=function(e,t,n){w("unimplemented"),n("unimplemented")}}var i="0.2.8",o={},a={};!function(e){function t(e,n){this.level=t.levels[e.toUpperCase()],this.tag=n}function n(e){var t=0;return{next:function(n){return n&&(t=0),t<e.length?{value:e[t++],done:!1}:{done:!0}}}}function r(e,t){e+="?";var n="";for(var r in t)n+=encodeURIComponent(r)+"="+encodeURIComponent(t[r])+"&";return n.length>0&&(n=n.substring(0,n.length-1)),e+n}function i(e){e=encodeURI(e);var t=new window.XMLHttpRequest,n=new Promise(function(e,n){t.onreadystatechange=function(){4==t.readyState&&t.status<400?e(t.response):n(t.status)}});return t.open("GET",e,!0),t.setRequestHeader("Content-type","application/json; charset=UTF-8"),t.send(),n}function o(e){var t=this;if(t.timeout=3e3,t.called=!1,!window.document)return!1;var n=Date.now();t.scriptTag=window.document.createElement("script"),e+="&callback=window.__jsonpHandler_"+n,t.scriptTag.src=e,t.scriptTag.type="text/javascript",t.scriptTag.async=!0,t.prom=new Promise(function(e,r){var i="__jsonpHandler_"+n;window[i]=function(n){t.called=!0,e(n),t.scriptTag.parentElement.removeChild(t.scriptTag),delete window[i]},setTimeout(function(){t.called||(r("Timeout jsonp request "+n),t.scriptTag.parentElement.removeChild(t.scriptTag),delete window[i])},t.timeout)}),window.document.getElementsByTagName("head")[0].appendChild(t.scriptTag)}t.levels={ALL:5,ERROR:4,WARN:3,INFO:2,DEBUG:1,OFF:0},t.prototype.e=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.tag),0!==this.level&&this.level>=t.levels.ERROR&&window.console.error.apply(console,e)},t.prototype.i=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.tag),0!==this.level&&this.level>=t.levels.WARN&&window.console.info.apply(console,e)},t.prototype.w=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.tag),0!==this.level&&this.level>=t.levels.INFO&&window.console.warn.apply(console,e)},t.prototype.d=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.tag),0!==this.level&&this.level>=t.levels.DEBUG&&window.console.log.apply(console,e)},t.prototype.setLevel=function(e){this.level=t.levels[e]};var a={Iterator:n,Logger:t,composeApiString:r,getJSON:i,jsonpRequest:o};e?e.Utils=a:window.Utils=a}(a),function(e,t){function n(e){var t=e.map(function(e){return{fullPath:e.fullPath,path:e.toURL(),internalURL:e.toInternalURL(),isFile:e.isFile,isDirectory:e.isDirectory}});return 1==t.length?t[0]:t}var r,i={};return i.LOG=r=new t("ALL","[File - module]"),i.ERROR_MAP={1:"NOT_FOUND_ERR",2:"SECURITY_ERR",3:"ABORT_ERR",4:"NOT_READABLE_ERR",5:"ENCODING_ERR",6:"NO_MODIFICATION_ALLOWED_ERR",7:"INVALID_STATE_ERR",8:"SYNTAX_ERR",9:"INVALID_MODIFICATION_ERR",10:"QUOTA_EXCEEDED_ERR",11:"TYPE_MISMATCH_ERR",12:"PATH_EXISTS_ERR"},i.currentFileTransfer=null,i.resolveFS=function(e){return new Promise(function(t,n){window.resolveLocalFileSystemURL(e,t,n)})},i.appendToFile=function(e,t,r){return r=void 0===arguments[2]?!1:arguments[2],i.resolveFS(e).then(function(e){return new Promise(function(i,o){e.createWriter(function(a){r||a.seek(a.length);var s=new Blob([t],{type:"text/plain"});a.write(s),a.onerror=o,a.onabort=o,a.onwriteend=function(){i(n([e]))}},o)})})},i.readFileAsHTML=function(e){return i.readFile(e).then(function(e){return(new window.DOMParser).parseFromString(e,"text/html")})},i.readFileAsJSON=function(e){return i.readFile(e).then(function(e){try{return Promise.resolve(window.JSON.parse(e))}catch(t){return Promise.reject(t)}})},i.removeFile=function(e){return i.resolveFS(e).then(function(e){return new Promise(function(t,n){e.remove(function(e){t(null===e||"OK"===e)},n)})})},i.removeDir=function(e){return i.resolveFS(e).then(function(e){return new Promise(function(t,n){e.removeRecursively(function(e){t(null===e||"OK"===e)},n)})})},i._promiseZip=function(e,t,n){return r.d("PROMISEZIP:",arguments),new Promise(function(r,i){window.zip.unzip(e,t,function(e){0===e?r(!0):i(e)},n)})},i.download=function(e,t,r,i){var o=this;this.ft=new window.FileTransfer,this.ft.onprogress=i,o.promise=new Promise(function(i,a){o.ft.download(window.encodeURI(e),t+r,function(e){i(n([e]))},function(e){a(e)},!0)})},i.createDir=function(e,t){return i.resolveFS(e).then(function(e){return new Promise(function(r,i){e.getDirectory(t,{create:!0},function(e){r(n([e]))},i)})})},i.fileExists=function(e){return new Promise(function(t){window.resolveLocalFileSystemURL(e,function(e){t(e.isFile)},function(e){t(1!==e.code)})})},i.dirExists=function(e){return new Promise(function(t){window.resolveLocalFileSystemURL(e,function(e){t(e.isDirectory)},function(e){t(1!=e.code)})})},i.requestFileSystem=function(e,t){return new Promise(function(n,r){window.requestFileSystem(e,t,n,r)})},i.readDir=function(e){return i.resolveFS(e).then(function(e){return new Promise(function(t,i){var o=e.createReader();o.readEntries(function(e){r.d("readDir:",e),t(n(e))},i)})})},i.readFile=function(e){return i.resolveFS(e).then(function(e){return new Promise(function(t,n){e.file(function(e){var r=new FileReader;r.onerror=n,r.onabort=n,r.onloadend=function(){var e=this.result;t(e)},r.readAsText(e)})})})},i.createFile=function(e,t){return i.resolveFS(e).then(function(e){return new Promise(function(r,i){e.getFile(t,{create:!0},function(e){r(n([e]))},i)})})},i.write=function(e,t){return i.appendToFile(e,t,!0)},i.moveDir=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),o=t.replace(n,"");return r.d("moveDir:",o,n),Promise.all([i.resolveFS(e),i.resolveFS(o)]).then(function(e){return r.d("moveDir: resolved entries",e),new Promise(function(t,r){e[0].moveTo(e[1],n,t,r)})})},i.copyFile=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),o=t.replace(n,"");return Promise.all([i.resolveFS(e),i.resolveFS(o)]).then(function(e){return r.d("copyFileTo",e),new Promise(function(t,r){e[0].copyTo(e[1],n,t,r)})})},i.copyDir=function(e,t){var n=t.substring(t.lastIndexOf("/")+1),o=t.replace(n,"");return Promise.all([i.resolveFS(e),i.resolveFS(o)]).then(function(i){return r.d("copyDir",e,"in",t),new Promise(function(e,t){i[0].copyTo(i[1],n,e,t)})})},e.file=i,i}(a,a.Utils.Logger),function(e,t,n){"use strict";function r(){}function i(t){function r(){var t=e.createDir(y.BASE_DIR,"games"),n=e.createDir(y.BASE_DIR,"scripts");return Promise.all([t,n]).then(function(t){return A.d("GamesDir and ScriptsDir created",t),A.d("Getting SDK from:",S),Promise.all([new e.download(S,t[1].path,"gfsdk.min.js").promise,new e.download(_,t[1].path,"dixie.js").promise,e.copyDir(y.WWW_DIR+"gameover_template",y.BASE_DIR+"gameover_template"),e.copyDir(y.WWW_DIR+"plugins",y.SDK_DIR+"plugins"),e.copyFile(y.CORDOVAJS,y.SDK_DIR+"cordova.js"),e.copyFile(y.CORDOVA_PLUGINS_JS,y.SDK_DIR+"cordova_plugins.js"),e.copyFile(y.STARGATEJS,y.SDK_DIR+"stargate.js"),e.copyFile(y.WWW_DIR+"js/gamesFixes.js",y.SDK_DIR+"gamesFixes.js")])})}if(A.d("Initialized called with:",t),b=t,!e)return Promise.reject("Missing file module!");try{u=window.cordova.file.applicationStorageDirectory,d=window.cordova.file.cacheDirectory,f=window.cordova.file.tempDirectory,p=window.cordova.file.applicationDirectory+"www/",g=window.cordova.file.applicationDirectory+"www/js/stargate.js",m=window.cordova.file.dataDirectory}catch(i){return A.e(i),Promise.reject(i)}A.i("cordova JS dir to include",y.CORDOVAJS),"ios"==window.device.platform.toLowerCase()&&(u+="Documents/"),"android"==window.device.platform.toLowerCase()&&(f=d),y.SDK_DIR=u+"scripts/",y.SDK_RELATIVE_DIR="../../scripts/",y.GAMEOVER_RELATIVE_DIR="../../gameover_template/",y.GAMES_DIR=u+"games/",y.BASE_DIR=u,y.CACHE_DIR=d,y.TEMP_DIR=f,y.CORDOVAJS=p+"cordova.js",y.CORDOVA_PLUGINS_JS=p+"cordova_plugins.js",y.STARGATEJS=p+"js/stargate.js",y.DATA_DIR=m,y.GAMEOVER_DIR=y.BASE_DIR+"gameover_template/",y.WWW_DIR=p,n.game._public.BASE_DIR=y.BASE_DIR,n.game._public.OFFLINE_INDEX=y.WWW_DIR+"index.html";var o=e.dirExists(y.GAMES_DIR),a=e.fileExists(y.SDK_DIR+"gfsdk.min.js");return Promise.all([o,a]).then(function(e){return e[0]||e[1]?Promise.resolve("AlreadyInitialized"):r()})}function o(t){return A.d("_getIndexHtmlById",y.GAMES_DIR+t),e.readDir(y.GAMES_DIR+t).then(function(e){return A.d("_getIndexHtmlById readDir",e),e.filter(function(e){var t=new RegExp(/index\.html$/i);return t.test(e.path)})})}function a(e){A.d("_removeRemoteSDK");for(var t,n=e.querySelectorAll("script"),r=0;r<n.length;r++)if(-1!==n[r].src.indexOf("gfsdk")){t=n[r],A.d("_removeRemoteSDK",t),t.parentNode.removeChild(t);break}return e}function s(e,t){e=a(e);var n,r=Array.isArray(t)===!1?[t]:t;A.d("injectScripts",r);var i=document.createElement("meta");i.httpEquiv="Content-Security-Policy",i.content="default-src * data: content: cdvfile: file: http: https: gap: https://ssl.gstatic.com 'unsafe-inline' 'unsafe-eval';style-src * cdvfile: http: https: 'unsafe-inline';",e.head.appendChild(i);for(var o=0;o<r.length;o++)if(r[o].endsWith(".css")){A.d("css inject:",r[o]);var s=e.createElement("link");s.rel="stylesheet",s.href=r[o],e.head.appendChild(s)}else n=document.createElement("script"),n.src=r[o],e.head.appendChild(n);return A.d("Cleaned dom:",e),e}function c(t,n){var r;return o(t).then(function(t){return r=t[0].path,e.readFileAsHTML(t[0].path)}).then(function(e){return A.d("_injectScripts"),A.d(e),s(e,n)}).then(function(e){A.d("Serialize dom");var t=(new XMLSerializer).serializeToString(e),n='<html xmlns="http://www.w3.org/1999/xhtml"';return t=t.replace(n,"<html").replace(RegExp(/[^\x20-\x7E\xA0-\xFF]/g),"")}).then(function(t){return t=t.trim(),A.d("Write dom:",r,t),e.write(r,t)})}function l(e){var t=new RegExp(/index\.html$/i);return t.test(e)}var u,d,f,p,m,g,w=t.Logger,h=t.composeApiString,v=t.jsonpRequest,y={},S="http://s2.motime.com/js/wl/webstore_html5game/gfsdk/dist/gfsdk.js?timestamp="+Date.now(),_="http://s2.motime.com/tbr/dixie.js?country=it-igames&timestamp="+Date.now(),I="http://resources2.buongiorno.com/lapis/apps/contents.getList",b={},D=!1,R={content_id:"",formats:"html5applications",sort:"-born_date",category:"b940b384ff0565b06dde433e05dc3c93",publisher:"",size:6,offset:0,label:"",label_slug:"",access_type:"",real_customer_id:"xx_gameasy",lang:"en",use_cs_id:"",white_label:"xx_gameasy",main_domain:"http://www2.gameasy.com/ww",fw:"gameasy",vh:"ww.gameasy.com",check_compatibility_header:0},A=new w("ALL","[Game - module]");r.prototype.download=function(t,n){function r(e){return function(t){var n=Math.round(t.loaded/t.total*100);s({percentage:n,type:e})}}function i(){u({type:"download"}),A.d("Download:",t.id,t.response_api_dld.binary_url);var n=new e.download(t.response_api_dld.binary_url,y.TEMP_DIR,f+".zip",r("download")).promise;return n.then(function(n){return u({type:"unzip"}),A.d("unzip:",t.id,y.TEMP_DIR+f),e._promiseZip(n.path,y.TEMP_DIR+f,r("unzip"))}).then(function(n){A.d("Unzip ended",n),d({type:"unzip"});var r=t.response_api_dld.url_download,i=r.substring(r.lastIndexOf("game"),r.length).split("/"),o="";return A.d("Get the right index folder of the game",i),i.length>2&&l(i[i.length-1])?(o=y.TEMP_DIR+[f,i[i.length-2]].join("/"),A.d("More than one level folders before index.html",i,o)):(o=y.TEMP_DIR+f,A.d("One level folder before index.html",i,o)),A.d("Copy game folder in games/",o,y.GAMES_DIR+f),e.moveDir(o,y.GAMES_DIR+f)}).then(function(t){return A.d("Remove zip from:",y.TEMP_DIR+f+".zip","last operation result",t),e.removeFile(y.TEMP_DIR+f+".zip")}).then(function(){A.d("Save meta.json for:",t.id);var n={gameId:t.id,size:{width:"240",height:"170",ratio:"1_4"},url:t.images.cover.ratio_1_4,type:"cover"},r=n.url.replace("[WSIZE]",n.size.width).replace("[HSIZE]",n.size.height),i=y.GAMES_DIR+n.gameId,o=i+"/images/"+n.type+"/",a=n.size.width+"x"+n.size.height+("_"+n.size.ratio||"")+".jpeg";return A.d("request Image to",r,"coverImageUrl",a,"imagesFolder",o),new e.download(r,o,a,function(){}).promise}).then(function(n){return A.d("Save meta.json for:",t.id),A.d("Download image result",n),t.images.cover.ratio_1_4=n.internalURL,e.createFile(y.GAMES_DIR+f,"meta.json").then(function(n){return e.write(n.path,JSON.stringify(t))})}).then(function(e){return A.d("result last operation:save meta.json",e),A.d("InjectScripts in game:",t.id,p),c(t.id,[y.SDK_RELATIVE_DIR+"gamesFixes.js",y.GAMEOVER_RELATIVE_DIR+"gameover.css",y.SDK_RELATIVE_DIR+"cordova.js",y.SDK_RELATIVE_DIR+"cordova_plugins.js",y.SDK_RELATIVE_DIR+"dixie.js",y.SDK_RELATIVE_DIR+"stargate.js",y.SDK_RELATIVE_DIR+"gfsdk.min.js"])}).then(function(e){return A.d("injectScripts result",e),d({type:"download"}),D=!1,t.id})["catch"](function(e){throw A.e(e,"Cleaning...game not downloaded",t.id),D=!1,a.remove(t.id),d({type:"error",description:e}),e})}if(this.isDownloading())return Promise.reject("Downloading...try later");if(200!==t.response_api_dld.status)return n.onEnd("response_api_dld.status not equal 200"),Promise.reject("response_api_dld.status not equal 200");D=!0;var o=this.isGameDownloaded(t.id),a=this;n=n?n:{};var s=n.onProgress?n.onProgress:function(){},u=n.onStart?n.onStart:function(){},d=n.onEnd?n.onEnd:function(){},f=t.id;return o.then(function(e){return A.d("Exists",e),e?Promise.reject({12:"AlreadyExists",gameID:t.id}):i()})},r.prototype.play=function(t){A.d("Play",t);var n=y.GAMES_DIR+t;return e.readDir(n).then(function(e){return e.filter(function(e){var t=new RegExp(/index\.html$/i);return t.test(e.path)})}).then(function(e){A.d(e);var t=e[0].internalURL+"?hybrid=1";"ios"==window.device.platform.toLowerCase()?(A.d("Play ios",t),window.location.href=t):(A.d("Play android",t),window.navigator.app.loadUrl(encodeURI(t)))})},r.prototype.remove=function(t){return A.d("Removing game",t),e.removeDir(y.GAMES_DIR+t)},r.prototype.isDownloading=function(){return D},r.prototype.abortDownload=function(){return this.isDownloading()?(A.d("Abort last download"),e.currentFileTransfer.abort(),e.currentFileTransfer=null,!0):(A.w("There's not a download operation to abort"),!1)},r.prototype.list=function(){return A.d("Get games list"),e.readDir(y.GAMES_DIR).then(function(e){var t=Array.isArray(e)?e:[e];return t.filter(function(e){return e.isDirectory?e:void 0})}).then(function(t){var n=t.map(function(t){return e.readFileAsJSON(t.path+"meta.json")});return Promise.all(n).then(function(e){return e})})},r.prototype.buildGameOver=function(t){var n=y.GAMES_DIR+t.content_id+"/meta.json";return t.hasOwnProperty("content_id")?(A.d("Read meta.json:",n),A.d("GAMEOVER_TEMPLATE path",y.GAMEOVER_DIR+"gameover.html"),Promise.all([e.readFileAsJSON(n),e.readFile(y.GAMEOVER_DIR+"gameover.html")]).then(function(e){var n=e[1],r=e[0];return A.i("Meta JSON:",r),n.replace("{{score}}",t.score).replace("{{url_share}}",r.url_share).replace("{{url_cover}}",r.images.cover.ratio_1_4).replace("{{startpage_url}}",y.WWW_DIR+"index.html")})):Promise.reject("Missing content_id key!")},r.prototype.isGameDownloaded=function(t){return e.dirExists(y.GAMES_DIR+t)},r.prototype.removeAll=function(){return e.removeDir(y.GAMES_DIR).then(function(t){return A.d("All games deleted!",t),e.createDir(y.BASE_DIR,"games")})},r.prototype.getBundleGameObjects=function(){var e=this;if(b&&b.bundleGames){A.d("Games bundle in configuration",b.bundleGames);var t,n=b.bundleGames.map(function(t){return e.isGameDownloaded(t)}),r=Promise.all(n).then(function(e){A.d("alreadyDownloaded",e);for(var t=0;t<e.length;t++)e[t]&&b.bundleGames.splice(t,1);return b.bundleGames}).then(function(e){return e.join(",")});return r.then(function(e){R.content_id=e;var t=h(I,R);return A.d("Request bundle games meta info:",t),new v(t).prom}).then(function(e){A.d("Games bundle response:",e),t=e;var n=e.map(function(e){return new v(e.url_api_dld).prom});return A.d("jsonpRequests",n),Promise.all(n)}).then(function(e){A.d("RESULTS",e);for(var n=0;n<e.length;n++)t[n].response_api_dld=e[n];return A.d("GameObjects",t),t})["catch"](function(e){A.e("Games bundle meta fail:",e)})}};var P={};n.game={},P.initialize=i,n.game._protected=P,n.game._public=new r}(a.file,a.Utils,a);var s=function(){var e={},t=!1;e.init=function(){if(N.hasOwnProperty("webappsfixes")&&"object"==typeof N.webappsfixes){t=!0;for(var e in N.webappsfixes)if(N.webappsfixes.hasOwnProperty(e))if(n.hasOwnProperty(e)&&"function"==typeof n[e]){g("[webappsFixes] applying fix: "+e);var r=n[e](N.webappsfixes[e]);r&&w("[webappsFixes] fix '"+e+"' failed: "+r)}else w("[webappsFixes] fix implementation not found for: "+e)}return t};var n={};return n.gamifiveSearchBox=function(e){if(!window.cordova||!window.cordova.plugins||!window.cordova.plugins.Keyboard)return"missing ionic-plugin-keyboard";if(e.platforms){if(S()&&!e.platforms.ios)return void g("[webappsFixes] [gamifiveSearchBox] fix disabled on iOS");if(y()&&!e.platforms.android)return void g("[webappsFixes] [gamifiveSearchBox] fix disabled on Android")}return window.addEventListener("native.keyboardshow",function(){setTimeout(function(){0===document.querySelectorAll("input:focus").length&&(g("[webappsFixes] [gamifiveSearchBox] keyboard show on null input: hiding"),cordova.plugins.Keyboard.close())},1)},!1),g("[webappsFixes] [gamifiveSearchBox] listening on event native.keyboardshow"),""},e}();window.pubKey="",window.forge="";var c;o.initializeOffline=function(e){return c?c:("object"!=typeof e&&(e={}),e.hasOwnProperty("hideSplashScreen")||(e.hideSplashScreen=!0),D=!0,c=new Promise(function(r){document.addEventListener("deviceready",function(){F(),_(),t(),Promise.all([cordova.getAppVersion.getVersionNumber(),n()]).then(function(t){P=t[0],"object"!=typeof t[1]&&(t[1]=JSON.parse(t[1])),p=t[1].start_url,N=t[1].stargateConf,e.hideSplashScreen&&(navigator.splashscreen.hide(),G(!1)),R=!0,g("Stargate.initializeOffline() done"),r(!0)})["catch"](function(e){w("initializeOffline() error: "+e)})})}))},o.conf={},o.conf.getWebappStartUrl=function(){if(!D)return w("Stargate not initialized, call Stargate.initialize first!");if(!R)return w("Stargate closed, wait for Stargate.initialize to complete!");var e=URI(N.webapp_start_url).addSearch("hybrid","1").addSearch("stargateVersion",l());return e};var l=function(){return N.stargate_version_to_load?N.stargate_version_to_load:(h("getStargateVersionToLoad() stargate_version_to_load must be set on manifest!"),m)};o.conf.getWebappOrigin=function(){var e=/http:\/\/[\w]{3,4}\..*\.[\w]{2,}/;return"undefined"==typeof N.webapp_start_url?(g("Stargate is initialized? Please call this method after it"),""):e.exec(N.webapp_start_url)[0]};var u;o.initialize=function(e,t,n,r){return"function"==typeof t&&"undefined"==typeof n&&"undefined"==typeof r&&(r=t),"undefined"==typeof r&&(g("Callback success not setted. \n You can use 'then'"),r=function(){}),"function"!=typeof r?(h("Stargate.initialize() callback is not a function!"),Promise.reject(new Error("Stargate.initialize() callback is not a function!"))):(b=z(),D?(h("Stargate.initialize() already called, executing callback."),r&&r(b),u):("object"!=typeof e&&(e={}),e.hybrid_conf&&(E="object"==typeof e.hybrid_conf?e.hybrid_conf:JSON.parse(decodeURIComponent(e.hybrid_conf))),e.modules?e.modules.constructor!==Array?w("initialize() configurations.modules is not an array"):O=e.modules:O=["mfp","iapbase","appsflyer","game"],e.modules_conf&&("object"!=typeof e.modules_conf?w("initialize() configurations.modules_conf is not an object"):k=e.modules_conf),e.country&&("mfp"in E?E.mfp.country=e.country:E.mfp={country:e.country}),b?(g("initialize() starting up, configuration: ",E),A=r,u=new Promise(function(e,t){document.addEventListener("deviceready",function(){L(e,t)},!1)}),D=!0,u):(g("version "+i+" running outside hybrid; loaded from server version: v"+l()),r&&r(b),u=Promise.resolve(b),D=!0,u)))},o.isInitialized=function(){return D},o.isOpen=function(){return R},o.isHybrid=function(){return z()},o.openUrl=function(e){return D?void window.open(e,"_system"):w("Stargate not initialized, call Stargate.initialize first!")},o.googleLogin=function(e,t){return D?(w("unimplemented"),void t("unimplemented")):t("Stargate not initialized, call Stargate.initialize first!")};var d,f={type:"unknown",networkState:"unknown"};o.addListener=function(e,t){"connectionchange"==e&&"function"==typeof t&&(g("onConnectionChange registered"),d=t)},document.addEventListener("online",e,!1),document.addEventListener("offline",e,!1),o.checkConnection=function(){var e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];return D?R?"undefined"==typeof navigator.connection||"function"!=typeof navigator.connection.getInfo?(t("Missing cordova plugin"),console.warn("Cordova Network Information module missing"),!1):(e(f),f):(t("Stargate closed, wait for Stargate.initialize to complete!"),!1):(t("Stargate not initialized, call Stargate.initialize first!"),!1)},o.getDeviceID=function(e,t){if(!D)return t("Stargate not initialized, call Stargate.initialize first!");if(!R)return t("Stargate closed, wait for Stargate.initialize to complete!"),!1;var n=v.uuid;e({deviceID:n})},o.setStatusbarVisibility=function(e,t,n){return D?R?"undefined"==typeof window.StatusBar?(w("[StatusBar] missing cordova plugin"),n("missing cordova plugin")):e?(window.StatusBar.show(),t("statusbar shown")):(window.StatusBar.hide(),t("statusbar hided")):(n("Stargate closed, wait for Stargate.initialize to complete!"),!1):n("Stargate not initialized, call Stargate.initialize first!")},o.getVersion=function(){return i},o.ad=new r;var p,m="2",g=console.log.bind(window.console,"[Stargate] "),w=console.error.bind(window.console,"[Stargate] "),h=console.warn.bind(window.console,"[Stargate] "),v={available:!1,cordova:"",manufacturer:"",model:"",platform:"",uuid:"",version:""},y=function(){return"Android"==v.platform},S=function(){return"iOS"==v.platform},_=function(){if("undefined"==typeof window.device)return w("Missing cordova device plugin");for(var e in v)window.device.hasOwnProperty(e)&&(v[e]=window.device[e]);return!0},I=function(e){g("launchUrl: "+e),document.location.href=e},b=!1,D=!1,R=!1,A=null,P="",E={},O=[],k={},x=function(){if("undefined"==typeof window.StatusBar)return w("[StatusBar] missing cordova plugin");if("undefined"!=typeof N.statusbar&&"undefined"!=typeof N.statusbar.hideOnUrlPattern&&N.statusbar.hideOnUrlPattern.constructor===Array){for(var e=document.location.href,t=!1,n=0;n<N.statusbar.hideOnUrlPattern.length;n++){var r=new RegExp(N.statusbar.hideOnUrlPattern[n]);if(r.test(e)){t=!0;break}}t?window.StatusBar.hide():window.StatusBar.show()}},F=function(){window.Cookies.set("hybrid","1"),window.localStorage.getItem("hybrid")||window.localStorage.setItem("hybrid",1)},U=function(){window.Cookies.set("stargateVersion",l()),window.localStorage.getItem("stargateVersion")||window.localStorage.setItem("stargateVersion",l())},T=function(){navigator.splashscreen.hide(),G(!1),"undefined"!=typeof SpinnerDialog&&SpinnerDialog.hide()},C=function(e){if(document.title=N.title,S()&&"undefined"!=typeof window.cordova&&cordova.require){var t=cordova.require("cordova/exec");t.setJsToNativeBridgeMode(t.jsToNativeModes.IFRAME_NAV)}if(U(),x(),B("mfp")&&J("mfp")){var n=V("mfp"),r=["motime_apikey","namespace","label"];r.forEach(function(e){!n.hasOwnProperty(e)&&N.hasOwnProperty(e)&&(n[e]=N[e])}),W.check(n)}B("deltadna")&&window.deltadna.startSDK(N.deltadna.environmentKey,N.deltadna.collectApi,N.deltadna.engageApi,Y,Z,N.deltadna.settings),J("iapbase")?X.initialize(V("iapbase")):J("iap")&&X.initialize(V("iap"))&&X.doRefresh(),B("appsflyer")&&J("appsflyer")&&Q.init(V("appsflyer")),s.init();var i=[];J("game")&&B("game")&&a.game&&i.push(a.game._protected.initialize(V("game"))),Promise.all(i).then(function(){j(e)})["catch"](function(t){w("onPluginReady() error: ",t),j(e)})},j=function(e){T(),R=!0,g("version "+i+" ready;  running in package version: "+P),A(!0),g("Stargate.initialize() done"),e(!0)},L=function(e,r){F(),_(),t(),Promise.all([cordova.getAppVersion.getVersionNumber(),n()]).then(function(t){P=t[0],"object"!=typeof t[1]&&(t[1]=JSON.parse(t[1])),p=t[1].start_url,N=t[1].stargateConf,C(e,r)})["catch"](function(e){w("onDeviceReady() error: "+e),r("onDeviceReady() error: "+e)})},z=function(){var e=window.URI(document.location.href);return e.hasQuery("hybrid")?!0:window.Cookies.get("hybrid")?!0:window.localStorage.getItem("hybrid")?!0:!1},M=!1,G=function(e){e?(M=!0,q()):(M=!1,H())},N={features:{}},V=function(e){if(!e)return w("getModuleConf() invalid module requested");if(e in k)return k[e];var t={iapbase:"IAP",iap:"IAP"},n=e;return t[e]&&(n=t[e]),n in E?E[n]:(g("getModuleConf(): no configuration for module: "+e+" ("+t+")"),{})},B=function(e){return"undefined"!=typeof N.features[e]&&N.features[e]},J=function(e){return O&&O.constructor===Array?O.indexOf(e)>-1:!1},W=function(){var e={};return e.check=function(t){var n=["motime_apikey","namespace","label","country"];n.forEach(function(e){return t.hasOwnProperty(e)?t[e]?void 0:w("[MFP] Configuration: '"+e+"' not valid!"):w("[MFP] Configuration '"+e+"' not defined!")}),e.get(t)},e.getContents=function(e,t,n,r){var i={};i.api_country=n,i.country=e,i.fpnamespace=t,r&&(i.extData=r);var o=JSON.stringify(i);return o},e.getPonyValue=function(e){try{return e.split("=")[1]}catch(t){w(t)}return""},e.setSession=function(t){var n=p;window.localStorage.getItem("appUrl")&&(n=window.localStorage.getItem("appUrl"));var r=new URI(p),i=r.hostname(),o=URITemplate(N.api.mfpSetUriTemplate).expand({protocol:r.protocol(),hostname:i,url:n,domain:i,_PONY:e.getPonyValue(t)});g("[MobileFingerPrint] going to url: ",o),I(o)},e.get=function(t){var n="",r=URITemplate(N.api.mfpGetUriTemplate).expand({apikey:t.motime_apikey,contents_inapp:e.getContents(t.country,t.namespace,t.label),country:t.country,expire:n});window.aja().url(r).type("jsonp").on("success",function(t){g("[MobileFingerPrint] get() response: ",t);var n="";if(t.content.inappInfo){var r=JSON.parse(t.content.inappInfo);r.extData&&(r.extData.ponyUrl&&(n=r.extData.ponyUrl),r.extData.return_url&&window.localStorage.setItem("appUrl",r.extData.return_url),r.extData.session_mfp&&ee.track({page:"hybrid_initialize",action:"MFP_get",session_mfp:r.extData.session_mfp})),e.setSession(n)}else g("[MobileFingerPrint] get(): Empty session")}).on("error",function(e){w("[MobileFingerPrint] get() error: ",e)}).go()},{check:e.check}}(),K=function(){"use strict";function e(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function t(e,t){return e<<t|e>>>32-t}function n(n,r,i,o,a,s){return e(t(e(e(r,n),e(o,s)),a),i)}function r(e,t,r,i,o,a,s){return n(t&r|~t&i,e,t,o,a,s)}function i(e,t,r,i,o,a,s){return n(t&i|r&~i,e,t,o,a,s)}function o(e,t,r,i,o,a,s){return n(t^r^i,e,t,o,a,s)}function a(e,t,r,i,o,a,s){return n(r^(t|~i),e,t,o,a,s)}function s(t,n){t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;var s,c,l,u,d,f=1732584193,p=-271733879,m=-1732584194,g=271733878;for(s=0;s<t.length;s+=16)c=f,l=p,u=m,d=g,f=r(f,p,m,g,t[s],7,-680876936),g=r(g,f,p,m,t[s+1],12,-389564586),m=r(m,g,f,p,t[s+2],17,606105819),p=r(p,m,g,f,t[s+3],22,-1044525330),f=r(f,p,m,g,t[s+4],7,-176418897),g=r(g,f,p,m,t[s+5],12,1200080426),m=r(m,g,f,p,t[s+6],17,-1473231341),p=r(p,m,g,f,t[s+7],22,-45705983),f=r(f,p,m,g,t[s+8],7,1770035416),g=r(g,f,p,m,t[s+9],12,-1958414417),m=r(m,g,f,p,t[s+10],17,-42063),p=r(p,m,g,f,t[s+11],22,-1990404162),f=r(f,p,m,g,t[s+12],7,1804603682),g=r(g,f,p,m,t[s+13],12,-40341101),m=r(m,g,f,p,t[s+14],17,-1502002290),p=r(p,m,g,f,t[s+15],22,1236535329),f=i(f,p,m,g,t[s+1],5,-165796510),g=i(g,f,p,m,t[s+6],9,-1069501632),m=i(m,g,f,p,t[s+11],14,643717713),p=i(p,m,g,f,t[s],20,-373897302),f=i(f,p,m,g,t[s+5],5,-701558691),g=i(g,f,p,m,t[s+10],9,38016083),m=i(m,g,f,p,t[s+15],14,-660478335),p=i(p,m,g,f,t[s+4],20,-405537848),f=i(f,p,m,g,t[s+9],5,568446438),g=i(g,f,p,m,t[s+14],9,-1019803690),m=i(m,g,f,p,t[s+3],14,-187363961),p=i(p,m,g,f,t[s+8],20,1163531501),f=i(f,p,m,g,t[s+13],5,-1444681467),g=i(g,f,p,m,t[s+2],9,-51403784),m=i(m,g,f,p,t[s+7],14,1735328473),p=i(p,m,g,f,t[s+12],20,-1926607734),f=o(f,p,m,g,t[s+5],4,-378558),g=o(g,f,p,m,t[s+8],11,-2022574463),m=o(m,g,f,p,t[s+11],16,1839030562),p=o(p,m,g,f,t[s+14],23,-35309556),f=o(f,p,m,g,t[s+1],4,-1530992060),g=o(g,f,p,m,t[s+4],11,1272893353),m=o(m,g,f,p,t[s+7],16,-155497632),p=o(p,m,g,f,t[s+10],23,-1094730640),f=o(f,p,m,g,t[s+13],4,681279174),g=o(g,f,p,m,t[s],11,-358537222),m=o(m,g,f,p,t[s+3],16,-722521979),p=o(p,m,g,f,t[s+6],23,76029189),f=o(f,p,m,g,t[s+9],4,-640364487),g=o(g,f,p,m,t[s+12],11,-421815835),m=o(m,g,f,p,t[s+15],16,530742520),p=o(p,m,g,f,t[s+2],23,-995338651),f=a(f,p,m,g,t[s],6,-198630844),g=a(g,f,p,m,t[s+7],10,1126891415),m=a(m,g,f,p,t[s+14],15,-1416354905),p=a(p,m,g,f,t[s+5],21,-57434055),f=a(f,p,m,g,t[s+12],6,1700485571),g=a(g,f,p,m,t[s+3],10,-1894986606),m=a(m,g,f,p,t[s+10],15,-1051523),p=a(p,m,g,f,t[s+1],21,-2054922799),f=a(f,p,m,g,t[s+8],6,1873313359),g=a(g,f,p,m,t[s+15],10,-30611744),m=a(m,g,f,p,t[s+6],15,-1560198380),p=a(p,m,g,f,t[s+13],21,1309151649),f=a(f,p,m,g,t[s+4],6,-145523070),g=a(g,f,p,m,t[s+11],10,-1120210379),m=a(m,g,f,p,t[s+2],15,718787259),p=a(p,m,g,f,t[s+9],21,-343485551),f=e(f,c),p=e(p,l),m=e(m,u),g=e(g,d);return[f,p,m,g]}function c(e){var t,n="";for(t=0;t<32*e.length;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;for(t=0;t<8*e.length;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function u(e){return c(s(l(e),8*e.length))}function d(e,t){var n,r,i=l(e),o=[],a=[];for(o[15]=a[15]=void 0,i.length>16&&(i=s(i,8*e.length)),n=0;16>n;n+=1)o[n]=909522486^i[n],a[n]=1549556828^i[n];return r=s(o.concat(l(t)),512+8*t.length),c(s(a.concat(r),640))}function f(e){var t,n,r="0123456789abcdef",i="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),i+=r.charAt(t>>>4&15)+r.charAt(15&t);return i}function p(e){return unescape(encodeURIComponent(e))}function m(e){return u(p(e))}function g(e){return f(m(e))}function w(e,t){return d(p(e),p(t))}function h(e,t){return f(w(e,t))}function v(e,t,n){return t?n?w(t,e):h(t,e):n?m(e):g(e)}return v}(),q=function(e){if("undefined"==typeof window.SpinnerDialog)return w("startLoading(): SpinnerDialog cordova plugin missing!");"object"!=typeof e&&(e={});var t=null;return e.hasOwnProperty("message")&&(t=e.message),window.SpinnerDialog.show(null,t),!0},H=function(){return"undefined"==typeof window.SpinnerDialog?w("startLoading(): SpinnerDialog cordova plugin missing!"):(window.SpinnerDialog.hide(),!0)};window.startLoading=q,window.stopLoading=H;var X={id:"",alias:"",type:"",verbosity:"",paymethod:"",subscribeMethod:"stargate",returnUrl:"",callbackSuccess:function(){g("[IAP] Undefined callbackSuccess")},callbackError:function(){g("[IAP] Undefined callbackError")},callbackListingSuccess:function(){g("[IAP] Undefined callbackListingSuccess")},callbackListingError:function(){
g("[IAP] Undefined callbackListingError")},requestedListingProductId:"",refreshDone:!1,lastCreateuserUrl:"",lastCreateuserData:"",createUserAttempt:0,maxCreateUserAttempt:6,productsInfo:{},initialize:function(e){return window.store?(X.returnUrl=document.location.href,e.id?X.id=e.id:y()?X.id=e.id_android:S()&&(X.id=e.id_ios),X.id?(e.alias&&(X.alias=e.alias),e.type&&(X.type=e.type),X.verbosity="INFO",X.paymethod=y()?"gwallet":"itunes",g("IAP initialize id: "+X.id),y()&&X.getGoogleAccount(),window.store.verbosity=window.store[X.verbosity],window.store.register({id:X.id,alias:X.alias,type:window.store[X.type]}),window.store.when(X.alias).approved(function(e){X.onPurchaseApproved(e)}),window.store.when(X.alias).verified(function(e){X.onPurchaseVerified(e)}),window.store.when(X.alias).updated(function(e){X.onProductUpdate(e)}),window.store.when(X.alias).owned(function(e){X.onProductOwned(e)}),window.store.when(X.alias).cancelled(function(e){X.onCancelledProduct(e)}),window.store.when(X.alias).error(function(e){X.error(JSON.stringify(e))}),window.store.ready(function(){X.onStoreReady()}),window.store.when("order "+X.id).approved(function(e){X.onOrderApproved(e)}),window.store.when("product").updated(function(e){X.saveProductInfo(e)}),!0):(w("[IAP] Configuration error, missing product id!"),!1)):(w("[IAP] Store not available, missing cordova plugin."),!1)},saveProductInfo:function(e){return"object"!=typeof e?void w("[IAP] saveProductInfo() got invalid data"):"id"in e?(X.productsInfo[e.id]=e,void(X.requestedListingProductId===e.id&&X.callbackListingSuccess(e))):void w("[IAP] saveProductInfo() got invalid data, id undefined")},doRefresh:function(e){(!X.refreshDone||e)&&(window.store.refresh(),X.refreshDone=!0)},getPassword:function(e){return K("iap."+e+".playme").substr(0,8)},getGoogleAccount:function(){window.accountmanager.getAccounts(X.checkGoogleAccount,X.error,"com.google")},checkGoogleAccount:function(e){if(e){g("[IAP] accounts"),g(e);for(var t in e)return window.localStorage.setItem("googleAccount",e[t].email),e[t].email}},onProductUpdate:function(e){g("IAP> Product updated."),g(JSON.stringify(e)),g(e.owned?"[IAP] Subscribed!":"[IAP] Not Subscribed")},onPurchaseApproved:function(e){g("IAP> Purchase approved."),g(JSON.stringify(e)),e.finish()},onPurchaseVerified:function(e){g("subscription verified ",e)},onStoreReady:function(){g("\\o/ STORE READY \\o/")},onProductOwned:function(e){if(g("[IAP] > Product Owned."),!e.transaction.id&&S())return g("[IAP] > no transaction id"),!1;if(window.localStorage.setItem("product",e),S()&&window.localStorage.setItem("transaction_id",e.transaction.id),y()){var t=e.transaction.purchaseToken+"|"+N.id+"|"+X.id;g("[IAP] Purchase Token: "+t),window.localStorage.getItem("user_account")||X.createUser(e,t)}else window.storekit.loadReceipts(function(t){window.localStorage.getItem("user_account")||(t.appStoreReceipt?(g("[IAP] appStoreReceipt: "+t.appStoreReceipt),X.createUser(e,t.appStoreReceipt)):g("[IAP] appStoreReceipt empty, ignoring request"))})},onCancelledProduct:function(e){G(!1),X.callbackError({iap_cancelled:1,return_url:X.returnUrl}),g("[IAP] > Purchase cancelled ##################################",e)},onOrderApproved:function(e){g("[IAP] ORDER APPROVED "+X.id),e.finish()},error:function(e){G(!1),X.callbackError({iap_error:1,return_url:X.returnUrl}),w("[IAP] error: "+e)},createUser:function(e,t){g("[IAP] createUser start "),window.localStorage.setItem("user_account",y()?window.localStorage.getItem("googleAccount")?window.localStorage.getItem("googleAccount"):t+"@google.com":e.transaction.id+"@itunes.com");var n=X.subscribeMethod,r={paymethod:X.paymethod,user_account:window.localStorage.getItem("user_account"),purchase_token:t,return_url:X.returnUrl,inapp_pwd:X.getPassword(t),hybrid:1};X.lastCreateuserUrl=n,X.lastCreateuserData=r;var i=function(e){if(X.createUserAttempt<=X.maxCreateUserAttempt)w("[IAP] createUser failed "+X.createUserAttempt+" times, trying again... last error: "+JSON.stringify(e)),s();else{g("[IAP] createUser onCreateError: removing user_account"),window.localStorage.removeItem("user_account");var t={iap_error:"1",return_url:X.returnUrl};G(!1),X.callbackError(t)}},o=function(e){g("[IAP] createUser success ",e);try{e.device_id=v.uuid,window.localStorage.getItem("transaction_id")&&(e.transaction_id=window.localStorage.getItem("transaction_id")),G(!1),X.callbackSuccess(e)}catch(t){i(t)}},a=10,s=function(){setTimeout(function(){X.createUserAttempt=X.createUserAttempt+1,g("[IAP] createUser attempt: "+X.createUserAttempt+" with timeout: "+a+"sec."),window.aja().method("POST").url(X.lastCreateuserUrl).cache(!1).timeout(1e3*a).data(X.lastCreateuserData).on("success",function(e){o(e)}).on("error",function(e){i(e)}).on("4**",function(e){i(e)}).on("5**",function(e){i(e)}).on("timeout",function(){i("timeout")}).on("end",function(){g("[IAP] createUser end"),G(!1)}).go(),a+=5},10)};X.createUserAttempt=0,s()}};o.inAppPurchaseSubscription=function(e,t,n,r){return D?R?(G(!0),"undefined"!=typeof r&&(X.returnUrl=r),"undefined"!=typeof n&&(X.subscribeMethod=n),X.callbackSuccess=e,X.callbackError=t,X.doRefresh(),void window.store.order(X.id)):t("Stargate closed, wait for Stargate.initialize to complete!"):t("Stargate not initialized, call Stargate.initialize first!")},o.inAppRestore=function(e,t,n,r){return D?R?("undefined"!=typeof n&&(X.subscribeMethod=n),"undefined"!=typeof r&&(X.returnUrl=r),X.callbackSuccess=e,X.callbackError=t,void X.doRefresh(!0)):t("Stargate closed, wait for Stargate.initialize to complete!"):t("Stargate not initialized, call Stargate.initialize first!")},o.inAppProductInfo=function(e,t,n){return D?R?(e||(e=X.id),X.productsInfo[e]?void t(X.productsInfo[e]):(X.requestedListingProductId=e,X.callbackListingSuccess=t,X.callbackListingError=n,void X.doRefresh(!0))):n("Stargate closed, wait for Stargate.initialize to complete!"):n("Stargate not initialized, call Stargate.initialize first!")},o.facebookLogin=function(e,t,n){return D?void facebookConnectPlugin.login(e.split(","),function(e){g("[facebook] got userdata: ",e),facebookConnectPlugin.getAccessToken(function(e){t({accessToken:e})},function(e){n({error:e})})},function(e){w("Got FB login error:",e),n({error:e})}):n("Stargate not initialized, call Stargate.initialize first!")},o.facebookShare=function(e,t,n){if(!D)return n("Stargate not initialized, call Stargate.initialize first!");var r={method:"share",href:e};facebookConnectPlugin.showDialog(r,function(e){t({message:e})},function(e){w("Got FB share error:",e),n({error:e})})};var Y=function(){deltadna.registerPushCallback($)},Z=function(e){w("[DeltaDNA] error: "+e)},$=function(e){return y()&&e.payload&&e.payload.url&&!e.foreground?I(e.payload.url):S()&&e.url?I(e.url):void 0},Q=function(){var e,t={},n={};return t.init=function(){if(!window.plugins||!window.plugins.appsFlyer)return w("[appsflyer] missing cordova plugin");if("undefined"==typeof N.appstore_appid)return w("[appsflyer] missing manifest configuration: appstore_appid");if("undefined"==typeof N.appsflyer_devkey)return w("[appsflyer] missing manifest configuration: appsflyer_devkey");var t=[N.appsflyer_devkey];S()&&t.push(N.appstore_appid),document.addEventListener("onInstallConversionDataLoaded",function(t){if(n=t.detail,"function"!=typeof e)return g("[appsflyer] callback not set!");try{e(n),g("[appsflyer] parameters sent to webapp callback: "+JSON.stringify(n))}catch(r){w("[appsflyer] callback error: "+r,r)}},!1),window.plugins.appsFlyer.initSdk(t)},t.setCallback=function(t){e=t},t}();o.setConversionDataCallback=function(e){Q.setCallback(e)};var ee=function(){var e,t={};return t.track=function(t){if("function"!=typeof e)return g("[analytics] callback not set!");try{e(t)}catch(n){w("[analytics] callback error: "+n,n)}},t.setCallback=function(t){e=t},t}();o.setAnalyticsCallback=function(e){ee.setCallback(e)};return o.game=a.game._public,o.file=a.file,o});