/*!
 * StargateJS Apps
 * v0.3.0
 * Copyright 2015 DMobileLab. http://buongiorno.com/
 * See LICENSE in this repository for license information
 */
!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof module&&module.exports?module.exports=n():e.Stargate=n()}(this,function(){function e(e){p.type=e.type,p.networkState=navigator.connection.type,"function"==typeof f&&f(p)}function n(){p.networkState=navigator.connection.type,"none"===navigator.connection.type?p.type="offline":p.type="online"}function t(e){"android"==window.device.platform.toLowerCase()?window.navigator.app.loadUrl(e):window.location.href=e}function i(){return window.cordova.file?s.file.readFileAsJSON(window.cordova.file.applicationDirectory+"www/manifest.json"):window.hostedwebapp?new Promise(function(e,n){window.hostedwebapp.getManifest(function(n){e(n)},function(e){h(e),n(new Error(e))})}):Promise.reject(new Error("getManifest() no available reading mechanism!"))}function r(){this.initialize=function(e,n,t){h("unimplemented"),t("unimplemented")},this.createBanner=function(e,n,t){h("unimplemented"),t("unimplemented")},this.hideBanner=function(e,n,t){h("unimplemented"),t("unimplemented")},this.removeBanner=function(e,n,t){h("unimplemented"),t("unimplemented")},this.showBannerAtSelectedPosition=function(e,n,t){h("unimplemented"),t("unimplemented")},this.showBannerAtGivenXY=function(e,n,t){h("unimplemented"),t("unimplemented")},this.registerAdEvents=function(e,n,t){h("unimplemented"),t("unimplemented")},this.prepareInterstitial=function(e,n,t){h("unimplemented"),t("unimplemented")},this.showInterstitial=function(e,n,t){h("unimplemented"),t("unimplemented")}}var o="0.3.0",a={},s={};!function(e){function n(e,t,i){this.level=n.levels[e.toUpperCase()],this.styles=i||{background:"white",color:"black"},this.tag="%c "+t+" ",this.styleString="background:"+this.styles.background+";color:"+this.styles.color+";",Object.defineProperties(this,{__d:{value:window.console.log.bind(window.console,this.tag,this.styleString),writable:!1,enumerable:!1,configurable:!1},__i:{value:window.console.info.bind(window.console,this.tag,this.styleString),writable:!1,enumerable:!1,configurable:!1},__e:{value:window.console.error.bind(window.console,this.tag,this.styleString),writable:!1,enumerable:!1,configurable:!1},__w:{value:window.console.warn.bind(window.console,this.tag,this.styleString),writable:!1,enumerable:!1,configurable:!1}})}function t(e){var n=0;return{next:function(t){return t&&(n=0),n<e.length?{value:e[n++],done:!1}:{done:!0}}}}function i(e,n){e+="?";var t="";for(var i in n)t+=encodeURIComponent(i)+"="+encodeURIComponent(n[i])+"&";return t.length>0&&(t=t.substring(0,t.length-1)),e+t}function r(e){e=encodeURI(e);var n=new window.XMLHttpRequest,t=new Promise(function(e,t){n.onreadystatechange=function(){4==n.readyState&&n.status<400?e(n.response):t(n.status)}});return n.open("GET",e,!0),n.setRequestHeader("Content-type","application/json; charset=UTF-8"),n.send(),t}function o(e){var n=this;if(n.timeout=3e3,n.called=!1,window.document){var t=Date.now();n.scriptTag=window.document.createElement("script"),e+="&callback=window.__jsonpHandler_"+t,n.scriptTag.src=e,n.scriptTag.type="text/javascript",n.scriptTag.async=!0,n.prom=new Promise(function(e,i){var r="__jsonpHandler_"+t;window[r]=function(t){n.called=!0,e(t),n.scriptTag.parentElement.removeChild(n.scriptTag),delete window[r]},setTimeout(function(){n.called||(i("Timeout jsonp request "+t),n.scriptTag.parentElement.removeChild(n.scriptTag),delete window[r])},n.timeout)}),window.document.getElementsByTagName("head")[0].appendChild(n.scriptTag)}}function a(e,n){var t=n||function(){};return new Promise(function(n,i){function r(){var t;switch(e.responseType){case"blob":t=new Blob([this.response],{type:e.mimeType||"image/jpeg"});break;case"arraybuffer":t=this.response;break;default:t=this.response,n(t)}}var o=new XMLHttpRequest;o.open("GET",e.url,!0),o.responseType=e.responseType||"blob",o.withCredentials=!0;var a=i,s=i;o.addEventListener("progress",t,!1),o.addEventListener("load",r,!1),o.addEventListener("error",s,!1),o.addEventListener("abort",a,!1),o.send(null)})}n.levels={ALL:5,ERROR:4,WARN:3,INFO:2,DEBUG:1,OFF:0},n.prototype.e=function(){0!==this.level&&this.level>=n.levels.ERROR&&this.__e(arguments)},n.prototype.i=function(){0!==this.level&&this.level>=n.levels.WARN&&this.__i(arguments)},n.prototype.w=function(){0!==this.level&&this.level>=n.levels.INFO&&this.__w(arguments)},n.prototype.d=function(){0!==this.level&&this.level>=n.levels.DEBUG&&this.__d(arguments)},n.prototype.setLevel=function(e){this.level=n.levels[e]};var s={Iterator:t,Logger:n,composeApiString:i,getJSON:r,jsonpRequest:o,getImageRaw:a};e?e.Utils=s:window.Utils=s}(s),function(e,n){function t(e){var n=e.map(function(e){return{fullPath:e.fullPath,path:e.toURL(),internalURL:e.toInternalURL(),isFile:e.isFile,isDirectory:e.isDirectory}});return 1==n.length?n[0]:n}var i,r={};r.LOG=i=new n.Logger("ALL","[File - module]"),window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,r.ERROR_MAP={1:"NOT_FOUND_ERR",2:"SECURITY_ERR",3:"ABORT_ERR",4:"NOT_READABLE_ERR",5:"ENCODING_ERR",6:"NO_MODIFICATION_ALLOWED_ERR",7:"INVALID_STATE_ERR",8:"SYNTAX_ERR",9:"INVALID_MODIFICATION_ERR",10:"QUOTA_EXCEEDED_ERR",11:"TYPE_MISMATCH_ERR",12:"PATH_EXISTS_ERR"},r.currentFileTransfer=null,r.resolveFS=function(e){return new Promise(function(n,t){window.resolveLocalFileSystemURL(e,n,t)})},r.appendToFile=function(e,n,i,o){return i=void 0===arguments[2]?!1:arguments[2],o=void 0===arguments[3]?"text/plain":arguments[3],r.resolveFS(e).then(function(e){return new Promise(function(r,a){e.createWriter(function(s){i||s.seek(s.length);var c;c=n instanceof Blob?n:new Blob([n],{type:o}),s.write(c),s.onerror=a,s.onabort=a,s.onwriteend=function(){r(t([e]))}},a)})})},r.readFileAsHTML=function(e){return r.readFile(e).then(function(e){return(new window.DOMParser).parseFromString(e,"text/html")})},r.readFileAsJSON=function(e){return r.readFile(e).then(function(e){try{return Promise.resolve(window.JSON.parse(e))}catch(n){return Promise.reject(n)}})},r.removeFile=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(n,t){e.remove(function(e){n(null===e||"OK"===e)},t)})})},r.removeDir=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(n,t){e.removeRecursively(function(e){n(null===e||"OK"===e)},t)})})},r._promiseZip=function(e,n,t){return i.d("PROMISEZIP:",arguments),new Promise(function(i,r){window.zip.unzip(e,n,function(e){0===e?i(!0):r(e)},t)})},r.download=function(e,n,i,o){var a=this;this.ft=new window.FileTransfer,this.ft.onprogress=o,r.currentFileTransfer=a.ft,a.promise=new Promise(function(r,o){a.ft.download(window.encodeURI(e),n+i,function(e){r(t([e])),a.ft=null},function(e){o(e),a.ft=null},!0)})},r.createDir=function(e,n){return r.resolveFS(e).then(function(e){return new Promise(function(i,r){e.getDirectory(n,{create:!0},function(e){i(t([e]))},r)})})},r.fileExists=function(e){return new Promise(function(n){window.resolveLocalFileSystemURL(e,function(e){n(e.isFile)},function(e){n(1!==e.code)})})},r.dirExists=function(e){return new Promise(function(n){window.resolveLocalFileSystemURL(e,function(e){n(e.isDirectory)},function(e){n(1!=e.code)})})},r.requestFileSystem=function(e,n){return new Promise(function(t,i){window.requestFileSystem(e,n,t,i)})},r.readDir=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(n,r){var o=e.createReader();o.readEntries(function(e){i.d("readDir:",e),n(t(e))},r)})})},r.readFile=function(e){return r.resolveFS(e).then(function(e){return new Promise(function(n,t){e.file(function(e){var i=new FileReader;i.onerror=t,i.onabort=t,i.onloadend=function(){var e=this.result;n(e)},i.readAsText(e)})})})},r.createFile=function(e,n){return r.resolveFS(e).then(function(e){return new Promise(function(i,r){e.getFile(n,{create:!0},function(e){i(t([e]))},r)})})},r.write=function(e,n){return r.appendToFile(e,n,!0)},r.moveDir=function(e,n){var t=n.substring(n.lastIndexOf("/")+1),o=n.replace(t,"");return i.d("moveDir:",o,t),Promise.all([r.resolveFS(e),r.resolveFS(o)]).then(function(e){return i.d("moveDir: resolved entries",e),new Promise(function(n,i){e[0].moveTo(e[1],t,n,i)})})},r.copyFile=function(e,n){var t=n.substring(n.lastIndexOf("/")+1),o=n.replace(t,"");return Promise.all([r.resolveFS(e),r.resolveFS(o)]).then(function(e){return i.d("copyFileTo",e),new Promise(function(n,i){e[0].copyTo(e[1],t,n,i)})})},r.copyDir=function(e,n){var t=n.substring(n.lastIndexOf("/")+1),o=n.replace(t,"");return Promise.all([r.resolveFS(e),r.resolveFS(o)]).then(function(r){return i.d("copyDir",e,"in",n),new Promise(function(e,n){r[0].copyTo(r[1],t,e,n)})})},e?e.file=r:window.file=r}(s,s.Utils),function(e,n,t){"use strict";function i(){}function r(n){function i(){var n=e.createDir(I.BASE_DIR,"games"),t=e.createDir(I.BASE_DIR,"scripts"),i=e.createFile(I.BASE_DIR,"offlineData.json").then(function(n){return j.d("offlineData",n),e.write(n.path,JSON.stringify(x))});return Promise.all([n,t,i]).then(function(n){return j.d("GamesDir, ScriptsDir, offlineData.json created",n),j.d("Getting SDK from:",D),Promise.all([new e.download(D,n[1].path,"gfsdk.min.js").promise,new e.download(R,n[1].path,"dixie.js").promise,e.copyDir(I.WWW_DIR+"gameover_template",I.BASE_DIR+"gameover_template"),e.copyDir(I.WWW_DIR+"plugins",I.SDK_DIR+"plugins"),e.copyFile(I.CORDOVAJS,I.SDK_DIR+"cordova.js"),e.copyFile(I.CORDOVA_PLUGINS_JS,I.SDK_DIR+"cordova_plugins.js"),e.copyFile(I.STARGATEJS,I.SDK_DIR+"stargate.js"),e.copyFile(I.WWW_DIR+"js/gamesFixes.js",I.SDK_DIR+"gamesFixes.js")])})}if(j.d("Initialized called with:",n),O=n,!e)return Promise.reject("Missing file module!");try{m=window.cordova.file.applicationStorageDirectory,g=window.cordova.file.cacheDirectory,w=window.cordova.file.tempDirectory,h=window.cordova.file.applicationDirectory+"www/",y=window.cordova.file.applicationDirectory+"www/js/stargate.js",v=window.cordova.file.dataDirectory}catch(r){return j.e(r),Promise.reject(r)}"ios"==window.device.platform.toLowerCase()&&(m+="Documents/"),"android"==window.device.platform.toLowerCase()&&(w=g),I.SDK_DIR=m+"scripts/",I.SDK_RELATIVE_DIR="../../scripts/",I.GAMEOVER_RELATIVE_DIR="../../gameover_template/",I.GAMES_DIR=m+"games/",I.BASE_DIR=m,I.CACHE_DIR=g,I.TEMP_DIR=w,I.CORDOVAJS=h+"cordova.js",I.CORDOVA_PLUGINS_JS=h+"cordova_plugins.js",I.STARGATEJS=h+"js/stargate.js",I.DATA_DIR=v,I.GAMEOVER_DIR=I.BASE_DIR+"gameover_template/",I.WWW_DIR=h,j.i("cordova JS dir to include",I.CORDOVAJS),t.game._public.BASE_DIR=I.BASE_DIR,t.game._public.OFFLINE_INDEX=I.WWW_DIR+"index.html";var o=e.dirExists(I.GAMES_DIR),a=e.fileExists(I.SDK_DIR+"gfsdk.min.js"),s=e.fileExists(I.SDK_DIR+"dixie.js");return Promise.all([o,a,s]).then(function(e){return e[0]||e[1]||e[2]?Promise.resolve("AlreadyInitialized"):i()})}function o(n){return j.d("_getIndexHtmlById",I.GAMES_DIR+n),e.readDir(I.GAMES_DIR+n).then(function(e){return j.d("_getIndexHtmlById readDir",e),e.filter(function(e){var n=new RegExp(/index\.html$/i);return n.test(e.path)})})}function a(e){j.d("_removeRemoteSDK");for(var n,t=e.querySelectorAll("script"),i=0;i<t.length;i++)if(-1!==t[i].src.indexOf("gfsdk")){n=t[i],j.d("_removeRemoteSDK",n),n.parentNode.removeChild(n);break}return e}function s(e,n){e=a(e);var t,i=Array.isArray(n)===!1?[n]:n;j.d("injectScripts",i);var r=document.createElement("meta");r.httpEquiv="Content-Security-Policy",r.content="default-src * data: content: cdvfile: file: http: https: gap: https://ssl.gstatic.com 'unsafe-inline' 'unsafe-eval';style-src * cdvfile: http: https: 'unsafe-inline';",e.head.appendChild(r);for(var o=0;o<i.length;o++)if(i[o].endsWith(".css")){j.d("css inject:",i[o]);var s=e.createElement("link");s.rel="stylesheet",s.href=i[o],e.head.appendChild(s)}else t=document.createElement("script"),t.src=i[o],e.head.appendChild(t);return j.d("Cleaned dom:",e),e}function c(e){var n=[];n.push(e.querySelector("link[href='/gmenu/frame.css']")),n.push(e.querySelector("iframe#menu")),n.push(e.querySelector("script[src='/gmenu/toggle.js']"));for(var t=e.querySelectorAll("script"),i=t.length-1;i>=0;i--)if(-1!==t[i].innerHTML.indexOf("function open")){n.push(t[i]);break}for(var r=0;r<n.length;r++)n[r]&&n[r].parentNode.removeChild(n[r]);return e}function l(n,t){var i;return o(n).then(function(n){return i=n[0].path,e.readFileAsHTML(n[0].path)}).then(function(e){return j.d("_injectScripts"),j.d(e),s(e,t)}).then(c).then(function(e){j.d("Serialize dom");var n=(new XMLSerializer).serializeToString(e),t='<html xmlns="http://www.w3.org/1999/xhtml"';return n=n.replace(t,"<html").replace(RegExp(/[^\x20-\x7E\xA0-\xFF]/g),"")}).then(function(n){return n=n.trim(),j.d("Write dom:",i,n),e.write(i,n)})}function u(e){var n=new RegExp(/index\.html$/i);return n.test(e)}function d(t){var i=t.url.replace("[WSIZE]",t.size.width).replace("[HSIZE]",t.size.height).split("?")[0],r=I.GAMES_DIR+t.gameId,o=t.type+"_"+t.size.width+"x"+t.size.height+("_"+t.size.ratio||"")+".jpeg";return j.d("request Image to",i,"coverImageUrl",o,"imagesFolder",r),"xhr"===t.method?Promise.all([e.createFile(r,o),n.getImageRaw({url:i})]).then(function(n){var t=n[0],i=n[1];return e.appendToFile(t.path,i,!0,"image/jpeg")}):new e.download(i,r,o,function(){}).promise}function f(e){var n=S(P,F),t=new b(n).prom;t.then(function(e){return j.d("apiGaForGames:",n,"ga_for_game:",e),e}).then(function(n){j.d("ga_for_game:",n);var t=S(E,{content_id:e,_PONY:n._PONYVALUE,format:"jsonp"});return j.d("gamifive_info_api",t),[new b(t).prom,n]}).then(function(n){return n[0].then(function(t){return j.d("gamifiveInfo:",t,"ga_for_game",n[1]),p({content_id:e,ga_for_game:n[1],gamifive_info:t.game_info})})})}function p(n){return e.readFileAsJSON(I.BASE_DIR+"offlineData.json").then(function(e){return e.GaForGame[n.content_id]=n.ga_for_game,e.GamifiveInfo[n.content_id]=n.gamifive_info,e}).then(function(n){return j.d("writing offlineData.json",n),e.write(I.BASE_DIR+"offlineData.json",JSON.stringify(n))})}var m,g,w,h,v,y,_=n.Logger,S=n.composeApiString,b=n.jsonpRequest,I={},D="http://s2.motime.com/js/wl/webstore_html5game/gfsdk/dist/gfsdk.js?timestamp="+Date.now(),R="http://s2.motime.com/tbr/dixie.js?country=it-igames&timestamp="+Date.now(),A="http://resources2.buongiorno.com/lapis/apps/contents.getList",P="http://www2.gameasy.com/ww-it/ga_for_games.js",E="http://www2.gameasy.com/ww-it/v01/gameplay_proxy",O={},k=!1,x={GaForGame:{},GamifiveInfo:{},queues:{}},F={print_json_response:1},T={content_id:"",formats:"html5applications",sort:"-born_date",category:"b940b384ff0565b06dde433e05dc3c93",publisher:"",size:6,offset:0,label:"",label_slug:"",access_type:"",real_customer_id:"xx_gameasy",lang:"en",use_cs_id:"",white_label:"xx_gameasy",main_domain:"http://www2.gameasy.com/ww",fw:"gameasy",vh:"ww.gameasy.com",check_compatibility_header:0},j=new _("ALL","[Game - module]",{background:"black",color:"#5aa73a"});i.prototype.download=function(n,t){function i(e){return function(n){var t=Math.round(n.loaded/n.total*100);s({percentage:t,type:e})}}function r(){c({type:"download"}),j.d("Start Download:",n.id,n.response_api_dld.binary_url),f(m);var t=new e.download(n.response_api_dld.binary_url,I.TEMP_DIR,m+".zip",i("download")).promise;return t.then(function(t){return c({type:"unzip"}),j.d("unzip:",n.id,I.TEMP_DIR+m),e._promiseZip(t.path,I.TEMP_DIR+m,i("unzip"))}).then(function(t){j.d("Unzip ended",t),p({type:"unzip"});var i=n.response_api_dld.url_download,r=i.substring(i.lastIndexOf("game"),i.length).split("/"),o="";return j.d("Get the right index folder of the game",r),r.length>2&&u(r[r.length-1])?(o=I.TEMP_DIR+[m,r[r.length-2]].join("/"),j.d("More than one level folders before index.html",r,o)):(o=I.TEMP_DIR+m,j.d("One level folder before index.html",r,o)),j.d("Copy game folder in games/",o,I.GAMES_DIR+m),e.moveDir(o,I.GAMES_DIR+m)}).then(function(n){return j.d("Remove zip from:",I.TEMP_DIR+m+".zip","last operation result",n),e.removeFile(I.TEMP_DIR+m+".zip")}).then(function(){j.d("Save meta.json for:",n.id);var e={gameId:n.id,size:{width:"240",height:"170",ratio:"1_4"},url:n.images.cover.ratio_1_4,type:"cover",method:"xhr"};return d(e)}).then(function(t){return j.d("Save meta.json for:",n.id),j.d("Download image result",t),n.images.cover.ratio_1_4=t.internalURL,e.createFile(I.GAMES_DIR+m,"meta.json").then(function(t){return e.write(t.path,JSON.stringify(n))})}).then(function(e){return j.d("result last operation:save meta.json",e),j.d("InjectScripts in game:",n.id,h),l(n.id,[I.SDK_RELATIVE_DIR+"gamesFixes.js",I.GAMEOVER_RELATIVE_DIR+"gameover.css",I.SDK_RELATIVE_DIR+"cordova.js",I.SDK_RELATIVE_DIR+"cordova_plugins.js",I.SDK_RELATIVE_DIR+"dixie.js",I.SDK_RELATIVE_DIR+"stargate.js",I.SDK_RELATIVE_DIR+"gfsdk.min.js"])}).then(function(e){return j.d("injectScripts result",e),p({type:"download"}),k=!1,n.id})["catch"](function(e){throw j.e(e,"Cleaning...game not downloaded",n.id),k=!1,a.remove(n.id),p({type:"error",description:e}),e})}if(this.isDownloading())return Promise.reject("Downloading...try later");if(200!==n.response_api_dld.status)return t.onEnd("response_api_dld.status not equal 200"),Promise.reject("response_api_dld.status not equal 200");var o=this.isGameDownloaded(n.id),a=this;t=t?t:{};var s=t.onProgress?t.onProgress:function(){},c=t.onStart?t.onStart:function(){},p=t.onEnd?t.onEnd:function(){},m=n.id;return o.then(function(e){return j.d("Exists",e),e?(k=!1,Promise.reject({12:"AlreadyExists",gameID:n.id})):(k=!0,r())})},i.prototype.play=function(n){j.d("Play",n);var t=I.GAMES_DIR+n;return e.readDir(t).then(function(e){return e.filter(function(e){var n=new RegExp(/index\.html$/i);return n.test(e.path)})}).then(function(e){j.d(e);var n=e[0].internalURL+"?hybrid=1";"ios"==window.device.platform.toLowerCase()?(j.d("Play ios",n),window.location.href=n):(j.d("Play android",n),window.navigator.app.loadUrl(encodeURI(n)))})},i.prototype.remove=function(n){j.d("Removing game",n);var t=e.dirExists(I.CACHE_DIR+n+".zip"),i=e.dirExists(I.GAMES_DIR+n);return Promise.all([t,i]).then(function(t){var i=[];return t[0]&&(j.d("Removed in cache",t[0]),i.push(e.removeFile(I.CACHE_DIR+n+".zip"))),t[1]&&(j.d("Removed",t[1]),i.push(e.removeDir(I.GAMES_DIR+n))),0===i.length&&j.i("Nothing to remove",i),i})},i.prototype.isDownloading=function(){return k},i.prototype.abortDownload=function(){return this.isDownloading()?(j.d("Abort last download"),e.currentFileTransfer&&(e.currentFileTransfer.abort(),e.currentFileTransfer=null),!0):(j.w("There's not a download operation to abort"),!1)},i.prototype.list=function(){return j.d("Get games list"),e.readDir(I.GAMES_DIR).then(function(e){var n=Array.isArray(e)?e:[e];return n.filter(function(e){return e.isDirectory?e:void 0})}).then(function(n){var t=n.map(function(n){return e.readFileAsJSON(n.path+"meta.json")});return Promise.all(t).then(function(e){return e})})},i.prototype.buildGameOver=function(n){var t=I.GAMES_DIR+n.content_id+"/meta.json";return n.hasOwnProperty("content_id")?(j.d("Read meta.json:",t),j.d("GAMEOVER_TEMPLATE path",I.GAMEOVER_DIR+"gameover.html"),Promise.all([e.readFileAsJSON(t),e.readFile(I.GAMEOVER_DIR+"gameover.html")]).then(function(e){var t=e[1],i=e[0];return j.i("Meta JSON:",i),t.replace("{{score}}",n.score).replace("{{url_share}}",i.url_share).replace("{{url_cover}}",i.images.cover.ratio_1_4).replace("{{startpage_url}}",I.WWW_DIR+"index.html")})):Promise.reject("Missing content_id key!")},i.prototype.isGameDownloaded=function(n){return e.dirExists(I.GAMES_DIR+n)},i.prototype.removeAll=function(){return e.removeDir(I.GAMES_DIR).then(function(n){return j.d("All games deleted!",n),e.createDir(I.BASE_DIR,"games")})},i.prototype.getBundleGameObjects=function(){var e=this;if(O&&O.bundle_games){j.d("Games bundle in configuration",O.bundle_games);var n,t=O.bundle_games.map(function(n){return e.isGameDownloaded(n)}),i=Promise.all(t).then(function(e){j.d("alreadyDownloaded",e);for(var n=0;n<e.length;n++)e[n]&&O.bundle_games.splice(n,1);return O.bundle_games}).then(function(e){return e.join(",")});return i.then(function(e){T.content_id=e;var n=S(A,T);return j.d("Request bundle games meta info:",n),new b(n).prom}).then(function(e){j.d("Games bundle response:",e),n=e;var t=e.map(function(e){return new b(e.url_api_dld).prom});return j.d("jsonpRequests",t),Promise.all(t)}).then(function(e){j.d("RESULTS",e);for(var t=0;t<e.length;t++)n[t].response_api_dld=e[t];return j.d("GameObjects",n),n})["catch"](function(e){j.e("Games bundle meta fail:",e)})}},document.addEventListener("online",function(n){j.d("Connection status detected, check assets:SDK,DIXIE",n),Promise.all([e.fileExists(I.SDK_DIR+"dixie.js"),e.fileExists(I.SDK_DIR+"gfsdk.min.js")]).then(function(n){var t=n[0],i=n[1],r=[];return i||(j.d("get SDK"),r.push(new e.download(D,I.SDK_DIR,"gfsdk.min.js").promise)),t||(j.d("get dixie"),r.push(new e.download(D,I.SDK_DIR,"dixie.js").promise)),Promise.all(r)})},!1);var U={};t.game={},U.initialize=r,t.game._protected=U,t.game._public=new i}(s.file,s.Utils,s);var c=function(){var e={},n=!1;e.init=function(){if(B.hasOwnProperty("webappsfixes")&&"object"==typeof B.webappsfixes){n=!0;for(var e in B.webappsfixes)if(B.webappsfixes.hasOwnProperty(e))if(t.hasOwnProperty(e)&&"function"==typeof t[e]){w("[webappsFixes] applying fix: "+e);var i=t[e](B.webappsfixes[e]);i&&h("[webappsFixes] fix '"+e+"' failed: "+i)}else h("[webappsFixes] fix implementation not found for: "+e)}return n};var t={};return t.gamifiveSearchBox=function(e){if(!window.cordova||!window.cordova.plugins||!window.cordova.plugins.Keyboard)return"missing ionic-plugin-keyboard";if(e.platforms){if(S()&&!e.platforms.ios)return void w("[webappsFixes] [gamifiveSearchBox] fix disabled on iOS");if(_()&&!e.platforms.android)return void w("[webappsFixes] [gamifiveSearchBox] fix disabled on Android")}return window.addEventListener("native.keyboardshow",function(){setTimeout(function(){0===document.querySelectorAll("input:focus").length&&(w("[webappsFixes] [gamifiveSearchBox] keyboard show on null input: hiding"),cordova.plugins.Keyboard.close())},1)},!1),w("[webappsFixes] [gamifiveSearchBox] listening on event native.keyboardshow"),""},e}();window.pubKey="",window.forge="";var l;a.initializeOffline=function(e){return l?l:("object"!=typeof e&&(e={}),e.hasOwnProperty("hideSplashScreen")||(e.hideSplashScreen=!0),R=!0,l=new Promise(function(t){document.addEventListener("deviceready",function(){T(),b(),n(),Promise.all([cordova.getAppVersion.getVersionNumber(),i()]).then(function(n){E=n[0],"object"!=typeof n[1]&&(n[1]=JSON.parse(n[1])),m=n[1].start_url,B=n[1].stargateConf,e.hideSplashScreen&&(navigator.splashscreen.hide(),N(!1)),A=!0,w("Stargate.initializeOffline() done"),t(!0)})["catch"](function(e){h("initializeOffline() error: "+e)})})}))},a.conf={},a.conf.getWebappStartUrl=function(){if(!R)return h("Stargate not initialized, call Stargate.initialize first!");if(!A)return h("Stargate closed, wait for Stargate.initialize to complete!");var e=URI(B.webapp_start_url).addSearch("hybrid","1").addSearch("stargateVersion",u());return e};var u=function(){return B.stargate_version_to_load?B.stargate_version_to_load:(v("getStargateVersionToLoad() stargate_version_to_load must be set on manifest!"),g)};a.conf.getWebappOrigin=function(){var e=/http:\/\/[\w]{3,4}\..*\.[\w]{2,}/;return"undefined"==typeof B.webapp_start_url?(w("Stargate is initialized? Please call this method after it"),""):e.exec(B.webapp_start_url)[0]};var d;a.initialize=function(e,n,t,i){return"function"==typeof n&&"undefined"==typeof t&&"undefined"==typeof i&&(i=n),"undefined"==typeof i&&(w("Callback success not setted. \n You can use 'then'"),i=function(){}),"function"!=typeof i?(v("Stargate.initialize() callback is not a function!"),Promise.reject(new Error("Stargate.initialize() callback is not a function!"))):(D=M(),R?(v("Stargate.initialize() already called, executing callback."),i&&i(D),d):("object"!=typeof e&&(e={}),e.hybrid_conf&&(O="object"==typeof e.hybrid_conf?e.hybrid_conf:JSON.parse(decodeURIComponent(e.hybrid_conf))),e.modules?e.modules.constructor!==Array?h("initialize() configurations.modules is not an array"):k=e.modules:k=["mfp","iapbase","appsflyer","game"],e.modules_conf&&("object"!=typeof e.modules_conf?h("initialize() configurations.modules_conf is not an object"):x=e.modules_conf),e.country&&("mfp"in O?O.mfp.country=e.country:O.mfp={country:e.country}),D?(w("initialize() starting up, configuration: ",O),P=i,d=new Promise(function(e,n){document.addEventListener("deviceready",function(){z(e,n)},!1)}),R=!0,d):(w("version "+o+" running outside hybrid; loaded from server version: v"+u()),i&&i(D),d=Promise.resolve(D),R=!0,d)))},a.isInitialized=function(){return R},a.isOpen=function(){return A},a.isHybrid=function(){return M()},a.openUrl=function(e){return R?void window.open(e,"_system"):h("Stargate not initialized, call Stargate.initialize first!")},a.googleLogin=function(e,n){return R?(h("unimplemented"),void n("unimplemented")):n("Stargate not initialized, call Stargate.initialize first!")};var f,p={type:"unknown",networkState:"unknown"};a.addListener=function(e,n){"connectionchange"==e&&"function"==typeof n&&(w("onConnectionChange registered"),f=n)},document.addEventListener("online",e,!1),document.addEventListener("offline",e,!1),a.checkConnection=function(){var e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0],n=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];return R?A?"undefined"==typeof navigator.connection||"function"!=typeof navigator.connection.getInfo?(n("Missing cordova plugin"),console.warn("Cordova Network Information module missing"),!1):(e(p),p):(n("Stargate closed, wait for Stargate.initialize to complete!"),!1):(n("Stargate not initialized, call Stargate.initialize first!"),!1)},a.getDeviceID=function(e,n){if(!R)return n("Stargate not initialized, call Stargate.initialize first!");if(!A)return n("Stargate closed, wait for Stargate.initialize to complete!"),!1;var t=y.uuid;e({deviceID:t})},a.goToLocalIndex=function(){if("undefined"!==window.cordova.file.applicationDirectory){var e=window.cordova.file.applicationDirectory+"www/index.html?hybrid=1";w("Redirect to",e),t(e)}},a.goToWebIndex=function(){var e=a.conf.getWebappStartUrl()+"";w("Redirect to",e),t(e)},a.setStatusbarVisibility=function(e,n,t){return R?A?"undefined"==typeof window.StatusBar?(h("[StatusBar] missing cordova plugin"),t("missing cordova plugin")):e?(window.StatusBar.show(),n("statusbar shown")):(window.StatusBar.hide(),n("statusbar hided")):(t("Stargate closed, wait for Stargate.initialize to complete!"),!1):t("Stargate not initialized, call Stargate.initialize first!")},a.getVersion=function(){return o},a.ad=new r;var m,g="2",w=console.log.bind(window.console,"[Stargate] "),h=console.error.bind(window.console,"[Stargate] "),v=console.warn.bind(window.console,"[Stargate] "),y={available:!1,cordova:"",manufacturer:"",model:"",platform:"",uuid:"",version:""},_=function(){return"Android"==y.platform},S=function(){return"iOS"==y.platform},b=function(){if("undefined"==typeof window.device)return h("Missing cordova device plugin");for(var e in y)window.device.hasOwnProperty(e)&&(y[e]=window.device[e]);return!0},I=function(e){w("launchUrl: "+e),document.location.href=e},D=!1,R=!1,A=!1,P=null,E="",O={},k=[],x={},F=function(){if("undefined"==typeof window.StatusBar)return h("[StatusBar] missing cordova plugin");if("undefined"!=typeof B.statusbar&&"undefined"!=typeof B.statusbar.hideOnUrlPattern&&B.statusbar.hideOnUrlPattern.constructor===Array){for(var e=document.location.href,n=!1,t=0;t<B.statusbar.hideOnUrlPattern.length;t++){var i=new RegExp(B.statusbar.hideOnUrlPattern[t]);if(i.test(e)){n=!0;break}}n?window.StatusBar.hide():window.StatusBar.show()}},T=function(){window.Cookies.set("hybrid","1"),window.localStorage.getItem("hybrid")||window.localStorage.setItem("hybrid",1)},j=function(){window.Cookies.set("stargateVersion",u()),window.localStorage.getItem("stargateVersion")||window.localStorage.setItem("stargateVersion",u())},U=function(){navigator.splashscreen.hide(),N(!1),"undefined"!=typeof SpinnerDialog&&SpinnerDialog.hide()},C=function(e){if(document.title=B.title,S()&&"undefined"!=typeof window.cordova&&cordova.require){var n=cordova.require("cordova/exec");n.setJsToNativeBridgeMode(n.jsToNativeModes.IFRAME_NAV)}if(j(),F(),q("mfp")&&K("mfp")){var t=V("mfp"),i=["motime_apikey","namespace","label"];i.forEach(function(e){!t.hasOwnProperty(e)&&B.hasOwnProperty(e)&&(t[e]=B[e])}),J.check(t)}q("deltadna")&&window.deltadna.startSDK(B.deltadna.environmentKey,B.deltadna.collectApi,B.deltadna.engageApi,Z,$,B.deltadna.settings),K("iapbase")?Y.initialize(V("iapbase")):K("iap")&&Y.initialize(V("iap"))&&w("Init IAP done."),q("appsflyer")&&K("appsflyer")&&ee.init(V("appsflyer")),c.init();var r=[];K("game")&&q("game")&&s.game&&r.push(s.game._protected.initialize(V("game"))),Promise.all(r).then(function(){L(e)})["catch"](function(n){h("onPluginReady() error: ",n),L(e)})},L=function(e){U(),A=!0,w("version "+o+" ready;  running in package version: "+E),P(!0),w("Stargate.initialize() done"),e(!0)},z=function(e,t){T(),b(),n(),Promise.all([cordova.getAppVersion.getVersionNumber(),i()]).then(function(n){E=n[0],"object"!=typeof n[1]&&(n[1]=JSON.parse(n[1])),m=n[1].start_url,B=n[1].stargateConf,C(e,t)})["catch"](function(e){h("onDeviceReady() error: "+e),t("onDeviceReady() error: "+e)})},M=function(){var e=window.URI(document.location.href);return e.hasQuery("hybrid")?!0:window.Cookies.get("hybrid")?!0:window.localStorage.getItem("hybrid")?!0:!1},G=!1,N=function(e){e?(G=!0,H()):(G=!1,X())},B={features:{}},V=function(e){if(!e)return h("getModuleConf() invalid module requested");if(e in x)return x[e];var n={iapbase:"IAP",iap:"IAP"},t=e;return n[e]&&(t=n[e]),t in O?O[t]:(w("getModuleConf(): no configuration for module: "+e+" ("+n+")"),{})},q=function(e){return"undefined"!=typeof B.features[e]&&B.features[e]},K=function(e){return k&&k.constructor===Array?k.indexOf(e)>-1:!1},J=function(){var e={};return e.check=function(n){var t=["motime_apikey","namespace","label","country"];t.forEach(function(e){return n.hasOwnProperty(e)?n[e]?void 0:h("[MFP] Configuration: '"+e+"' not valid!"):h("[MFP] Configuration '"+e+"' not defined!")}),e.get(n)},e.getContents=function(e,n,t,i){var r={};r.api_country=t,r.country=e,r.fpnamespace=n,i&&(r.extData=i);var o=JSON.stringify(r);return o},e.getPonyValue=function(e){try{return e.split("=")[1]}catch(n){h(n)}return""},e.setSession=function(n){var t=m;window.localStorage.getItem("appUrl")&&(t=window.localStorage.getItem("appUrl"));var i=new URI(m),r=i.hostname(),o=URITemplate(B.api.mfpSetUriTemplate).expand({protocol:i.protocol(),hostname:r,url:t,domain:r,_PONY:e.getPonyValue(n)});w("[MobileFingerPrint] going to url: ",o),I(o)},e.get=function(n){var t="",i=URITemplate(B.api.mfpGetUriTemplate).expand({apikey:n.motime_apikey,contents_inapp:e.getContents(n.country,n.namespace,n.label),country:n.country,expire:t});window.aja().url(i).type("jsonp").on("success",function(n){w("[MobileFingerPrint] get() response: ",n);var t="";if(n.content.inappInfo){var i=JSON.parse(n.content.inappInfo);i.extData&&(i.extData.ponyUrl&&(t=i.extData.ponyUrl),i.extData.return_url&&window.localStorage.setItem("appUrl",i.extData.return_url),i.extData.session_mfp&&ne.track({page:"hybrid_initialize",action:"MFP_get",session_mfp:i.extData.session_mfp})),e.setSession(t)}else w("[MobileFingerPrint] get(): Empty session")}).on("error",function(e){h("[MobileFingerPrint] get() error: ",e)}).go()},{check:e.check}}(),W=function(){"use strict";function e(e,n){var t=(65535&e)+(65535&n),i=(e>>16)+(n>>16)+(t>>16);return i<<16|65535&t}function n(e,n){return e<<n|e>>>32-n}function t(t,i,r,o,a,s){return e(n(e(e(i,t),e(o,s)),a),r)}function i(e,n,i,r,o,a,s){return t(n&i|~n&r,e,n,o,a,s)}function r(e,n,i,r,o,a,s){return t(n&r|i&~r,e,n,o,a,s)}function o(e,n,i,r,o,a,s){return t(n^i^r,e,n,o,a,s)}function a(e,n,i,r,o,a,s){return t(i^(n|~r),e,n,o,a,s)}function s(n,t){n[t>>5]|=128<<t%32,n[(t+64>>>9<<4)+14]=t;var s,c,l,u,d,f=1732584193,p=-271733879,m=-1732584194,g=271733878;
for(s=0;s<n.length;s+=16)c=f,l=p,u=m,d=g,f=i(f,p,m,g,n[s],7,-680876936),g=i(g,f,p,m,n[s+1],12,-389564586),m=i(m,g,f,p,n[s+2],17,606105819),p=i(p,m,g,f,n[s+3],22,-1044525330),f=i(f,p,m,g,n[s+4],7,-176418897),g=i(g,f,p,m,n[s+5],12,1200080426),m=i(m,g,f,p,n[s+6],17,-1473231341),p=i(p,m,g,f,n[s+7],22,-45705983),f=i(f,p,m,g,n[s+8],7,1770035416),g=i(g,f,p,m,n[s+9],12,-1958414417),m=i(m,g,f,p,n[s+10],17,-42063),p=i(p,m,g,f,n[s+11],22,-1990404162),f=i(f,p,m,g,n[s+12],7,1804603682),g=i(g,f,p,m,n[s+13],12,-40341101),m=i(m,g,f,p,n[s+14],17,-1502002290),p=i(p,m,g,f,n[s+15],22,1236535329),f=r(f,p,m,g,n[s+1],5,-165796510),g=r(g,f,p,m,n[s+6],9,-1069501632),m=r(m,g,f,p,n[s+11],14,643717713),p=r(p,m,g,f,n[s],20,-373897302),f=r(f,p,m,g,n[s+5],5,-701558691),g=r(g,f,p,m,n[s+10],9,38016083),m=r(m,g,f,p,n[s+15],14,-660478335),p=r(p,m,g,f,n[s+4],20,-405537848),f=r(f,p,m,g,n[s+9],5,568446438),g=r(g,f,p,m,n[s+14],9,-1019803690),m=r(m,g,f,p,n[s+3],14,-187363961),p=r(p,m,g,f,n[s+8],20,1163531501),f=r(f,p,m,g,n[s+13],5,-1444681467),g=r(g,f,p,m,n[s+2],9,-51403784),m=r(m,g,f,p,n[s+7],14,1735328473),p=r(p,m,g,f,n[s+12],20,-1926607734),f=o(f,p,m,g,n[s+5],4,-378558),g=o(g,f,p,m,n[s+8],11,-2022574463),m=o(m,g,f,p,n[s+11],16,1839030562),p=o(p,m,g,f,n[s+14],23,-35309556),f=o(f,p,m,g,n[s+1],4,-1530992060),g=o(g,f,p,m,n[s+4],11,1272893353),m=o(m,g,f,p,n[s+7],16,-155497632),p=o(p,m,g,f,n[s+10],23,-1094730640),f=o(f,p,m,g,n[s+13],4,681279174),g=o(g,f,p,m,n[s],11,-358537222),m=o(m,g,f,p,n[s+3],16,-722521979),p=o(p,m,g,f,n[s+6],23,76029189),f=o(f,p,m,g,n[s+9],4,-640364487),g=o(g,f,p,m,n[s+12],11,-421815835),m=o(m,g,f,p,n[s+15],16,530742520),p=o(p,m,g,f,n[s+2],23,-995338651),f=a(f,p,m,g,n[s],6,-198630844),g=a(g,f,p,m,n[s+7],10,1126891415),m=a(m,g,f,p,n[s+14],15,-1416354905),p=a(p,m,g,f,n[s+5],21,-57434055),f=a(f,p,m,g,n[s+12],6,1700485571),g=a(g,f,p,m,n[s+3],10,-1894986606),m=a(m,g,f,p,n[s+10],15,-1051523),p=a(p,m,g,f,n[s+1],21,-2054922799),f=a(f,p,m,g,n[s+8],6,1873313359),g=a(g,f,p,m,n[s+15],10,-30611744),m=a(m,g,f,p,n[s+6],15,-1560198380),p=a(p,m,g,f,n[s+13],21,1309151649),f=a(f,p,m,g,n[s+4],6,-145523070),g=a(g,f,p,m,n[s+11],10,-1120210379),m=a(m,g,f,p,n[s+2],15,718787259),p=a(p,m,g,f,n[s+9],21,-343485551),f=e(f,c),p=e(p,l),m=e(m,u),g=e(g,d);return[f,p,m,g]}function c(e){var n,t="";for(n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function l(e){var n,t=[];for(t[(e.length>>2)-1]=void 0,n=0;n<t.length;n+=1)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function u(e){return c(s(l(e),8*e.length))}function d(e,n){var t,i,r=l(e),o=[],a=[];for(o[15]=a[15]=void 0,r.length>16&&(r=s(r,8*e.length)),t=0;16>t;t+=1)o[t]=909522486^r[t],a[t]=1549556828^r[t];return i=s(o.concat(l(n)),512+8*n.length),c(s(a.concat(i),640))}function f(e){var n,t,i="0123456789abcdef",r="";for(t=0;t<e.length;t+=1)n=e.charCodeAt(t),r+=i.charAt(n>>>4&15)+i.charAt(15&n);return r}function p(e){return unescape(encodeURIComponent(e))}function m(e){return u(p(e))}function g(e){return f(m(e))}function w(e,n){return d(p(e),p(n))}function h(e,n){return f(w(e,n))}function v(e,n,t){return n?t?w(n,e):h(n,e):t?m(e):g(e)}return v}(),H=function(e){if("undefined"==typeof window.SpinnerDialog)return h("startLoading(): SpinnerDialog cordova plugin missing!");"object"!=typeof e&&(e={});var n=null;return e.hasOwnProperty("message")&&(n=e.message),window.SpinnerDialog.show(null,n),!0},X=function(){return"undefined"==typeof window.SpinnerDialog?h("startLoading(): SpinnerDialog cordova plugin missing!"):(window.SpinnerDialog.hide(),!0)};window.startLoading=H,window.stopLoading=X;var Y={id:"",alias:"",type:"",verbosity:"",paymethod:"",subscribeMethod:"stargate",returnUrl:"",callbackSuccess:function(){w("[IAP] Undefined callbackSuccess")},callbackError:function(){w("[IAP] Undefined callbackError")},callbackListingSuccess:function(){w("[IAP] Undefined callbackListingSuccess")},callbackListingError:function(){w("[IAP] Undefined callbackListingError")},requestedListingProductId:"",refreshDone:!1,lastCreateuserUrl:"",lastCreateuserData:"",createUserAttempt:0,maxCreateUserAttempt:6,refreshInProgress:!1,productsInfo:{},initialize:function(e){return window.store?(Y.returnUrl=document.location.href,e.id?Y.id=e.id:_()?Y.id=e.id_android:S()&&(Y.id=e.id_ios),Y.id?(e.alias&&(Y.alias=e.alias),e.type&&(Y.type=e.type),Y.verbosity="INFO",Y.paymethod=_()?"gwallet":"itunes",w("IAP initialize id: "+Y.id),_()&&Y.getGoogleAccount(),window.store.verbosity=window.store[Y.verbosity],window.store.register({id:Y.id,alias:Y.alias,type:window.store[Y.type]}),window.store.when(Y.alias).approved(function(e){Y.onPurchaseApproved(e)}),window.store.when(Y.alias).verified(function(e){Y.onPurchaseVerified(e)}),window.store.when(Y.alias).updated(function(e){Y.onProductUpdate(e)}),window.store.when(Y.alias).owned(function(e){Y.onProductOwned(e)}),window.store.when(Y.alias).cancelled(function(e){Y.onCancelledProduct(e)}),window.store.when(Y.alias).error(function(e){Y.error(JSON.stringify(e))}),window.store.ready(function(){Y.onStoreReady()}),window.store.when("order "+Y.id).approved(function(e){Y.onOrderApproved(e)}),window.store.when("product").updated(function(e){Y.saveProductInfo(e)}),!0):(h("[IAP] Configuration error, missing product id!"),!1)):(h("[IAP] Store not available, missing cordova plugin."),!1)},saveProductInfo:function(e){return Y.refreshInProgress=!1,"object"!=typeof e?void h("[IAP] saveProductInfo() got invalid data"):"id"in e?(Y.productsInfo[e.id]=e,void(Y.requestedListingProductId===e.id&&Y.callbackListingSuccess(e))):void h("[IAP] saveProductInfo() got invalid data, id undefined")},doRefresh:function(e){Y.refreshInProgress&&v("[IAP] doRefresh() refresh in progress, skipping..."),(!Y.refreshDone||e)&&(window.store.refresh(),Y.refreshDone=!0,Y.refreshInProgress=!0,w("[IAP] doRefresh() refreshing..."))},getPassword:function(e){return W("iap."+e+".playme").substr(0,8)},getGoogleAccount:function(){window.accountmanager.getAccounts(Y.checkGoogleAccount,Y.error,"com.google")},checkGoogleAccount:function(e){if(e){w("[IAP] accounts"),w(e);for(var n in e)return window.localStorage.setItem("googleAccount",e[n].email),e[n].email}},onProductUpdate:function(e){w("IAP> Product updated."),w(JSON.stringify(e)),w(e.owned?"[IAP] Subscribed!":"[IAP] Not Subscribed")},onPurchaseApproved:function(e){w("IAP> Purchase approved."),w(JSON.stringify(e)),e.finish()},onPurchaseVerified:function(e){w("subscription verified ",e)},onStoreReady:function(){w("\\o/ STORE READY \\o/")},onProductOwned:function(e){if(w("[IAP] > Product Owned."),!e.transaction.id&&S())return w("[IAP] > no transaction id"),!1;if(window.localStorage.setItem("product",e),S()&&window.localStorage.setItem("transaction_id",e.transaction.id),_()){var n=e.transaction.purchaseToken+"|"+B.id+"|"+Y.id;w("[IAP] Purchase Token: "+n),window.localStorage.getItem("user_account")||Y.createUser(e,n)}else window.storekit.loadReceipts(function(n){window.localStorage.getItem("user_account")||(n.appStoreReceipt?(w("[IAP] appStoreReceipt: "+n.appStoreReceipt),Y.createUser(e,n.appStoreReceipt)):w("[IAP] appStoreReceipt empty, ignoring request"))})},onCancelledProduct:function(e){N(!1),Y.callbackError({iap_cancelled:1,return_url:Y.returnUrl}),w("[IAP] > Purchase cancelled ##################################",e)},onOrderApproved:function(e){w("[IAP] ORDER APPROVED "+Y.id),e.finish()},error:function(e){N(!1),Y.callbackError({iap_error:1,return_url:Y.returnUrl}),h("[IAP] error: "+e)},createUser:function(e,n){w("[IAP] createUser start "),window.localStorage.setItem("user_account",_()?window.localStorage.getItem("googleAccount")?window.localStorage.getItem("googleAccount"):n+"@google.com":e.transaction.id+"@itunes.com");var t=Y.subscribeMethod,i={paymethod:Y.paymethod,user_account:window.localStorage.getItem("user_account"),purchase_token:n,return_url:Y.returnUrl,inapp_pwd:Y.getPassword(n),hybrid:1};Y.lastCreateuserUrl=t,Y.lastCreateuserData=i;var r=function(e){if(Y.createUserAttempt<=Y.maxCreateUserAttempt)h("[IAP] createUser failed "+Y.createUserAttempt+" times, trying again... last error: "+JSON.stringify(e)),s();else{w("[IAP] createUser onCreateError: removing user_account"),window.localStorage.removeItem("user_account");var n={iap_error:"1",return_url:Y.returnUrl};N(!1),Y.callbackError(n)}},o=function(e){w("[IAP] createUser success ",e);try{e.device_id=y.uuid,window.localStorage.getItem("transaction_id")&&(e.transaction_id=window.localStorage.getItem("transaction_id")),N(!1),Y.callbackSuccess(e)}catch(n){r(n)}},a=10,s=function(){setTimeout(function(){Y.createUserAttempt=Y.createUserAttempt+1,w("[IAP] createUser attempt: "+Y.createUserAttempt+" with timeout: "+a+"sec."),window.aja().method("POST").url(Y.lastCreateuserUrl).cache(!1).timeout(1e3*a).data(Y.lastCreateuserData).on("success",function(e){o(e)}).on("error",function(e){r(e)}).on("4**",function(e){r(e)}).on("5**",function(e){r(e)}).on("timeout",function(){r("timeout")}).on("end",function(){w("[IAP] createUser end"),N(!1)}).go(),a+=5},10)};Y.createUserAttempt=0,s()}};a.inAppPurchaseSubscription=function(e,n,t,i){return R?A?(N(!0),"undefined"!=typeof i&&(Y.returnUrl=i),"undefined"!=typeof t&&(Y.subscribeMethod=t),Y.callbackSuccess=e,Y.callbackError=n,Y.doRefresh(),void window.store.order(Y.id)):n("Stargate closed, wait for Stargate.initialize to complete!"):n("Stargate not initialized, call Stargate.initialize first!")},a.inAppRestore=function(e,n,t,i){return R?A?("undefined"!=typeof t&&(Y.subscribeMethod=t),"undefined"!=typeof i&&(Y.returnUrl=i),Y.callbackSuccess=e,Y.callbackError=n,void Y.doRefresh(!0)):n("Stargate closed, wait for Stargate.initialize to complete!"):n("Stargate not initialized, call Stargate.initialize first!")},a.inAppProductInfo=function(e,n,t){return R?A?(e||(e=Y.id),Y.productsInfo[e]?void n(Y.productsInfo[e]):(Y.requestedListingProductId=e,Y.callbackListingSuccess=n,Y.callbackListingError=t,void Y.doRefresh(!0))):t("Stargate closed, wait for Stargate.initialize to complete!"):t("Stargate not initialized, call Stargate.initialize first!")},a.facebookLogin=function(e,n,t){return R?void facebookConnectPlugin.login(e.split(","),function(e){w("[facebook] got userdata: ",e),facebookConnectPlugin.getAccessToken(function(e){n({accessToken:e})},function(e){t({error:e})})},function(e){h("Got FB login error:",e),t({error:e})}):t("Stargate not initialized, call Stargate.initialize first!")},a.facebookShare=function(e,n,t){if(!R)return t("Stargate not initialized, call Stargate.initialize first!");var i={method:"share",href:e};facebookConnectPlugin.showDialog(i,function(e){n({message:e})},function(e){h("Got FB share error:",e),t({error:e})})};var Z=function(){deltadna.registerPushCallback(Q)},$=function(e){h("[DeltaDNA] error: "+e)},Q=function(e){return _()&&e.payload&&e.payload.url&&!e.foreground?I(e.payload.url):S()&&e.url?I(e.url):void 0},ee=function(){var e,n={},t={};return n.init=function(){if(!window.plugins||!window.plugins.appsFlyer)return h("[appsflyer] missing cordova plugin");if("undefined"==typeof B.appstore_appid)return h("[appsflyer] missing manifest configuration: appstore_appid");if("undefined"==typeof B.appsflyer_devkey)return h("[appsflyer] missing manifest configuration: appsflyer_devkey");var n=[B.appsflyer_devkey];S()&&n.push(B.appstore_appid),document.addEventListener("onInstallConversionDataLoaded",function(n){if(t=n.detail,"function"!=typeof e)return w("[appsflyer] callback not set!");try{e(t),w("[appsflyer] parameters sent to webapp callback: "+JSON.stringify(t))}catch(i){h("[appsflyer] callback error: "+i,i)}},!1),window.plugins.appsFlyer.initSdk(n)},n.setCallback=function(n){e=n},n}();a.setConversionDataCallback=function(e){ee.setCallback(e)};var ne=function(){var e,n={};return n.track=function(n){if("function"!=typeof e)return w("[analytics] callback not set!");try{e(n)}catch(t){h("[analytics] callback error: "+t,t)}},n.setCallback=function(n){e=n},n}();a.setAnalyticsCallback=function(e){ne.setCallback(e)};return a.game=s.game._public,a.file=s.file,a});