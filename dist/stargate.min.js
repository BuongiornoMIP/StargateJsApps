/*!
 * StargateJS Apps
 * v0.1.0
 * Copyright 2015 DMobileLab. http://buongiorno.com/
 * See LICENSE in this repository for license information
 */
!function(t,e){"use strict";"object"==typeof exports?module.exports=e(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],e):t.URI=e(t.punycode,t.IPv6,t.SecondLevelDomains,t)}(this,function(t,e,r,n){"use strict";function o(t,e){var r=arguments.length>=1,n=arguments.length>=2;if(!(this instanceof o))return r?n?new o(t,e):new o(t):new o;if(void 0===t){if(r)throw new TypeError("undefined is not a valid argument for URI");t="undefined"!=typeof location?location.href+"":""}return this.href(t),void 0!==e?this.absoluteTo(e):this}function i(t){return t.replace(/([.*+?^=!:()|[\]\/\\])/g,"\\$1")}function a(t){return void 0===t?"Undefined":String(Object.prototype.toString.call(t)).slice(8,-1)}function s(t){return"Array"===a(t)}function u(t,e){var r,n,o={};if("RegExp"===a(e))o=null;else if(s(e))for(r=0,n=e.length;n>r;r++)o[e[r]]=!0;else o[e]=!0;for(r=0,n=t.length;n>r;r++){var i=o&&void 0!==o[t[r]]||!o&&e.test(t[r]);i&&(t.splice(r,1),n--,r--)}return t}function c(t,e){var r,n;if(s(e)){for(r=0,n=e.length;n>r;r++)if(!c(t,e[r]))return!1;return!0}var o=a(e);for(r=0,n=t.length;n>r;r++)if("RegExp"===o){if("string"==typeof t[r]&&t[r].match(e))return!0}else if(t[r]===e)return!0;return!1}function p(t,e){if(!s(t)||!s(e))return!1;if(t.length!==e.length)return!1;t.sort(),e.sort();for(var r=0,n=t.length;n>r;r++)if(t[r]!==e[r])return!1;return!0}function l(t){var e=/^\/+|\/+$/g;return t.replace(e,"")}function f(t){return escape(t)}function h(t){return encodeURIComponent(t).replace(/[!'()*]/g,f).replace(/\*/g,"%2A")}function d(t){return function(e,r){return void 0===e?this._parts[t]||"":(this._parts[t]=e||null,this.build(!r),this)}}function m(t,e){return function(r,n){return void 0===r?this._parts[t]||"":(null!==r&&(r+="",r.charAt(0)===e&&(r=r.substring(1))),this._parts[t]=r,this.build(!n),this)}}var y=n&&n.URI;o.version="1.17.0";var g=o.prototype,v=Object.prototype.hasOwnProperty;o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\.-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/},o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(t){if(t&&t.nodeName){var e=t.nodeName.toLowerCase();if("input"!==e||"image"===t.type)return o.domAttributes[e]}},o.encode=h,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=h,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(t,e){var r=o.encode(t+"");return void 0===e&&(e=o.escapeQuerySpace),e?r.replace(/%20/g,"+"):r},o.decodeQuery=function(t,e){t+="",void 0===e&&(e=o.escapeQuerySpace);try{return o.decode(e?t.replace(/\+/g,"%20"):t)}catch(r){return t}};var _,w={encode:"encode",decode:"decode"},b=function(t,e){return function(r){try{return o[e](r+"").replace(o.characters[t][e].expression,function(r){return o.characters[t][e].map[r]})}catch(n){return r}}};for(_ in w)o[_+"PathSegment"]=b("pathname",w[_]),o[_+"UrnPathSegment"]=b("urnpath",w[_]);var A=function(t,e,r){return function(n){var i;i=r?function(t){return o[e](o[r](t))}:o[e];for(var a=(n+"").split(t),s=0,u=a.length;u>s;s++)a[s]=i(a[s]);return a.join(t)}};o.decodePath=A("/","decodePathSegment"),o.decodeUrnPath=A(":","decodeUrnPathSegment"),o.recodePath=A("/","encodePathSegment","decode"),o.recodeUrnPath=A(":","encodeUrnPathSegment","decode"),o.encodeReserved=b("reserved","encode"),o.parse=function(t,e){var r;return e||(e={}),r=t.indexOf("#"),r>-1&&(e.fragment=t.substring(r+1)||null,t=t.substring(0,r)),r=t.indexOf("?"),r>-1&&(e.query=t.substring(r+1)||null,t=t.substring(0,r)),"//"===t.substring(0,2)?(e.protocol=null,t=t.substring(2),t=o.parseAuthority(t,e)):(r=t.indexOf(":"),r>-1&&(e.protocol=t.substring(0,r)||null,e.protocol&&!e.protocol.match(o.protocol_expression)?e.protocol=void 0:"//"===t.substring(r+1,r+3)?(t=t.substring(r+3),t=o.parseAuthority(t,e)):(t=t.substring(r+1),e.urn=!0))),e.path=t,e},o.parseHost=function(t,e){t=t.replace(/\\/g,"/");var r,n,o=t.indexOf("/");if(-1===o&&(o=t.length),"["===t.charAt(0))r=t.indexOf("]"),e.hostname=t.substring(1,r)||null,e.port=t.substring(r+2,o)||null,"/"===e.port&&(e.port=null);else{var i=t.indexOf(":"),a=t.indexOf("/"),s=t.indexOf(":",i+1);-1!==s&&(-1===a||a>s)?(e.hostname=t.substring(0,o)||null,e.port=null):(n=t.substring(0,o).split(":"),e.hostname=n[0]||null,e.port=n[1]||null)}return e.hostname&&"/"!==t.substring(o).charAt(0)&&(o++,t="/"+t),t.substring(o)||"/"},o.parseAuthority=function(t,e){return t=o.parseUserinfo(t,e),o.parseHost(t,e)},o.parseUserinfo=function(t,e){var r,n=t.indexOf("/"),i=t.lastIndexOf("@",n>-1?n:t.length-1);return i>-1&&(-1===n||n>i)?(r=t.substring(0,i).split(":"),e.username=r[0]?o.decode(r[0]):null,r.shift(),e.password=r[0]?o.decode(r.join(":")):null,t=t.substring(i+1)):(e.username=null,e.password=null),t},o.parseQuery=function(t,e){if(!t)return{};if(t=t.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!t)return{};for(var r,n,i,a={},s=t.split("&"),u=s.length,c=0;u>c;c++)r=s[c].split("="),n=o.decodeQuery(r.shift(),e),i=r.length?o.decodeQuery(r.join("="),e):null,v.call(a,n)?(("string"==typeof a[n]||null===a[n])&&(a[n]=[a[n]]),a[n].push(i)):a[n]=i;return a},o.build=function(t){var e="";return t.protocol&&(e+=t.protocol+":"),t.urn||!e&&!t.hostname||(e+="//"),e+=o.buildAuthority(t)||"","string"==typeof t.path&&("/"!==t.path.charAt(0)&&"string"==typeof t.hostname&&(e+="/"),e+=t.path),"string"==typeof t.query&&t.query&&(e+="?"+t.query),"string"==typeof t.fragment&&t.fragment&&(e+="#"+t.fragment),e},o.buildHost=function(t){var e="";return t.hostname?(e+=o.ip6_expression.test(t.hostname)?"["+t.hostname+"]":t.hostname,t.port&&(e+=":"+t.port),e):""},o.buildAuthority=function(t){return o.buildUserinfo(t)+o.buildHost(t)},o.buildUserinfo=function(t){var e="";return t.username&&(e+=o.encode(t.username),t.password&&(e+=":"+o.encode(t.password)),e+="@"),e},o.buildQuery=function(t,e,r){var n,i,a,u,c="";for(i in t)if(v.call(t,i)&&i)if(s(t[i]))for(n={},a=0,u=t[i].length;u>a;a++)void 0!==t[i][a]&&void 0===n[t[i][a]+""]&&(c+="&"+o.buildQueryParameter(i,t[i][a],r),e!==!0&&(n[t[i][a]+""]=!0));else void 0!==t[i]&&(c+="&"+o.buildQueryParameter(i,t[i],r));return c.substring(1)},o.buildQueryParameter=function(t,e,r){return o.encodeQuery(t,r)+(null!==e?"="+o.encodeQuery(e,r):"")},o.addQuery=function(t,e,r){if("object"==typeof e)for(var n in e)v.call(e,n)&&o.addQuery(t,n,e[n]);else{if("string"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===t[e])return void(t[e]=r);"string"==typeof t[e]&&(t[e]=[t[e]]),s(r)||(r=[r]),t[e]=(t[e]||[]).concat(r)}},o.removeQuery=function(t,e,r){var n,i,c;if(s(e))for(n=0,i=e.length;i>n;n++)t[e[n]]=void 0;else if("RegExp"===a(e))for(c in t)e.test(c)&&(t[c]=void 0);else if("object"==typeof e)for(c in e)v.call(e,c)&&o.removeQuery(t,c,e[c]);else{if("string"!=typeof e)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==r?"RegExp"===a(r)?!s(t[e])&&r.test(t[e])?t[e]=void 0:t[e]=u(t[e],r):t[e]!==String(r)||s(r)&&1!==r.length?s(t[e])&&(t[e]=u(t[e],r)):t[e]=void 0:t[e]=void 0}},o.hasQuery=function(t,e,r,n){if("object"==typeof e){for(var i in e)if(v.call(e,i)&&!o.hasQuery(t,i,e[i]))return!1;return!0}if("string"!=typeof e)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(a(r)){case"Undefined":return e in t;case"Boolean":var u=Boolean(s(t[e])?t[e].length:t[e]);return r===u;case"Function":return!!r(t[e],e,t);case"Array":if(!s(t[e]))return!1;var l=n?c:p;return l(t[e],r);case"RegExp":return s(t[e])?n?c(t[e],r):!1:Boolean(t[e]&&t[e].match(r));case"Number":r=String(r);case"String":return s(t[e])?n?c(t[e],r):!1:t[e]===r;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.commonPath=function(t,e){var r,n=Math.min(t.length,e.length);for(r=0;n>r;r++)if(t.charAt(r)!==e.charAt(r)){r--;break}return 1>r?t.charAt(0)===e.charAt(0)&&"/"===t.charAt(0)?"/":"":(("/"!==t.charAt(r)||"/"!==e.charAt(r))&&(r=t.substring(0,r).lastIndexOf("/")),t.substring(0,r+1))},o.withinString=function(t,e,r){r||(r={});var n=r.start||o.findUri.start,i=r.end||o.findUri.end,a=r.trim||o.findUri.trim,s=/[a-z0-9-]=["']?$/i;for(n.lastIndex=0;;){var u=n.exec(t);if(!u)break;var c=u.index;if(r.ignoreHtml){var p=t.slice(Math.max(c-3,0),c);if(p&&s.test(p))continue}var l=c+t.slice(c).search(i),f=t.slice(c,l).replace(a,"");if(!r.ignore||!r.ignore.test(f)){l=c+f.length;var h=e(f,c,l,t);t=t.slice(0,c)+h+t.slice(l),n.lastIndex=c+h.length}}return n.lastIndex=0,t},o.ensureValidHostname=function(e){if(e.match(o.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(t.toASCII(e).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]')}},o.noConflict=function(t){if(t){var e={URI:this.noConflict()};return n.URITemplate&&"function"==typeof n.URITemplate.noConflict&&(e.URITemplate=n.URITemplate.noConflict()),n.IPv6&&"function"==typeof n.IPv6.noConflict&&(e.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&"function"==typeof n.SecondLevelDomains.noConflict&&(e.SecondLevelDomains=n.SecondLevelDomains.noConflict()),e}return n.URI===this&&(n.URI=y),this},g.build=function(t){return t===!0?this._deferred_build=!0:(void 0===t||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},g.clone=function(){return new o(this)},g.valueOf=g.toString=function(){return this.build(!1)._string},g.protocol=d("protocol"),g.username=d("username"),g.password=d("password"),g.hostname=d("hostname"),g.port=d("port"),g.query=m("query","?"),g.fragment=m("fragment","#"),g.search=function(t,e){var r=this.query(t,e);return"string"==typeof r&&r.length?"?"+r:r},g.hash=function(t,e){var r=this.fragment(t,e);return"string"==typeof r&&r.length?"#"+r:r},g.pathname=function(t,e){if(void 0===t||t===!0){var r=this._parts.path||(this._parts.hostname?"/":"");return t?(this._parts.urn?o.decodeUrnPath:o.decodePath)(r):r}return this._parts.urn?this._parts.path=t?o.recodeUrnPath(t):"":this._parts.path=t?o.recodePath(t):"/",this.build(!e),this},g.path=g.pathname,g.href=function(t,e){var r;if(void 0===t)return this.toString();this._string="",this._parts=o._parts();var n=t instanceof o,i="object"==typeof t&&(t.hostname||t.path||t.pathname);if(t.nodeName){var a=o.getDomAttribute(t);t=t[a]||"",i=!1}if(!n&&i&&void 0!==t.pathname&&(t=t.toString()),"string"==typeof t||t instanceof String)this._parts=o.parse(String(t),this._parts);else{if(!n&&!i)throw new TypeError("invalid input");var s=n?t._parts:t;for(r in s)v.call(this._parts,r)&&(this._parts[r]=s[r])}return this.build(!e),this},g.is=function(t){var e=!1,n=!1,i=!1,a=!1,s=!1,u=!1,c=!1,p=!this._parts.urn;switch(this._parts.hostname&&(p=!1,n=o.ip4_expression.test(this._parts.hostname),i=o.ip6_expression.test(this._parts.hostname),e=n||i,a=!e,s=a&&r&&r.has(this._parts.hostname),u=a&&o.idn_expression.test(this._parts.hostname),c=a&&o.punycode_expression.test(this._parts.hostname)),t.toLowerCase()){case"relative":return p;case"absolute":return!p;case"domain":case"name":return a;case"sld":return s;case"ip":return e;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return i;case"idn":return u;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return c}return null};var x=g.protocol,S=g.port,P=g.hostname;g.protocol=function(t,e){if(void 0!==t&&t&&(t=t.replace(/:(\/\/)?$/,""),!t.match(o.protocol_expression)))throw new TypeError('Protocol "'+t+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return x.call(this,t,e)},g.scheme=g.protocol,g.port=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t&&(0===t&&(t=null),t&&(t+="",":"===t.charAt(0)&&(t=t.substring(1)),t.match(/[^0-9]/))))throw new TypeError('Port "'+t+'" contains characters other than [0-9]');return S.call(this,t,e)},g.hostname=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t){var r={},n=o.parseHost(t,r);if("/"!==n)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');t=r.hostname}return P.call(this,t,e)},g.origin=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){var r=this.protocol(),n=this.authority();return n?(r?r+"://":"")+this.authority():""}var i=o(t);return this.protocol(i.protocol()).authority(i.authority()).build(!e),this},g.host=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?o.buildHost(this._parts):"";var r=o.parseHost(t,this._parts);if("/"!==r)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},g.authority=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?o.buildAuthority(this._parts):"";var r=o.parseAuthority(t,this._parts);if("/"!==r)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},g.userinfo=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.username)return"";var r=o.buildUserinfo(this._parts);return r.substring(0,r.length-1)}return"@"!==t[t.length-1]&&(t+="@"),o.parseUserinfo(t,this._parts),this.build(!e),this},g.resource=function(t,e){var r;return void 0===t?this.path()+this.search()+this.hash():(r=o.parse(t),this._parts.path=r.path,this._parts.query=r.query,this._parts.fragment=r.fragment,this.build(!e),this)},g.subdomain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,r)||""}var n=this._parts.hostname.length-this.domain().length,a=this._parts.hostname.substring(0,n),s=new RegExp("^"+i(a));return t&&"."!==t.charAt(t.length-1)&&(t+="."),t&&o.ensureValidHostname(t),this._parts.hostname=this._parts.hostname.replace(s,t),this.build(!e),this},g.domain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.match(/\./g);if(r&&r.length<2)return this._parts.hostname;var n=this._parts.hostname.length-this.tld(e).length-1;return n=this._parts.hostname.lastIndexOf(".",n-1)+1,this._parts.hostname.substring(n)||""}if(!t)throw new TypeError("cannot set domain empty");if(o.ensureValidHostname(t),!this._parts.hostname||this.is("IP"))this._parts.hostname=t;else{var a=new RegExp(i(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(a,t)}return this.build(!e),this},g.tld=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.lastIndexOf("."),o=this._parts.hostname.substring(n+1);return e!==!0&&r&&r.list[o.toLowerCase()]?r.get(this._parts.hostname)||o:o}var a;if(!t)throw new TypeError("cannot set TLD empty");if(t.match(/[^a-zA-Z0-9-]/)){if(!r||!r.is(t))throw new TypeError('TLD "'+t+'" contains characters other than [A-Z0-9]');a=new RegExp(i(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,t)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");a=new RegExp(i(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,t)}return this.build(!e),this},g.directory=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var r=this._parts.path.length-this.filename().length-1,n=this._parts.path.substring(0,r)||(this._parts.hostname?"/":"");return t?o.decodePath(n):n}var a=this._parts.path.length-this.filename().length,s=this._parts.path.substring(0,a),u=new RegExp("^"+i(s));return this.is("relative")||(t||(t="/"),"/"!==t.charAt(0)&&(t="/"+t)),t&&"/"!==t.charAt(t.length-1)&&(t+="/"),t=o.recodePath(t),this._parts.path=this._parts.path.replace(u,t),this.build(!e),this},g.filename=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path||"/"===this._parts.path)return"";var r=this._parts.path.lastIndexOf("/"),n=this._parts.path.substring(r+1);return t?o.decodePathSegment(n):n}var a=!1;"/"===t.charAt(0)&&(t=t.substring(1)),t.match(/\.?\//)&&(a=!0);var s=new RegExp(i(this.filename())+"$");return t=o.recodePath(t),this._parts.path=this._parts.path.replace(s,t),a?this.normalizePath(e):this.build(!e),this},g.suffix=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path||"/"===this._parts.path)return"";var r,n,a=this.filename(),s=a.lastIndexOf(".");return-1===s?"":(r=a.substring(s+1),n=/^[a-z0-9%]+$/i.test(r)?r:"",t?o.decodePathSegment(n):n)}"."===t.charAt(0)&&(t=t.substring(1));var u,c=this.suffix();if(c)u=t?new RegExp(i(c)+"$"):new RegExp(i("."+c)+"$");else{if(!t)return this;this._parts.path+="."+o.recodePath(t)}return u&&(t=o.recodePath(t),this._parts.path=this._parts.path.replace(u,t)),this.build(!e),this},g.segment=function(t,e,r){var n=this._parts.urn?":":"/",o=this.path(),i="/"===o.substring(0,1),a=o.split(n);if(void 0!==t&&"number"!=typeof t&&(r=e,e=t,t=void 0),void 0!==t&&"number"!=typeof t)throw new Error('Bad segment "'+t+'", must be 0-based integer');if(i&&a.shift(),0>t&&(t=Math.max(a.length+t,0)),void 0===e)return void 0===t?a:a[t];if(null===t||void 0===a[t])if(s(e)){a=[];for(var u=0,c=e.length;c>u;u++)(e[u].length||a.length&&a[a.length-1].length)&&(a.length&&!a[a.length-1].length&&a.pop(),a.push(l(e[u])))}else(e||"string"==typeof e)&&(e=l(e),""===a[a.length-1]?a[a.length-1]=e:a.push(e));else e?a[t]=l(e):a.splice(t,1);return i&&a.unshift(""),this.path(a.join(n),r)},g.segmentCoded=function(t,e,r){var n,i,a;if("number"!=typeof t&&(r=e,e=t,t=void 0),void 0===e){if(n=this.segment(t,e,r),s(n))for(i=0,a=n.length;a>i;i++)n[i]=o.decode(n[i]);else n=void 0!==n?o.decode(n):void 0;return n}if(s(e))for(i=0,a=e.length;a>i;i++)e[i]=o.encode(e[i]);else e="string"==typeof e||e instanceof String?o.encode(e):e;return this.segment(t,e,r)};var I=g.query;return g.query=function(t,e){if(t===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof t){var r=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),n=t.call(this,r);return this._parts.query=o.buildQuery(n||r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this}return void 0!==t&&"string"!=typeof t?(this._parts.query=o.buildQuery(t,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this):I.call(this,t,e)},g.setQuery=function(t,e,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof t||t instanceof String)n[t]=void 0!==e?e:null;else{if("object"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in t)v.call(t,i)&&(n[i]=t[i])}return this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(r=e),this.build(!r),this},g.addQuery=function(t,e,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(n,t,void 0===e?null:e),this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(r=e),this.build(!r),this},g.removeQuery=function(t,e,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(n,t,e),this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(r=e),this.build(!r),this},g.hasQuery=function(t,e,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(n,t,e,r)},g.setSearch=g.setQuery,g.addSearch=g.addQuery,g.removeSearch=g.removeQuery,g.hasSearch=g.hasQuery,g.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},g.normalizeProtocol=function(t){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!t)),this},g.normalizeHostname=function(r){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!r)),this},g.normalizePort=function(t){return"string"==typeof this._parts.protocol&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!t)),this},g.normalizePath=function(t){var e=this._parts.path;if(!e)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!t),this;if("/"===this._parts.path)return this;var r,n,i,a="";for("/"!==e.charAt(0)&&(r=!0,e="/"+e),("/.."===e.slice(-3)||"/."===e.slice(-2))&&(e+="/"),e=e.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),r&&(a=e.substring(1).match(/^(\.\.\/)+/)||"",a&&(a=a[0]));;){if(n=e.indexOf("/.."),-1===n)break;0!==n?(i=e.substring(0,n).lastIndexOf("/"),-1===i&&(i=n),e=e.substring(0,i)+e.substring(n+3)):e=e.substring(3)}return r&&this.is("relative")&&(e=a+e.substring(1)),e=o.recodePath(e),this._parts.path=e,this.build(!t),this},g.normalizePathname=g.normalizePath,g.normalizeQuery=function(t){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!t)),this},g.normalizeFragment=function(t){return this._parts.fragment||(this._parts.fragment=null,this.build(!t)),this},g.normalizeSearch=g.normalizeQuery,g.normalizeHash=g.normalizeFragment,g.iso8859=function(){var t=o.encode,e=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=t,o.decode=e}return this},g.unicode=function(){var t=o.encode,e=o.decode;o.encode=h,o.decode=unescape;try{this.normalize()}finally{o.encode=t,o.decode=e}return this},g.readable=function(){var e=this.clone();e.username("").password("").normalize();var r="";if(e._parts.protocol&&(r+=e._parts.protocol+"://"),e._parts.hostname&&(e.is("punycode")&&t?(r+=t.toUnicode(e._parts.hostname),e._parts.port&&(r+=":"+e._parts.port)):r+=e.host()),e._parts.hostname&&e._parts.path&&"/"!==e._parts.path.charAt(0)&&(r+="/"),r+=e.path(!0),e._parts.query){for(var n="",i=0,a=e._parts.query.split("&"),s=a.length;s>i;i++){var u=(a[i]||"").split("=");n+="&"+o.decodeQuery(u[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==u[1]&&(n+="="+o.decodeQuery(u[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}r+="?"+n.substring(1)}return r+=o.decodeQuery(e.hash(),!0)},g.absoluteTo=function(t){var e,r,n,i=this.clone(),a=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t instanceof o||(t=new o(t)),i._parts.protocol||(i._parts.protocol=t._parts.protocol),this._parts.hostname)return i;for(r=0;n=a[r];r++)i._parts[n]=t._parts[n];return i._parts.path?".."===i._parts.path.substring(-2)&&(i._parts.path+="/"):(i._parts.path=t._parts.path,i._parts.query||(i._parts.query=t._parts.query)),"/"!==i.path().charAt(0)&&(e=t.directory(),e=e?e:0===t.path().indexOf("/")?"/":"",i._parts.path=(e?e+"/":"")+i._parts.path,i.normalizePath()),i.build(),i},g.relativeTo=function(t){var e,r,n,i,a,s=this.clone().normalize();if(s._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t=new o(t).normalize(),e=s._parts,r=t._parts,i=s.path(),a=t.path(),"/"!==i.charAt(0))throw new Error("URI is already relative");if("/"!==a.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(e.protocol===r.protocol&&(e.protocol=null),e.username!==r.username||e.password!==r.password)return s.build();if(null!==e.protocol||null!==e.username||null!==e.password)return s.build();if(e.hostname!==r.hostname||e.port!==r.port)return s.build();if(e.hostname=null,e.port=null,i===a)return e.path="",s.build();if(n=o.commonPath(i,a),!n)return s.build();var u=r.path.substring(n.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return e.path=u+e.path.substring(n.length)||"./",s.build()},g.equals=function(t){var e,r,n,i=this.clone(),a=new o(t),u={},c={},l={};if(i.normalize(),a.normalize(),i.toString()===a.toString())return!0;if(e=i.query(),r=a.query(),i.query(""),a.query(""),i.toString()!==a.toString())return!1;if(e.length!==r.length)return!1;u=o.parseQuery(e,this._parts.escapeQuerySpace),c=o.parseQuery(r,this._parts.escapeQuerySpace);for(n in u)if(v.call(u,n)){if(s(u[n])){if(!p(u[n],c[n]))return!1}else if(u[n]!==c[n])return!1;l[n]=!0}for(n in c)if(v.call(c,n)&&!l[n])return!1;return!0},g.duplicateQueryParameters=function(t){return this._parts.duplicateQueryParameters=!!t,this},g.escapeQuerySpace=function(t){return this._parts.escapeQuerySpace=!!t,this},o}),function(t,e){"use strict";"object"==typeof exports?module.exports=e(require("./URI")):"function"==typeof define&&define.amd?define(["./URI"],e):t.URITemplate=e(t.URI,t)}(this,function(t,e){"use strict";function r(t){return r._cache[t]?r._cache[t]:this instanceof r?(this.expression=t,r._cache[t]=this,this):new r(t)}function n(t){this.data=t,this.cache={}}var o=e&&e.URITemplate,i=Object.prototype.hasOwnProperty,a=r.prototype,s={"":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encode"},"+":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},"#":{prefix:"#",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},".":{prefix:".",separator:".",named:!1,empty_name_separator:!1,encode:"encode"},"/":{prefix:"/",separator:"/",named:!1,empty_name_separator:!1,encode:"encode"},";":{prefix:";",separator:";",named:!0,empty_name_separator:!1,encode:"encode"},"?":{prefix:"?",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"},"&":{prefix:"&",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"}};return r._cache={},r.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g,r.VARIABLE_PATTERN=/^([^*:]+)((\*)|:(\d+))?$/,r.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_]/,r.expand=function(t,e){var n,o,i,a=s[t.operator],u=a.named?"Named":"Unnamed",c=t.variables,p=[];for(i=0;o=c[i];i++)n=e.get(o.name),n.val.length?p.push(r["expand"+u](n,a,o.explode,o.explode&&a.separator||",",o.maxlength,o.name)):n.type&&p.push("");return p.length?a.prefix+p.join(a.separator):""},r.expandNamed=function(e,r,n,o,i,a){var s,u,c,p="",l=r.encode,f=r.empty_name_separator,h=!e[l].length,d=2===e.type?"":t[l](a);for(u=0,c=e.val.length;c>u;u++)i?(s=t[l](e.val[u][1].substring(0,i)),2===e.type&&(d=t[l](e.val[u][0].substring(0,i)))):h?(s=t[l](e.val[u][1]),2===e.type?(d=t[l](e.val[u][0]),e[l].push([d,s])):e[l].push([void 0,s])):(s=e[l][u][1],2===e.type&&(d=e[l][u][0])),p&&(p+=o),n?p+=d+(f||s?"=":"")+s:(u||(p+=t[l](a)+(f||s?"=":"")),2===e.type&&(p+=d+","),p+=s);return p},r.expandUnnamed=function(e,r,n,o,i){var a,s,u,c,p="",l=r.encode,f=r.empty_name_separator,h=!e[l].length;for(u=0,c=e.val.length;c>u;u++)i?s=t[l](e.val[u][1].substring(0,i)):h?(s=t[l](e.val[u][1]),e[l].push([2===e.type?t[l](e.val[u][0]):void 0,s])):s=e[l][u][1],p&&(p+=o),2===e.type&&(a=i?t[l](e.val[u][0].substring(0,i)):e[l][u][0],p+=a,p+=n?f||s?"=":"":","),p+=s;return p},r.noConflict=function(){return e.URITemplate===r&&(e.URITemplate=o),r},a.expand=function(t){var e="";this.parts&&this.parts.length||this.parse(),t instanceof n||(t=new n(t));for(var o=0,i=this.parts.length;i>o;o++)e+="string"==typeof this.parts[o]?this.parts[o]:r.expand(this.parts[o],t);return e},a.parse=function(){var t,e,n,o=this.expression,i=r.EXPRESSION_PATTERN,a=r.VARIABLE_PATTERN,u=r.VARIABLE_NAME_PATTERN,c=[],p=0;for(i.lastIndex=0;;){if(e=i.exec(o),null===e){c.push(o.substring(p));break}if(c.push(o.substring(p,e.index)),p=e.index+e[0].length,!s[e[1]])throw new Error('Unknown Operator "'+e[1]+'" in "'+e[0]+'"');if(!e[3])throw new Error('Unclosed Expression "'+e[0]+'"');t=e[2].split(",");for(var l=0,f=t.length;f>l;l++){if(n=t[l].match(a),null===n)throw new Error('Invalid Variable "'+t[l]+'" in "'+e[0]+'"');if(n[1].match(u))throw new Error('Invalid Variable Name "'+n[1]+'" in "'+e[0]+'"');t[l]={name:n[1],explode:!!n[3],maxlength:n[4]&&parseInt(n[4],10)}}if(!t.length)throw new Error('Expression Missing Variable(s) "'+e[0]+'"');c.push({expression:e[0],operator:e[1],variables:t})}return c.length||c.push(o),this.parts=c,this},n.prototype.get=function(t){var e,r,n,o=this.data,a={type:0,val:[],encode:[],encodeReserved:[]};if(void 0!==this.cache[t])return this.cache[t];if(this.cache[t]=a,n="[object Function]"===String(Object.prototype.toString.call(o))?o(t):"[object Function]"===String(Object.prototype.toString.call(o[t]))?o[t](t):o[t],
void 0===n||null===n)return a;if("[object Array]"===String(Object.prototype.toString.call(n))){for(e=0,r=n.length;r>e;e++)void 0!==n[e]&&null!==n[e]&&a.val.push([void 0,String(n[e])]);a.val.length&&(a.type=3)}else if("[object Object]"===String(Object.prototype.toString.call(n))){for(e in n)i.call(n,e)&&void 0!==n[e]&&null!==n[e]&&a.val.push([e,String(n[e])]);a.val.length&&(a.type=2)}else a.type=1,a.val.push([void 0,String(n)]);return a},t.expand=function(e,n){var o=new r(e),i=o.expand(n);return new t(i)},r}),function(t){if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else Q=t()}(function(){"use strict";function t(t){return function(){return X.apply(t,arguments)}}function e(t){return t===Object(t)}function r(t){return"[object StopIteration]"===et(t)||t instanceof L}function n(t,e){if(N&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(rt)){for(var r=[],n=e;n;n=n.source)n.stack&&r.unshift(n.stack);r.unshift(t.stack);var i=r.join("\n"+rt+"\n");t.stack=o(i)}}function o(t){for(var e=t.split("\n"),r=[],n=0;n<e.length;++n){var o=e[n];s(o)||i(o)||!o||r.push(o)}return r.join("\n")}function i(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function a(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var r=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(r)return[r[1],Number(r[2])];var n=/.*@(.+):(\d+)$/.exec(t);return n?[n[1],Number(n[2])]:void 0}function s(t){var e=a(t);if(!e)return!1;var r=e[0],n=e[1];return r===B&&n>=M&&at>=n}function u(){if(N)try{throw new Error}catch(t){var e=t.stack.split("\n"),r=e[0].indexOf("@")>0?e[1]:e[2],n=a(r);if(!n)return;return B=n[0],n[1]}}function c(t,e,r){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(e+" is deprecated, use "+r+" instead.",new Error("").stack),t.apply(t,arguments)}}function p(t){return g(t)?t:v(t)?R(t):I(t)}function l(){function t(t){e=t,i.source=t,G(r,function(e,r){V(function(){t.promiseDispatch.apply(t,r)})},void 0),r=void 0,n=void 0}var e,r=[],n=[],o=W(l.prototype),i=W(d.prototype);if(i.promiseDispatch=function(t,o,i){var a=Z(arguments);r?(r.push(a),"when"===o&&i[1]&&n.push(i[1])):V(function(){e.promiseDispatch.apply(e,a)})},i.valueOf=function(){if(r)return i;var t=y(e);return g(t)&&(e=t),t},i.inspect=function(){return e?e.inspect():{state:"pending"}},p.longStackSupport&&N)try{throw new Error}catch(a){i.stack=a.stack.substring(a.stack.indexOf("\n")+1)}return o.promise=i,o.resolve=function(r){e||t(p(r))},o.fulfill=function(r){e||t(I(r))},o.reject=function(r){e||t(P(r))},o.notify=function(t){e||G(n,function(e,r){V(function(){r(t)})},void 0)},o}function f(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=l();try{t(e.resolve,e.reject,e.notify)}catch(r){e.reject(r)}return e.promise}function h(t){return f(function(e,r){for(var n=0,o=t.length;o>n;n++)p(t[n]).then(e,r)})}function d(t,e,r){void 0===e&&(e=function(t){return P(new Error("Promise does not support operation: "+t))}),void 0===r&&(r=function(){return{state:"unknown"}});var n=W(d.prototype);if(n.promiseDispatch=function(r,o,i){var a;try{a=t[o]?t[o].apply(n,i):e.call(n,o,i)}catch(s){a=P(s)}r&&r(a)},n.inspect=r,r){var o=r();"rejected"===o.state&&(n.exception=o.reason),n.valueOf=function(){var t=r();return"pending"===t.state||"rejected"===t.state?n:t.value}}return n}function m(t,e,r,n){return p(t).then(e,r,n)}function y(t){if(g(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function g(t){return e(t)&&"function"==typeof t.promiseDispatch&&"function"==typeof t.inspect}function v(t){return e(t)&&"function"==typeof t.then}function _(t){return g(t)&&"pending"===t.inspect().state}function w(t){return!g(t)||"fulfilled"===t.inspect().state}function b(t){return g(t)&&"rejected"===t.inspect().state}function A(){nt.length=0,ot.length=0,it||(it=!0)}function x(t,e){it&&(ot.push(t),e&&"undefined"!=typeof e.stack?nt.push(e.stack):nt.push("(no stack) "+e))}function S(t){if(it){var e=J(ot,t);-1!==e&&(ot.splice(e,1),nt.splice(e,1))}}function P(t){var e=d({when:function(e){return e&&S(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return x(e,t),e}function I(t){return d({when:function(){return t},get:function(e){return t[e]},set:function(e,r){t[e]=r},"delete":function(e){delete t[e]},post:function(e,r){return null===e||void 0===e?t.apply(void 0,r):t[e].apply(t,r)},apply:function(e,r){return t.apply(e,r)},keys:function(){return tt(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function R(t){var e=l();return V(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(r){e.reject(r)}}),e.promise}function j(t){return d({isDef:function(){}},function(e,r){return O(t,e,r)},function(){return p(t).inspect()})}function k(t,e,r){return p(t).spread(e,r)}function E(t){return function(){function e(t,e){var a;if("undefined"==typeof StopIteration){try{a=n[t](e)}catch(s){return P(s)}return a.done?a.value:m(a.value,o,i)}try{a=n[t](e)}catch(s){return r(s)?s.value:P(s)}return m(a,o,i)}var n=t.apply(this,arguments),o=e.bind(e,"next"),i=e.bind(e,"throw");return o()}}function U(t){p.done(p.async(t)())}function Q(t){throw new L(t)}function T(t){return function(){return k([this,C(arguments)],function(e,r){return t.apply(e,r)})}}function O(t,e,r){return p(t).dispatch(e,r)}function C(t){return m(t,function(t){var e=0,r=l();return G(t,function(n,o,i){var a;g(o)&&"fulfilled"===(a=o.inspect()).state?t[i]=a.value:(++e,m(o,function(n){t[i]=n,0===--e&&r.resolve(t)},r.reject,function(t){r.notify({index:i,value:t})}))},void 0),0===e&&r.resolve(t),r.promise})}function q(t){return m(t,function(t){return t=K(t,p),m(C(K(t,function(t){return m(t,$,$)})),function(){return t})})}function z(t){return p(t).allSettled()}function D(t,e){return p(t).then(void 0,void 0,e)}function F(t,e){return p(t).nodeify(e)}var N=!1;try{throw new Error}catch(H){N=!!H.stack}var B,L,M=u(),$=function(){},V=function(){function t(){for(;e.next;){e=e.next;var r=e.task;e.task=void 0;var o=e.domain;o&&(e.domain=void 0,o.enter());try{r()}catch(a){if(i)throw o&&o.exit(),setTimeout(t,0),o&&o.enter(),a;setTimeout(function(){throw a},0)}o&&o.exit()}n=!1}var e={task:void 0,next:null},r=e,n=!1,o=void 0,i=!1;if(V=function(t){r=r.next={task:t,domain:i&&process.domain,next:null},n||(n=!0,o())},"undefined"!=typeof process&&process.nextTick)i=!0,o=function(){process.nextTick(t)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var a=new MessageChannel;a.port1.onmessage=function(){o=s,a.port1.onmessage=t,t()};var s=function(){a.port2.postMessage(0)};o=function(){setTimeout(t,0),s()}}else o=function(){setTimeout(t,0)};return V}(),X=Function.call,Z=t(Array.prototype.slice),G=t(Array.prototype.reduce||function(t,e){var r=0,n=this.length;if(1===arguments.length)for(;;){if(r in this){e=this[r++];break}if(++r>=n)throw new TypeError}for(;n>r;r++)r in this&&(e=t(e,this[r],r));return e}),J=t(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),K=t(Array.prototype.map||function(t,e){var r=this,n=[];return G(r,function(o,i,a){n.push(t.call(e,i,a,r))},void 0),n}),W=Object.create||function(t){function e(){}return e.prototype=t,new e},Y=t(Object.prototype.hasOwnProperty),tt=Object.keys||function(t){var e=[];for(var r in t)Y(t,r)&&e.push(r);return e},et=t(Object.prototype.toString);L="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var rt="From previous event:";p.resolve=p,p.nextTick=V,p.longStackSupport=!1,p.defer=l,l.prototype.makeNodeResolver=function(){var t=this;return function(e,r){e?t.reject(e):arguments.length>2?t.resolve(Z(arguments,1)):t.resolve(r)}},p.Promise=f,p.promise=f,f.race=h,f.all=C,f.reject=P,f.resolve=p,p.passByCopy=function(t){return t},d.prototype.passByCopy=function(){return this},p.join=function(t,e){return p(t).join(e)},d.prototype.join=function(t){return p([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})},p.race=h,d.prototype.race=function(){return this.then(p.race)},p.makePromise=d,d.prototype.toString=function(){return"[object Promise]"},d.prototype.then=function(t,e,r){function o(e){try{return"function"==typeof t?t(e):e}catch(r){return P(r)}}function i(t){if("function"==typeof e){n(t,s);try{return e(t)}catch(r){return P(r)}}return P(t)}function a(t){return"function"==typeof r?r(t):t}var s=this,u=l(),c=!1;return V(function(){s.promiseDispatch(function(t){c||(c=!0,u.resolve(o(t)))},"when",[function(t){c||(c=!0,u.resolve(i(t)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(t){var e,r=!1;try{e=a(t)}catch(n){if(r=!0,!p.onerror)throw n;p.onerror(n)}r||u.notify(e)}]),u.promise},p.when=m,d.prototype.thenResolve=function(t){return this.then(function(){return t})},p.thenResolve=function(t,e){return p(t).thenResolve(e)},d.prototype.thenReject=function(t){return this.then(function(){throw t})},p.thenReject=function(t,e){return p(t).thenReject(e)},p.nearer=y,p.isPromise=g,p.isPromiseAlike=v,p.isPending=_,d.prototype.isPending=function(){return"pending"===this.inspect().state},p.isFulfilled=w,d.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},p.isRejected=b,d.prototype.isRejected=function(){return"rejected"===this.inspect().state};var nt=[],ot=[],it=!0;p.resetUnhandledRejections=A,p.getUnhandledReasons=function(){return nt.slice()},p.stopUnhandledRejectionTracking=function(){A(),it=!1},A(),p.reject=P,p.fulfill=I,p.master=j,p.spread=k,d.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},p.async=E,p.spawn=U,p["return"]=Q,p.promised=T,p.dispatch=O,d.prototype.dispatch=function(t,e){var r=this,n=l();return V(function(){r.promiseDispatch(n.resolve,t,e)}),n.promise},p.get=function(t,e){return p(t).dispatch("get",[e])},d.prototype.get=function(t){return this.dispatch("get",[t])},p.set=function(t,e,r){return p(t).dispatch("set",[e,r])},d.prototype.set=function(t,e){return this.dispatch("set",[t,e])},p.del=p["delete"]=function(t,e){return p(t).dispatch("delete",[e])},d.prototype.del=d.prototype["delete"]=function(t){return this.dispatch("delete",[t])},p.mapply=p.post=function(t,e,r){return p(t).dispatch("post",[e,r])},d.prototype.mapply=d.prototype.post=function(t,e){return this.dispatch("post",[t,e])},p.send=p.mcall=p.invoke=function(t,e){return p(t).dispatch("post",[e,Z(arguments,2)])},d.prototype.send=d.prototype.mcall=d.prototype.invoke=function(t){return this.dispatch("post",[t,Z(arguments,1)])},p.fapply=function(t,e){return p(t).dispatch("apply",[void 0,e])},d.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},p["try"]=p.fcall=function(t){return p(t).dispatch("apply",[void 0,Z(arguments,1)])},d.prototype.fcall=function(){return this.dispatch("apply",[void 0,Z(arguments)])},p.fbind=function(t){var e=p(t),r=Z(arguments,1);return function(){return e.dispatch("apply",[this,r.concat(Z(arguments))])}},d.prototype.fbind=function(){var t=this,e=Z(arguments);return function(){return t.dispatch("apply",[this,e.concat(Z(arguments))])}},p.keys=function(t){return p(t).dispatch("keys",[])},d.prototype.keys=function(){return this.dispatch("keys",[])},p.all=C,d.prototype.all=function(){return C(this)},p.allResolved=c(q,"allResolved","allSettled"),d.prototype.allResolved=function(){return q(this)},p.allSettled=z,d.prototype.allSettled=function(){return this.then(function(t){return C(K(t,function(t){function e(){return t.inspect()}return t=p(t),t.then(e,e)}))})},p.fail=p["catch"]=function(t,e){return p(t).then(void 0,e)},d.prototype.fail=d.prototype["catch"]=function(t){return this.then(void 0,t)},p.progress=D,d.prototype.progress=function(t){return this.then(void 0,void 0,t)},p.fin=p["finally"]=function(t,e){return p(t)["finally"](e)},d.prototype.fin=d.prototype["finally"]=function(t){return t=p(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},p.done=function(t,e,r,n){return p(t).done(e,r,n)},d.prototype.done=function(t,e,r){var o=function(t){V(function(){if(n(t,i),!p.onerror)throw t;p.onerror(t)})},i=t||e||r?this.then(t,e,r):this;"object"==typeof process&&process&&process.domain&&(o=process.domain.bind(o)),i.then(void 0,o)},p.timeout=function(t,e,r){return p(t).timeout(e,r)},d.prototype.timeout=function(t,e){var r=l(),n=setTimeout(function(){r.reject(new Error(e||"Timed out after "+t+" ms"))},t);return this.then(function(t){clearTimeout(n),r.resolve(t)},function(t){clearTimeout(n),r.reject(t)},r.notify),r.promise},p.delay=function(t,e){return void 0===e&&(e=t,t=void 0),p(t).delay(e)},d.prototype.delay=function(t){return this.then(function(e){var r=l();return setTimeout(function(){r.resolve(e)},t),r.promise})},p.nfapply=function(t,e){return p(t).nfapply(e)},d.prototype.nfapply=function(t){var e=l(),r=Z(t);return r.push(e.makeNodeResolver()),this.fapply(r).fail(e.reject),e.promise},p.nfcall=function(t){var e=Z(arguments,1);return p(t).nfapply(e)},d.prototype.nfcall=function(){var t=Z(arguments),e=l();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},p.nfbind=p.denodeify=function(t){var e=Z(arguments,1);return function(){var r=e.concat(Z(arguments)),n=l();return r.push(n.makeNodeResolver()),p(t).fapply(r).fail(n.reject),n.promise}},d.prototype.nfbind=d.prototype.denodeify=function(){var t=Z(arguments);return t.unshift(this),p.denodeify.apply(void 0,t)},p.nbind=function(t,e){var r=Z(arguments,2);return function(){function n(){return t.apply(e,arguments)}var o=r.concat(Z(arguments)),i=l();return o.push(i.makeNodeResolver()),p(n).fapply(o).fail(i.reject),i.promise}},d.prototype.nbind=function(){var t=Z(arguments,0);return t.unshift(this),p.nbind.apply(void 0,t)},p.nmapply=p.npost=function(t,e,r){return p(t).npost(e,r)},d.prototype.nmapply=d.prototype.npost=function(t,e){var r=Z(e||[]),n=l();return r.push(n.makeNodeResolver()),this.dispatch("post",[t,r]).fail(n.reject),n.promise},p.nsend=p.nmcall=p.ninvoke=function(t,e){var r=Z(arguments,2),n=l();return r.push(n.makeNodeResolver()),p(t).dispatch("post",[e,r]).fail(n.reject),n.promise},d.prototype.nsend=d.prototype.nmcall=d.prototype.ninvoke=function(t){var e=Z(arguments,1),r=l();return e.push(r.makeNodeResolver()),this.dispatch("post",[t,e]).fail(r.reject),r.promise},p.nodeify=F,d.prototype.nodeify=function(t){return t?void this.then(function(e){V(function(){t(null,e)})},function(e){V(function(){t(e)})}):this};var at=u();return p}),function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.Stargate=e()}(this,function(){function t(){this.initialize=function(t,e,r){d("unimplemented"),r("unimplemented")},this.createBanner=function(t,e,r){d("unimplemented"),r("unimplemented")},this.hideBanner=function(t,e,r){d("unimplemented"),r("unimplemented")},this.removeBanner=function(t,e,r){d("unimplemented"),r("unimplemented")},this.showBannerAtSelectedPosition=function(t,e,r){d("unimplemented"),r("unimplemented")},this.showBannerAtGivenXY=function(t,e,r){d("unimplemented"),r("unimplemented")},this.registerAdEvents=function(t,e,r){d("unimplemented"),r("unimplemented")},this.prepareInterstitial=function(t,e,r){d("unimplemented"),r("unimplemented")},this.showInterstitial=function(t,e,r){d("unimplemented"),r("unimplemented")}}var e={},r=function(){deltadna.registerPushCallback(o)},n=function(t){d("[DeltaDNA] error: "+t)},o=function(t){return y()&&t.payload&&t.payload.url&&!t.foreground?w(t.payload.url):g()&&t.url?w(t.url):void 0};e.facebookLogin=function(t,e,r){facebookConnectPlugin.login(t.split(","),function(t){h("[facebook] got userdata: ",t),facebookConnectPlugin.getAccessToken(function(t){e({accessToken:t})},function(t){r({error:t})})},function(t){d("Got FB login error:",t),r({error:t})})},e.facebookShare=function(t,e,r){var n={method:"share",href:t};facebookConnectPlugin.showDialog(n,function(t){e({message:t})},function(t){d("Got FB share error:",t),r({error:t})})};var i={id:"",alias:"",type:"",verbosity:"",paymethod:"",subscribeMethod:"stargate",returnUrl:"",callbackSuccess:function(){h("[IAP] Undefined callbackSuccess")},callbackError:function(){h("[IAP] Undefined callbackError")},initialize:function(){return window.store?(i.returnUrl=document.location.href,E.IAP.id&&(i.id=E.IAP.id),E.IAP.alias&&(i.alias=E.IAP.alias),E.IAP.type&&(i.type=E.IAP.type),i.verbosity="DEBUG",i.paymethod=y()?"gwallet":"itunes",h("IAP initialize id: "+i.id),y()&&i.getGoogleAccount(),window.store.verbosity=window.store[i.verbosity],window.store.register({id:i.id,alias:i.alias,type:store[i.type]}),window.store.when(i.alias).approved(function(t){i.onPurchaseApproved(t)}),window.store.when(i.alias).verified(function(t){i.onPurchaseVerified(t)}),window.store.when(i.alias).updated(function(t){i.onProductUpdate(t)}),window.store.when(i.alias).owned(function(t){i.onProductOwned(t)}),window.store.when(i.alias).cancelled(function(t){i.onCancelledProduct(t)}),window.store.when(i.alias).error(function(t){i.error(JSON.stringify(t))}),window.store.ready(function(){i.onStoreReady()}),void window.store.when("order "+i.id).approved(function(t){i.onOrderApproved(t)})):void d("Store not available")},getPassword:function(t){return c("iap."+t+".playme").substr(0,8)},getGoogleAccount:function(){window.accountmanager.getAccounts(i.checkGoogleAccount,i.error,"com.google")},checkGoogleAccount:function(t){if(t){h("[IAP] accounts"),h(t);for(var e in t)return window.localStorage.setItem("googleAccount",t[e].email),t[e].email}},onProductUpdate:function(t){h("IAP> Product updated."),h(JSON.stringify(t)),h(t.owned?"[IAP] Subscribed!":"[IAP] Not Subscribed")},onPurchaseApproved:function(t){h("IAP> Purchase approved."),h(JSON.stringify(t)),t.finish()},onPurchaseVerified:function(t){h("subscription verified ",t)},onStoreReady:function(){h("\\o/ STORE READY \\o/")},onProductOwned:function(t){if(h("[IAP] > Product Owned."),!t.transaction.id&&g())return h("[IAP] > no transaction id"),!1;if(window.localStorage.setItem("product",t),g()&&window.localStorage.setItem("transaction_id",t.transaction.id),y()){var e=t.transaction.purchaseToken+"|"+z.id+"|"+i.id;h("[IAP] Purchase Token: "+e),window.localStorage.getItem("user_account")||i.createUser(t,e)}else storekit.loadReceipts(function(e){h("[IAP] appStoreReceipt: "+e.appStoreReceipt),window.localStorage.getItem("user_account")||i.createUser(t,e.appStoreReceipt)})},onCancelledProduct:function(t){q(!1),i.callbackError({iap_cancelled:1,return_url:i.returnUrl}),h("[IAP] > Purchase cancelled ##################################",t)},onOrderApproved:function(t){h("[IAP] ORDER APPROVED "+i.id),t.finish()},error:function(t){q(!1),i.callbackError({iap_error:1,return_url:i.returnUrl}),d("[IAP] error: "+t)},createUser:function(t,e){window.localStorage.setItem("user_account",y()?window.localStorage.getItem("googleAccount")?window.localStorage.getItem("googleAccount"):e+"@google.com":t.transaction.id+"@itunes.com");var r=i.subscribeMethod;l({method:"post",url:r,data:{paymethod:i.paymethod,user_account:window.localStorage.getItem("user_account"),purchase_token:e,return_url:i.returnUrl,inapp_pwd:i.getPassword(e),hybrid:1},type:"jsonp",success:function(t){h("[IAP] createUser success ",t),t.device_id=m.uuid,window.localStorage.getItem("transaction_id")&&(t.transaction_id=window.localStorage.getItem("transaction_id")),q(!1),i.callbackSuccess(t)},error:function(t){d("[IAP] Call failed, please try again...",t);var e={iap_error:"1",return_url:i.returnUrl};q(!1),i.callbackError(e)}})}};e.inAppPurchaseSubscription=function(t,e,r,n){q(!0),"undefined"!=typeof n&&(i.returnUrl=n),"undefined"!=typeof r&&(i.subscribeMethod=r),i.callbackSuccess=t,i.callbackError=e,window.store.order(i.id),window.store.refresh()},e.inAppRestore=function(t,e,r,n){q(!0),"undefined"!=typeof r&&(i.subscribeMethod=r),"undefined"!=typeof n&&(i.returnUrl=n),i.callbackSuccess=t,i.callbackError=e,d("[IAP] unimplemented restore, FIXME!");var o={iap_error:"1",return_url:i.returnUrl};q(!1),i.callbackError(o)};var a=function(){ProgressIndicator.showSimple(!0)},s=function(){ProgressIndicator.hide()};window.startLoading=a,window.stopLoading=s;var u,c=function(){"use strict";function t(t,e){var r=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(r>>16);return n<<16|65535&r}function e(t,e){return t<<e|t>>>32-e}function r(r,n,o,i,a,s){return t(e(t(t(n,r),t(i,s)),a),o)}function n(t,e,n,o,i,a,s){return r(e&n|~e&o,t,e,i,a,s)}function o(t,e,n,o,i,a,s){return r(e&o|n&~o,t,e,i,a,s)}function i(t,e,n,o,i,a,s){return r(e^n^o,t,e,i,a,s)}function a(t,e,n,o,i,a,s){return r(n^(e|~o),t,e,i,a,s)}function s(e,r){e[r>>5]|=128<<r%32,e[(r+64>>>9<<4)+14]=r;var s,u,c,p,l,f=1732584193,h=-271733879,d=-1732584194,m=271733878;for(s=0;s<e.length;s+=16)u=f,c=h,p=d,l=m,f=n(f,h,d,m,e[s],7,-680876936),m=n(m,f,h,d,e[s+1],12,-389564586),d=n(d,m,f,h,e[s+2],17,606105819),h=n(h,d,m,f,e[s+3],22,-1044525330),f=n(f,h,d,m,e[s+4],7,-176418897),m=n(m,f,h,d,e[s+5],12,1200080426),d=n(d,m,f,h,e[s+6],17,-1473231341),h=n(h,d,m,f,e[s+7],22,-45705983),f=n(f,h,d,m,e[s+8],7,1770035416),m=n(m,f,h,d,e[s+9],12,-1958414417),d=n(d,m,f,h,e[s+10],17,-42063),h=n(h,d,m,f,e[s+11],22,-1990404162),f=n(f,h,d,m,e[s+12],7,1804603682),m=n(m,f,h,d,e[s+13],12,-40341101),d=n(d,m,f,h,e[s+14],17,-1502002290),h=n(h,d,m,f,e[s+15],22,1236535329),f=o(f,h,d,m,e[s+1],5,-165796510),m=o(m,f,h,d,e[s+6],9,-1069501632),d=o(d,m,f,h,e[s+11],14,643717713),h=o(h,d,m,f,e[s],20,-373897302),f=o(f,h,d,m,e[s+5],5,-701558691),m=o(m,f,h,d,e[s+10],9,38016083),d=o(d,m,f,h,e[s+15],14,-660478335),h=o(h,d,m,f,e[s+4],20,-405537848),f=o(f,h,d,m,e[s+9],5,568446438),m=o(m,f,h,d,e[s+14],9,-1019803690),d=o(d,m,f,h,e[s+3],14,-187363961),h=o(h,d,m,f,e[s+8],20,1163531501),f=o(f,h,d,m,e[s+13],5,-1444681467),m=o(m,f,h,d,e[s+2],9,-51403784),d=o(d,m,f,h,e[s+7],14,1735328473),h=o(h,d,m,f,e[s+12],20,-1926607734),f=i(f,h,d,m,e[s+5],4,-378558),m=i(m,f,h,d,e[s+8],11,-2022574463),d=i(d,m,f,h,e[s+11],16,1839030562),h=i(h,d,m,f,e[s+14],23,-35309556),f=i(f,h,d,m,e[s+1],4,-1530992060),m=i(m,f,h,d,e[s+4],11,1272893353),d=i(d,m,f,h,e[s+7],16,-155497632),h=i(h,d,m,f,e[s+10],23,-1094730640),f=i(f,h,d,m,e[s+13],4,681279174),m=i(m,f,h,d,e[s],11,-358537222),d=i(d,m,f,h,e[s+3],16,-722521979),h=i(h,d,m,f,e[s+6],23,76029189),f=i(f,h,d,m,e[s+9],4,-640364487),m=i(m,f,h,d,e[s+12],11,-421815835),d=i(d,m,f,h,e[s+15],16,530742520),h=i(h,d,m,f,e[s+2],23,-995338651),f=a(f,h,d,m,e[s],6,-198630844),m=a(m,f,h,d,e[s+7],10,1126891415),d=a(d,m,f,h,e[s+14],15,-1416354905),h=a(h,d,m,f,e[s+5],21,-57434055),f=a(f,h,d,m,e[s+12],6,1700485571),m=a(m,f,h,d,e[s+3],10,-1894986606),d=a(d,m,f,h,e[s+10],15,-1051523),h=a(h,d,m,f,e[s+1],21,-2054922799),f=a(f,h,d,m,e[s+8],6,1873313359),m=a(m,f,h,d,e[s+15],10,-30611744),d=a(d,m,f,h,e[s+6],15,-1560198380),h=a(h,d,m,f,e[s+13],21,1309151649),f=a(f,h,d,m,e[s+4],6,-145523070),m=a(m,f,h,d,e[s+11],10,-1120210379),d=a(d,m,f,h,e[s+2],15,718787259),h=a(h,d,m,f,e[s+9],21,-343485551),f=t(f,u),h=t(h,c),d=t(d,p),m=t(m,l);return[f,h,d,m]}function u(t){var e,r="";for(e=0;e<32*t.length;e+=8)r+=String.fromCharCode(t[e>>5]>>>e%32&255);return r}function c(t){var e,r=[];for(r[(t.length>>2)-1]=void 0,e=0;e<r.length;e+=1)r[e]=0;for(e=0;e<8*t.length;e+=8)r[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return r}function p(t){return u(s(c(t),8*t.length))}function l(t,e){var r,n,o=c(t),i=[],a=[];for(i[15]=a[15]=void 0,o.length>16&&(o=s(o,8*t.length)),r=0;16>r;r+=1)i[r]=909522486^o[r],a[r]=1549556828^o[r];return n=s(i.concat(c(e)),512+8*e.length),u(s(a.concat(n),640))}function f(t){var e,r,n="0123456789abcdef",o="";for(r=0;r<t.length;r+=1)e=t.charCodeAt(r),o+=n.charAt(e>>>4&15)+n.charAt(15&e);return o}function h(t){return unescape(encodeURIComponent(t))}function d(t){return p(h(t))}function m(t){return f(d(t))}function y(t,e){return l(h(t),h(e))}function g(t,e){return f(y(t,e))}function v(t,e,r){return e?r?y(e,t):g(e,t):r?d(t):m(t)}return v}(),p={check:function(){I?p.get(I):d("Country not defined!")},getContents:function(t,e,r,n){var o={};o.api_country=r,o.country=t,o.fpnamespace=e,n&&(o.extData=n);var i=JSON.stringify(o);return i},getPonyValue:function(t){try{return t.split("=")[1]}catch(e){d(e)}return""},set:function(t){var e=u;window.localStorage.getItem("appUrl")&&(e=window.localStorage.getItem("appUrl"));var r=new URI(u),n=r.hostname(),o=URITemplate(z.api.mfpSetUriTemplate).expand({protocol:r.protocol(),hostname:n,url:e,domain:n,_PONY:p.getPonyValue(t)});h("MFP going to url: ",o),w(o)},get:function(t){var e="",r=URITemplate(z.api.mfpGetUriTemplate).expand({apikey:z.motime_apikey,contents_inapp:p.getContents(t,z.namespace,z.label),country:t,expire:e});l({url:r,type:"jsonp",method:"get",error:function(t){d("MFP.get() error: "+t)},success:function(t){h("MFP.get() resp: ",t);var e="";if(t.content.inappInfo){var r=JSON.parse(t.content.inappInfo);r.extData&&r.extData.ponyUrl&&(e=r.extData.ponyUrl),r.extData&&r.extData.return_url&&window.localStorage.setItem("appUrl",r.extData.return_url),p.set(e)}else h("MFP.get(): Empty session")}})}},l=function(){function t(t){var e=S.exec(t.url);return e=e&&e[1]||v.location.protocol,x.test(e)?P.test(t.request.status):!!t.request.response}function e(e,r,n){return function(){return e._aborted?n(e.request):e._timedOut?n(e.request,"Request is aborted: timeout"):void(e.request&&4==e.request[I]&&(e.request.onreadystatechange=T,t(e)?r(e.request):n(e.request)))}}function r(t,e){var r,n=e.headers||{};n.Accept=n.Accept||C.accept[e.type]||C.accept["*"];var o="undefined"!=typeof FormData&&e.data instanceof FormData;e.crossOrigin||n[j]||(n[j]=C.requestedWith),n[R]||o||(n[R]=e.contentType||C.contentType);for(r in n)n.hasOwnProperty(r)&&"setRequestHeader"in t&&t.setRequestHeader(r,n[r])}function n(t,e){"undefined"!=typeof e.withCredentials&&"undefined"!=typeof t.withCredentials&&(t.withCredentials=!!e.withCredentials)}function o(t){_=t}function i(t,e){return t+(/\?/.test(t)?"&":"?")+e}function a(t,e,r,n){var a=k+=1,s=t.jsonpCallback||"callback",u=t.jsonpCallbackName||l.getcallbackPrefix(a),c=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),p=n.match(c),f=w.createElement("script"),h=0,d=-1!==navigator.userAgent.indexOf("MSIE 10.0");return p?"?"===p[3]?n=n.replace(c,"$1="+u):u=p[3]:n=i(n,s+"="+u),v[u]=o,f.type="text/javascript",f.src=n,f.async=!0,"undefined"==typeof f.onreadystatechange||d||(f.htmlFor=f.id="_reqwest_"+a),f.onload=f.onreadystatechange=function(){return f[I]&&"complete"!==f[I]&&"loaded"!==f[I]||h?!1:(f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),e(_),_=void 0,A.removeChild(f),void(h=1))},A.appendChild(f),{abort:function(){f.onload=f.onreadystatechange=null,r({},"Request is aborted: timeout",{}),_=void 0,A.removeChild(f),h=1}}}function s(t,o){var s,u=this.o,c=(u.method||"GET").toUpperCase(),p="string"==typeof u?u:u.url,f=u.processData!==!1&&u.data&&"string"!=typeof u.data?l.toQueryString(u.data):u.data||null,h=!1;return"jsonp"!=u.type&&"GET"!=c||!f||(p=i(p,f),f=null),"jsonp"==u.type?a(u,t,o,p):(s=u.xhr&&u.xhr(u)||q(u),s.open(c,p,u.async===!1?!1:!0),r(s,u),n(s,u),v[Q]&&s instanceof v[Q]?(s.onload=t,s.onerror=o,s.onprogress=function(){},h=!0):s.onreadystatechange=e(this,t,o),u.before&&u.before(s),h?setTimeout(function(){s.send(f)},200):s.send(f),s)}function u(t,e){this.o=t,this.fn=e,p.apply(this,arguments)}function c(t){return null!==t?t.match("json")?"json":t.match("javascript")?"js":t.match("text")?"html":t.match("xml")?"xml":void 0:void 0}function p(t,e){function r(e){for(t.timeout&&clearTimeout(a.timeout),a.timeout=null;a._completeHandlers.length>0;)a._completeHandlers.shift()(e)}function n(n){var o=t.type||n&&c(n.getResponseHeader("Content-Type"));n="jsonp"!==o?a.request:n;var s=z.dataFilter(n.responseText,o),u=s;try{n.responseText=u}catch(p){}if(u)switch(o){case"json":try{n=v.JSON.parse(u)}catch(l){return i(n,"Could not parse JSON in response",l)}break;case"html":n=u;break;case"xml":n=n.responseXML&&n.responseXML.parseError&&n.responseXML.parseError.errorCode&&n.responseXML.parseError.reason?null:n.responseXML}for(a._responseArgs.resp=n,a._fulfilled=!0,e(n),a._successHandler(n);a._fulfillmentHandlers.length>0;)n=a._fulfillmentHandlers.shift()(n);r(n)}function o(){a._timedOut=!0,a.request.abort()}function i(t,e,n){for(t=a.request,a._responseArgs.resp=t,a._responseArgs.msg=e,a._responseArgs.t=n,a._erred=!0;a._errorHandlers.length>0;)a._errorHandlers.shift()(t,e,n);r(t)}this.url="string"==typeof t?t:t.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var a=this;e=e||function(){},t.timeout&&(this.timeout=setTimeout(function(){o()},t.timeout)),t.success&&(this._successHandler=function(){t.success.apply(t,arguments)}),t.error&&this._errorHandlers.push(function(){t.error.apply(t,arguments)}),t.complete&&this._completeHandlers.push(function(){t.complete.apply(t,arguments)}),this.request=s.call(this,n,i)}function l(t,e){return new u(t,e)}function f(t){return t?t.replace(/\r?\n/g,"\r\n"):""}function h(t,e){var r,n,o,i,a=t.name,s=t.tagName.toLowerCase(),u=function(t){t&&!t.disabled&&e(a,f(t.attributes.value&&t.attributes.value.specified?t.value:t.text))};if(!t.disabled&&a)switch(s){case"input":/reset|button|image|file/i.test(t.type)||(r=/checkbox/i.test(t.type),n=/radio/i.test(t.type),o=t.value,(!(r||n)||t.checked)&&e(a,f(r&&""===o?"on":o)));break;case"textarea":e(a,f(t.value));break;case"select":if("select-one"===t.type.toLowerCase())u(t.selectedIndex>=0?t.options[t.selectedIndex]:null);else for(i=0;t.length&&i<t.length;i+=1)t.options[i].selected&&u(t.options[i])}}function d(){var t,e,r=this,n=function(t,e){var n,o,i;for(n=0;n<e.length;n+=1)for(i=t[b](e[n]),o=0;o<i.length;o+=1)h(i[o],r)};for(e=0;e<arguments.length;e+=1)t=arguments[e],/input|select|textarea/i.test(t.tagName)&&h(t,r),n(t,["input","select","textarea"])}function m(){return l.toQueryString(l.serializeArray.apply(null,arguments))}function y(){var t={};return d.apply(function(e,r){e in t?(t[e]&&!O(t[e])&&(t[e]=[t[e]]),t[e].push(r)):t[e]=r},arguments),t}function g(t,e,r,n){var o,i,a,s=/\[\]$/;if(O(e))for(i=0;e&&i<e.length;i+=1)a=e[i],r||s.test(t)?n(t,a):g(t+"["+("object"==typeof a?i:"")+"]",a,r,n);else if(e&&"[object Object]"===e.toString())for(o in e)g(t+"["+o+"]",e[o],r,n);else n(t,e)}var v=this;if(!("window"in v))throw new Error("Running outside a browser window is not supported!");var _,w=document,b="getElementsByTagName",A=w[b]("head")[0],x=/^http/,S=/(^\w+):\/\//,P=/^(20\d|1223)$/,I="readyState",R="Content-Type",j="X-Requested-With",k=0,E="reqwest_"+ +new Date,U="XMLHttpRequest",Q="XDomainRequest",T=function(){},O="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},C={contentType:"application/x-www-form-urlencoded",requestedWith:U,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},q=function(t){if(t.crossOrigin===!0){var e=v[U]?new XMLHttpRequest:null;if(e&&"withCredentials"in e)return e;if(v[Q])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return v[U]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},z={dataFilter:function(t){return t}};return u.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){p.call(this,this.o,this.fn)},then:function(t,e){return t=t||function(){},e=e||function(){},this._fulfilled?this._responseArgs.resp=t(this._responseArgs.resp):this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(t),this._errorHandlers.push(e)),
this},always:function(t){return this._fulfilled||this._erred?t(this._responseArgs.resp):this._completeHandlers.push(t),this},fail:function(t){return this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(t),this},"catch":function(t){return this.fail(t)}},l.serializeArray=function(){var t=[];return d.apply(function(e,r){t.push({name:e,value:r})},arguments),t},l.serialize=function(){if(0===arguments.length)return"";var t,e,r=Array.prototype.slice.call(arguments,0);return t=r.pop(),t&&t.nodeType&&r.push(t)&&(t=null),t&&(t=t.type),e="map"==t?y:"array"==t?l.serializeArray:m,e.apply(null,r)},l.toQueryString=function(t,e){var r,n,o=e||!1,i=[],a=encodeURIComponent,s=function(t,e){e="function"==typeof e?e():null==e?"":e,i[i.length]=a(t)+"="+a(e)};if(O(t))for(n=0;t&&n<t.length;n+=1)s(t[n].name,t[n].value);else for(r in t)t.hasOwnProperty(r)&&g(r,t[r],o,s);return i.join("&").replace(/%20/g,"+")},l.getcallbackPrefix=function(){return E},l.compat=function(t,e){return t&&(t.type&&(t.method=t.type)&&delete t.type,t.dataType&&(t.type=t.dataType),t.jsonpCallback&&(t.jsonpCallbackName=t.jsonpCallback)&&delete t.jsonpCallback,t.jsonp&&(t.jsonpCallback=t.jsonp)),new u(t,e)},l.ajaxSetup=function(t){t=t||{};for(var e in t)z[e]=t[e]},l},f=2,h=function(t,e){return"undefined"!=typeof e?console.log("[Stargate] "+t+" ",e):console.log("[Stargate] "+t),!0},d=function(t,e){return"undefined"!=typeof e?console.error("[Stargate] "+t+" ",e):console.error("[Stargate] "+t),!1},m={available:!1,cordova:"",manufacturer:"",model:"",platform:"",uuid:"",version:""},y=function(){return"Android"==m.platform},g=function(){return"iOS"==m.platform},v=function(){if("undefined"==typeof window.device)return d("Missing cordova device plugin");for(var t in m)window.device.hasOwnProperty(t)&&(m[t]=window.device[t]);return!0},_=function(){var t=Q.defer();return window.hostedwebapp.getManifest(function(e){t.resolve(e)},function(e){t.reject(new Error(e)),console.error(e)}),t.promise},w=function(t){h("launchUrl: "+t),document.location.href=t},b=!1,A=!1,x=null,S=null,P="",I="",R="",j="",k="",E={},U=function(){if("undefined"==typeof window.StatusBar)return d("[StatusBar] missing cordova plugin");if("undefined"!=typeof z.stausbar&&"undefined"!=typeof z.stausbar.hideOnUrlPattern&&z.stausbar.hideOnUrlPattern.constructor===Array){for(var t=document.location.href,e=!1,r=0;r<z.stausbar.hideOnUrlPattern.length;r++){var n=new RegExp(z.stausbar.hideOnUrlPattern[r]);if(n.test(t)){e=!0;break}}e?window.StatusBar.hide():window.StatusBar.show()}},T=function(){document.title=z.title,U(),D("mfp")&&p.check(),D("deltadna")&&window.deltadna.startSDK(z.deltadna.environmentKey,z.deltadna.collectApi,z.deltadna.engageApi,r,n,z.deltadna.settings),navigator.splashscreen.hide(),q(!1),i.initialize(),document.cookie="hybrid=1; path=/",document.cookie="stargateVersion="+f+"; path=/",null!==window.localStorage.getItem("hybrid")&&window.localStorage.setItem("hybrid",1),null!==window.localStorage.getItem("stargateVersion")&&window.localStorage.setItem("stargateVersion",f),A=!0,x(),S.resolve("Stargate.initialize() done")},O=function(){v(),Q.all([cordova.getAppVersion.getVersionNumber(),_()]).then(function(t){P=t[0],u=t[1].start_url,z=t[1].stargateConf,T()}).fail(function(t){d("onDeviceReady() error: "+t)})},C=!1,q=function(t){t?(C=!0,a()):(C=!1,s())},z={},D=function(t){return"undefined"!=typeof z.features[t]&&z.features[t]};return window.pubKey="",window.forge="",e.initialize=function(t,e,r,n){return b&&Q.defer().reject(new Error("Stargate.initialize() already called!")),b=!0,x=n,S=Q.defer(),t.country&&(I=t.country),t.selector&&(R=t.selector),t.api_selector&&(j=t.api_selector),t.app_prefix&&(k=t.app_prefix),t.hybrid_conf&&(E="object"==typeof t.hybrid_conf?t.hybrid_conf:JSON.parse(decodeURIComponent(t.hybrid_conf))),document.addEventListener("deviceready",O,!1),S.promise},e.isInitialized=function(){return b},e.isOpen=function(){return A},e.openUrl=function(t){return b?void window.open(t,"_system"):d("Stargate not initialized, call Stargate.initialize first!")},e.googleLogin=function(t,e){return b?(d("unimplemented"),void e("unimplemented")):e("Stargate not initialized, call Stargate.initialize first!")},e.checkConnection=function(t,e){if(!b)return e("Stargate not initialized, call Stargate.initialize first!");var r=navigator.connection.type;t({networkState:r})},e.getDeviceID=function(t,e){if(!b)return e("Stargate not initialized, call Stargate.initialize first!");var r=m.uuid;t({deviceID:r})},e.ad=new t,e});