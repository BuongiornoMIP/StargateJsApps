/*!
 * StargateJS Apps
 * v0.1.0
 * Copyright 2015 DMobileLab. http://buongiorno.com/
 * See LICENSE in this repository for license information
 */
!function(e,t){"use strict";"object"==typeof exports?module.exports=t(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],t):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)}(this,function(e,t,r,n){"use strict";function o(e,t){var r=arguments.length>=1,n=arguments.length>=2;if(!(this instanceof o))return r?n?new o(e,t):new o(e):new o;if(void 0===e){if(r)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!=typeof location?location.href+"":""}return this.href(e),void 0!==t?this.absoluteTo(t):this}function i(e){return e.replace(/([.*+?^=!:()|[\]\/\\])/g,"\\$1")}function a(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function s(e){return"Array"===a(e)}function u(e,t){var r,n,o={};if("RegExp"===a(t))o=null;else if(s(t))for(r=0,n=t.length;n>r;r++)o[t[r]]=!0;else o[t]=!0;for(r=0,n=e.length;n>r;r++){var i=o&&void 0!==o[e[r]]||!o&&t.test(e[r]);i&&(e.splice(r,1),n--,r--)}return e}function c(e,t){var r,n;if(s(t)){for(r=0,n=t.length;n>r;r++)if(!c(e,t[r]))return!1;return!0}var o=a(t);for(r=0,n=e.length;n>r;r++)if("RegExp"===o){if("string"==typeof e[r]&&e[r].match(t))return!0}else if(e[r]===t)return!0;return!1}function p(e,t){if(!s(e)||!s(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var r=0,n=e.length;n>r;r++)if(e[r]!==t[r])return!1;return!0}function l(e){var t=/^\/+|\/+$/g;return e.replace(t,"")}function d(e){return escape(e)}function f(e){return encodeURIComponent(e).replace(/[!'()*]/g,d).replace(/\*/g,"%2A")}function h(e){return function(t,r){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!r),this)}}function g(e,t){return function(r,n){return void 0===r?this._parts[e]||"":(null!==r&&(r+="",r.charAt(0)===t&&(r=r.substring(1))),this._parts[e]=r,this.build(!n),this)}}var m=n&&n.URI;o.version="1.17.0";var y=o.prototype,v=Object.prototype.hasOwnProperty;o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\.-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/},o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return o.domAttributes[t]}},o.encode=f,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=f,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(e,t){var r=o.encode(e+"");return void 0===t&&(t=o.escapeQuerySpace),t?r.replace(/%20/g,"+"):r},o.decodeQuery=function(e,t){e+="",void 0===t&&(t=o.escapeQuerySpace);try{return o.decode(t?e.replace(/\+/g,"%20"):e)}catch(r){return e}};var b,w={encode:"encode",decode:"decode"},A=function(e,t){return function(r){try{return o[t](r+"").replace(o.characters[e][t].expression,function(r){return o.characters[e][t].map[r]})}catch(n){return r}}};for(b in w)o[b+"PathSegment"]=A("pathname",w[b]),o[b+"UrnPathSegment"]=A("urnpath",w[b]);var _=function(e,t,r){return function(n){var i;i=r?function(e){return o[t](o[r](e))}:o[t];for(var a=(n+"").split(e),s=0,u=a.length;u>s;s++)a[s]=i(a[s]);return a.join(e)}};o.decodePath=_("/","decodePathSegment"),o.decodeUrnPath=_(":","decodeUrnPathSegment"),o.recodePath=_("/","encodePathSegment","decode"),o.recodeUrnPath=_(":","encodeUrnPathSegment","decode"),o.encodeReserved=A("reserved","encode"),o.parse=function(e,t){var r;return t||(t={}),r=e.indexOf("#"),r>-1&&(t.fragment=e.substring(r+1)||null,e=e.substring(0,r)),r=e.indexOf("?"),r>-1&&(t.query=e.substring(r+1)||null,e=e.substring(0,r)),"//"===e.substring(0,2)?(t.protocol=null,e=e.substring(2),e=o.parseAuthority(e,t)):(r=e.indexOf(":"),r>-1&&(t.protocol=e.substring(0,r)||null,t.protocol&&!t.protocol.match(o.protocol_expression)?t.protocol=void 0:"//"===e.substring(r+1,r+3)?(e=e.substring(r+3),e=o.parseAuthority(e,t)):(e=e.substring(r+1),t.urn=!0))),t.path=e,t},o.parseHost=function(e,t){e=e.replace(/\\/g,"/");var r,n,o=e.indexOf("/");if(-1===o&&(o=e.length),"["===e.charAt(0))r=e.indexOf("]"),t.hostname=e.substring(1,r)||null,t.port=e.substring(r+2,o)||null,"/"===t.port&&(t.port=null);else{var i=e.indexOf(":"),a=e.indexOf("/"),s=e.indexOf(":",i+1);-1!==s&&(-1===a||a>s)?(t.hostname=e.substring(0,o)||null,t.port=null):(n=e.substring(0,o).split(":"),t.hostname=n[0]||null,t.port=n[1]||null)}return t.hostname&&"/"!==e.substring(o).charAt(0)&&(o++,e="/"+e),e.substring(o)||"/"},o.parseAuthority=function(e,t){return e=o.parseUserinfo(e,t),o.parseHost(e,t)},o.parseUserinfo=function(e,t){var r,n=e.indexOf("/"),i=e.lastIndexOf("@",n>-1?n:e.length-1);return i>-1&&(-1===n||n>i)?(r=e.substring(0,i).split(":"),t.username=r[0]?o.decode(r[0]):null,r.shift(),t.password=r[0]?o.decode(r.join(":")):null,e=e.substring(i+1)):(t.username=null,t.password=null),e},o.parseQuery=function(e,t){if(!e)return{};if(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!e)return{};for(var r,n,i,a={},s=e.split("&"),u=s.length,c=0;u>c;c++)r=s[c].split("="),n=o.decodeQuery(r.shift(),t),i=r.length?o.decodeQuery(r.join("="),t):null,v.call(a,n)?(("string"==typeof a[n]||null===a[n])&&(a[n]=[a[n]]),a[n].push(i)):a[n]=i;return a},o.build=function(e){var t="";return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//"),t+=o.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&"string"==typeof e.hostname&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},o.buildHost=function(e){var t="";return e.hostname?(t+=o.ip6_expression.test(e.hostname)?"["+e.hostname+"]":e.hostname,e.port&&(t+=":"+e.port),t):""},o.buildAuthority=function(e){return o.buildUserinfo(e)+o.buildHost(e)},o.buildUserinfo=function(e){var t="";return e.username&&(t+=o.encode(e.username),e.password&&(t+=":"+o.encode(e.password)),t+="@"),t},o.buildQuery=function(e,t,r){var n,i,a,u,c="";for(i in e)if(v.call(e,i)&&i)if(s(e[i]))for(n={},a=0,u=e[i].length;u>a;a++)void 0!==e[i][a]&&void 0===n[e[i][a]+""]&&(c+="&"+o.buildQueryParameter(i,e[i][a],r),t!==!0&&(n[e[i][a]+""]=!0));else void 0!==e[i]&&(c+="&"+o.buildQueryParameter(i,e[i],r));return c.substring(1)},o.buildQueryParameter=function(e,t,r){return o.encodeQuery(e,r)+(null!==t?"="+o.encodeQuery(t,r):"")},o.addQuery=function(e,t,r){if("object"==typeof t)for(var n in t)v.call(t,n)&&o.addQuery(e,n,t[n]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=r);"string"==typeof e[t]&&(e[t]=[e[t]]),s(r)||(r=[r]),e[t]=(e[t]||[]).concat(r)}},o.removeQuery=function(e,t,r){var n,i,c;if(s(t))for(n=0,i=t.length;i>n;n++)e[t[n]]=void 0;else if("RegExp"===a(t))for(c in e)t.test(c)&&(e[c]=void 0);else if("object"==typeof t)for(c in t)v.call(t,c)&&o.removeQuery(e,c,t[c]);else{if("string"!=typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==r?"RegExp"===a(r)?!s(e[t])&&r.test(e[t])?e[t]=void 0:e[t]=u(e[t],r):e[t]!==String(r)||s(r)&&1!==r.length?s(e[t])&&(e[t]=u(e[t],r)):e[t]=void 0:e[t]=void 0}},o.hasQuery=function(e,t,r,n){if("object"==typeof t){for(var i in t)if(v.call(t,i)&&!o.hasQuery(e,i,t[i]))return!1;return!0}if("string"!=typeof t)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(a(r)){case"Undefined":return t in e;case"Boolean":var u=Boolean(s(e[t])?e[t].length:e[t]);return r===u;case"Function":return!!r(e[t],t,e);case"Array":if(!s(e[t]))return!1;var l=n?c:p;return l(e[t],r);case"RegExp":return s(e[t])?n?c(e[t],r):!1:Boolean(e[t]&&e[t].match(r));case"Number":r=String(r);case"String":return s(e[t])?n?c(e[t],r):!1:e[t]===r;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.commonPath=function(e,t){var r,n=Math.min(e.length,t.length);for(r=0;n>r;r++)if(e.charAt(r)!==t.charAt(r)){r--;break}return 1>r?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":(("/"!==e.charAt(r)||"/"!==t.charAt(r))&&(r=e.substring(0,r).lastIndexOf("/")),e.substring(0,r+1))},o.withinString=function(e,t,r){r||(r={});var n=r.start||o.findUri.start,i=r.end||o.findUri.end,a=r.trim||o.findUri.trim,s=/[a-z0-9-]=["']?$/i;for(n.lastIndex=0;;){var u=n.exec(e);if(!u)break;var c=u.index;if(r.ignoreHtml){var p=e.slice(Math.max(c-3,0),c);if(p&&s.test(p))continue}var l=c+e.slice(c).search(i),d=e.slice(c,l).replace(a,"");if(!r.ignore||!r.ignore.test(d)){l=c+d.length;var f=t(d,c,l,e);e=e.slice(0,c)+f+e.slice(l),n.lastIndex=c+f.length}}return n.lastIndex=0,e},o.ensureValidHostname=function(t){if(t.match(o.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(e.toASCII(t).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]')}},o.noConflict=function(e){if(e){var t={URI:this.noConflict()};return n.URITemplate&&"function"==typeof n.URITemplate.noConflict&&(t.URITemplate=n.URITemplate.noConflict()),n.IPv6&&"function"==typeof n.IPv6.noConflict&&(t.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&"function"==typeof n.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=n.SecondLevelDomains.noConflict()),t}return n.URI===this&&(n.URI=m),this},y.build=function(e){return e===!0?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},y.clone=function(){return new o(this)},y.valueOf=y.toString=function(){return this.build(!1)._string},y.protocol=h("protocol"),y.username=h("username"),y.password=h("password"),y.hostname=h("hostname"),y.port=h("port"),y.query=g("query","?"),y.fragment=g("fragment","#"),y.search=function(e,t){var r=this.query(e,t);return"string"==typeof r&&r.length?"?"+r:r},y.hash=function(e,t){var r=this.fragment(e,t);return"string"==typeof r&&r.length?"#"+r:r},y.pathname=function(e,t){if(void 0===e||e===!0){var r=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?o.decodeUrnPath:o.decodePath)(r):r}return this._parts.urn?this._parts.path=e?o.recodeUrnPath(e):"":this._parts.path=e?o.recodePath(e):"/",this.build(!t),this},y.path=y.pathname,y.href=function(e,t){var r;if(void 0===e)return this.toString();this._string="",this._parts=o._parts();var n=e instanceof o,i="object"==typeof e&&(e.hostname||e.path||e.pathname);if(e.nodeName){var a=o.getDomAttribute(e);e=e[a]||"",i=!1}if(!n&&i&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=o.parse(String(e),this._parts);else{if(!n&&!i)throw new TypeError("invalid input");var s=n?e._parts:e;for(r in s)v.call(this._parts,r)&&(this._parts[r]=s[r])}return this.build(!t),this},y.is=function(e){var t=!1,n=!1,i=!1,a=!1,s=!1,u=!1,c=!1,p=!this._parts.urn;switch(this._parts.hostname&&(p=!1,n=o.ip4_expression.test(this._parts.hostname),i=o.ip6_expression.test(this._parts.hostname),t=n||i,a=!t,s=a&&r&&r.has(this._parts.hostname),u=a&&o.idn_expression.test(this._parts.hostname),c=a&&o.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return p;case"absolute":return!p;case"domain":case"name":return a;case"sld":return s;case"ip":return t;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return i;case"idn":return u;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return c}return null};var P=y.protocol,S=y.port,x=y.hostname;y.protocol=function(e,t){if(void 0!==e&&e&&(e=e.replace(/:(\/\/)?$/,""),!e.match(o.protocol_expression)))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return P.call(this,e,t)},y.scheme=y.protocol,y.port=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e&&(0===e&&(e=null),e&&(e+="",":"===e.charAt(0)&&(e=e.substring(1)),e.match(/[^0-9]/))))throw new TypeError('Port "'+e+'" contains characters other than [0-9]');return S.call(this,e,t)},y.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var r={},n=o.parseHost(e,r);if("/"!==n)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=r.hostname}return x.call(this,e,t)},y.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var r=this.protocol(),n=this.authority();return n?(r?r+"://":"")+this.authority():""}var i=o(e);return this.protocol(i.protocol()).authority(i.authority()).build(!t),this},y.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?o.buildHost(this._parts):"";var r=o.parseHost(e,this._parts);if("/"!==r)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},y.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?o.buildAuthority(this._parts):"";var r=o.parseAuthority(e,this._parts);if("/"!==r)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},y.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.username)return"";var r=o.buildUserinfo(this._parts);return r.substring(0,r.length-1)}return"@"!==e[e.length-1]&&(e+="@"),o.parseUserinfo(e,this._parts),this.build(!t),this},y.resource=function(e,t){var r;return void 0===e?this.path()+this.search()+this.hash():(r=o.parse(e),this._parts.path=r.path,this._parts.query=r.query,this._parts.fragment=r.fragment,this.build(!t),this)},y.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,r)||""}var n=this._parts.hostname.length-this.domain().length,a=this._parts.hostname.substring(0,n),s=new RegExp("^"+i(a));return e&&"."!==e.charAt(e.length-1)&&(e+="."),e&&o.ensureValidHostname(e),this._parts.hostname=this._parts.hostname.replace(s,e),this.build(!t),this},y.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.match(/\./g);if(r&&r.length<2)return this._parts.hostname;var n=this._parts.hostname.length-this.tld(t).length-1;return n=this._parts.hostname.lastIndexOf(".",n-1)+1,this._parts.hostname.substring(n)||""}if(!e)throw new TypeError("cannot set domain empty");if(o.ensureValidHostname(e),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var a=new RegExp(i(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(a,e)}return this.build(!t),this},y.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.lastIndexOf("."),o=this._parts.hostname.substring(n+1);return t!==!0&&r&&r.list[o.toLowerCase()]?r.get(this._parts.hostname)||o:o}var a;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!r||!r.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');a=new RegExp(i(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");a=new RegExp(i(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,e)}return this.build(!t),this},y.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||e===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var r=this._parts.path.length-this.filename().length-1,n=this._parts.path.substring(0,r)||(this._parts.hostname?"/":"");return e?o.decodePath(n):n}var a=this._parts.path.length-this.filename().length,s=this._parts.path.substring(0,a),u=new RegExp("^"+i(s));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=o.recodePath(e),this._parts.path=this._parts.path.replace(u,e),this.build(!t),this},y.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||e===!0){if(!this._parts.path||"/"===this._parts.path)return"";var r=this._parts.path.lastIndexOf("/"),n=this._parts.path.substring(r+1);return e?o.decodePathSegment(n):n}var a=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(a=!0);var s=new RegExp(i(this.filename())+"$");return e=o.recodePath(e),this._parts.path=this._parts.path.replace(s,e),a?this.normalizePath(t):this.build(!t),this},y.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||e===!0){if(!this._parts.path||"/"===this._parts.path)return"";var r,n,a=this.filename(),s=a.lastIndexOf(".");return-1===s?"":(r=a.substring(s+1),n=/^[a-z0-9%]+$/i.test(r)?r:"",e?o.decodePathSegment(n):n)}"."===e.charAt(0)&&(e=e.substring(1));var u,c=this.suffix();if(c)u=e?new RegExp(i(c)+"$"):new RegExp(i("."+c)+"$");else{if(!e)return this;this._parts.path+="."+o.recodePath(e)}return u&&(e=o.recodePath(e),this._parts.path=this._parts.path.replace(u,e)),this.build(!t),this},y.segment=function(e,t,r){var n=this._parts.urn?":":"/",o=this.path(),i="/"===o.substring(0,1),a=o.split(n);if(void 0!==e&&"number"!=typeof e&&(r=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(i&&a.shift(),0>e&&(e=Math.max(a.length+e,0)),void 0===t)return void 0===e?a:a[e];if(null===e||void 0===a[e])if(s(t)){a=[];for(var u=0,c=t.length;c>u;u++)(t[u].length||a.length&&a[a.length-1].length)&&(a.length&&!a[a.length-1].length&&a.pop(),a.push(l(t[u])))}else(t||"string"==typeof t)&&(t=l(t),""===a[a.length-1]?a[a.length-1]=t:a.push(t));else t?a[e]=l(t):a.splice(e,1);return i&&a.unshift(""),this.path(a.join(n),r)},y.segmentCoded=function(e,t,r){var n,i,a;if("number"!=typeof e&&(r=t,t=e,e=void 0),void 0===t){if(n=this.segment(e,t,r),s(n))for(i=0,a=n.length;a>i;i++)n[i]=o.decode(n[i]);else n=void 0!==n?o.decode(n):void 0;return n}if(s(t))for(i=0,a=t.length;a>i;i++)t[i]=o.encode(t[i]);else t="string"==typeof t||t instanceof String?o.encode(t):t;return this.segment(e,t,r)};var R=y.query;return y.query=function(e,t){if(e===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var r=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),n=e.call(this,r);return this._parts.query=o.buildQuery(n||r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=o.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):R.call(this,e,t)},y.setQuery=function(e,t,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)n[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in e)v.call(e,i)&&(n[i]=e[i])}return this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(r=t),this.build(!r),this},y.addQuery=function(e,t,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(n,e,void 0===t?null:t),this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(r=t),this.build(!r),this},y.removeQuery=function(e,t,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(n,e,t),this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(r=t),this.build(!r),this},y.hasQuery=function(e,t,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(n,e,t,r)},y.setSearch=y.setQuery,y.addSearch=y.addQuery,y.removeSearch=y.removeQuery,y.hasSearch=y.hasQuery,y.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},y.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},y.normalizeHostname=function(r){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!r)),this},y.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},y.normalizePath=function(e){var t=this._parts.path;if(!t)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;var r,n,i,a="";for("/"!==t.charAt(0)&&(r=!0,t="/"+t),("/.."===t.slice(-3)||"/."===t.slice(-2))&&(t+="/"),t=t.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),r&&(a=t.substring(1).match(/^(\.\.\/)+/)||"",a&&(a=a[0]));;){if(n=t.indexOf("/.."),-1===n)break;0!==n?(i=t.substring(0,n).lastIndexOf("/"),-1===i&&(i=n),t=t.substring(0,i)+t.substring(n+3)):t=t.substring(3)}return r&&this.is("relative")&&(t=a+t.substring(1)),t=o.recodePath(t),this._parts.path=t,this.build(!e),this},y.normalizePathname=y.normalizePath,y.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},y.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},y.normalizeSearch=y.normalizeQuery,y.normalizeHash=y.normalizeFragment,y.iso8859=function(){var e=o.encode,t=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=e,o.decode=t}return this},y.unicode=function(){var e=o.encode,t=o.decode;o.encode=f,o.decode=unescape;try{this.normalize()}finally{o.encode=e,o.decode=t}return this},y.readable=function(){var t=this.clone();t.username("").password("").normalize();var r="";if(t._parts.protocol&&(r+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(r+=e.toUnicode(t._parts.hostname),t._parts.port&&(r+=":"+t._parts.port)):r+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(r+="/"),r+=t.path(!0),t._parts.query){for(var n="",i=0,a=t._parts.query.split("&"),s=a.length;s>i;i++){var u=(a[i]||"").split("=");n+="&"+o.decodeQuery(u[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==u[1]&&(n+="="+o.decodeQuery(u[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}r+="?"+n.substring(1)}return r+=o.decodeQuery(t.hash(),!0)},y.absoluteTo=function(e){var t,r,n,i=this.clone(),a=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof o||(e=new o(e)),i._parts.protocol||(i._parts.protocol=e._parts.protocol),this._parts.hostname)return i;for(r=0;n=a[r];r++)i._parts[n]=e._parts[n];return i._parts.path?".."===i._parts.path.substring(-2)&&(i._parts.path+="/"):(i._parts.path=e._parts.path,i._parts.query||(i._parts.query=e._parts.query)),"/"!==i.path().charAt(0)&&(t=e.directory(),t=t?t:0===e.path().indexOf("/")?"/":"",i._parts.path=(t?t+"/":"")+i._parts.path,i.normalizePath()),i.build(),i},y.relativeTo=function(e){var t,r,n,i,a,s=this.clone().normalize();if(s._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new o(e).normalize(),t=s._parts,r=e._parts,i=s.path(),a=e.path(),"/"!==i.charAt(0))throw new Error("URI is already relative");if("/"!==a.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===r.protocol&&(t.protocol=null),t.username!==r.username||t.password!==r.password)return s.build();if(null!==t.protocol||null!==t.username||null!==t.password)return s.build();if(t.hostname!==r.hostname||t.port!==r.port)return s.build();if(t.hostname=null,t.port=null,i===a)return t.path="",s.build();if(n=o.commonPath(i,a),!n)return s.build();var u=r.path.substring(n.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=u+t.path.substring(n.length)||"./",s.build()},y.equals=function(e){var t,r,n,i=this.clone(),a=new o(e),u={},c={},l={};if(i.normalize(),a.normalize(),i.toString()===a.toString())return!0;if(t=i.query(),r=a.query(),i.query(""),a.query(""),i.toString()!==a.toString())return!1;if(t.length!==r.length)return!1;u=o.parseQuery(t,this._parts.escapeQuerySpace),c=o.parseQuery(r,this._parts.escapeQuerySpace);for(n in u)if(v.call(u,n)){if(s(u[n])){if(!p(u[n],c[n]))return!1}else if(u[n]!==c[n])return!1;l[n]=!0}for(n in c)if(v.call(c,n)&&!l[n])return!1;return!0},y.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},y.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},o}),function(e,t){"use strict";"object"==typeof exports?module.exports=t(require("./URI")):"function"==typeof define&&define.amd?define(["./URI"],t):e.URITemplate=t(e.URI,e)}(this,function(e,t){"use strict";function r(e){return r._cache[e]?r._cache[e]:this instanceof r?(this.expression=e,r._cache[e]=this,this):new r(e)}function n(e){this.data=e,this.cache={}}var o=t&&t.URITemplate,i=Object.prototype.hasOwnProperty,a=r.prototype,s={"":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encode"},"+":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},"#":{prefix:"#",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},".":{prefix:".",separator:".",named:!1,empty_name_separator:!1,encode:"encode"},"/":{prefix:"/",separator:"/",named:!1,empty_name_separator:!1,encode:"encode"},";":{prefix:";",separator:";",named:!0,empty_name_separator:!1,encode:"encode"},"?":{prefix:"?",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"},"&":{prefix:"&",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"}};return r._cache={},r.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g,r.VARIABLE_PATTERN=/^([^*:]+)((\*)|:(\d+))?$/,r.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_]/,r.expand=function(e,t){var n,o,i,a=s[e.operator],u=a.named?"Named":"Unnamed",c=e.variables,p=[];for(i=0;o=c[i];i++)n=t.get(o.name),n.val.length?p.push(r["expand"+u](n,a,o.explode,o.explode&&a.separator||",",o.maxlength,o.name)):n.type&&p.push("");return p.length?a.prefix+p.join(a.separator):""},r.expandNamed=function(t,r,n,o,i,a){var s,u,c,p="",l=r.encode,d=r.empty_name_separator,f=!t[l].length,h=2===t.type?"":e[l](a);for(u=0,c=t.val.length;c>u;u++)i?(s=e[l](t.val[u][1].substring(0,i)),2===t.type&&(h=e[l](t.val[u][0].substring(0,i)))):f?(s=e[l](t.val[u][1]),2===t.type?(h=e[l](t.val[u][0]),t[l].push([h,s])):t[l].push([void 0,s])):(s=t[l][u][1],2===t.type&&(h=t[l][u][0])),p&&(p+=o),n?p+=h+(d||s?"=":"")+s:(u||(p+=e[l](a)+(d||s?"=":"")),2===t.type&&(p+=h+","),p+=s);return p},r.expandUnnamed=function(t,r,n,o,i){var a,s,u,c,p="",l=r.encode,d=r.empty_name_separator,f=!t[l].length;for(u=0,c=t.val.length;c>u;u++)i?s=e[l](t.val[u][1].substring(0,i)):f?(s=e[l](t.val[u][1]),t[l].push([2===t.type?e[l](t.val[u][0]):void 0,s])):s=t[l][u][1],p&&(p+=o),2===t.type&&(a=i?e[l](t.val[u][0].substring(0,i)):t[l][u][0],p+=a,p+=n?d||s?"=":"":","),p+=s;return p},r.noConflict=function(){return t.URITemplate===r&&(t.URITemplate=o),r},a.expand=function(e){var t="";this.parts&&this.parts.length||this.parse(),e instanceof n||(e=new n(e));for(var o=0,i=this.parts.length;i>o;o++)t+="string"==typeof this.parts[o]?this.parts[o]:r.expand(this.parts[o],e);return t},a.parse=function(){var e,t,n,o=this.expression,i=r.EXPRESSION_PATTERN,a=r.VARIABLE_PATTERN,u=r.VARIABLE_NAME_PATTERN,c=[],p=0;for(i.lastIndex=0;;){if(t=i.exec(o),null===t){c.push(o.substring(p));break}if(c.push(o.substring(p,t.index)),p=t.index+t[0].length,!s[t[1]])throw new Error('Unknown Operator "'+t[1]+'" in "'+t[0]+'"');if(!t[3])throw new Error('Unclosed Expression "'+t[0]+'"');e=t[2].split(",");for(var l=0,d=e.length;d>l;l++){if(n=e[l].match(a),null===n)throw new Error('Invalid Variable "'+e[l]+'" in "'+t[0]+'"');if(n[1].match(u))throw new Error('Invalid Variable Name "'+n[1]+'" in "'+t[0]+'"');e[l]={name:n[1],explode:!!n[3],maxlength:n[4]&&parseInt(n[4],10)}}if(!e.length)throw new Error('Expression Missing Variable(s) "'+t[0]+'"');c.push({expression:t[0],operator:t[1],variables:e})}return c.length||c.push(o),this.parts=c,this},n.prototype.get=function(e){var t,r,n,o=this.data,a={type:0,val:[],encode:[],encodeReserved:[]};if(void 0!==this.cache[e])return this.cache[e];if(this.cache[e]=a,n="[object Function]"===String(Object.prototype.toString.call(o))?o(e):"[object Function]"===String(Object.prototype.toString.call(o[e]))?o[e](e):o[e],
void 0===n||null===n)return a;if("[object Array]"===String(Object.prototype.toString.call(n))){for(t=0,r=n.length;r>t;t++)void 0!==n[t]&&null!==n[t]&&a.val.push([void 0,String(n[t])]);a.val.length&&(a.type=3)}else if("[object Object]"===String(Object.prototype.toString.call(n))){for(t in n)i.call(n,t)&&void 0!==n[t]&&null!==n[t]&&a.val.push([t,String(n[t])]);a.val.length&&(a.type=2)}else a.type=1,a.val.push([void 0,String(n)]);return a},e.expand=function(t,n){var o=new r(t),i=o.expand(n);return new e(i)},r}),function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function e(e){return function(){return X.apply(e,arguments)}}function t(e){return e===Object(e)}function r(e){return"[object StopIteration]"===te(e)||e instanceof F}function n(e,t){if(N&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(re)){for(var r=[],n=t;n;n=n.source)n.stack&&r.unshift(n.stack);r.unshift(e.stack);var i=r.join("\n"+re+"\n");e.stack=o(i)}}function o(e){for(var t=e.split("\n"),r=[],n=0;n<t.length;++n){var o=t[n];s(o)||i(o)||!o||r.push(o)}return r.join("\n")}function i(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function a(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var r=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(r)return[r[1],Number(r[2])];var n=/.*@(.+):(\d+)$/.exec(e);return n?[n[1],Number(n[2])]:void 0}function s(e){var t=a(e);if(!t)return!1;var r=t[0],n=t[1];return r===B&&n>=H&&ae>=n}function u(){if(N)try{throw new Error}catch(e){var t=e.stack.split("\n"),r=t[0].indexOf("@")>0?t[1]:t[2],n=a(r);if(!n)return;return B=n[0],n[1]}}function c(e,t,r){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+r+" instead.",new Error("").stack),e.apply(e,arguments)}}function p(e){return y(e)?e:v(e)?I(e):R(e)}function l(){function e(e){t=e,i.source=e,J(r,function(t,r){$(function(){e.promiseDispatch.apply(e,r)})},void 0),r=void 0,n=void 0}var t,r=[],n=[],o=W(l.prototype),i=W(h.prototype);if(i.promiseDispatch=function(e,o,i){var a=G(arguments);r?(r.push(a),"when"===o&&i[1]&&n.push(i[1])):$(function(){t.promiseDispatch.apply(t,a)})},i.valueOf=function(){if(r)return i;var e=m(t);return y(e)&&(t=e),e},i.inspect=function(){return t?t.inspect():{state:"pending"}},p.longStackSupport&&N)try{throw new Error}catch(a){i.stack=a.stack.substring(a.stack.indexOf("\n")+1)}return o.promise=i,o.resolve=function(r){t||e(p(r))},o.fulfill=function(r){t||e(R(r))},o.reject=function(r){t||e(x(r))},o.notify=function(e){t||J(n,function(t,r){$(function(){r(e)})},void 0)},o}function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=l();try{e(t.resolve,t.reject,t.notify)}catch(r){t.reject(r)}return t.promise}function f(e){return d(function(t,r){for(var n=0,o=e.length;o>n;n++)p(e[n]).then(t,r)})}function h(e,t,r){void 0===t&&(t=function(e){return x(new Error("Promise does not support operation: "+e))}),void 0===r&&(r=function(){return{state:"unknown"}});var n=W(h.prototype);if(n.promiseDispatch=function(r,o,i){var a;try{a=e[o]?e[o].apply(n,i):t.call(n,o,i)}catch(s){a=x(s)}r&&r(a)},n.inspect=r,r){var o=r();"rejected"===o.state&&(n.exception=o.reason),n.valueOf=function(){var e=r();return"pending"===e.state||"rejected"===e.state?n:e.value}}return n}function g(e,t,r,n){return p(e).then(t,r,n)}function m(e){if(y(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function y(e){return t(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function v(e){return t(e)&&"function"==typeof e.then}function b(e){return y(e)&&"pending"===e.inspect().state}function w(e){return!y(e)||"fulfilled"===e.inspect().state}function A(e){return y(e)&&"rejected"===e.inspect().state}function _(){ne.length=0,oe.length=0,ie||(ie=!0)}function P(e,t){ie&&(oe.push(e),t&&"undefined"!=typeof t.stack?ne.push(t.stack):ne.push("(no stack) "+t))}function S(e){if(ie){var t=Z(oe,e);-1!==t&&(oe.splice(t,1),ne.splice(t,1))}}function x(e){var t=h({when:function(t){return t&&S(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return P(t,e),t}function R(e){return h({when:function(){return e},get:function(t){return e[t]},set:function(t,r){e[t]=r},"delete":function(t){delete e[t]},post:function(t,r){return null===t||void 0===t?e.apply(void 0,r):e[t].apply(e,r)},apply:function(t,r){return e.apply(t,r)},keys:function(){return ee(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function I(e){var t=l();return $(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(r){t.reject(r)}}),t.promise}function E(e){return h({isDef:function(){}},function(t,r){return j(e,t,r)},function(){return p(e).inspect()})}function C(e,t,r){return p(e).spread(t,r)}function O(e){return function(){function t(e,t){var a;if("undefined"==typeof StopIteration){try{a=n[e](t)}catch(s){return x(s)}return a.done?a.value:g(a.value,o,i)}try{a=n[e](t)}catch(s){return r(s)?s.value:x(s)}return g(a,o,i)}var n=e.apply(this,arguments),o=t.bind(t,"next"),i=t.bind(t,"throw");return o()}}function k(e){p.done(p.async(e)())}function T(e){throw new F(e)}function M(e){return function(){return C([this,D(arguments)],function(t,r){return e.apply(t,r)})}}function j(e,t,r){return p(e).dispatch(t,r)}function D(e){return g(e,function(e){var t=0,r=l();return J(e,function(n,o,i){var a;y(o)&&"fulfilled"===(a=o.inspect()).state?e[i]=a.value:(++t,g(o,function(n){e[i]=n,0===--t&&r.resolve(e)},r.reject,function(e){r.notify({index:i,value:e})}))},void 0),0===t&&r.resolve(e),r.promise})}function U(e){return g(e,function(e){return e=Y(e,p),g(D(Y(e,function(e){return g(e,V,V)})),function(){return e})})}function q(e){return p(e).allSettled()}function Q(e,t){return p(e).then(void 0,void 0,t)}function L(e,t){return p(e).nodeify(t)}var N=!1;try{throw new Error}catch(z){N=!!z.stack}var B,F,H=u(),V=function(){},$=function(){function e(){for(;t.next;){t=t.next;var r=t.task;t.task=void 0;var o=t.domain;o&&(t.domain=void 0,o.enter());try{r()}catch(a){if(i)throw o&&o.exit(),setTimeout(e,0),o&&o.enter(),a;setTimeout(function(){throw a},0)}o&&o.exit()}n=!1}var t={task:void 0,next:null},r=t,n=!1,o=void 0,i=!1;if($=function(e){r=r.next={task:e,domain:i&&process.domain,next:null},n||(n=!0,o())},"undefined"!=typeof process&&process.nextTick)i=!0,o=function(){process.nextTick(e)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var a=new MessageChannel;a.port1.onmessage=function(){o=s,a.port1.onmessage=e,e()};var s=function(){a.port2.postMessage(0)};o=function(){setTimeout(e,0),s()}}else o=function(){setTimeout(e,0)};return $}(),X=Function.call,G=e(Array.prototype.slice),J=e(Array.prototype.reduce||function(e,t){var r=0,n=this.length;if(1===arguments.length)for(;;){if(r in this){t=this[r++];break}if(++r>=n)throw new TypeError}for(;n>r;r++)r in this&&(t=e(t,this[r],r));return t}),Z=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),Y=e(Array.prototype.map||function(e,t){var r=this,n=[];return J(r,function(o,i,a){n.push(e.call(t,i,a,r))},void 0),n}),W=Object.create||function(e){function t(){}return t.prototype=e,new t},K=e(Object.prototype.hasOwnProperty),ee=Object.keys||function(e){var t=[];for(var r in e)K(e,r)&&t.push(r);return t},te=e(Object.prototype.toString);F="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var re="From previous event:";p.resolve=p,p.nextTick=$,p.longStackSupport=!1,p.defer=l,l.prototype.makeNodeResolver=function(){var e=this;return function(t,r){t?e.reject(t):arguments.length>2?e.resolve(G(arguments,1)):e.resolve(r)}},p.Promise=d,p.promise=d,d.race=f,d.all=D,d.reject=x,d.resolve=p,p.passByCopy=function(e){return e},h.prototype.passByCopy=function(){return this},p.join=function(e,t){return p(e).join(t)},h.prototype.join=function(e){return p([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},p.race=f,h.prototype.race=function(){return this.then(p.race)},p.makePromise=h,h.prototype.toString=function(){return"[object Promise]"},h.prototype.then=function(e,t,r){function o(t){try{return"function"==typeof e?e(t):t}catch(r){return x(r)}}function i(e){if("function"==typeof t){n(e,s);try{return t(e)}catch(r){return x(r)}}return x(e)}function a(e){return"function"==typeof r?r(e):e}var s=this,u=l(),c=!1;return $(function(){s.promiseDispatch(function(e){c||(c=!0,u.resolve(o(e)))},"when",[function(e){c||(c=!0,u.resolve(i(e)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(e){var t,r=!1;try{t=a(e)}catch(n){if(r=!0,!p.onerror)throw n;p.onerror(n)}r||u.notify(t)}]),u.promise},p.when=g,h.prototype.thenResolve=function(e){return this.then(function(){return e})},p.thenResolve=function(e,t){return p(e).thenResolve(t)},h.prototype.thenReject=function(e){return this.then(function(){throw e})},p.thenReject=function(e,t){return p(e).thenReject(t)},p.nearer=m,p.isPromise=y,p.isPromiseAlike=v,p.isPending=b,h.prototype.isPending=function(){return"pending"===this.inspect().state},p.isFulfilled=w,h.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},p.isRejected=A,h.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ne=[],oe=[],ie=!0;p.resetUnhandledRejections=_,p.getUnhandledReasons=function(){return ne.slice()},p.stopUnhandledRejectionTracking=function(){_(),ie=!1},_(),p.reject=x,p.fulfill=R,p.master=E,p.spread=C,h.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},p.async=O,p.spawn=k,p["return"]=T,p.promised=M,p.dispatch=j,h.prototype.dispatch=function(e,t){var r=this,n=l();return $(function(){r.promiseDispatch(n.resolve,e,t)}),n.promise},p.get=function(e,t){return p(e).dispatch("get",[t])},h.prototype.get=function(e){return this.dispatch("get",[e])},p.set=function(e,t,r){return p(e).dispatch("set",[t,r])},h.prototype.set=function(e,t){return this.dispatch("set",[e,t])},p.del=p["delete"]=function(e,t){return p(e).dispatch("delete",[t])},h.prototype.del=h.prototype["delete"]=function(e){return this.dispatch("delete",[e])},p.mapply=p.post=function(e,t,r){return p(e).dispatch("post",[t,r])},h.prototype.mapply=h.prototype.post=function(e,t){return this.dispatch("post",[e,t])},p.send=p.mcall=p.invoke=function(e,t){return p(e).dispatch("post",[t,G(arguments,2)])},h.prototype.send=h.prototype.mcall=h.prototype.invoke=function(e){return this.dispatch("post",[e,G(arguments,1)])},p.fapply=function(e,t){return p(e).dispatch("apply",[void 0,t])},h.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},p["try"]=p.fcall=function(e){return p(e).dispatch("apply",[void 0,G(arguments,1)])},h.prototype.fcall=function(){return this.dispatch("apply",[void 0,G(arguments)])},p.fbind=function(e){var t=p(e),r=G(arguments,1);return function(){return t.dispatch("apply",[this,r.concat(G(arguments))])}},h.prototype.fbind=function(){var e=this,t=G(arguments);return function(){return e.dispatch("apply",[this,t.concat(G(arguments))])}},p.keys=function(e){return p(e).dispatch("keys",[])},h.prototype.keys=function(){return this.dispatch("keys",[])},p.all=D,h.prototype.all=function(){return D(this)},p.allResolved=c(U,"allResolved","allSettled"),h.prototype.allResolved=function(){return U(this)},p.allSettled=q,h.prototype.allSettled=function(){return this.then(function(e){return D(Y(e,function(e){function t(){return e.inspect()}return e=p(e),e.then(t,t)}))})},p.fail=p["catch"]=function(e,t){return p(e).then(void 0,t)},h.prototype.fail=h.prototype["catch"]=function(e){return this.then(void 0,e)},p.progress=Q,h.prototype.progress=function(e){return this.then(void 0,void 0,e)},p.fin=p["finally"]=function(e,t){return p(e)["finally"](t)},h.prototype.fin=h.prototype["finally"]=function(e){return e=p(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},p.done=function(e,t,r,n){return p(e).done(t,r,n)},h.prototype.done=function(e,t,r){var o=function(e){$(function(){if(n(e,i),!p.onerror)throw e;p.onerror(e)})},i=e||t||r?this.then(e,t,r):this;"object"==typeof process&&process&&process.domain&&(o=process.domain.bind(o)),i.then(void 0,o)},p.timeout=function(e,t,r){return p(e).timeout(t,r)},h.prototype.timeout=function(e,t){var r=l(),n=setTimeout(function(){r.reject(new Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(n),r.resolve(e)},function(e){clearTimeout(n),r.reject(e)},r.notify),r.promise},p.delay=function(e,t){return void 0===t&&(t=e,e=void 0),p(e).delay(t)},h.prototype.delay=function(e){return this.then(function(t){var r=l();return setTimeout(function(){r.resolve(t)},e),r.promise})},p.nfapply=function(e,t){return p(e).nfapply(t)},h.prototype.nfapply=function(e){var t=l(),r=G(e);return r.push(t.makeNodeResolver()),this.fapply(r).fail(t.reject),t.promise},p.nfcall=function(e){var t=G(arguments,1);return p(e).nfapply(t)},h.prototype.nfcall=function(){var e=G(arguments),t=l();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},p.nfbind=p.denodeify=function(e){var t=G(arguments,1);return function(){var r=t.concat(G(arguments)),n=l();return r.push(n.makeNodeResolver()),p(e).fapply(r).fail(n.reject),n.promise}},h.prototype.nfbind=h.prototype.denodeify=function(){var e=G(arguments);return e.unshift(this),p.denodeify.apply(void 0,e)},p.nbind=function(e,t){var r=G(arguments,2);return function(){function n(){return e.apply(t,arguments)}var o=r.concat(G(arguments)),i=l();return o.push(i.makeNodeResolver()),p(n).fapply(o).fail(i.reject),i.promise}},h.prototype.nbind=function(){var e=G(arguments,0);return e.unshift(this),p.nbind.apply(void 0,e)},p.nmapply=p.npost=function(e,t,r){return p(e).npost(t,r)},h.prototype.nmapply=h.prototype.npost=function(e,t){var r=G(t||[]),n=l();return r.push(n.makeNodeResolver()),this.dispatch("post",[e,r]).fail(n.reject),n.promise},p.nsend=p.nmcall=p.ninvoke=function(e,t){var r=G(arguments,2),n=l();return r.push(n.makeNodeResolver()),p(e).dispatch("post",[t,r]).fail(n.reject),n.promise},h.prototype.nsend=h.prototype.nmcall=h.prototype.ninvoke=function(e){var t=G(arguments,1),r=l();return t.push(r.makeNodeResolver()),this.dispatch("post",[e,t]).fail(r.reject),r.promise},p.nodeify=L,h.prototype.nodeify=function(e){return e?void this.then(function(t){$(function(){e(null,t)})},function(t){$(function(){e(t)})}):this};var ae=u();return p}),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.Stargate=t()}(this,function(){function AdStargate(){this.initialize=function(e,t,r){err("unimplemented"),r("unimplemented")},this.createBanner=function(e,t,r){err("unimplemented"),r("unimplemented")},this.hideBanner=function(e,t,r){err("unimplemented"),r("unimplemented")},this.removeBanner=function(e,t,r){err("unimplemented"),r("unimplemented")},this.showBannerAtSelectedPosition=function(e,t,r){err("unimplemented"),r("unimplemented")},this.showBannerAtGivenXY=function(e,t,r){err("unimplemented"),r("unimplemented")},this.registerAdEvents=function(e,t,r){err("unimplemented"),r("unimplemented")},this.prepareInterstitial=function(e,t,r){err("unimplemented"),r("unimplemented")},this.showInterstitial=function(e,t,r){err("unimplemented"),r("unimplemented")}}function startLoading(){ProgressIndicator.showSimple(!0)}function stopLoading(){ProgressIndicator.hide()}function timeoutLoading(e){startLoading(),setTimeout(function(){stopLoading()},e)}function ab2str(e){return String.fromCharCode.apply(null,new Uint16Array(e))}function str2ab(e){for(var t=new ArrayBuffer(2*e.length),r=new Uint16Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}var stargatePublic={},AdManager={AdMobSupport:!1,MoPubSupport:!1,AdPosition:{NO_CHANGE:0,TOP_LEFT:1,TOP_CENTER:2,TOP_RIGHT:3,LEFT:4,CENTER:5,RIGHT:6,BOTTOM_LEFT:7,BOTTOM_CENTER:8,BOTTOM_RIGHT:9,POS_XY:10},AdSize:{SMART_BANNER:"SMART_BANNER",BANNER:"BANNER",MEDIUM_RECTANGLE:"MEDIUM_RECTANGLE",FULL_BANNER:"FULL_BANNER",LEADERBOARD:"LEADERBOARD",SKYSCRAPER:"SKYSCRAPER"},DefaultOptions:null,initialize:function(e,t,r){return e&&(AdManager.DefaultOptions=e),AdMob&&(AdManager.AdMobSupport=!0,AdManager.initAdMob(e,t,r)),MoPub&&(AdManager.MoPubSupport=!0),!0},isAdMobSupported:function(){return AdManager.AdMobSupport},isMoPubSupported:function(){return AdManager.MoPubSupport},getUserAgent:function(){return/(android)/i.test(navigator.userAgent)?"android":/(ipod|iphone|ipad)/i.test(navigator.userAgent)?"ios":"other"},initAdMob:function(e,t,r){var n={adSize:"BANNER",position:8,bgColor:"black",isTesting:!1,autoShow:!0};AdMob.setOptions(n,t,r)},initMoPub:function(e,t,r){},registerAdEvents:function(e){document.addEventListener("onAdFailLoad",e),document.addEventListener("onAdLoaded",e),document.addEventListener("onAdPresent",e),document.addEventListener("onAdLeaveApp",e),document.addEventListener("onAdDismiss",e)},manageAdEvents:function(e){console.log("error: "+e.error+", reason: "+e.reason+", adNetwork:"+e.adNetwork+", adType:"+e.adType+", adEvent:"+e.adEvent)},createBanner:function(e,t,r){var n={},o=new Array,i=AdManager.getUserAgent();e||AdManager.isObjEmpty(AdManager.DefaultOptions)||(e=AdManager.DefaultOptions),Array.isArray(e)?o=e:o.push(e),o.forEach(function(e){if("default"==e.device||e.device==i){var o=AdManager.getAdSize().toLowerCase();e.overlap&&(n.overlap=e.overlap),e.offsetTopBar&&(n.offsetTopBar=e.offsetTopBar),n.adSize=AdManager.getAdSize(),o&&(n.adId=e[o]),e.position&&(n.position=AdManager.AdPosition[e.position]),e.width&&(n.width=e.width),e.height&&(n.height=e.height),e.autoShow&&(n.autoShow=e.autoShow),"admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?(e.width&&e.height&&(n.adSize="CUSTOM"),AdMob.createBanner(n,t,r)):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.createBanner(n,t,r)}})},showBannerAtSelectedPosition:function(e){var t=new Array,r=AdManager.getUserAgent();e||AdManager.isObjEmpty(AdManager.DefaultOptions)||(e=AdManager.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){("default"==e.device||e.device==r)&&("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showBanner(e.position):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showBanner(e.position))})},showBannerAtGivenXY:function(e){var t=new Array,r=AdManager.getUserAgent();e||AdManager.isObjEmpty(AdManager.DefaultOptions)||(e=AdManager.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){("default"==e.device||e.device==r)&&("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showBannerAtXY(e.x,e.y):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showBannerAtXY(e.x,e.y))})},hideBanner:function(e){var t=new Array,r=AdManager.getUserAgent();e||AdManager.isObjEmpty(AdManager.DefaultOptions)||(e=AdManager.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){("default"==e.device||e.device==r)&&("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.hideBanner():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.hideBanner())})},removeBanner:function(e){var t=new Array,r=AdManager.getUserAgent();e||AdManager.isObjEmpty(AdManager.DefaultOptions)||(e=AdManager.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){("default"==e.device||e.device==r)&&("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.removeBanner():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.removeBanner())})},prepareInterstitial:function(e,t,r){var n={},o=new Array,i=AdManager.getUserAgent();e||AdManager.isObjEmpty(AdManager.DefaultOptions)||(e=AdManager.DefaultOptions),Array.isArray(e)?o=e:o.push(e),o.forEach(function(e){("default"==e.device||e.device==i)&&(e.interstitial&&(n.adId=e.interstitial),e.autoShow&&(n.autoShow=e.autoShow),"admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.prepareInterstitial(n):"mopub"==e.network.toLowerCase()&&MoPub.prepareInterstitial(n,t,r))})},showInterstitial:function(e){var t=new Array,r=AdManager.getUserAgent();e||AdManager.isObjEmpty(AdManager.DefaultOptions)||(e=AdManager.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){("default"==e.device||e.device==r)&&("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showInterstitial():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showInterstitial())})},isObjEmpty:function(e){return 0===Object.keys(e).length},getAdSize:function(){var e=screen.height,t=screen.width;return t>=728&&e>=90?AdManager.AdSize.LEADERBOARD:t>=468&&e>=60?AdManager.AdSize.BANNER:t>=320&&e>=50?AdManager.AdSize.BANNER:void 0}},onDeltaDNAStartedSuccess=function(){deltadna.registerPushCallback(onDeltaDNAPush)},onDeltaDNAStartedError=function(e){err("[DeltaDNA] error: "+e)},onDeltaDNAPush=function(e){ua.Android()&&e.payload&&e.payload.url&&!e.foreground&&launchUrl(e.payload.url),ua.iOS()&&e.url&&launchUrl(e.url)};stargatePublic.facebookLogin=function(e,t,r){facebookConnectPlugin.login(e.split(","),function(e,r){facebookConnectPlugin.getAccessToken(function(e){t({accessToken:e})},function(e){t({error:e})})},function(e){err("Got FB login error:",e),r({error:e})})},stargatePublic.facebookShare=function(e,t,r){var n={method:"share",href:e};facebookConnectPlugin.showDialog(n,function(e){t({message:e})},function(e){err("Got FB share error:",e),r({error:e})})};var IAP={id:"",alias:"",type:"",verbosity:"",paymethod:"",subscribeMethod:"stargate",returnUrl:"",initialize:function(){return window.store?(hybrid_conf.IAP.id&&(IAP.id=hybrid_conf.IAP.id),hybrid_conf.IAP.alias&&(IAP.alias=hybrid_conf.IAP.alias),hybrid_conf.IAP.type&&(IAP.type=hybrid_conf.IAP.type),hybrid_conf.IAP.verbosity&&(IAP.verbosity=hybrid_conf.IAP.verbosity),hybrid_conf.IAP.paymethod&&(IAP.paymethod=hybrid_conf.IAP.paymethod),log("IAP initialize id: "+IAP.id),ua.Android()&&IAP.getGoogleAccount(),store.verbosity=store[IAP.verbosity],store.register({id:IAP.id,alias:IAP.alias,type:store[IAP.type]}),store.when(IAP.alias).approved(function(e){IAP.onPurchaseApproved(e)}),store.when(IAP.alias).verified(function(e){IAP.onPurchaseVerified(e)}),store.when(IAP.alias).updated(function(e){IAP.onProductUpdate(e)}),store.when(IAP.alias).owned(function(e){IAP.onProductOwned(e)}),store.when(IAP.alias).cancelled(function(e){IAP.onCancelledProduct(e)}),store.when(IAP.alias).error(function(e){IAP.error(JSON.stringify(e))}),store.ready(function(){IAP.onStoreReady()}),void store.when("order "+IAP.id).approved(function(e){IAP.onOrderApproved(e)})):void log("Store not available")},getPassword:function(e){return md5("iap."+e+".playme").substr(0,8)},getGoogleAccount:function(){window.accountmanager.getAccounts(IAP.checkGoogleAccount,IAP.error,"com.google")},checkGoogleAccount:function(e){if(e){log("accounts"),log(e);for(var t in e)return window.localStorage.setItem("googleAccount",e[t].email),e[t].email}},onProductUpdate:function(e){log("IAP> Product updated."),log(JSON.stringify(e)),log(e.owned?"Subscribed!":"Not Subscribed")},onPurchaseApproved:function(e){log("IAP> Purchase approved."),log(JSON.stringify(e)),e.finish()},onPurchaseVerified:function(e){log("subscription verified")},onStoreReady:function(){log("\\o/ STORE READY \\o/")},onProductOwned:function(e){if(console.log("IAP > Product Owned."),!e.transaction.id&&ua.iOS())return console.log("IAP > no transaction id"),!1;if(window.localStorage.setItem("product",e),ua.iOS()&&window.localStorage.setItem("transaction_id",e.transaction.id),ua.Android()){var t=e.transaction.purchaseToken+"|"+stargateConf.id+"|"+IAP.id;log("Purchase Token: "+t),window.localStorage.getItem("user_account")||IAP.createUser(e,t)}else storekit.loadReceipts(function(t){log("appStoreReceipt: "+t.appStoreReceipt),window.localStorage.getItem("user_account")||IAP.createUser(e,t.appStoreReceipt)})},onCancelledProduct:function(e){err("UN-IMPLEMENTED!"),log("IAP > Purchase cancelled ##################################")},onOrderApproved:function(e){log("ORDER APPROVED "+IAP.id),e.finish()},error:function(e){err("UN-IMPLEMENTED!"),log("error")},createUser:function(e,t){window.localStorage.setItem("user_account",ua.Android()?window.localStorage.getItem("googleAccount")?window.localStorage.getItem("googleAccount"):t+"@google.com":e.transaction.id+"@itunes.com"),err("UN-IMPLEMENTED!")}},md5=function(){function e(e,t){var a=e[0],s=e[1],u=e[2],c=e[3];a=r(a,s,u,c,t[0],7,-680876936),c=r(c,a,s,u,t[1],12,-389564586),u=r(u,c,a,s,t[2],17,606105819),s=r(s,u,c,a,t[3],22,-1044525330),a=r(a,s,u,c,t[4],7,-176418897),c=r(c,a,s,u,t[5],12,1200080426),u=r(u,c,a,s,t[6],17,-1473231341),s=r(s,u,c,a,t[7],22,-45705983),a=r(a,s,u,c,t[8],7,1770035416),c=r(c,a,s,u,t[9],12,-1958414417),u=r(u,c,a,s,t[10],17,-42063),s=r(s,u,c,a,t[11],22,-1990404162),a=r(a,s,u,c,t[12],7,1804603682),c=r(c,a,s,u,t[13],12,-40341101),u=r(u,c,a,s,t[14],17,-1502002290),s=r(s,u,c,a,t[15],22,1236535329),a=n(a,s,u,c,t[1],5,-165796510),c=n(c,a,s,u,t[6],9,-1069501632),u=n(u,c,a,s,t[11],14,643717713),s=n(s,u,c,a,t[0],20,-373897302),a=n(a,s,u,c,t[5],5,-701558691),c=n(c,a,s,u,t[10],9,38016083),u=n(u,c,a,s,t[15],14,-660478335),s=n(s,u,c,a,t[4],20,-405537848),a=n(a,s,u,c,t[9],5,568446438),c=n(c,a,s,u,t[14],9,-1019803690),u=n(u,c,a,s,t[3],14,-187363961),s=n(s,u,c,a,t[8],20,1163531501),a=n(a,s,u,c,t[13],5,-1444681467),c=n(c,a,s,u,t[2],9,-51403784),u=n(u,c,a,s,t[7],14,1735328473),s=n(s,u,c,a,t[12],20,-1926607734),a=o(a,s,u,c,t[5],4,-378558),c=o(c,a,s,u,t[8],11,-2022574463),u=o(u,c,a,s,t[11],16,1839030562),s=o(s,u,c,a,t[14],23,-35309556),a=o(a,s,u,c,t[1],4,-1530992060),c=o(c,a,s,u,t[4],11,1272893353),u=o(u,c,a,s,t[7],16,-155497632),s=o(s,u,c,a,t[10],23,-1094730640),a=o(a,s,u,c,t[13],4,681279174),c=o(c,a,s,u,t[0],11,-358537222),u=o(u,c,a,s,t[3],16,-722521979),s=o(s,u,c,a,t[6],23,76029189),a=o(a,s,u,c,t[9],4,-640364487),c=o(c,a,s,u,t[12],11,-421815835),u=o(u,c,a,s,t[15],16,530742520),s=o(s,u,c,a,t[2],23,-995338651),a=i(a,s,u,c,t[0],6,-198630844),c=i(c,a,s,u,t[7],10,1126891415),u=i(u,c,a,s,t[14],15,-1416354905),s=i(s,u,c,a,t[5],21,-57434055),a=i(a,s,u,c,t[12],6,1700485571),c=i(c,a,s,u,t[3],10,-1894986606),u=i(u,c,a,s,t[10],15,-1051523),s=i(s,u,c,a,t[1],21,-2054922799),a=i(a,s,u,c,t[8],6,1873313359),c=i(c,a,s,u,t[15],10,-30611744),u=i(u,c,a,s,t[6],15,-1560198380),s=i(s,u,c,a,t[13],21,1309151649),a=i(a,s,u,c,t[4],6,-145523070),c=i(c,a,s,u,t[11],10,-1120210379),u=i(u,c,a,s,t[2],15,718787259),s=i(s,u,c,a,t[9],21,-343485551),e[0]=l(a,e[0]),e[1]=l(s,e[1]),e[2]=l(u,e[2]),e[3]=l(c,e[3])}function t(e,t,r,n,o,i){return t=l(l(t,e),l(n,i)),l(t<<o|t>>>32-o,r)}function r(e,r,n,o,i,a,s){return t(r&n|~r&o,e,r,i,a,s)}function n(e,r,n,o,i,a,s){return t(r&o|n&~o,e,r,i,a,s)}function o(e,r,n,o,i,a,s){return t(r^n^o,e,r,i,a,s)}function i(e,r,n,o,i,a,s){return t(n^(r|~o),e,r,i,a,s)}function a(t){var r,n=t.length,o=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=t.length;r+=64)e(o,s(t.substring(r-64,r)));t=t.substring(r-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<t.length;r++)i[r>>2]|=t.charCodeAt(r)<<(r%4<<3);if(i[r>>2]|=128<<(r%4<<3),r>55)for(e(o,i),r=0;16>r;r++)i[r]=0;return i[14]=8*n,e(o,i),o}function s(e){var t,r=[];for(t=0;64>t;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function u(e){for(var t="",r=0;4>r;r++)t+=d[e>>8*r+4&15]+d[e>>8*r&15];return t}function c(e){for(var t=0;t<e.length;t++)e[t]=u(e[t]);return e.join("")}function p(e){return c(a(unescape(encodeURIComponent(e))))}function l(e,t){return e+t&4294967295}var d="0123456789abcdef".split("");return p}(),MFP={check:function(){country?MFP.get(country):err("Country not defined!")},getContents:function(e,t,r,n){var o={};o.api_country=r,o.country=e,o.fpnamespace=t,n&&(o.extData=n);var i=JSON.stringify(o);return i},getPonyValue:function(e){try{return e.split("=")[1]}catch(t){err(t)}return""},set:function(e,t){var r=baseUrl;window.localStorage.getItem("appUrl")&&(r=window.localStorage.getItem("appUrl"));var n=new URI(baseUrl),o=n.hostname(),i=URITemplate(stargateConf.api.mfpSetUriTemplate).expand({protocol:n.protocol(),hostname:o,url:r,domain:o,_PONY:MFP.getPonyValue(e)});log("MFP going to url: ",i),launchUrl(i)},get:function(e){var t="",r=URITemplate(stargateConf.api.mfpGetUriTemplate).expand({apikey:stargateConf.motime_apikey,contents_inapp:MFP.getContents(e,stargateConf.namespace,stargateConf.label),country:e,expire:t});reqwest({url:r,type:"jsonp",method:"get",error:function(e){err("MFP.get() error: "+e)},success:function(t){log("MFP.get() resp: ",t);var r="";if(t.content.inappInfo){var n=JSON.parse(t.content.inappInfo);n.extData&&n.extData.ponyUrl&&(r=n.extData.ponyUrl),n.extData&&n.extData.return_url&&window.localStorage.setItem("appUrl",n.extData.return_url),MFP.set(r,e)}else log("MFP.get(): Empty session")}})}};!function(e,t,r){"undefined"!=typeof module&&module.exports?module.exports=r():"function"==typeof define&&define.amd?define(r):t[e]=r()}("reqwest",this,function(){function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,r){return function(){return e._aborted?r(e.request):e._timedOut?r(e.request,"Request is aborted: timeout"):void(e.request&&4==e.request[readyState]&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):r(e.request)))}}function setHeaders(e,t){var r,n=t.headers||{};n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var o="undefined"!=typeof FormData&&t.data instanceof FormData;t.crossOrigin||n[requestedWith]||(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||o||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&"setRequestHeader"in e&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){"undefined"!=typeof t.withCredentials&&"undefined"!=typeof e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,r,n){var o=uniqid++,i=e.jsonpCallback||"callback",a=e.jsonpCallbackName||reqwest.getcallbackPrefix(o),s=new RegExp("((^|\\?|&)"+i+")=([^&]+)"),u=n.match(s),c=doc.createElement("script"),p=0,l=-1!==navigator.userAgent.indexOf("MSIE 10.0");return u?"?"===u[3]?n=n.replace(s,"$1="+a):a=u[3]:n=urlappend(n,i+"="+a),context[a]=generalCallback,c.type="text/javascript",c.src=n,c.async=!0,"undefined"==typeof c.onreadystatechange||l||(c.htmlFor=c.id="_reqwest_"+o),c.onload=c.onreadystatechange=function(){return c[readyState]&&"complete"!==c[readyState]&&"loaded"!==c[readyState]||p?!1:(c.onload=c.onreadystatechange=null,c.onclick&&c.onclick(),t(lastValue),lastValue=void 0,head.removeChild(c),void(p=1))},head.appendChild(c),{abort:function(){c.onload=c.onreadystatechange=null,r({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(c),p=1}}}function getRequest(e,t){var r,n=this.o,o=(n.method||"GET").toUpperCase(),i="string"==typeof n?n:n.url,a=n.processData!==!1&&n.data&&"string"!=typeof n.data?reqwest.toQueryString(n.data):n.data||null,s=!1;return"jsonp"!=n.type&&"GET"!=o||!a||(i=urlappend(i,a),a=null),"jsonp"==n.type?handleJsonp(n,e,t,i):(r=n.xhr&&n.xhr(n)||xhr(n),r.open(o,i,n.async===!1?!1:!0),setHeaders(r,n),setCredentials(r,n),context[xDomainRequest]&&r instanceof context[xDomainRequest]?(r.onload=e,r.onerror=t,r.onprogress=function(){},s=!0):r.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(r),s?setTimeout(function(){r.send(a)},200):r.send(a),r)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){return null!==e?e.match("json")?"json":e.match("javascript")?"js":e.match("text")?"html":e.match("xml")?"xml":void 0:void 0;
}function init(o,fn){function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,r){for(e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=r,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(e,t,r);complete(e)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var r,n,o,i,a=e.name,s=e.tagName.toLowerCase(),u=function(e){e&&!e.disabled&&t(a,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(!e.disabled&&a)switch(s){case"input":/reset|button|image|file/i.test(e.type)||(r=/checkbox/i.test(e.type),n=/radio/i.test(e.type),o=e.value,(!(r||n)||e.checked)&&t(a,normalize(r&&""===o?"on":o)));break;case"textarea":t(a,normalize(e.value));break;case"select":if("select-one"===e.type.toLowerCase())u(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(i=0;e.length&&i<e.length;i++)e.options[i].selected&&u(e.options[i])}}function eachFormElement(){var e,t,r=this,n=function(e,t){var n,o,i;for(n=0;n<t.length;n++)for(i=e[byTag](t[n]),o=0;o<i.length;o++)serial(i[o],r)};for(t=0;t<arguments.length;t++)e=arguments[t],/input|select|textarea/i.test(e.tagName)&&serial(e,r),n(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,r){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(r)):e[t]=r},arguments),e}function buildParams(e,t,r,n){var o,i,a,s=/\[\]$/;if(isArray(t))for(i=0;t&&i<t.length;i++)a=t[i],r||s.test(e)?n(e,a):buildParams(e+"["+("object"==typeof a?i:"")+"]",a,r,n);else if(t&&"[object Object]"===t.toString())for(o in t)buildParams(e+"["+o+"]",t[o],r,n);else n(e,t)}var context=this;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{XHR2=require("xhr2")}catch(ex){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=context[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},"catch":function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,r){e.push({name:t,value:r})},arguments),e},reqwest.serialize=function(){if(0===arguments.length)return"";var e,t,r=Array.prototype.slice.call(arguments,0);return e=r.pop(),e&&e.nodeType&&r.push(e)&&(e=null),e&&(e=e.type),t="map"==e?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString,t.apply(null,r)},reqwest.toQueryString=function(e,t){var r,n,o=t||!1,i=[],a=encodeURIComponent,s=function(e,t){t="function"==typeof t?t():null==t?"":t,i[i.length]=a(e)+"="+a(t)};if(isArray(e))for(n=0;e&&n<e.length;n++)s(e[n].name,e[n].value);else for(r in e)e.hasOwnProperty(r)&&buildParams(r,e[r],o,s);return i.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest});var stargateVersion=2,log=function(e,t){return"undefined"!=typeof t?console.log("[Stargate] "+e+" ",t):console.log("[Stargate] "+e),!0},err=function(e,t){return"undefined"!=typeof t?console.error("[Stargate] "+e+" ",t):console.error("[Stargate] "+e),!1},runningDevice={available:!1,cordova:"",manufacturer:"",model:"",platform:"",uuid:"",version:""},isRunningOnAndroid=function(){return"Android"==runningDevice.platform},isRunningOnIos=function(){return"iOS"==runningDevice.platform},isRunningOnCordova=function(){return"undefined"!=typeof window.cordova},initDevice=function(){if("undefined"==typeof window.device)return err("Missing cordova device plugin");for(var e in runningDevice)window.device.hasOwnProperty(e)&&(runningDevice[e]=window.device[e]);return!0};window.pubKey="",window.forge="";var getManifest=function(){var e=Q.defer();return hostedwebapp.getManifest(function(t){e.resolve(t)},function(t){e.reject(new Error(t)),console.error(t)}),e.promise},launchUrl=function(e){log("launchUrl: "+e),document.location.href=e},isStargateInitialized=!1,isStargateOpen=!1,initializeCallback=null,initializeDeferred=null,appVersion="",country="",selector="",api_selector="",app_prefix="",hybrid_conf={},baseUrl,updateStatusBar=function(){if("undefined"==typeof StatusBar)return err("[StatusBar] missing cordova plugin");if("undefined"!=typeof stargateConf.stausbar&&"undefined"!=typeof stargateConf.stausbar.hideOnUrlPattern&&stargateConf.stausbar.hideOnUrlPattern.constructor===Array){for(var e=document.location.href,t=!1,r=0;r<stargateConf.stausbar.hideOnUrlPattern.length;r++){var n=new RegExp(stargateConf.stausbar.hideOnUrlPattern[r]);if(n.test(e)){t=!0;break}}t?StatusBar.hide():StatusBar.show()}},onPluginReady=function(){document.title=stargateConf.title,updateStatusBar(),hasFeature("mfp")&&MFP.check(),hasFeature("deltadna")&&window.deltadna.startSDK(stargateConf.deltadna.environmentKey,stargateConf.deltadna.collectApi,stargateConf.deltadna.engageApi,onDeltaDNAStartedSuccess,onDeltaDNAStartedError,stargateConf.deltadna.settings),navigator.splashscreen.hide(),setBusy(!1),IAP.initialize(),document.cookie="hybrid=1; path=/",document.cookie="stargateVersion="+stargateVersion+"; path=/",null!==window.localStorage.getItem("hybrid")&&window.localStorage.setItem("hybrid",1),null!==window.localStorage.getItem("stargateVersion")&&window.localStorage.setItem("stargateVersion",stargateVersion),isStargateOpen=!0,initializeCallback(),initializeDeferred.resolve("Stargate.initialize() done")},onDeviceReady=function(){initDevice(),Q.all([cordova.getAppVersion.getVersionNumber(),getManifest()]).then(function(e){appVersion=e[0],baseUrl=e[1].start_url,stargateConf=e[1].stargateConf,onPluginReady()}).fail(function(e){err("onDeviceReady() error: "+e)})};stargatePublic.initialize=function(e,t,r,n){return isStargateInitialized&&Q.defer().reject(new Error("Stargate.initialize() already called!")),isStargateInitialized=!0,initializeCallback=n,initializeDeferred=Q.defer(),e.country&&(country=e.country),e.selector&&(selector=e.selector),e.api_selector&&(api_selector=e.api_selector),e.app_prefix&&(app_prefix=e.app_prefix),e.hybrid_conf&&(hybrid_conf="object"==typeof e.hybrid_conf?e.hybrid_conf:JSON.parse(decodeURIComponent(e.hybrid_conf))),document.addEventListener("deviceready",onDeviceReady,!1),initializeDeferred.promise},stargatePublic.isInitialized=function(){return isStargateInitialized},stargatePublic.isOpen=function(){return isStargateOpen},stargatePublic.openUrl=function(e){window.open(e,"_system")},stargatePublic.googleLogin=function(e,t){err("unimplemented"),t("unimplemented")},stargatePublic.checkConnection=function(e,t){var r=navigator.connection.type;e({networkState:r})},stargatePublic.getDeviceID=function(e,t){var r=device.uuid;e({deviceID:r})};var stargateBusy=!1,isBusy=function(){return stargateBusy},setBusy=function(e){e?(stargateBusy=!0,startLoading()):(stargateBusy=!1,stopLoading())},stargateConf={},hasFeature=function(e){return"undefined"!=typeof stargateConf.features[e]&&stargateConf.features[e]},ua={Android:function(){return/Android/i.test(navigator.userAgent)},BlackBerry:function(){return/BlackBerry/i.test(navigator.userAgent)},iOS:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},Windows:function(){return/IEMobile/i.test(navigator.userAgent)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Windows()}},utils={elementHasClass:function(e,t){var r=" "+t+" ",n="/[\n	\r]/g";return(" "+e.className+" ").replace(n," ").indexOf(r)>=0?!0:!1},pegasus:function(e,t){return t=new XMLHttpRequest,t.open("GET",e),e=[],t.onreadystatechange=t.then=function(r,n,o){if(r.call&&(e=[,r,n]),4==t.readyState&&(o=e[0|t.status/200]))try{o(JSON.parse(t.responseText),t)}catch(i){o(null,t)}},t.send(),t}};return stargatePublic});