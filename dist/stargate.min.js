/*!
 * StargateJS Apps
 * v0.5.4
 * Copyright 2015 DMobileLab. http://buongiorno.com/
 * See LICENSE in this repository for license information
 */
!function(e,t){"use strict";"object"==typeof exports?module.exports=t(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],t):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)}(this,function(e,t,r,n){"use strict";function i(e,t){var r=arguments.length>=1,n=arguments.length>=2;if(!(this instanceof i))return r?n?new i(e,t):new i(e):new i;if(void 0===e){if(r)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!=typeof location?location.href+"":""}return this.href(e),void 0!==t?this.absoluteTo(t):this}function o(e){return e.replace(/([.*+?^=!:()|[\]\/\\])/g,"\\$1")}function a(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function s(e){return"Array"===a(e)}function u(e,t){var r,n,i={};if("RegExp"===a(t))i=null;else if(s(t))for(r=0,n=t.length;n>r;r++)i[t[r]]=!0;else i[t]=!0;for(r=0,n=e.length;n>r;r++){var o=i&&void 0!==i[e[r]]||!i&&t.test(e[r]);o&&(e.splice(r,1),n--,r--)}return e}function c(e,t){var r,n;if(s(t)){for(r=0,n=t.length;n>r;r++)if(!c(e,t[r]))return!1;return!0}var i=a(t);for(r=0,n=e.length;n>r;r++)if("RegExp"===i){if("string"==typeof e[r]&&e[r].match(t))return!0}else if(e[r]===t)return!0;return!1}function l(e,t){if(!s(e)||!s(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var r=0,n=e.length;n>r;r++)if(e[r]!==t[r])return!1;return!0}function d(e){var t=/^\/+|\/+$/g;return e.replace(t,"")}function p(e){return escape(e)}function f(e){return encodeURIComponent(e).replace(/[!'()*]/g,p).replace(/\*/g,"%2A")}function h(e){return function(t,r){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!r),this)}}function g(e,t){return function(r,n){return void 0===r?this._parts[e]||"":(null!==r&&(r+="",r.charAt(0)===t&&(r=r.substring(1))),this._parts[e]=r,this.build(!n),this)}}var m=n&&n.URI;i.version="1.17.0";var w=i.prototype,v=Object.prototype.hasOwnProperty;i._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:i.duplicateQueryParameters,escapeQuerySpace:i.escapeQuerySpace}},i.duplicateQueryParameters=!1,i.escapeQuerySpace=!0,i.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,i.idn_expression=/[^a-z0-9\.-]/i,i.punycode_expression=/(xn--)/i,i.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,i.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,i.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,i.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/},i.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},i.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,i.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},i.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return i.domAttributes[t]}},i.encode=f,i.decode=decodeURIComponent,i.iso8859=function(){i.encode=escape,i.decode=unescape},i.unicode=function(){i.encode=f,i.decode=decodeURIComponent},i.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},i.encodeQuery=function(e,t){var r=i.encode(e+"");return void 0===t&&(t=i.escapeQuerySpace),t?r.replace(/%20/g,"+"):r},i.decodeQuery=function(e,t){e+="",void 0===t&&(t=i.escapeQuerySpace);try{return i.decode(t?e.replace(/\+/g,"%20"):e)}catch(r){return e}};var y,_={encode:"encode",decode:"decode"},b=function(e,t){return function(r){try{return i[t](r+"").replace(i.characters[e][t].expression,function(r){return i.characters[e][t].map[r]})}catch(n){return r}}};for(y in _)i[y+"PathSegment"]=b("pathname",_[y]),i[y+"UrnPathSegment"]=b("urnpath",_[y]);var S=function(e,t,r){return function(n){var o;o=r?function(e){return i[t](i[r](e))}:i[t];for(var a=(n+"").split(e),s=0,u=a.length;u>s;s++)a[s]=o(a[s]);return a.join(e)}};i.decodePath=S("/","decodePathSegment"),i.decodeUrnPath=S(":","decodeUrnPathSegment"),i.recodePath=S("/","encodePathSegment","decode"),i.recodeUrnPath=S(":","encodeUrnPathSegment","decode"),i.encodeReserved=b("reserved","encode"),i.parse=function(e,t){var r;return t||(t={}),r=e.indexOf("#"),r>-1&&(t.fragment=e.substring(r+1)||null,e=e.substring(0,r)),r=e.indexOf("?"),r>-1&&(t.query=e.substring(r+1)||null,e=e.substring(0,r)),"//"===e.substring(0,2)?(t.protocol=null,e=e.substring(2),e=i.parseAuthority(e,t)):(r=e.indexOf(":"),r>-1&&(t.protocol=e.substring(0,r)||null,t.protocol&&!t.protocol.match(i.protocol_expression)?t.protocol=void 0:"//"===e.substring(r+1,r+3)?(e=e.substring(r+3),e=i.parseAuthority(e,t)):(e=e.substring(r+1),t.urn=!0))),t.path=e,t},i.parseHost=function(e,t){e=e.replace(/\\/g,"/");var r,n,i=e.indexOf("/");if(-1===i&&(i=e.length),"["===e.charAt(0))r=e.indexOf("]"),t.hostname=e.substring(1,r)||null,t.port=e.substring(r+2,i)||null,"/"===t.port&&(t.port=null);else{var o=e.indexOf(":"),a=e.indexOf("/"),s=e.indexOf(":",o+1);-1!==s&&(-1===a||a>s)?(t.hostname=e.substring(0,i)||null,t.port=null):(n=e.substring(0,i).split(":"),t.hostname=n[0]||null,t.port=n[1]||null)}return t.hostname&&"/"!==e.substring(i).charAt(0)&&(i++,e="/"+e),e.substring(i)||"/"},i.parseAuthority=function(e,t){return e=i.parseUserinfo(e,t),i.parseHost(e,t)},i.parseUserinfo=function(e,t){var r,n=e.indexOf("/"),o=e.lastIndexOf("@",n>-1?n:e.length-1);return o>-1&&(-1===n||n>o)?(r=e.substring(0,o).split(":"),t.username=r[0]?i.decode(r[0]):null,r.shift(),t.password=r[0]?i.decode(r.join(":")):null,e=e.substring(o+1)):(t.username=null,t.password=null),e},i.parseQuery=function(e,t){if(!e)return{};if(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!e)return{};for(var r,n,o,a={},s=e.split("&"),u=s.length,c=0;u>c;c++)r=s[c].split("="),n=i.decodeQuery(r.shift(),t),o=r.length?i.decodeQuery(r.join("="),t):null,v.call(a,n)?(("string"==typeof a[n]||null===a[n])&&(a[n]=[a[n]]),a[n].push(o)):a[n]=o;return a},i.build=function(e){var t="";return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//"),t+=i.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&"string"==typeof e.hostname&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},i.buildHost=function(e){var t="";return e.hostname?(t+=i.ip6_expression.test(e.hostname)?"["+e.hostname+"]":e.hostname,e.port&&(t+=":"+e.port),t):""},i.buildAuthority=function(e){return i.buildUserinfo(e)+i.buildHost(e)},i.buildUserinfo=function(e){var t="";return e.username&&(t+=i.encode(e.username),e.password&&(t+=":"+i.encode(e.password)),t+="@"),t},i.buildQuery=function(e,t,r){var n,o,a,u,c="";for(o in e)if(v.call(e,o)&&o)if(s(e[o]))for(n={},a=0,u=e[o].length;u>a;a++)void 0!==e[o][a]&&void 0===n[e[o][a]+""]&&(c+="&"+i.buildQueryParameter(o,e[o][a],r),t!==!0&&(n[e[o][a]+""]=!0));else void 0!==e[o]&&(c+="&"+i.buildQueryParameter(o,e[o],r));return c.substring(1)},i.buildQueryParameter=function(e,t,r){return i.encodeQuery(e,r)+(null!==t?"="+i.encodeQuery(t,r):"")},i.addQuery=function(e,t,r){if("object"==typeof t)for(var n in t)v.call(t,n)&&i.addQuery(e,n,t[n]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=r);"string"==typeof e[t]&&(e[t]=[e[t]]),s(r)||(r=[r]),e[t]=(e[t]||[]).concat(r)}},i.removeQuery=function(e,t,r){var n,o,c;if(s(t))for(n=0,o=t.length;o>n;n++)e[t[n]]=void 0;else if("RegExp"===a(t))for(c in e)t.test(c)&&(e[c]=void 0);else if("object"==typeof t)for(c in t)v.call(t,c)&&i.removeQuery(e,c,t[c]);else{if("string"!=typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==r?"RegExp"===a(r)?!s(e[t])&&r.test(e[t])?e[t]=void 0:e[t]=u(e[t],r):e[t]!==String(r)||s(r)&&1!==r.length?s(e[t])&&(e[t]=u(e[t],r)):e[t]=void 0:e[t]=void 0}},i.hasQuery=function(e,t,r,n){if("object"==typeof t){for(var o in t)if(v.call(t,o)&&!i.hasQuery(e,o,t[o]))return!1;return!0}if("string"!=typeof t)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(a(r)){case"Undefined":return t in e;case"Boolean":var u=Boolean(s(e[t])?e[t].length:e[t]);return r===u;case"Function":return!!r(e[t],t,e);case"Array":if(!s(e[t]))return!1;var d=n?c:l;return d(e[t],r);case"RegExp":return s(e[t])?n?c(e[t],r):!1:Boolean(e[t]&&e[t].match(r));case"Number":r=String(r);case"String":return s(e[t])?n?c(e[t],r):!1:e[t]===r;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},i.commonPath=function(e,t){var r,n=Math.min(e.length,t.length);for(r=0;n>r;r++)if(e.charAt(r)!==t.charAt(r)){r--;break}return 1>r?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":(("/"!==e.charAt(r)||"/"!==t.charAt(r))&&(r=e.substring(0,r).lastIndexOf("/")),e.substring(0,r+1))},i.withinString=function(e,t,r){r||(r={});var n=r.start||i.findUri.start,o=r.end||i.findUri.end,a=r.trim||i.findUri.trim,s=/[a-z0-9-]=["']?$/i;for(n.lastIndex=0;;){var u=n.exec(e);if(!u)break;var c=u.index;if(r.ignoreHtml){var l=e.slice(Math.max(c-3,0),c);if(l&&s.test(l))continue}var d=c+e.slice(c).search(o),p=e.slice(c,d).replace(a,"");if(!r.ignore||!r.ignore.test(p)){d=c+p.length;var f=t(p,c,d,e);e=e.slice(0,c)+f+e.slice(d),n.lastIndex=c+f.length}}return n.lastIndex=0,e},i.ensureValidHostname=function(t){if(t.match(i.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(e.toASCII(t).match(i.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]')}},i.noConflict=function(e){if(e){var t={URI:this.noConflict()};return n.URITemplate&&"function"==typeof n.URITemplate.noConflict&&(t.URITemplate=n.URITemplate.noConflict()),n.IPv6&&"function"==typeof n.IPv6.noConflict&&(t.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&"function"==typeof n.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=n.SecondLevelDomains.noConflict()),t}return n.URI===this&&(n.URI=m),this},w.build=function(e){return e===!0?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=i.build(this._parts),this._deferred_build=!1),this},w.clone=function(){return new i(this)},w.valueOf=w.toString=function(){return this.build(!1)._string},w.protocol=h("protocol"),w.username=h("username"),w.password=h("password"),w.hostname=h("hostname"),w.port=h("port"),w.query=g("query","?"),w.fragment=g("fragment","#"),w.search=function(e,t){var r=this.query(e,t);return"string"==typeof r&&r.length?"?"+r:r},w.hash=function(e,t){var r=this.fragment(e,t);return"string"==typeof r&&r.length?"#"+r:r},w.pathname=function(e,t){if(void 0===e||e===!0){var r=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?i.decodeUrnPath:i.decodePath)(r):r}return this._parts.urn?this._parts.path=e?i.recodeUrnPath(e):"":this._parts.path=e?i.recodePath(e):"/",this.build(!t),this},w.path=w.pathname,w.href=function(e,t){var r;if(void 0===e)return this.toString();this._string="",this._parts=i._parts();var n=e instanceof i,o="object"==typeof e&&(e.hostname||e.path||e.pathname);if(e.nodeName){var a=i.getDomAttribute(e);e=e[a]||"",o=!1}if(!n&&o&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=i.parse(String(e),this._parts);else{if(!n&&!o)throw new TypeError("invalid input");var s=n?e._parts:e;for(r in s)v.call(this._parts,r)&&(this._parts[r]=s[r])}return this.build(!t),this},w.is=function(e){var t=!1,n=!1,o=!1,a=!1,s=!1,u=!1,c=!1,l=!this._parts.urn;switch(this._parts.hostname&&(l=!1,n=i.ip4_expression.test(this._parts.hostname),o=i.ip6_expression.test(this._parts.hostname),t=n||o,a=!t,s=a&&r&&r.has(this._parts.hostname),u=a&&i.idn_expression.test(this._parts.hostname),c=a&&i.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return a;case"sld":return s;case"ip":return t;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return o;case"idn":return u;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return c}return null};var A=w.protocol,P=w.port,I=w.hostname;w.protocol=function(e,t){if(void 0!==e&&e&&(e=e.replace(/:(\/\/)?$/,""),!e.match(i.protocol_expression)))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return A.call(this,e,t)},w.scheme=w.protocol,w.port=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e&&(0===e&&(e=null),e&&(e+="",":"===e.charAt(0)&&(e=e.substring(1)),e.match(/[^0-9]/))))throw new TypeError('Port "'+e+'" contains characters other than [0-9]');return P.call(this,e,t)},w.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var r={},n=i.parseHost(e,r);if("/"!==n)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=r.hostname}return I.call(this,e,t)},w.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var r=this.protocol(),n=this.authority();return n?(r?r+"://":"")+this.authority():""}var o=i(e);return this.protocol(o.protocol()).authority(o.authority()).build(!t),this},w.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?i.buildHost(this._parts):"";var r=i.parseHost(e,this._parts);if("/"!==r)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},w.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?i.buildAuthority(this._parts):"";var r=i.parseAuthority(e,this._parts);if("/"!==r)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},w.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.username)return"";var r=i.buildUserinfo(this._parts);return r.substring(0,r.length-1)}return"@"!==e[e.length-1]&&(e+="@"),i.parseUserinfo(e,this._parts),this.build(!t),this},w.resource=function(e,t){var r;return void 0===e?this.path()+this.search()+this.hash():(r=i.parse(e),this._parts.path=r.path,this._parts.query=r.query,this._parts.fragment=r.fragment,this.build(!t),this)},w.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,r)||""}var n=this._parts.hostname.length-this.domain().length,a=this._parts.hostname.substring(0,n),s=new RegExp("^"+o(a));return e&&"."!==e.charAt(e.length-1)&&(e+="."),e&&i.ensureValidHostname(e),this._parts.hostname=this._parts.hostname.replace(s,e),this.build(!t),this},w.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.match(/\./g);if(r&&r.length<2)return this._parts.hostname;var n=this._parts.hostname.length-this.tld(t).length-1;return n=this._parts.hostname.lastIndexOf(".",n-1)+1,this._parts.hostname.substring(n)||""}if(!e)throw new TypeError("cannot set domain empty");if(i.ensureValidHostname(e),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var a=new RegExp(o(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(a,e)}return this.build(!t),this},w.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(n+1);return t!==!0&&r&&r.list[i.toLowerCase()]?r.get(this._parts.hostname)||i:i}var a;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!r||!r.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');a=new RegExp(o(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");a=new RegExp(o(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,e)}return this.build(!t),this},w.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||e===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var r=this._parts.path.length-this.filename().length-1,n=this._parts.path.substring(0,r)||(this._parts.hostname?"/":"");return e?i.decodePath(n):n}var a=this._parts.path.length-this.filename().length,s=this._parts.path.substring(0,a),u=new RegExp("^"+o(s));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=i.recodePath(e),this._parts.path=this._parts.path.replace(u,e),this.build(!t),this},w.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||e===!0){if(!this._parts.path||"/"===this._parts.path)return"";var r=this._parts.path.lastIndexOf("/"),n=this._parts.path.substring(r+1);return e?i.decodePathSegment(n):n}var a=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(a=!0);var s=new RegExp(o(this.filename())+"$");return e=i.recodePath(e),this._parts.path=this._parts.path.replace(s,e),a?this.normalizePath(t):this.build(!t),this},w.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||e===!0){if(!this._parts.path||"/"===this._parts.path)return"";var r,n,a=this.filename(),s=a.lastIndexOf(".");return-1===s?"":(r=a.substring(s+1),n=/^[a-z0-9%]+$/i.test(r)?r:"",e?i.decodePathSegment(n):n)}"."===e.charAt(0)&&(e=e.substring(1));var u,c=this.suffix();if(c)u=e?new RegExp(o(c)+"$"):new RegExp(o("."+c)+"$");else{if(!e)return this;this._parts.path+="."+i.recodePath(e)}return u&&(e=i.recodePath(e),this._parts.path=this._parts.path.replace(u,e)),this.build(!t),this},w.segment=function(e,t,r){var n=this._parts.urn?":":"/",i=this.path(),o="/"===i.substring(0,1),a=i.split(n);if(void 0!==e&&"number"!=typeof e&&(r=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(o&&a.shift(),0>e&&(e=Math.max(a.length+e,0)),void 0===t)return void 0===e?a:a[e];if(null===e||void 0===a[e])if(s(t)){a=[];for(var u=0,c=t.length;c>u;u++)(t[u].length||a.length&&a[a.length-1].length)&&(a.length&&!a[a.length-1].length&&a.pop(),a.push(d(t[u])))}else(t||"string"==typeof t)&&(t=d(t),""===a[a.length-1]?a[a.length-1]=t:a.push(t));else t?a[e]=d(t):a.splice(e,1);return o&&a.unshift(""),this.path(a.join(n),r)},w.segmentCoded=function(e,t,r){var n,o,a;if("number"!=typeof e&&(r=t,t=e,e=void 0),void 0===t){if(n=this.segment(e,t,r),s(n))for(o=0,a=n.length;a>o;o++)n[o]=i.decode(n[o]);else n=void 0!==n?i.decode(n):void 0;return n}if(s(t))for(o=0,a=t.length;a>o;o++)t[o]=i.encode(t[o]);else t="string"==typeof t||t instanceof String?i.encode(t):t;return this.segment(e,t,r)};var E=w.query;return w.query=function(e,t){if(e===!0)return i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var r=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace),n=e.call(this,r);return this._parts.query=i.buildQuery(n||r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=i.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):E.call(this,e,t)},w.setQuery=function(e,t,r){var n=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)n[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var o in e)v.call(e,o)&&(n[o]=e[o])}return this._parts.query=i.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(r=t),this.build(!r),this},w.addQuery=function(e,t,r){var n=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return i.addQuery(n,e,void 0===t?null:t),this._parts.query=i.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(r=t),this.build(!r),this},w.removeQuery=function(e,t,r){var n=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return i.removeQuery(n,e,t),this._parts.query=i.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(r=t),this.build(!r),this},w.hasQuery=function(e,t,r){var n=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return i.hasQuery(n,e,t,r)},w.setSearch=w.setQuery,w.addSearch=w.addQuery,w.removeSearch=w.removeQuery,w.hasSearch=w.hasQuery,w.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},w.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},w.normalizeHostname=function(r){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!r)),this},w.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===i.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},w.normalizePath=function(e){var t=this._parts.path;if(!t)return this;if(this._parts.urn)return this._parts.path=i.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;var r,n,o,a="";for("/"!==t.charAt(0)&&(r=!0,t="/"+t),("/.."===t.slice(-3)||"/."===t.slice(-2))&&(t+="/"),t=t.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),r&&(a=t.substring(1).match(/^(\.\.\/)+/)||"",a&&(a=a[0]));;){if(n=t.indexOf("/.."),-1===n)break;0!==n?(o=t.substring(0,n).lastIndexOf("/"),-1===o&&(o=n),t=t.substring(0,o)+t.substring(n+3)):t=t.substring(3)}return r&&this.is("relative")&&(t=a+t.substring(1)),t=i.recodePath(t),this._parts.path=t,this.build(!e),this},w.normalizePathname=w.normalizePath,w.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(i.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},w.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},w.normalizeSearch=w.normalizeQuery,w.normalizeHash=w.normalizeFragment,w.iso8859=function(){var e=i.encode,t=i.decode;i.encode=escape,i.decode=decodeURIComponent;try{this.normalize()}finally{i.encode=e,i.decode=t}return this},w.unicode=function(){var e=i.encode,t=i.decode;i.encode=f,i.decode=unescape;try{this.normalize()}finally{i.encode=e,i.decode=t}return this},w.readable=function(){var t=this.clone();t.username("").password("").normalize();var r="";if(t._parts.protocol&&(r+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(r+=e.toUnicode(t._parts.hostname),t._parts.port&&(r+=":"+t._parts.port)):r+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(r+="/"),r+=t.path(!0),t._parts.query){for(var n="",o=0,a=t._parts.query.split("&"),s=a.length;s>o;o++){var u=(a[o]||"").split("=");n+="&"+i.decodeQuery(u[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==u[1]&&(n+="="+i.decodeQuery(u[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}r+="?"+n.substring(1)}return r+=i.decodeQuery(t.hash(),!0)},w.absoluteTo=function(e){var t,r,n,o=this.clone(),a=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof i||(e=new i(e)),o._parts.protocol||(o._parts.protocol=e._parts.protocol),this._parts.hostname)return o;for(r=0;n=a[r];r++)o._parts[n]=e._parts[n];return o._parts.path?".."===o._parts.path.substring(-2)&&(o._parts.path+="/"):(o._parts.path=e._parts.path,o._parts.query||(o._parts.query=e._parts.query)),"/"!==o.path().charAt(0)&&(t=e.directory(),t=t?t:0===e.path().indexOf("/")?"/":"",o._parts.path=(t?t+"/":"")+o._parts.path,o.normalizePath()),o.build(),o},w.relativeTo=function(e){var t,r,n,o,a,s=this.clone().normalize();if(s._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new i(e).normalize(),t=s._parts,r=e._parts,o=s.path(),a=e.path(),"/"!==o.charAt(0))throw new Error("URI is already relative");if("/"!==a.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===r.protocol&&(t.protocol=null),t.username!==r.username||t.password!==r.password)return s.build();if(null!==t.protocol||null!==t.username||null!==t.password)return s.build();if(t.hostname!==r.hostname||t.port!==r.port)return s.build();if(t.hostname=null,t.port=null,o===a)return t.path="",s.build();if(n=i.commonPath(o,a),!n)return s.build();var u=r.path.substring(n.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=u+t.path.substring(n.length)||"./",s.build()},w.equals=function(e){var t,r,n,o=this.clone(),a=new i(e),u={},c={},d={};if(o.normalize(),a.normalize(),o.toString()===a.toString())return!0;if(t=o.query(),r=a.query(),o.query(""),a.query(""),o.toString()!==a.toString())return!1;if(t.length!==r.length)return!1;u=i.parseQuery(t,this._parts.escapeQuerySpace),c=i.parseQuery(r,this._parts.escapeQuerySpace);for(n in u)if(v.call(u,n)){if(s(u[n])){if(!l(u[n],c[n]))return!1}else if(u[n]!==c[n])return!1;d[n]=!0}for(n in c)if(v.call(c,n)&&!d[n])return!1;return!0},w.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},w.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},i}),function(e,t){"use strict";"object"==typeof exports?module.exports=t(require("./URI")):"function"==typeof define&&define.amd?define(["./URI"],t):e.URITemplate=t(e.URI,e)}(this,function(e,t){"use strict";function r(e){return r._cache[e]?r._cache[e]:this instanceof r?(this.expression=e,r._cache[e]=this,this):new r(e)}function n(e){this.data=e,this.cache={}}var i=t&&t.URITemplate,o=Object.prototype.hasOwnProperty,a=r.prototype,s={"":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encode"},"+":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},"#":{prefix:"#",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},".":{prefix:".",separator:".",named:!1,empty_name_separator:!1,encode:"encode"},"/":{prefix:"/",separator:"/",named:!1,empty_name_separator:!1,encode:"encode"},";":{prefix:";",separator:";",named:!0,empty_name_separator:!1,encode:"encode"},"?":{prefix:"?",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"},"&":{prefix:"&",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"}};return r._cache={},r.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g,r.VARIABLE_PATTERN=/^([^*:]+)((\*)|:(\d+))?$/,r.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_]/,r.expand=function(e,t){var n,i,o,a=s[e.operator],u=a.named?"Named":"Unnamed",c=e.variables,l=[];for(o=0;i=c[o];o++)n=t.get(i.name),n.val.length?l.push(r["expand"+u](n,a,i.explode,i.explode&&a.separator||",",i.maxlength,i.name)):n.type&&l.push("");return l.length?a.prefix+l.join(a.separator):""},r.expandNamed=function(t,r,n,i,o,a){var s,u,c,l="",d=r.encode,p=r.empty_name_separator,f=!t[d].length,h=2===t.type?"":e[d](a);for(u=0,c=t.val.length;c>u;u++)o?(s=e[d](t.val[u][1].substring(0,o)),2===t.type&&(h=e[d](t.val[u][0].substring(0,o)))):f?(s=e[d](t.val[u][1]),2===t.type?(h=e[d](t.val[u][0]),t[d].push([h,s])):t[d].push([void 0,s])):(s=t[d][u][1],2===t.type&&(h=t[d][u][0])),l&&(l+=i),n?l+=h+(p||s?"=":"")+s:(u||(l+=e[d](a)+(p||s?"=":"")),2===t.type&&(l+=h+","),l+=s);return l},r.expandUnnamed=function(t,r,n,i,o){var a,s,u,c,l="",d=r.encode,p=r.empty_name_separator,f=!t[d].length;for(u=0,c=t.val.length;c>u;u++)o?s=e[d](t.val[u][1].substring(0,o)):f?(s=e[d](t.val[u][1]),t[d].push([2===t.type?e[d](t.val[u][0]):void 0,s])):s=t[d][u][1],l&&(l+=i),2===t.type&&(a=o?e[d](t.val[u][0].substring(0,o)):t[d][u][0],l+=a,l+=n?p||s?"=":"":","),l+=s;return l},r.noConflict=function(){return t.URITemplate===r&&(t.URITemplate=i),r},a.expand=function(e){var t="";this.parts&&this.parts.length||this.parse(),e instanceof n||(e=new n(e));for(var i=0,o=this.parts.length;o>i;i++)t+="string"==typeof this.parts[i]?this.parts[i]:r.expand(this.parts[i],e);return t},a.parse=function(){var e,t,n,i=this.expression,o=r.EXPRESSION_PATTERN,a=r.VARIABLE_PATTERN,u=r.VARIABLE_NAME_PATTERN,c=[],l=0;for(o.lastIndex=0;;){if(t=o.exec(i),null===t){c.push(i.substring(l));break}if(c.push(i.substring(l,t.index)),l=t.index+t[0].length,!s[t[1]])throw new Error('Unknown Operator "'+t[1]+'" in "'+t[0]+'"');if(!t[3])throw new Error('Unclosed Expression "'+t[0]+'"');e=t[2].split(",");for(var d=0,p=e.length;p>d;d++){if(n=e[d].match(a),null===n)throw new Error('Invalid Variable "'+e[d]+'" in "'+t[0]+'"');if(n[1].match(u))throw new Error('Invalid Variable Name "'+n[1]+'" in "'+t[0]+'"');e[d]={name:n[1],explode:!!n[3],maxlength:n[4]&&parseInt(n[4],10)}}if(!e.length)throw new Error('Expression Missing Variable(s) "'+t[0]+'"');c.push({expression:t[0],operator:t[1],variables:e})}return c.length||c.push(i),this.parts=c,this},n.prototype.get=function(e){var t,r,n,i=this.data,a={type:0,val:[],encode:[],encodeReserved:[]};if(void 0!==this.cache[e])return this.cache[e];if(this.cache[e]=a,n="[object Function]"===String(Object.prototype.toString.call(i))?i(e):"[object Function]"===String(Object.prototype.toString.call(i[e]))?i[e](e):i[e],
void 0===n||null===n)return a;if("[object Array]"===String(Object.prototype.toString.call(n))){for(t=0,r=n.length;r>t;t++)void 0!==n[t]&&null!==n[t]&&a.val.push([void 0,String(n[t])]);a.val.length&&(a.type=3)}else if("[object Object]"===String(Object.prototype.toString.call(n))){for(t in n)o.call(n,t)&&void 0!==n[t]&&null!==n[t]&&a.val.push([t,String(n[t])]);a.val.length&&(a.type=2)}else a.type=1,a.val.push([void 0,String(n)]);return a},e.expand=function(t,n){var i=new r(t),o=i.expand(n);return new e(o)},r}),function(){"use strict";var e=["html","json","jsonp","script"],t=["connect","delete","get","head","options","patch","post","put","trace"],r=function o(){var e={},t={},r={url:function(e){return s.call(this,"url",e,n.string)},sync:function(e){return s.call(this,"sync",e,n.bool)},cache:function(e){return s.call(this,"cache",e,n.bool)},type:function(e){return s.call(this,"type",e,n.type)},header:function(t,r){return e.headers=e.headers||{},n.string(t),"undefined"!=typeof r?(n.string(r),e.headers[t]=r,this):e.headers[t]},auth:function(t,r){return n.string(t),n.string(r),e.auth={user:t,passwd:r},this},timeout:function(e){return s.call(this,"timeout",e,n.positiveInteger)},method:function(e){return s.call(this,"method",e,n.method)},queryString:function(e){return s.call(this,"queryString",e,n.queryString)},data:function(e){return s.call(this,"data",e,n.plainObject)},body:function(e){return s.call(this,"body",e,null,function(e){if("object"==typeof e){if(!(e instanceof FormData)){try{e=JSON.stringify(e)}catch(t){throw new TypeError("Unable to stringify body's content : "+t.name)}this.header("Content-Type","application/json")}}else e+="";return e})},into:function(e){return s.call(this,"into",e,n.selector,function(e){return"string"==typeof e?document.querySelectorAll(e):e instanceof HTMLElement?[e]:void 0})},jsonPaddingName:function(e){return s.call(this,"jsonPaddingName",e,n.string)},jsonPadding:function(e){return s.call(this,"jsonPadding",e,n.func)},on:function(e,r){return"function"==typeof r&&(t[e]=t[e]||[],t[e].push(r)),this},off:function(e){return t[e]=[],this},trigger:function(e,r){var n=this,i=function(e,r){t[e]instanceof Array&&t[e].forEach(function(e){e.call(n,r)})};if("undefined"!=typeof e){e+="";var o=/^([0-9])([0-9x])([0-9x])$/i,a=e.match(o);a&&a.length>3?Object.keys(t).forEach(function(e){var t=e.match(o);!(t&&t.length>3&&a[1]===t[1])||"x"!==t[2]&&a[2]!==t[2]||"x"!==t[3]&&a[3]!==t[3]||i(e,r)}):t[e]&&i(e,r)}return this},go:function(){var t=e.type||(e.into?"html":"json"),r=c();return"function"==typeof a[t]?a[t].call(this,r):void 0}},a={json:function(e){var t=this;a._xhr.call(this,e,function(e){if(e)try{e=JSON.parse(e)}catch(r){return t.trigger("error",r),null}return e})},html:function(t){a._xhr.call(this,t,function(t){return e.into&&e.into.length&&[].forEach.call(e.into,function(e){e.innerHTML=t}),t})},_xhr:function(t,r){var n,i,o,a,s,c=this,l=e.method||"get",d=e.sync!==!0,p=new XMLHttpRequest,f=e.data,h=e.body,g=(e.headers||{},this.header("Content-Type")),m=e.timeout;if(!g&&f&&u()&&(this.header("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),g=this.header("Content-Type")),f&&u())if("string"!=typeof h&&(h=""),g.indexOf("json")>-1)try{h=JSON.stringify(f)}catch(w){throw new TypeError("Unable to stringify body's content : "+w.name)}else{a=g&&g.indexOf("x-www-form-urlencoded")>1;for(n in f)h+=a?encodeURIComponent(n)+"="+encodeURIComponent(f[n])+"&":n+"="+f[n]+"\n\r"}s=[l,t,d],e.auth&&(s.push(e.auth.user),s.push(e.auth.passwd)),p.open.apply(p,s);for(i in e.headers)p.setRequestHeader(i,e.headers[i]);p.onprogress=function(e){e.lengthComputable&&c.trigger("progress",e.loaded/e.total)},p.onload=function(){var e=p.responseText;o&&clearTimeout(o),this.status>=200&&this.status<300&&("function"==typeof r&&(e=r(e)),c.trigger("success",e)),c.trigger(this.status,e),c.trigger("end",e)},p.onerror=function(e){o&&clearTimeout(o),c.trigger("error",e,arguments)},m&&(o=setTimeout(function(){c.trigger("timeout",{type:"timeout",expiredAfter:m},p,arguments),p.abort()},m)),p.send(h)},jsonp:function(t){var r,n=this,a=document.querySelector("head"),s=e.sync!==!0,u=e.jsonPaddingName||"callback",c=e.jsonPadding||"_padd"+(new Date).getTime()+Math.floor(1e4*Math.random()),l={};if(o[c])throw new Error("Padding "+c+"  already exists. It must be unique.");/^ajajsonp_/.test(c)||(c="ajajsonp_"+c),window[c]=function(e){n.trigger("success",e),a.removeChild(r),window[c]=void 0},l[u]=c,t=i(t,l),r=document.createElement("script"),r.async=s,r.src=t,r.onerror=function(){n.trigger("error",arguments),a.removeChild(r),window[c]=void 0},a.appendChild(r)},script:function(t){var r,n=this,i=document.querySelector("head")||document.querySelector("body"),o=e.sync!==!0;if(!i)throw new Error("Ok, wait a second, you want to load a script, but you don't have at least a head or body tag...");r=document.createElement("script"),r.async=o,r.src=t,r.onerror=function(){n.trigger("error",arguments),i.removeChild(r)},r.onload=function(){n.trigger("success",arguments)},i.appendChild(r)}},s=function(t,r,i,o){if("undefined"!=typeof r){if("function"==typeof i)try{r=i.call(n,r)}catch(a){throw new TypeError("Failed to set "+t+" : "+a.message)}return"function"==typeof o?e[t]=o.call(this,r):e[t]=r,this}return"undefined"===e[t]?null:e[t]},u=function(){return["delete","patch","post","put"].indexOf(e.method)>-1},c=function(){var t=e.url,r="undefined"!=typeof e.cache?!!e.cache:!0,n=e.queryString||"",o=e.data;return r===!1&&(n+="&ajabuster="+(new Date).getTime()),t=i(t,n),o&&!u()&&(t=i(t,o)),t};return r},n={bool:function(e){return!!e},string:function(e){if("string"!=typeof e)throw new TypeError("a string is expected, but "+e+" ["+typeof e+"] given");return e},positiveInteger:function(e){if(parseInt(e)!==e||0>=e)throw new TypeError("an integer is expected, but "+e+" ["+typeof e+"] given");return e},plainObject:function(e){if("object"!=typeof e||e.constructor!==Object)throw new TypeError("an object is expected, but "+e+"  ["+typeof e+"] given");return e},type:function(t){if(t=this.string(t),e.indexOf(t.toLowerCase())<0)throw new TypeError("a type in ["+e.join(", ")+"] is expected, but "+t+" given");return t.toLowerCase()},method:function(e){if(e=this.string(e),t.indexOf(e.toLowerCase())<0)throw new TypeError("a method in ["+t.join(", ")+"] is expected, but "+e+" given");return e.toLowerCase()},queryString:function(e){var t={};return"string"==typeof e?e.replace("?","").split("&").forEach(function(e){var r=e.split("=");2===r.length&&(t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]))}):t=e,this.plainObject(t)},selector:function(e){if("string"!=typeof e&&!(e instanceof HTMLElement))throw new TypeError("a selector or an HTMLElement is expected, "+e+" ["+typeof e+"] given");return e},func:function(e){if(e=this.string(e),!/^([a-zA-Z_])([a-zA-Z0-9_\-])+$/.test(e))throw new TypeError("a valid function name is expected, "+e+" ["+typeof e+"] given");return e}},i=function(e,t){var r;if(e=e||"",t)if(-1===e.indexOf("?")&&(e+="?"),"string"==typeof t)e+=t;else if("object"==typeof t)for(r in t)e+="&"+encodeURIComponent(r)+"="+encodeURIComponent(t[r]);return e};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof exports?module.exports=r:window.aja=window.aja||r}(),function(e){function t(e,t){return function(){e.apply(t,arguments)}}function r(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],u(e,t(i,this),t(o,this))}function n(e){var t=this;return null===this._state?void this._deferreds.push(e):void l(function(){var r=t._state?e.onFulfilled:e.onRejected;if(null===r)return void(t._state?e.resolve:e.reject)(t._value);var n;try{n=r(t._value)}catch(i){return void e.reject(i)}e.resolve(n)})}function i(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if("function"==typeof r)return void u(t(r,e),t(i,this),t(o,this))}this._state=!0,this._value=e,a.call(this)}catch(n){o.call(this,n)}}function o(e){this._state=!1,this._value=e,a.call(this)}function a(){for(var e=0,t=this._deferreds.length;t>e;e++)n.call(this,this._deferreds[e]);this._deferreds=null}function s(e,t,r,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n}function u(e,t,r){var n=!1;try{e(function(e){n||(n=!0,t(e))},function(e){n||(n=!0,r(e))})}catch(i){if(n)return;n=!0,r(i)}}var c=setTimeout,l="function"==typeof setImmediate&&setImmediate||function(e){c(e,1)},d=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};r.prototype["catch"]=function(e){return this.then(null,e)},r.prototype.then=function(e,t){var i=this;return new r(function(r,o){n.call(i,new s(e,t,r,o))})},r.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&d(arguments[0])?arguments[0]:arguments);return new r(function(t,r){function n(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){n(o,e)},r)}e[o]=a,0===--i&&t(e)}catch(u){r(u)}}if(0===e.length)return t([]);for(var i=e.length,o=0;o<e.length;o++)n(o,e[o])})},r.resolve=function(e){return e&&"object"==typeof e&&e.constructor===r?e:new r(function(t){t(e)})},r.reject=function(e){return new r(function(t,r){r(e)})},r.race=function(e){return new r(function(t,r){for(var n=0,i=e.length;i>n;n++)e[n].then(t,r)})},r._setImmediateFn=function(e){l=e},"undefined"!=typeof module&&module.exports?module.exports=r:e.Promise||(e.Promise=r)}(this),function(e,t){"use strict";var r=function(e){if("object"!=typeof e.document)throw new Error("Cookies.js requires a `window` with a `document` object");var r=function(e,t,n){return 1===arguments.length?r.get(e):r.set(e,t,n)};return r._document=e.document,r._cacheKeyPrefix="cookey.",r._maxExpireDate=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),r.defaults={path:"/",secure:!1},r.get=function(e){r._cachedDocumentCookie!==r._document.cookie&&r._renewCache();var n=r._cache[r._cacheKeyPrefix+e];return n===t?t:decodeURIComponent(n)},r.set=function(e,n,i){return i=r._getExtendedOptions(i),i.expires=r._getExpiresDate(n===t?-1:i.expires),r._document.cookie=r._generateCookieString(e,n,i),r},r.expire=function(e,n){return r.set(e,t,n)},r._getExtendedOptions=function(e){return{path:e&&e.path||r.defaults.path,domain:e&&e.domain||r.defaults.domain,expires:e&&e.expires||r.defaults.expires,secure:e&&e.secure!==t?e.secure:r.defaults.secure}},r._isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},r._getExpiresDate=function(e,t){if(t=t||new Date,"number"==typeof e?e=e===1/0?r._maxExpireDate:new Date(t.getTime()+1e3*e):"string"==typeof e&&(e=new Date(e)),e&&!r._isValidDate(e))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return e},r._generateCookieString=function(e,t,r){e=e.replace(/[^#$&+\^`|]/g,encodeURIComponent),e=e.replace(/\(/g,"%28").replace(/\)/g,"%29"),t=(t+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),r=r||{};var n=e+"="+t;return n+=r.path?";path="+r.path:"",n+=r.domain?";domain="+r.domain:"",n+=r.expires?";expires="+r.expires.toUTCString():"",n+=r.secure?";secure":""},r._getCacheFromString=function(e){for(var n={},i=e?e.split("; "):[],o=0;o<i.length;o++){var a=r._getKeyValuePairFromCookieString(i[o]);n[r._cacheKeyPrefix+a.key]===t&&(n[r._cacheKeyPrefix+a.key]=a.value)}return n},r._getKeyValuePairFromCookieString=function(e){var t=e.indexOf("=");t=0>t?e.length:t;var r,n=e.substr(0,t);try{r=decodeURIComponent(n)}catch(i){console&&"function"==typeof console.error&&console.error('Could not decode cookie with key "'+n+'"',i)}return{key:r,value:e.substr(t+1)}},r._renewCache=function(){r._cache=r._getCacheFromString(r._document.cookie),r._cachedDocumentCookie=r._document.cookie},r._areEnabled=function(){var e="cookies.js",t="1"===r.set(e,1).get(e);return r.expire(e),t},r.enabled=r._areEnabled(),r},n="object"==typeof e.document?r(e):r;"function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof exports?("object"==typeof module&&"object"==typeof module.exports&&(exports=module.exports=n),exports.Cookies=n):e.Cookies=n}("undefined"==typeof window?this:window),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.Stargate=t()}(this,function(){function e(e){f.type=e.type,f.networkState=navigator.connection.type,"function"==typeof p&&p(f)}function t(){document.addEventListener("offline",e,!1),document.addEventListener("online",e,!1)}function r(){f.networkState=navigator.connection.type,"none"===navigator.connection.type?f.type="offline":f.type="online"}function n(e){if("android"==window.device.platform.toLowerCase())window.navigator.app.loadUrl(e);else if("ios"==window.device.platform.toLowerCase()&&-1!==e.indexOf("file:///")){var t=e.split("?")[0];w("Without qs",t),window.resolveLocalFileSystemURL(t,function(e){var t=e.toInternalURL()+"?hybrid=1";w("Redirect to",t),window.location.href=t},v)}else window.location.href=e}function i(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.AppIsDebug?new Promise(function(e,t){window.cordova.plugins.AppIsDebug.get(function(t){e(t)},function(e){v("getAppIsDebug(): "+e,e),t(new Error(e))})}):(v("getAppIsDebug(): plugin not available!"),Promise.resolve({}))}function o(){return window.cordova.file?u.file.readFileAsJSON(window.cordova.file.applicationDirectory+"www/manifest.json"):window.hostedwebapp?new Promise(function(e,t){window.hostedwebapp.getManifest(function(t){e(t)},function(e){v(e),t(new Error(e))})}):(v("getManifest() no available reading mechanism!"),Promise.resolve({}))}var a="0.5.4",s={},u={};!function(e){function t(e,r,n){this.level=t.levels[e.toUpperCase()],this.styles=n||{background:"white",color:"black"},this.tag="%c "+r+" ",this.isstaging="1"==="IS_STAGING = 1".slice(-1),this.styleString="background:"+this.styles.background+";color:"+this.styles.color+";";var i=function(){if(arguments.length<1)return"";for(var e=Array.prototype.slice.call(arguments[0]),t="",r=0;r<e.length;r++)t+="object"==typeof e[r]?" "+JSON.stringify(e[r]):" "+e[r];return t},o=window.console.log.bind(window.console,this.tag,this.styleString),a=window.console.info.bind(window.console,this.tag,this.styleString),s=window.console.error.bind(window.console,this.tag,this.styleString),u=window.console.warn.bind(window.console,this.tag,this.styleString);this.isstaging||(o=function(){window.console.log("[D] [Stargate] "+i.apply(null,arguments))},a=function(){window.console.log("[I] [Stargate] "+i.apply(null,arguments))},s=function(){window.console.log("[E] [Stargate] "+i.apply(null,arguments))},u=function(){window.console.log("[W] [Stargate] "+i.apply(null,arguments))}),Object.defineProperties(this,{__d:{value:o,writable:!1,enumerable:!1,configurable:!1},__i:{value:a,writable:!1,enumerable:!1,configurable:!1},__e:{value:s,writable:!1,enumerable:!1,configurable:!1},__w:{value:u,writable:!1,enumerable:!1,configurable:!1}})}function r(e){var t=0;return{next:function(r){return r&&(t=0),t<e.length?{value:e[t++],done:!1}:{done:!0}}}}function n(e,t){e=e.split("?")[0].slice(0),e+="?";var r="";for(var n in t)r+=encodeURIComponent(n)+"="+encodeURIComponent(t[n])+"&";return r.length>0&&(r=r.substring(0,r.length-1)),e+r}function i(e){e=encodeURI(e);var t="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),r="responseType"in t;t.open("GET",e,!0),r&&(t.responseType="json");var n=new Promise(function(e,n){t.onreadystatechange=function(){if(4===t.readyState)try{var i=r?t.response:JSON.parse(t.responseText);e(i)}catch(o){n(o)}}});return t.setRequestHeader("Content-type","application/json; charset=UTF-8"),t.send(),n}function o(e){var t=this;if(t.timeout=3e3,t.called=!1,window.document){var r=Date.now();t.scriptTag=window.document.createElement("script"),e+="&callback=window.__jsonpHandler_"+r,t.scriptTag.src=e,t.scriptTag.type="text/javascript",t.scriptTag.async=!0,t.prom=new Promise(function(e,n){var i="__jsonpHandler_"+r;window[i]=function(r){t.called=!0,e(r),t.scriptTag.parentElement.removeChild(t.scriptTag),delete window[i]},setTimeout(function(){t.called||(n("Timeout jsonp request "+r),t.scriptTag.parentElement.removeChild(t.scriptTag),delete window[i])},t.timeout)}),window.document.getElementsByTagName("head")[0].appendChild(t.scriptTag)}}function a(e,t){var r=t||function(){};return new Promise(function(t,n){function i(){var r;switch(e.responseType){case"blob":r=new Blob([this.response],{type:e.mimeType||"image/jpeg"});break;case"arraybuffer":r=this.response;break;default:r=this.response,t(r)}}var o=new XMLHttpRequest;o.open("GET",e.url,!0),o.responseType=e.responseType||"blob",e.withCredentials&&(o.withCredentials=e.withCredentials);var a=n,s=n;o.addEventListener("progress",r,!1),o.addEventListener("load",i,!1),o.addEventListener("error",s,!1),o.addEventListener("abort",a,!1),o.send(null)})}function s(e,t){var r=Object.prototype.toString.apply({});if(e.toString()!==r||t.toString()!==r)throw new Error("Cannot merge different type");var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);for(var o in t)t.hasOwnProperty(i)&&(n[o]=t[o]);return n}function u(e){return{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}function c(e){e=e.slice(0),e=decodeURIComponent(e);var t=e.split("?")[1];if(!t)return{};var r=t.split("&");return r.reduce(function(e,t){var r=t.split("="),n=r[0],i=r[1];return e[n]=i,e},{})}t.levels={ALL:5,ERROR:4,WARN:3,INFO:2,DEBUG:1,OFF:0},t.prototype.e=function(){0!==this.level&&this.level>=t.levels.ERROR&&this.__e(arguments)},t.prototype.i=function(){0!==this.level&&this.level>=t.levels.WARN&&this.__i(arguments)},t.prototype.w=function(){0!==this.level&&this.level>=t.levels.INFO&&this.__w(arguments)},t.prototype.d=function(){0!==this.level&&this.level>=t.levels.DEBUG&&this.__d(arguments)},t.prototype.setLevel=function(e){this.level=t.levels[e]};var l={Iterator:r,Logger:t,composeApiString:n,getJSON:i,jsonpRequest:o,getImageRaw:a,extend:s,getType:u,dequerify:c};e?e.Utils=l:window.Utils=l}(u),function(e,t){function r(e){var t=e.map(function(e){return{fullPath:e.fullPath,path:e.toURL(),internalURL:e.toInternalURL(),isFile:e.isFile,isDirectory:e.isDirectory}});return 1==t.length?t[0]:t}var n={},i=new t.Logger("ALL","[File - module]");n.LOG=i,window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,n.ERROR_MAP={1:"NOT_FOUND_ERR",2:"SECURITY_ERR",3:"ABORT_ERR",4:"NOT_READABLE_ERR",5:"ENCODING_ERR",6:"NO_MODIFICATION_ALLOWED_ERR",7:"INVALID_STATE_ERR",8:"SYNTAX_ERR",9:"INVALID_MODIFICATION_ERR",10:"QUOTA_EXCEEDED_ERR",11:"TYPE_MISMATCH_ERR",12:"PATH_EXISTS_ERR"},n.currentFileTransfer=null,n.resolveFS=function(e){return new Promise(function(t,r){window.resolveLocalFileSystemURL(e,t,r)})},n.appendToFile=function(e,t,i,o){return i=void 0===arguments[2]?!1:arguments[2],o=void 0===arguments[3]?"text/plain":arguments[3],n.resolveFS(e).then(function(e){return new Promise(function(n,a){e.createWriter(function(s){i||s.seek(s.length);var u;u=t instanceof Blob?t:new Blob([t],{type:o}),s.write(u),s.onerror=a,s.onabort=a,s.onwriteend=function(){n(r([e]))}},a)})})},n.readFileAsHTML=function(e){return n.readFile(e).then(function(e){return(new window.DOMParser).parseFromString(e,"text/html")})},n.readFileAsJSON=function(e){return n.readFile(e).then(function(e){try{return Promise.resolve(window.JSON.parse(e))}catch(t){return Promise.reject(t)}})},n.removeFile=function(e){return n.resolveFS(e).then(function(e){return new Promise(function(t,r){e.remove(function(e){t(null===e||"OK"===e)},r)})})},n.removeDir=function(e){return n.resolveFS(e).then(function(e){return new Promise(function(t,r){e.removeRecursively(function(e){t(null===e||"OK"===e)},r)})})},n._promiseZip=function(e,t,r){return i.d("PROMISEZIP:",arguments),new Promise(function(n,i){window.zip.unzip(e,t,function(e){0===e?n(!0):i(e)},r)})},n.download=function(e,t,i,o){var a=this;this.ft=new window.FileTransfer,this.ft.onprogress=o,n.currentFileTransfer=a.ft,a.promise=new Promise(function(n,o){a.ft.download(window.encodeURI(e),t+i,function(e){n(r([e])),a.ft=null},function(e){o(e),a.ft=null},!0)})},n.createDir=function(e,t){return n.resolveFS(e).then(function(e){return new Promise(function(n,i){e.getDirectory(t,{create:!0},function(e){n(r([e]))},i)})})},n.fileExists=function(e){return new Promise(function(t){window.resolveLocalFileSystemURL(e,function(e){t(e.isFile)},function(e){t(1!==e.code)})})},n.dirExists=function(e){return new Promise(function(t){window.resolveLocalFileSystemURL(e,function(e){t(e.isDirectory)},function(e){t(1!=e.code)})})},n.requestFileSystem=function(e,t){return new Promise(function(r,n){window.requestFileSystem(e,t,r,n)})},n.readDir=function(e){return n.resolveFS(e).then(function(e){return new Promise(function(t,n){var o=e.createReader();o.readEntries(function(e){i.d("readDir:",e),t(r(e))},n)})})},n.readFile=function(e){return n.resolveFS(e).then(function(e){return new Promise(function(t,r){e.file(function(e){var n=new FileReader;n.onerror=r,n.onabort=r,n.onloadend=function(){var e=this.result;t(e)},n.readAsText(e)})})})},n.createFile=function(e,t){return n.resolveFS(e).then(function(e){return new Promise(function(n,i){e.getFile(t,{create:!0},function(e){n(r([e]))},i)})})},n.write=function(e,t){return n.appendToFile(e,t,!0)},n.moveDir=function(e,t){var r=t.substring(t.lastIndexOf("/")+1),o=t.replace(r,"");return i.d("moveDir:",o,r),Promise.all([n.resolveFS(e),n.resolveFS(o)]).then(function(e){return i.d("moveDir: resolved entries",e),new Promise(function(t,n){e[0].moveTo(e[1],r,t,n)})})},n.copyFile=function(e,t){var r=t.substring(t.lastIndexOf("/")+1),o=t.replace(r,"");return Promise.all([n.resolveFS(e),n.resolveFS(o)]).then(function(e){return i.d("copyFileTo",e),new Promise(function(t,n){e[0].copyTo(e[1],r,t,n)})})},n.copyDir=function(e,t){var r=t.substring(t.lastIndexOf("/")+1),o=t.replace(r,"");return Promise.all([n.resolveFS(e),n.resolveFS(o)]).then(function(n){return i.d("copyDir",e,"in",t),new Promise(function(e,t){n[0].copyTo(n[1],r,e,t)})})},n.getMetadata=function(e){return n.resolveFS(e).then(function(e){return new Promise(function(t,r){e.getMetadata(t,r)})})},e?e.file=n:window.file=n}(u,u.Utils),function(e,t,r){"use strict";function n(){}function i(t){if(t&&(R=E(R,t)),j.d("Initialized called with:",R),!e)return Promise.reject("Missing file module!");try{w=window.cordova.file.applicationStorageDirectory,v=window.cordova.file.cacheDirectory,y=window.cordova.file.tempDirectory,_=window.cordova.file.applicationDirectory+"www/",S=window.cordova.file.applicationDirectory+"www/js/stargate.js",b=window.cordova.file.dataDirectory}catch(n){return j.e(n),Promise.reject(n)}"ios"==window.device.platform.toLowerCase()&&(w+="Documents/"),"android"==window.device.platform.toLowerCase()&&(y=v),D.SDK_DIR=w+"scripts/",D.SDK_RELATIVE_DIR="../../scripts/",D.GAMEOVER_RELATIVE_DIR="../../gameover_template/",D.GAMES_DIR=w+"games/",D.BASE_DIR=w,D.CACHE_DIR=v,D.TEMP_DIR=y,D.CORDOVAJS=_+"cordova.js",D.CORDOVA_PLUGINS_JS=_+"cordova_plugins.js",D.STARGATEJS=_+"js/stargate.js",D.DATA_DIR=b,D.GAMEOVER_DIR=D.BASE_DIR+"gameover_template/",D.WWW_DIR=_,j.i("cordova JS dir to include",D.CORDOVAJS),r.game._public.BASE_DIR=D.BASE_DIR,r.game._public.OFFLINE_INDEX=D.WWW_DIR+"index.html";var i=e.createDir(D.BASE_DIR,"games"),s=e.createDir(D.BASE_DIR,"scripts"),u=e.fileExists(D.BASE_DIR+"offlineData.json").then(function(t){return t?(j.i("offlineData.json already exists"),t):(j.i("creating offlineData.json"),e.createFile(D.BASE_DIR,"offlineData.json").then(function(t){return j.d("offlineData",t),e.write(t.path,JSON.stringify(O))}))});return Promise.all([i,s,u]).then(function(e){return j.d("GamesDir, ScriptsDir, offlineData.json created",e),o()}).then(a)}function o(){return Promise.all([e.dirExists(D.BASE_DIR+"gameover_template"),e.dirExists(D.SDK_DIR+"plugins"),e.fileExists(D.SDK_DIR+"cordova.js"),e.fileExists(D.SDK_DIR+"cordova_plugins.js"),e.fileExists(D.SDK_DIR+"stargate.js"),e.fileExists(D.SDK_DIR+"gamesFixes.js")]).then(function(t){var r=[];return t[0]||r.push(e.copyDir(D.WWW_DIR+"gameover_template",D.BASE_DIR+"gameover_template")),t[1]||r.push(e.copyDir(D.WWW_DIR+"plugins",D.SDK_DIR+"plugins")),t[2]||r.push(e.copyFile(D.CORDOVAJS,D.SDK_DIR+"cordova.js")),t[3]||r.push(e.copyFile(D.CORDOVA_PLUGINS_JS,D.SDK_DIR+"cordova_plugins.js")),t[4]||r.push(e.copyFile(D.STARGATEJS,D.SDK_DIR+"stargate.js")),t[5]||r.push(e.copyFile(D.WWW_DIR+"js/gamesFixes.js",D.SDK_DIR+"gamesFixes.js")),Promise.all(r)})}function a(){var t=new Date,r=P(R.sdk_url,{v:t.getTime()}),n=P(R.dixie_url,{v:t.getTime(),country:"xx-gameasy"});return Promise.all([e.fileExists(D.SDK_DIR+"dixie.js"),e.fileExists(D.SDK_DIR+"gfsdk.min.js")]).then(function(t){var i=t[0],o=t[1],a=[];return""===R.sdk_url||o||(j.d("isSdkDownloaded",o,"get SDK",r),a.push(new e.download(r,D.SDK_DIR,"gfsdk.min.js").promise)),""===R.dixie_url||i||(j.d("isDixieDownloaded",i,"get dixie",n),a.push(new e.download(n,D.SDK_DIR,"dixie.js").promise)),Promise.all(a)}).then(function(){return Promise.all([e.getMetadata(D.SDK_DIR+"dixie.js"),e.getMetadata(D.SDK_DIR+"gfsdk.min.js")])}).then(function(i){var o=i[0],a=i[1],s=[],u=new Date(o.modificationTime),c=new Date(a.modificationTime);return u.getDate()<t.getDate()&&(j.d("updating sdk",r,u),s.push(new e.download(r,D.SDK_DIR,"gfsdk.min.js").promise)),c.getDate()<t.getDate()&&(j.d("updating dixie",n,c),s.push(new e.download(n,D.SDK_DIR,"dixie.js").promise)),Promise.all(s)})}function s(t){return j.d("_getIndexHtmlById",D.GAMES_DIR+t),e.readDir(D.GAMES_DIR+t).then(function(e){return j.d("_getIndexHtmlById readDir",e),e.filter(function(e){return p(e.path)})})}function u(e){j.d("_removeRemoteSDK");for(var t,r=e.querySelectorAll("script"),n=0;n<r.length;n++)if(-1!==r[n].src.indexOf("gfsdk")){t=r[n],j.d("_removeRemoteSDK",t),t.parentNode.removeChild(t);break}return e}function c(e,t){e=u(e);var r,n,i=Array.isArray(t)===!1?[t]:t;j.d("injectScripts",i);var o=document.createElement("meta");o.httpEquiv="Content-Security-Policy",o.content="default-src * data: content: cdvfile: file: http: https: gap: https://ssl.gstatic.com 'unsafe-inline' 'unsafe-eval';style-src * cdvfile: http: https: 'unsafe-inline';",e.head.insertBefore(o,e.getElementsByTagName("meta")[0]);var a=e.createElement("script");a.id="__root__",e.head.insertBefore(a,e.head.firstElementChild);for(var s=e.createDocumentFragment(),c=0;c<i.length;c++)i[c].endsWith(".css")?(j.d("css inject:",i[c]),n=e.createElement("link"),n.rel="stylesheet",n.href=i[c],e.head.insertBefore(n,e.getElementsByTagName("link")[0])):(r=e.createElement("script"),r.src=i[c],s.appendChild(r));return e.head.insertBefore(s,e.head.getElementsByTagName("script")[0]),j.d("Cleaned dom:",e),e}function l(e){var t=[];t.push(e.querySelector("link[href='/gmenu/frame.css']")),t.push(e.querySelector("iframe#menu")),t.push(e.querySelector("script[src='/gmenu/toggle.js']"));for(var r=e.querySelectorAll("script"),n=r.length-1;n>=0;n--)if(-1!==r[n].innerHTML.indexOf("function open")){t.push(r[n]);break}for(var i=0;i<t.length;i++)t[i]&&t[i].parentNode.removeChild(t[i]);return e}function d(t,r){var n;return s(t).then(function(t){return n=t[0].path,j.d("injectScripts",n),e.readFileAsHTML(t[0].path)}).then(function(e){function t(t){e.head.appendChild(t)}var n=e.body.querySelectorAll("meta"),i=e.body.querySelectorAll("link"),o=e.body.querySelectorAll("style"),a=e.body.querySelectorAll("title");n=[].slice.call(n),i=[].slice.call(i),o=[].slice.call(o),a=[].slice.call(a);var s=n.concat(i).concat(o).concat(a);return s.map(t),e.body.innerHTML=e.body.innerHTML.trim(),j.d("_injectScripts"),j.d(e),c(e,r)}).then(l).then(function(e){var t=[].slice.call(e.querySelector("html").attributes),r=t.map(function(e){return e.name+'="'+e.value+'"'}).join(" "),n="<!DOCTYPE html><html "+r+">"+e.documentElement.innerHTML+"</html>";return j.d("Serialized dom",n),n}).then(function(t){return j.d("Write dom:",n,t),e.write(n,t)})}function p(e){var t=new RegExp(/.*\.html?$/i);return t.test(e)}function f(r){var n=r.url.replace("[WSIZE]",r.size.width).replace("[HSIZE]",r.size.height).split("?")[0],i=D.GAMES_DIR+r.gameId,o=r.type+"_"+r.size.width+"x"+r.size.height+("_"+r.size.ratio||"")+".jpeg";return j.d("request Image to",n,"coverImageUrl",o,"imagesFolder",i),"xhr"===r.method?Promise.all([e.createFile(i,o),t.getImageRaw({url:n})]).then(function(t){var r=t[0],n=t[1];return e.appendToFile(r.path,n,!0,"image/jpeg")}):new e.download(n,i,o,function(){}).promise}function h(){return j.i("readUserJson",D.BASE_DIR+"user.json"),e.readFileAsJSON(D.BASE_DIR+"user.json")}function g(e){var t=P(R.ga_for_game_url,T),r=new I(t).prom,n=Promise.all([r,h()]);return n.then(function(r){var n=r[0],i=r[1];if(!i.ponyUrl)throw j.w("ponyUrl in user check undefined!",i.ponyUrl),new Error("Not premium user");var o=i.ponyUrl.split("&_PONY=")[1];j.d("PONYVALUE",o),j.d("apiGaForGames:",t,"ga_for_game:",n);var a=P(R.gamifive_info_api,{content_id:e,format:"jsonp"});return a+=i.ponyUrl,j.d("gamifive_info_api",a),[new I(a).prom,n]}).then(function(t){return t[0].then(function(r){return j.d("gamifiveInfo:",r,"ga_for_game",t[1]),m({content_id:e,ga_for_game:t[1],gamifive_info:r.game_info})})})}function m(t){return e.readFileAsJSON(D.BASE_DIR+"offlineData.json").then(function(e){return e.GaForGame[t.content_id]=t.ga_for_game,e.GamifiveInfo[t.content_id]=t.gamifive_info,e}).then(function(t){return j.d("writing offlineData.json",t),e.write(D.BASE_DIR+"offlineData.json",JSON.stringify(t))})}var w,v,y,_,b,S,A=t.Logger,P=t.composeApiString,I=t.jsonpRequest,E=t.extend,D={},R={sdk_url:"",dixie_url:"",api:"",ga_for_game_url:"",gamifive_info_api:"",bundle_games:[]},x=!1,O={GaForGame:{},GamifiveInfo:{},queues:{}},T={print_json_response:1},C={content_id:"",formats:"html5applications",sort:"-born_date",category:"b940b384ff0565b06dde433e05dc3c93",publisher:"",size:6,offset:0,label:"",label_slug:"",access_type:"",real_customer_id:"xx_gameasy",lang:"en",use_cs_id:"",white_label:"xx_gameasy",main_domain:"http://www2.gameasy.com/ww",fw:"gameasy",vh:"ww.gameasy.com",check_compatibility_header:0},j=new A("ALL","[Game - module]",{background:"black",color:"#5aa73a"});n.prototype.download=function(t,r){function n(e){return function(t){var r=Math.round(t.loaded/t.total*100);u({percentage:r,type:e})}}function i(){c({type:"download"});var r=e.requestFileSystem(1,v);return j.d("Get ga_for_game and gamifive info, fly my minipony!"),r.then(function(e){return j.i("Space is ok, can download:",v,e),g(y)}).then(function(r){return j.d("Ga for game and gamifive info stored!",r),j.d("Start Download:",t.id,t.response_api_dld.binary_url),new e.download(t.response_api_dld.binary_url,D.TEMP_DIR,y+".zip",n("download")).promise}).then(function(r){return c({type:"unzip"}),j.d("unzip:",t.id,D.TEMP_DIR+y),e._promiseZip(r.path,D.TEMP_DIR+y,n("unzip"))}).then(function(r){j.d("Unzip ended",r),l({type:"unzip"});var n=t.response_api_dld.url_download,i=n.substring(n.lastIndexOf("game"),n.length).split("/"),o=n.split("/"),a=o.slice(o.lastIndexOf("game"),o.length);i=[];for(var s=0;s<a.length;s++)"game"===a[s]||p(a[s])||i.push(a[s]);j.d("Folders before index",i),i.unshift(y);var u=D.TEMP_DIR+i.join("/");return j.d("Folders on disk",u),j.d("Copy game folder in games/",u,D.GAMES_DIR+y),e.moveDir(u,D.GAMES_DIR+y)}).then(function(t){return j.d("Remove zip from:",D.TEMP_DIR+y+".zip","last operation result",t),e.removeFile(D.TEMP_DIR+y+".zip")}).then(function(){j.d("Save meta.json for:",t.id);var e={gameId:t.id,size:{width:"500",height:"500",ratio:"1"},url:t.images.cover.ratio_1,type:"cover",method:"xhr"};return f(e)}).then(function(r){return j.d("Save meta.json for:",t.id),j.d("Download image result",r),t.images.cover.ratio_1=r.internalURL,e.createFile(D.GAMES_DIR+y,"meta.json").then(function(r){
return e.write(r.path,JSON.stringify(t))})}).then(function(e){return j.d("result last operation:save meta.json",e),j.d("InjectScripts in game:",t.id,_),d(t.id,[D.SDK_RELATIVE_DIR+"gamesFixes.js",D.GAMEOVER_RELATIVE_DIR+"gameover.css",D.SDK_RELATIVE_DIR+"cordova.js",D.SDK_RELATIVE_DIR+"cordova_plugins.js",D.SDK_RELATIVE_DIR+"dixie.js",D.SDK_RELATIVE_DIR+"stargate.js",D.SDK_RELATIVE_DIR+"gfsdk.min.js"])}).then(function(e){return j.d("injectScripts result",e),l({type:"download"}),x=!1,t.id})["catch"](function(e){throw j.e(e,"Cleaning...game not downloaded",t.id),x=!1,o.remove(t.id),l({type:"error",description:e}),e})}var o=this;t=JSON.parse(JSON.stringify(t));var a;if(this.isDownloading())return a={type:"error",description:"AlreadyDownloading"},r.onEnd(a),Promise.reject(a);if(!t.hasOwnProperty("response_api_dld")||200!==t.response_api_dld.status)return a={type:"error",description:"response_api_dld.status not equal 200 or undefined"},r.onEnd(a),Promise.reject(a);var s=this.isGameDownloaded(t.id);r=r?r:{};var u=r.onProgress?r.onProgress:function(){},c=r.onStart?r.onStart:function(){},l=r.onEnd?r.onEnd:function(){},h=t.size.replace("KB","").replace("MB","").replace(",",".").trim(),m={KB:1,MB:2,GB:3,TB:5},w=t.size.indexOf("MB")>-1?!0:!1,v=h*Math.pow(1024,w?m.MB:m.KB),y=t.id;return s.then(function(e){return j.d("Exists",e),e?(x=!1,Promise.reject({12:"AlreadyExists",gameID:t.id})):(x=!0,i())})},n.prototype.play=function(t){j.d("Play",t);var r=D.GAMES_DIR+t;return e.readDir(r).then(function(e){return e.filter(function(e){return p(e.path)})}).then(function(e){j.d("Playing this",e);var t=e[0].internalURL+"?hybrid=1";"ios"==window.device.platform.toLowerCase()?(j.d("Play ios",t),window.location.href=t):(j.d("Play android",t),window.navigator.app.loadUrl(encodeURI(t)))})},n.prototype.remove=function(t){j.d("Removing game",t);var r=e.dirExists(D.CACHE_DIR+t+".zip"),n=e.dirExists(D.GAMES_DIR+t);return Promise.all([r,n]).then(function(r){var n=[];return r[0]&&(j.d("Removed in cache",r[0]),n.push(e.removeFile(D.CACHE_DIR+t+".zip"))),r[1]&&(j.d("Removed",r[1]),n.push(e.removeDir(D.GAMES_DIR+t))),0===n.length&&j.i("Nothing to remove",n),n})},n.prototype.isDownloading=function(){return x},n.prototype.abortDownload=function(){return this.isDownloading()?(j.d("Abort last download"),e.currentFileTransfer&&(e.currentFileTransfer.abort(),e.currentFileTransfer=null,x=!1),!0):(j.w("There's not a download operation to abort"),!1)},n.prototype.list=function(){return j.d("Get games list"),e.readDir(D.GAMES_DIR).then(function(e){var t=Array.isArray(e)?e:[e];return t.filter(function(e){return e.isDirectory?e:void 0})}).then(function(t){var r=t.map(function(t){return e.readFileAsJSON(t.path+"meta.json")});return Promise.all(r).then(function(e){return e})})},n.prototype.buildGameOver=function(t){var r=D.GAMES_DIR+t.content_id+"/meta.json";return t.hasOwnProperty("content_id")?(j.d("Read meta.json:",r),j.d("GAMEOVER_TEMPLATE path",D.GAMEOVER_DIR+"gameover.html"),Promise.all([e.readFileAsJSON(r),e.readFile(D.GAMEOVER_DIR+"gameover.html")]).then(function(e){var r=e[1],n=e[0];return j.i("Meta JSON:",n),r.replace("{{score}}",t.score).replace("{{game_title}}",n.title).replace("{{game_title}}",n.title).replace("{{url_share}}",n.url_share).replace("{{url_cover}}",n.images.cover.ratio_1)})):Promise.reject("Missing content_id key!")},n.prototype.isGameDownloaded=function(t){return e.dirExists(D.GAMES_DIR+t)},n.prototype.removeAll=function(){return e.removeDir(D.GAMES_DIR).then(function(t){return j.d("All games deleted!",t),e.createDir(D.BASE_DIR,"games")})},n.prototype.getBundleGameObjects=function(){var e=this;if(R.bundle_games.length>0){j.d("Games bundle in configuration",R.bundle_games);var t,r=R.bundle_games.map(function(t){return e.isGameDownloaded(t)}),n=Promise.all(r).then(function(e){j.d("alreadyDownloaded",e);for(var t=0;t<e.length;t++)e[t]&&R.bundle_games.splice(t,1);return R.bundle_games}).then(function(e){return e.join(",")});return n.then(function(e){C.content_id=e;var t=P(R.api,C);return j.d("Request bundle games meta info:",t),new I(t).prom}).then(function(e){j.d("Games bundle response:",e),t=e;var r=e.map(function(e){return new I(e.url_api_dld).prom});return j.d("jsonpRequests",r),Promise.all(r)}).then(function(e){j.d("RESULTS",e);for(var r=0;r<e.length;r++)t[r].response_api_dld=e[r];return j.d("GameObjects",t),t})["catch"](function(e){j.e("Games bundle meta fail:",e)})}return j.w("Bundle_games array is empty!"),Promise.reject("bundle_games array is empty!")},n.prototype.needsUpdate=function(r){var n="";return e.readFileAsJSON(D.GAMES_DIR+r+"/meta.json").then(function(e){return n=e.response_api_dld.binary_md5,t.getJSON(e.url_api_dld)}).then(function(e){if(200===e.status)return e.binary_md5!==n;throw new Error("ResponseStatus "+e.status)})};var k={};r.game={},k.initialize=i,r.game._protected=k,r.game._public=new n}(u.file,u.Utils,u),function(e){"use strict";function t(){this.events={}}t.prototype.on=function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)},t.prototype.trigger=function(e,t){!this.events[e]||this.events[e]<1||this.events[e].map(function(e){e.call(null,t||{})})},t.prototype.remove=function(e,t){if(this.events[e]){var r=this.events[e].indexOf(t);r>-1&&this.events[e].splice(r,1)}},e.EventBus=t}(u),function(e){function t(e,t,r,n,i){return function(){if("function"==typeof e&&(e=e.call(null)),e)return t.apply(r||null,arguments);switch(n=n||"NoMessage",i){case"warn":console.warn(n);break;case"error":console.error(n);break;case"info":console.info(n);break;default:console.log(n)}}}e.Decorators={requireCondition:t}}(u),function(e,t,r){function n(){this.LOG=new e.Logger("OFF","ADMANAGER")}function i(e,t){return e.some(function(e){return t===e})}function o(){return"undefined"!==window.admob}var a={};a=/(android)/i.test(navigator.userAgent)?{banner:"ca-app-pub-6869992474017983/9375997553",interstitial:"ca-app-pub-6869992474017983/1657046752"}:/(ipod|iphone|ipad)/i.test(navigator.userAgent)?{banner:"ca-app-pub-6869992474017983/4806197152",interstitial:"ca-app-pub-6869992474017983/7563979554"}:{banner:"ca-app-pub-6869992474017983/8878394753",interstitial:"ca-app-pub-6869992474017983/1355127956"};var s,u=["ios","android"];n.prototype.initialize=function(t){return s=window.device.platform.toLowerCase(),i(u,s)?(this.AD_TYPE=window.admob.AD_TYPE,this.AD_SIZE=window.admob.AD_SIZE,this.LOG=new e.Logger("all","[AdManager]"),this.LOG.i("initialize admob with",s,t[s]),this.setOptions(t[s]),Promise.resolve("OK")):Promise.reject([s,"Unsupported"].join(" "))},n.prototype.createBanner=function(t){this.LOG.i("createBanner");var r=this;return t=e.extend(r.options,t||{}),new Promise(function(e,r){window.admob.createBannerView(t,e,r)})},n.prototype.removeBanner=function(){return window.admob.destroyBannerView(),Promise.resolve("OK")},n.prototype.showBanner=function(){return new Promise(function(e,t){window.admob.showBannerAd(!0,e,t)})},n.prototype.showBannerAtGivenXY=function(){this.LOG.d("NotImplemented")},n.prototype.showBannerAtSelectedPosition=function(){this.LOG.d("NotImplemented")},n.prototype.hideBanner=function(){return new Promise(function(e,t){window.admob.showBannerAd(!1,e,t)})},n.prototype.prepareInterstitial=function(t){var r=this;return new Promise(function(n,i){window.admob.requestInterstitialAd(e.extend(r.options,t||{}),n,i)})},n.prototype.showInterstitial=function(){return new Promise(function(e,t){window.admob.showInterstitialAd(e,t)})},n.prototype.registerAdEvents=function(e){this.LOG.d("NotImplemented",e)},n.prototype.setOptions=function(e){this.options=e||{},window.admob.setOptions(e||{})};for(var c in n.prototype)n.prototype.hasOwnProperty(c)&&(n.prototype[c]=t.requireCondition(o,n.prototype[c],n.prototype,"try cordova plugin add cordova-admob:plugin not installed","warn"));r.AdManager=new n}(u.Utils,u.Decorators,u);var c=function(){var e={},t=!1;e.init=function(){if(H.hasOwnProperty("webappsfixes")&&"object"==typeof H.webappsfixes){t=!0;for(var e in H.webappsfixes)if(H.webappsfixes.hasOwnProperty(e))if(r.hasOwnProperty(e)&&"function"==typeof r[e]){w("[webappsFixes] applying fix: "+e);var n=r[e](H.webappsfixes[e]);n&&v("[webappsFixes] fix '"+e+"' failed: "+n)}else v("[webappsFixes] fix implementation not found for: "+e)}return t};var r={};return r.gamifiveSearchBox=function(e){if(!window.cordova||!window.cordova.plugins||!window.cordova.plugins.Keyboard)return"missing ionic-plugin-keyboard";if(e.platforms){if(S()&&!e.platforms.ios)return void w("[webappsFixes] [gamifiveSearchBox] fix disabled on iOS");if(b()&&!e.platforms.android)return void w("[webappsFixes] [gamifiveSearchBox] fix disabled on Android")}return window.addEventListener("native.keyboardshow",function(){setTimeout(function(){0===document.querySelectorAll("input:focus").length&&(w("[webappsFixes] [gamifiveSearchBox] keyboard show on null input: hiding"),cordova.plugins.Keyboard.close())},1)},!1),w("[webappsFixes] [gamifiveSearchBox] listening on event native.keyboardshow"),""},e}();u.statusbar=function(){var e={};return e.initialize=function(e){if("undefined"==typeof window.StatusBar)return v("[StatusBar] missing cordova plugin");if(!e||e.constructor!==Object||0===Object.keys(e).length){if(!H.statusbar)return;e=H.statusbar}if("undefined"!=typeof e.hideOnUrlPattern&&e.hideOnUrlPattern.constructor===Array){for(var t=document.location.href,r=!1,n=0;n<e.hideOnUrlPattern.length;n++){var i=new RegExp(e.hideOnUrlPattern[n]);if(i.test(t)){r=!0;break}}r?window.StatusBar.hide():window.StatusBar.show()}e.color&&window.StatusBar.backgroundColorByHexString(e.color)},e.setVisibility=function(e,t,r){return"undefined"==typeof window.StatusBar?(v("[StatusBar] missing cordova plugin"),r("missing cordova plugin")):e?(window.StatusBar.show(),t("statusbar shown")):(window.StatusBar.hide(),t("statusbar hided"))},e}(),s.setStatusbarVisibility=function(e,t,r){return E?D?u.statusbar.setVisibility(e,t,r):(r("Stargate closed, wait for Stargate.initialize to complete!"),!1):r("Stargate not initialized, call Stargate.initialize first!")},window.pubKey="",window.forge="",s.conf={},s.conf.getWebappStartUrl=function(){if(!E)return v("Stargate not initialized, call Stargate.initialize first!");if(!D)return v("Stargate closed, wait for Stargate.initialize to complete!");var e=URI(H.webapp_start_url).addSearch("hybrid","1").addSearch("stargateVersion",l());return String(e)};var l=function(){return H.stargate_version_to_load?H.stargate_version_to_load:(y("getStargateVersionToLoad() stargate_version_to_load must be set on manifest!"),h)};s.conf.getWebappOrigin=function(){var e=/http:\/\/[\w]{3,4}\..*\.[\w]{2,}/;return"undefined"==typeof H.webapp_start_url?(w("Stargate is initialized? Please call this method after it"),""):e.exec(H.webapp_start_url)[0]};var d;s.initialize=function(e,t,r,n){return"function"==typeof t&&"undefined"==typeof r&&"undefined"==typeof n&&(n=t),"undefined"==typeof n&&(w("Callback success not setted. \n You can use 'then'"),n=function(){}),"function"!=typeof n?(y("Stargate.initialize() callback is not a function!"),Promise.reject(new Error("Stargate.initialize() callback is not a function!"))):(I=V(),E?(y("Stargate.initialize() already called, executing callback."),n&&n(I),d):("object"!=typeof e&&(e={}),e.hybrid_conf&&(U="object"==typeof e.hybrid_conf?e.hybrid_conf:JSON.parse(decodeURIComponent(e.hybrid_conf))),e.modules?e.modules.constructor!==Array?v("initialize() configurations.modules is not an array"):L=e.modules:L=["mfp","iapbase","appsflyer","game"],e.modules_conf&&("object"!=typeof e.modules_conf?v("initialize() configurations.modules_conf is not an object"):z=e.modules_conf),e.country&&("mfp"in U?U.mfp.country=e.country:U.mfp={country:e.country}),I?(w("initialize() starting up, configuration: ",U),R=n,d=new Promise(function(e,t){var r=function(){Q(e,t),document.removeEventListener("deviceready",r,!1)};document.addEventListener("deviceready",r,!1)}),E=!0,d):(w("version "+a+" running outside hybrid "),n&&n(I),d=Promise.resolve(I),E=!0,d)))},s.isInitialized=function(){return E},s.isOpen=function(){return D},s.isHybrid=function(){return V()},s.openUrl=function(e){return E?void window.open(e,"_system"):v("Stargate not initialized, call Stargate.initialize first!")},s.googleLogin=function(e,t){return E?(v("unimplemented"),void t("unimplemented")):t("Stargate not initialized, call Stargate.initialize first!")};var p,f={type:"unknown",networkState:"unknown"};s.addListener=function(e,t){"connectionchange"==e&&"function"==typeof t&&(w("onConnectionChange registered"),p=t)},s.checkConnection=function(){var e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];return E?D?"undefined"==typeof navigator.connection||"function"!=typeof navigator.connection.getInfo?(t("Missing cordova plugin"),console.warn("Cordova Network Information module missing"),!1):(e(f),f):(t("Stargate closed, wait for Stargate.initialize to complete!"),!1):(t("Stargate not initialized, call Stargate.initialize first!"),!1)},s.getDeviceID=function(e,t){if(!E)return t("Stargate not initialized, call Stargate.initialize first!");if(!D)return t("Stargate closed, wait for Stargate.initialize to complete!"),!1;var r=_.uuid;e({deviceID:r})},s.goToLocalIndex=function(){if("undefined"!==window.cordova.file.applicationDirectory){var e="?hybrid=1",t=window.cordova.file.applicationDirectory+"www/index.html";n(t+e)}else v("Missing cordova-plugin-file. Install it with: cordova plugin add cordova-plugin-file")},s.goToWebIndex=function(){var e=s.conf.getWebappStartUrl()+"";w("Redirect to",e),n(e)},s.getVersion=function(){return a},s.getAppInformation=function(){return F};var h="2",g="1"==="IS_STAGING = 1".slice(-1),m=function(){for(var e=Array.prototype.slice.call(arguments),t="",r=0;r<e.length;r++)t+="object"==typeof e[r]?" "+JSON.stringify(e[r]):" "+e[r];return t},w=console.log.bind(window.console,"[Stargate] "),v=console.error.bind(window.console,"[Stargate] "),y=console.warn.bind(window.console,"[Stargate] ");g||(w=function(){console.log("[I] [Stargate] "+m.apply(null,arguments))},v=function(){console.log("[E] [Stargate] "+m.apply(null,arguments))},y=function(){console.log("[W] [Stargate] "+m.apply(null,arguments))});var _={available:!1,cordova:"",manufacturer:"",model:"",platform:"",uuid:"",version:""},b=function(){return"Android"==_.platform},S=function(){return"iOS"==_.platform},A=function(){if("undefined"==typeof window.device)return v("Missing cordova device plugin");for(var e in _)window.device.hasOwnProperty(e)&&(_[e]=window.device[e]);return!0},P=function(e){w("launchUrl: "+e),document.location.href=e},I=!1,E=!1,D=!1,R=null,x="",O="",T="",C=!1,j=0,k={full:1,light:2,1:"full",2:"light"},U={},L=[],z={},F={cordova:null,manufacturer:null,model:null,platform:null,deviceId:null,version:null,packageVersion:null,packageName:null,packageBuild:null,stargate:null,stargateModules:null,stargateError:null},N=function(){window.Cookies.set("hybrid","1"),window.localStorage.getItem("hybrid")||window.localStorage.setItem("hybrid",1)},M=function(){window.Cookies.set("stargateVersion",l()),window.localStorage.getItem("stargateVersion")||window.localStorage.setItem("stargateVersion",l())},B=function(){$("leavesplash")||navigator.splashscreen.hide(),K(!1),"undefined"!=typeof SpinnerDialog&&SpinnerDialog.hide()},q=function(e){if(w("onPluginReady() start"),document.title=H.title,S()&&"undefined"!=typeof window.cordova&&cordova.require){var r=cordova.require("cordova/exec");r.setJsToNativeBridgeMode(r.jsToNativeModes.IFRAME_NAV)}if(t(),M(),W("mfp")&&$("mfp")){var n=J("mfp"),i=["motime_apikey","namespace","label"];i.forEach(function(e){!n.hasOwnProperty(e)&&H.hasOwnProperty(e)&&(n[e]=H[e])}),Y.check(n)}W("deltadna")&&window.deltadna.startSDK(H.deltadna.environmentKey,H.deltadna.collectApi,H.deltadna.engageApi,oe,ae,H.deltadna.settings),u.statusbar.initialize(J("statusbar")),$("iapbase")?(ne.initialize(J("iapbase")),j=k.full):$("iap")?(ne.initialize(J("iap"))&&w("Init IAP done."),j=k.full):$("iaplight")&&(re.initialize(J("iaplight")),j=k.light),W("appsflyer")&&$("appsflyer")&&ce.init(J("appsflyer")),c.init(),ue.initialize();var o=[];$("game")&&W("game")&&u.game&&o.push(u.game._protected.initialize(J("game"))),$("adv")&&u.AdManager&&o.push(u.AdManager.initialize(J("adv"))),$("globalization")&&o.push(ie.initialize()),Promise.all(o).then(function(){G(e)})["catch"](function(t){v("onPluginReady() error: ",t),G(e,t)})},G=function(e,t){w("onStargateReady() start"),B(),D=!0,w("version "+a+" ready;  running in package version: "+x),F={cordova:_.cordova,manufacturer:_.manufacturer,model:_.model,platform:_.platform,deviceId:_.uuid,version:_.version,packageVersion:x,packageName:T,packageBuild:O,stargate:a},L&&L.constructor===Array&&(F.stargateModules=L.join(", ")),t&&t instanceof Error&&(F.stargateError=t.toString()),window.navigator&&window.navigator.connection&&window.navigator.connection.type&&(F.connectionType=window.navigator.connection.type),R(!0),w("Stargate.initialize() done"),e(!0)},Q=function(e,t){w("onDeviceReady() start"),N(),A(),r(),Promise.all([cordova.getAppVersion.getVersionNumber(),o(),cordova.getAppVersion.getPackageName(),cordova.getAppVersion.getVersionCode(),i()]).then(function(r){x=r[0],"object"!=typeof r[1]&&(r[1]=JSON.parse(r[1])),T=r[2],O=r[3],r[4]&&"object"==typeof r[4]&&r[4].debug&&(C=!0),H=r[1].stargateConf,q(e,t)})["catch"](function(e){v("onDeviceReady() error: "+e),t("onDeviceReady() error: "+e)})},V=function(){var e=window.URI(document.location.href),t=e.protocol();return"file"===t||"cdvfile"===t?!0:e.hasQuery("hybrid")?!0:window.Cookies.get("hybrid")?!0:window.localStorage.getItem("hybrid")?!0:!1},K=function(e){e?ee():te()},H={features:{}},J=function(e){if(!e)return v("getModuleConf() invalid module requested");if(e in z)return z[e];var t={iapbase:"IAP",iap:"IAP"},r=e;return t[e]&&(r=t[e]),U&&r in U?U[r]:(w("getModuleConf(): no configuration for module: "+e+" ("+t+")"),{})},W=function(e){return"undefined"!=typeof H.features[e]&&H.features[e]},$=function(e){return L&&L.constructor===Array?L.indexOf(e)>-1:!1},Z=function(){var e={},t=function(e){var t=["message","subject","files","chooserTitle"],r={url:e.url};return t.forEach(function(t){t in e&&(r[t]=e[t])}),r},r=function(e){if(S()){if("facebook"===e)return"com.apple.social.facebook";if("twitter"===e)return"com.apple.social.twitter"}return e},n=function(e,r,n){var i=t(e),o=function(e){w("[share] Share completed? "+e.completed),w("[share] Shared to app: "+e.app),r(e)},a=function(e){v("[share] Sharing failed with message: "+e),n(e)};window.plugins.socialsharing.shareWithOptions(i,o,a)},i=function(e,t,r){var n=function(e){w("[share] Facebook share completed, result: ",e),t(e)},i=function(e){v("[share] Facebook sharing failed with message: "+e),r(e)};window.plugins.socialsharing.shareViaFacebook("",null,e.url,n,i)},o=function(e,t,r){var n=function(e){w("[share] Twitter share completed, result: ",e),t(e)},i=function(e){v("[share] Twitter sharing failed with message: "+e),r(e)},o="";"message"in e&&(o=e.message),window.plugins.socialsharing.shareViaTwitter(o,null,e.url,n,i)},a=function(e,t,r){var n=function(e){w("[share] Whatsapp share completed, result: ",e),t(e)},i=function(e){v("[share] Whatsapp sharing failed with message: "+e),r(e)},o="";"message"in e&&(o=e.message),window.plugins.socialsharing.shareViaWhatsApp(o,null,e.url,n,i)};return e.canShareVia=function(e,t){var n=r(e);return new Promise(function(r){window.plugins.socialsharing.canShareVia(n,null,null,null,t,function(t){w("[share] canShareVia "+e+" ("+n+") result true: ",t),r({network:e,available:!0})},function(t){w("[share] canShareVia "+e+" ("+n+") result false: ",t),r({network:e,available:!1})})})},e.socialShare=function(e,t,r){return"object"!=typeof e&&(e={},y("[share] parameter options must be object!")),e.type||(e.type="chooser"),window.plugins&&window.plugins.socialsharing?e.url?(w("[share] Sharing url: "+e.url+" on: "+e.type,e),"chooser"==e.type?n(e,t,r):"facebook"==e.type?i(e,t,r):"twitter"==e.type?o(e,t,r):"whatsapp"==e.type?a(e,t,r):(v("[share] type not valid"),r("type not valid"))):(v("[share] missing parameter url"),r("missing parameter url")):(v("[share] missing cordova plugin"),r("missing cordova plugin"))},e}();s.socialShare=function(e){if(!E)return Promise.reject("Stargate not initialized, call Stargate.initialize first!");if(!D)return Promise.reject("Stargate closed, wait for Stargate.initialize to complete!");var t=new Promise(function(t,r){Z.socialShare(e,t,r)});return t},s.socialShareAvailable=function(e){if(!E)return Promise.reject("Stargate not initialized, call Stargate.initialize first!");if(!D)return Promise.reject("Stargate closed, wait for Stargate.initialize to complete!");if(!window.plugins||!window.plugins.socialsharing)return v("[share] missing cordova plugin"),Promise.reject("missing cordova plugin");if(!e.socials||"object"!=typeof e.socials)return v("[share] missing object parameter socials"),Promise.reject("missing object parameter socials");if(!e.url)return v("[share] missing parameter url"),Promise.reject("missing parameter url");var t=new Promise(function(t,r){var n=[],i=["facebook","whatsapp","twitter","instagram"];i.forEach(function(t){e.socials[t]&&n.push(Z.canShareVia(t,e.url))}),Promise.all(n).then(function(e){var r={};e.forEach(function(e){r[e.network]=e.available}),t(r)},function(e){v(e),r(e)})});return t};var Y=function(){var e={};return e.check=function(t){var r=["motime_apikey","namespace","label","country"];r.forEach(function(e){return t.hasOwnProperty(e)?t[e]?void 0:v("[MFP] Configuration: '"+e+"' not valid!"):v("[MFP] Configuration '"+e+"' not defined!")}),e.get(t)},e.getContents=function(e,t,r,n){var i={};i.api_country=r,i.country=e,i.fpnamespace=t,n&&(i.extData=n);var o=JSON.stringify(i);return o},e.getPonyValue=function(e){try{return e.split("=")[1]}catch(t){v(t)}return""},e.setSession=function(t){var r=s.conf.getWebappStartUrl();window.localStorage.getItem("appUrl")&&(r=window.localStorage.getItem("appUrl"));var n=new URI(r),i=n.hostname(),o=URITemplate(H.api.mfpSetUriTemplate).expand({protocol:n.protocol(),hostname:i,url:r,domain:i,_PONY:e.getPonyValue(t)});w("[MobileFingerPrint] going to url: ",o),P(o)},e.get=function(t){var r="",n=URITemplate(H.api.mfpGetUriTemplate).expand({apikey:t.motime_apikey,contents_inapp:e.getContents(t.country,t.namespace,t.label),country:t.country,expire:r});window.aja().url(n).type("jsonp").on("success",function(t){w("[MobileFingerPrint] get() response: ",t);var r="";if(t.content.inappInfo){var n=JSON.parse(t.content.inappInfo);n.extData&&(n.extData.ponyUrl&&(r=n.extData.ponyUrl),n.extData.return_url&&window.localStorage.setItem("appUrl",n.extData.return_url),n.extData.session_mfp&&le.track({page:"hybrid_initialize",action:"MFP_get",session_mfp:n.extData.session_mfp})),e.setSession(r)}else w("[MobileFingerPrint] get(): Empty session")}).on("error",function(e){v("[MobileFingerPrint] get() error: ",e)}).go()},{check:e.check}}(),X=function(){"use strict";function e(e,t){var r=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(r>>16);return n<<16|65535&r}function t(e,t){return e<<t|e>>>32-t}function r(r,n,i,o,a,s){return e(t(e(e(n,r),e(o,s)),a),i)}function n(e,t,n,i,o,a,s){return r(t&n|~t&i,e,t,o,a,s)}function i(e,t,n,i,o,a,s){return r(t&i|n&~i,e,t,o,a,s)}function o(e,t,n,i,o,a,s){return r(t^n^i,e,t,o,a,s)}function a(e,t,n,i,o,a,s){return r(n^(t|~i),e,t,o,a,s)}function s(t,r){t[r>>5]|=128<<r%32,t[(r+64>>>9<<4)+14]=r;var s,u,c,l,d,p=1732584193,f=-271733879,h=-1732584194,g=271733878;for(s=0;s<t.length;s+=16)u=p,c=f,l=h,d=g,p=n(p,f,h,g,t[s],7,-680876936),g=n(g,p,f,h,t[s+1],12,-389564586),h=n(h,g,p,f,t[s+2],17,606105819),f=n(f,h,g,p,t[s+3],22,-1044525330),p=n(p,f,h,g,t[s+4],7,-176418897),g=n(g,p,f,h,t[s+5],12,1200080426),h=n(h,g,p,f,t[s+6],17,-1473231341),f=n(f,h,g,p,t[s+7],22,-45705983),p=n(p,f,h,g,t[s+8],7,1770035416),g=n(g,p,f,h,t[s+9],12,-1958414417),h=n(h,g,p,f,t[s+10],17,-42063),f=n(f,h,g,p,t[s+11],22,-1990404162),p=n(p,f,h,g,t[s+12],7,1804603682),g=n(g,p,f,h,t[s+13],12,-40341101),h=n(h,g,p,f,t[s+14],17,-1502002290),f=n(f,h,g,p,t[s+15],22,1236535329),p=i(p,f,h,g,t[s+1],5,-165796510),g=i(g,p,f,h,t[s+6],9,-1069501632),h=i(h,g,p,f,t[s+11],14,643717713),f=i(f,h,g,p,t[s],20,-373897302),p=i(p,f,h,g,t[s+5],5,-701558691),g=i(g,p,f,h,t[s+10],9,38016083),h=i(h,g,p,f,t[s+15],14,-660478335),f=i(f,h,g,p,t[s+4],20,-405537848),p=i(p,f,h,g,t[s+9],5,568446438),g=i(g,p,f,h,t[s+14],9,-1019803690),h=i(h,g,p,f,t[s+3],14,-187363961),f=i(f,h,g,p,t[s+8],20,1163531501),p=i(p,f,h,g,t[s+13],5,-1444681467),g=i(g,p,f,h,t[s+2],9,-51403784),h=i(h,g,p,f,t[s+7],14,1735328473),f=i(f,h,g,p,t[s+12],20,-1926607734),p=o(p,f,h,g,t[s+5],4,-378558),g=o(g,p,f,h,t[s+8],11,-2022574463),h=o(h,g,p,f,t[s+11],16,1839030562),f=o(f,h,g,p,t[s+14],23,-35309556),p=o(p,f,h,g,t[s+1],4,-1530992060),g=o(g,p,f,h,t[s+4],11,1272893353),h=o(h,g,p,f,t[s+7],16,-155497632),f=o(f,h,g,p,t[s+10],23,-1094730640),p=o(p,f,h,g,t[s+13],4,681279174),g=o(g,p,f,h,t[s],11,-358537222),h=o(h,g,p,f,t[s+3],16,-722521979),f=o(f,h,g,p,t[s+6],23,76029189),p=o(p,f,h,g,t[s+9],4,-640364487),g=o(g,p,f,h,t[s+12],11,-421815835),h=o(h,g,p,f,t[s+15],16,530742520),f=o(f,h,g,p,t[s+2],23,-995338651),p=a(p,f,h,g,t[s],6,-198630844),g=a(g,p,f,h,t[s+7],10,1126891415),h=a(h,g,p,f,t[s+14],15,-1416354905),f=a(f,h,g,p,t[s+5],21,-57434055),p=a(p,f,h,g,t[s+12],6,1700485571),g=a(g,p,f,h,t[s+3],10,-1894986606),h=a(h,g,p,f,t[s+10],15,-1051523),f=a(f,h,g,p,t[s+1],21,-2054922799),p=a(p,f,h,g,t[s+8],6,1873313359),g=a(g,p,f,h,t[s+15],10,-30611744),h=a(h,g,p,f,t[s+6],15,-1560198380),f=a(f,h,g,p,t[s+13],21,1309151649),p=a(p,f,h,g,t[s+4],6,-145523070),g=a(g,p,f,h,t[s+11],10,-1120210379),h=a(h,g,p,f,t[s+2],15,718787259),f=a(f,h,g,p,t[s+9],21,-343485551),p=e(p,u),f=e(f,c),h=e(h,l),g=e(g,d);return[p,f,h,g]}function u(e){var t,r="";for(t=0;t<32*e.length;t+=8)r+=String.fromCharCode(e[t>>5]>>>t%32&255);return r}function c(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;for(t=0;t<8*e.length;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function l(e){return u(s(c(e),8*e.length))}function d(e,t){var r,n,i=c(e),o=[],a=[];for(o[15]=a[15]=void 0,i.length>16&&(i=s(i,8*e.length)),r=0;16>r;r+=1)o[r]=909522486^i[r],a[r]=1549556828^i[r];return n=s(o.concat(c(t)),512+8*t.length),u(s(a.concat(n),640))}function p(e){var t,r,n="0123456789abcdef",i="";for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),i+=n.charAt(t>>>4&15)+n.charAt(15&t);return i}function f(e){return unescape(encodeURIComponent(e))}function h(e){return l(f(e))}function g(e){return p(h(e))}function m(e,t){return d(f(e),f(t))}function w(e,t){return p(m(e,t))}function v(e,t,r){return t?r?m(t,e):w(t,e):r?h(e):g(e)}return v}(),ee=function(e){if("undefined"==typeof window.SpinnerDialog)return v("startLoading(): SpinnerDialog cordova plugin missing!");"object"!=typeof e&&(e={});var t=null;return e.hasOwnProperty("message")&&(t=e.message),window.SpinnerDialog.show(null,t),!0},te=function(){return"undefined"==typeof window.SpinnerDialog?v("startLoading(): SpinnerDialog cordova plugin missing!"):(window.SpinnerDialog.hide(),!0)};window.startLoading=ee,window.stopLoading=te,s.inAppPurchaseSubscription=function(e,t,r,n){return E?D?(K(!0),"undefined"!=typeof n&&(ne.returnUrl=n),"undefined"!=typeof r&&(ne.subscribeMethod=r),ne.callbackSuccess=e,ne.callbackError=t,ne.inappPurchaseCalled=!0,ne.lastCreateUserProduct&&ne.lastCreateUserToken?(ne.createUser(ne.lastCreateUserProduct,ne.lastCreateUserToken),!0):(ne.doRefresh(),window.store.order(ne.id),!0)):(t("Stargate closed, wait for Stargate.initialize to complete!"),!1):(t("Stargate not initialized, call Stargate.initialize first!"),!1)},s.inAppRestore=function(e,t,r,n){return E?D?("undefined"!=typeof r&&(ne.subscribeMethod=r),"undefined"!=typeof n&&(ne.returnUrl=n),ne.callbackSuccess=e,ne.callbackError=t,ne.inappPurchaseCalled=!0,void ne.doRefresh(!0)):t("Stargate closed, wait for Stargate.initialize to complete!"):t("Stargate not initialized, call Stargate.initialize first!")},s.inAppProductInfo=function(e){if(e.productId||(e.productId=ne.id),"function"!=typeof e.callbackListingSuccess&&(e.callbackListingSuccess=function(){}),"function"!=typeof e.callbackPurchaseSuccess&&(e.callbackPurchaseSuccess=function(){}),"function"!=typeof e.callbackError&&(e.callbackError=function(){}),!e.subscriptionUrl)return v("[IAP] inAppProductInfo(): options.subscriptionUrl invalid"),!1;if(!E)return e.callbackError("Stargate not initialized, call Stargate.initialize first!"),!1;if(!D)return e.callbackError("Stargate closed, wait for Stargate.initialize to complete!"),!1;if(ne.subscribeMethod=e.subscriptionUrl,ne.requestedListingProductId=e.productId,ne.callbackListingSuccess=e.callbackListingSuccess,ne.callbackPurchaseSuccess=e.callbackPurchaseSuccess,ne.callbackListingError=e.callbackError,ne.inappProductInfoCalled=!0,ne.productsInfo[e.productId])try{ne.callbackListingSuccess(ne.productsInfo[e.productId])}catch(t){v("[IAP] inAppProductInfo(): error on callbackListingSuccess!")}return ne.lastCreateUserProduct&&ne.lastCreateUserToken?(ne.createUser(ne.lastCreateUserProduct,ne.lastCreateUserToken),!0):(ne.doRefresh(!0),!0)};var re=function(){var e={},t=null,r=[],n=[];e.initialize=function(e){return window.inAppPurchase?null!==t?t:((e.productsIdAndroid||e.productsIdIos)&&(b()?r=e.productsIdAndroid:S()&&(r=e.productsIdIos)),r?r&&r.constructor!==Array?Promise.reject("parameter error, productsId(Android|Ios) must be an array"):0===r.length?Promise.reject("parameter error, productsId(Android|Ios) must contains at least a productid"):t=window.inAppPurchase.getProducts(r).then(function(e){return n=e,w("[IAPlight] getProducts ok",e),e})["catch"](function(e){v("[IAPlight] getProducts KO",e)}):Promise.reject("missing parameter productsId(Android|Ios)")):Promise.reject("inAppPurchase not available, missing cordova plugin.")},e.subscribe=function(e){if(null===t)return Promise.reject("Not initialized");var r=function(){return window.inAppPurchase.subscribe(e).then(function(e){return w("[IAPlight] subscribe ok",e),e})["catch"](function(e){v("[IAPlight] subscribe KO: "+e,e)})};return t.then(r)},e.getExpireDate=function(e){if(null===t)return Promise.reject("Not initialized");var r=function(){return window.inAppPurchase.getReceiptBundle().then(function(t){w("[IAPlight] getExpireDate getReceiptBundle ok",t);var r={};return t.inAppPurchases&&t.inAppPurchases.constructor===Array&&t.inAppPurchases.forEach(function(t){if(t.productId==e){if(!r.subscriptionExpirationDate)return void(r=t);var n=new Date(r.subscriptionExpirationDate),i=new Date(t.subscriptionExpirationDate);if(i>n)return void(r=t)}}),r}).then(function(e){if(!e.subscriptionExpirationDate)return null;w("[IAPlight] getExpireDate lastPurchase ok",e);var t=new Date(e.subscriptionExpirationDate);return"[object Date]"!==Object.prototype.toString.call(t)?(v("[IAPlight] getReceiptBundle invalid date: "+e.subscriptionExpirationDate+" Date.toString:"+t),null):isNaN(t.getTime())?null:t})["catch"](function(e){v("[IAPlight] getReceiptBundle KO: "+e,e)})};return t.then(r)},e.restore=function(){if(null===t)return Promise.reject("Not initialized");var e=function(){return window.inAppPurchase.restorePurchases().then(function(e){return w("[IAPlight] restore restorePurchases ok",e),e})["catch"](function(e){v("[IAPlight] restore restorePurchases KO: "+e,e)})};return t.then(e)},e.getProductInfo=function(e){return null===t?Promise.reject("Not initialized"):t.then(function(){var t={};return n.forEach(function(r){r.productId==e&&(t=r)}),w("[IAPlight] getProductInfo(): product found:",t),t})};var i=function(e){return function(){return E?D?e.apply(null,arguments):Promise.reject("Stargate closed, wait for Stargate.initialize to complete!"):Promise.reject("Stargate not initialized, call Stargate.initialize first!")}};return e["public"]={initialize:i(e.initialize),restore:i(e.restore),getProductInfo:i(e.getProductInfo),subscribe:i(e.subscribe),getExpireDate:i(e.getExpireDate)
},e.__clean__=function(){t=null},e}();s.iaplight=re["public"];var ne={id:"",alias:"",type:"",verbosity:"",paymethod:"",subscribeMethod:"",returnUrl:"",callbackSuccess:function(){w("[IAP] Undefined callbackSuccess")},callbackError:function(){w("[IAP] Undefined callbackError")},callbackListingSuccess:function(){w("[IAP] Undefined callbackListingSuccess")},callbackListingError:function(){w("[IAP] Undefined callbackListingError")},callbackPurchaseSuccess:function(){w("[IAP] Undefined callbackPurchaseSuccess")},requestedListingProductId:"",inappPurchaseCalled:!1,inappProductInfoCalled:!1,lastCreateUserProduct:null,lastCreateUserToken:null,refreshDone:!1,lastCreateuserUrl:"",lastCreateuserData:"",createUserAttempt:0,maxCreateUserAttempt:6,refreshInProgress:!1,productsInfo:{},initialize:function(e){return window.store?(ne.returnUrl=document.location.href,e.id?ne.id=e.id:b()?ne.id=e.id_android:S()&&(ne.id=e.id_ios),ne.id?(e.alias&&(ne.alias=e.alias),e.type&&(ne.type=e.type),e.api_createuser&&(ne.subscribeMethod=e.api_createuser),ne.verbosity="INFO",ne.paymethod=b()?"gwallet":"itunes",w("IAP initialize id: "+ne.id),b()&&ne.getGoogleAccount(),window.store.verbosity=window.store[ne.verbosity],window.store.register({id:ne.id,alias:ne.alias,type:window.store[ne.type]}),window.store.when(ne.alias).approved(function(e){ne.onPurchaseApproved(e)}),window.store.when(ne.alias).verified(function(e){ne.onPurchaseVerified(e)}),window.store.when(ne.alias).updated(function(e){ne.onProductUpdate(e)}),window.store.when(ne.alias).owned(function(e){ne.onProductOwned(e)}),window.store.when(ne.alias).cancelled(function(e){ne.onCancelledProduct(e)}),window.store.when(ne.alias).error(function(e){ne.error(JSON.stringify(e))}),window.store.ready(function(){ne.onStoreReady()}),window.store.when("order "+ne.id).approved(function(e){ne.onOrderApproved(e)}),window.store.when("product").updated(function(e){ne.saveProductInfo(e)}),!0):(v("[IAP] Configuration error, missing product id!"),!1)):(v("[IAP] Store not available, missing cordova plugin."),!1)},saveProductInfo:function(e){return ne.refreshInProgress=!1,"object"!=typeof e?void v("[IAP] saveProductInfo() got invalid data"):"id"in e?(ne.productsInfo[e.id]=e,void(ne.requestedListingProductId===e.id&&ne.callbackListingSuccess(e))):void v("[IAP] saveProductInfo() got invalid data, id undefined")},doRefresh:function(e){ne.refreshInProgress&&y("[IAP] doRefresh() refresh in progress, skipping..."),(!ne.refreshDone||e)&&(window.store.refresh(),ne.refreshDone=!0,ne.refreshInProgress=!0,w("[IAP] doRefresh() refreshing..."))},getPassword:function(e){return X("iap."+e+".playme").substr(0,8)},getGoogleAccount:function(){window.accountmanager.getAccounts(ne.checkGoogleAccount,ne.error,"com.google")},checkGoogleAccount:function(e){if(e){w("[IAP] accounts"),w(e);for(var t in e)return window.localStorage.setItem("googleAccount",e[t].email),e[t].email}},onProductUpdate:function(e){w("IAP> Product updated."),w(JSON.stringify(e)),w(e.owned?"[IAP] Subscribed!":"[IAP] Not Subscribed")},onPurchaseApproved:function(e){w("IAP> Purchase approved."),w(JSON.stringify(e)),e.finish()},onPurchaseVerified:function(e){w("subscription verified ",e)},onStoreReady:function(){w("\\o/ STORE READY \\o/")},onProductOwned:function(e){if(w("[IAP] > Product Owned."),!e.transaction.id&&S())return v("[IAP] > no transaction id"),!1;if(window.localStorage.setItem("product",e),S()&&window.localStorage.setItem("transaction_id",e.transaction.id),b()){var t=e.transaction.purchaseToken+"|"+T+"|"+ne.id;w("[IAP] Purchase Token: "+t),window.localStorage.getItem("user_account")||ne.createUser(e,t)}else window.storekit.loadReceipts(function(t){window.localStorage.getItem("user_account")||(t.appStoreReceipt?(w("[IAP] appStoreReceipt: "+t.appStoreReceipt),ne.createUser(e,t.appStoreReceipt)):w("[IAP] appStoreReceipt empty, ignoring request"))})},onCancelledProduct:function(e){K(!1),ne.callbackError({iap_cancelled:1,return_url:ne.returnUrl}),w("[IAP] > Purchase cancelled ##################################",e)},onOrderApproved:function(e){w("[IAP] ORDER APPROVED "+ne.id),e.finish()},error:function(e){K(!1),v("[IAP] error: "+e),ne.callbackError({iap_error:1,return_url:ne.returnUrl})},createUser:function(e,t){if(w("[IAP] createUser start "),!ne.inappProductInfoCalled&&!ne.inappPurchaseCalled)return ne.lastCreateUserProduct=e,void(ne.lastCreateUserToken=t);if(!ne.subscribeMethod)return void v("[IAP] createUser configuration error: missing api url.");window.localStorage.setItem("user_account",b()?window.localStorage.getItem("googleAccount")?window.localStorage.getItem("googleAccount"):t+"@google.com":e.transaction.id+"@itunes.com");var r=ne.subscribeMethod,n={paymethod:ne.paymethod,user_account:window.localStorage.getItem("user_account"),purchase_token:t,return_url:ne.returnUrl,inapp_pwd:ne.getPassword(t),hybrid:1};ne.lastCreateuserUrl=r,ne.lastCreateuserData=n;var i=function(e){if(ne.createUserAttempt<=ne.maxCreateUserAttempt)v("[IAP] createUser failed "+ne.createUserAttempt+" times, trying again... last error: "+JSON.stringify(e)),s();else{v("[IAP] createUser onCreateError: removing user_account"),window.localStorage.removeItem("user_account");var t={iap_error:"1",return_url:ne.returnUrl};K(!1),ne.inappPurchaseCalled?ne.callbackError(t):ne.inappProductInfoCalled&&ne.callbackListingError(t)}},o=function(e){w("[IAP] createUser success ",e);try{e.device_id=_.uuid,window.localStorage.getItem("transaction_id")&&(e.transaction_id=window.localStorage.getItem("transaction_id")),K(!1),ne.callbackSuccess(e),ne.inappPurchaseCalled?ne.callbackSuccess(e):ne.inappProductInfoCalled&&ne.callbackPurchaseSuccess(e)}catch(t){i(t)}},a=10,s=function(){setTimeout(function(){ne.createUserAttempt=ne.createUserAttempt+1,w("[IAP] createUser attempt: "+ne.createUserAttempt+" with timeout: "+a+"sec."),w("[IAP] POST createUser: "+ne.lastCreateuserUrl+" params: "+JSON.stringify(ne.lastCreateuserData)+" timeout: "+1e3*a),window.aja().method("POST").url(ne.lastCreateuserUrl).cache(!1).timeout(1e3*a).data(ne.lastCreateuserData).on("success",function(e){o(e)}).on("error",function(e){i(e)}).on("4xx",function(e){i(e)}).on("5xx",function(e){i(e)}).on("timeout",function(){i("timeout")}).on("end",function(){w("[IAP] createUser end"),K(!1)}).go(),a+=5},10)};ne.createUserAttempt=0,s()}},ie=function(){var e={},t={},r={},n=!1;return e.initialize=function(){if("object"!=typeof window.navigator||"object"!=typeof window.navigator.globalization)return v("[globalization] missing cordova plugin!"),!1;var e=new Promise(function(e){navigator.globalization.getPreferredLanguage(function(r){return"object"!=typeof r?(v("[globalization] initialize getPreferredLanguage result error: invalid type",r),void e({error:"invalid type"})):(w("[globalization] initialize getPreferredLanguage result ok: ",r),t=r,void e(r))},function(t){v("[globalization] initialize getPreferredLanguage result error: ",t),e({error:t})})}),i=new Promise(function(e){navigator.globalization.getLocaleName(function(t){return"object"!=typeof t?(v("[globalization] initialize getLocaleName result error: invalid type",t),void e({error:"invalid type"})):(w("[globalization] initialize getLocaleName result ok: ",t),r=t,void e(t))},function(t){v("[globalization] initialize getLocaleName result error: ",t),e({error:t})})});return Promise.all([e,i]).then(function(e){return n=!0,e})},e.getPreferredLanguage=function(){return n?t:(v("[globalization] getPreferredLanguage: not initialized!"),!1)},e.getLocaleName=function(){return n?r:(v("[globalization] getLocaleName: not initialized!"),!1)},e}();s.facebookLogin=function(e,t,r){return E?void facebookConnectPlugin.login(e.split(","),function(e){w("[facebook] got userdata: ",e),facebookConnectPlugin.getAccessToken(function(e){t({accessToken:e})},function(e){r({error:e})})},function(e){v("Got FB login error:",e),r({error:e})}):r("Stargate not initialized, call Stargate.initialize first!")},s.facebookShare=function(e,t,r){if(!E)return r("Stargate not initialized, call Stargate.initialize first!");var n={method:"share",href:e};facebookConnectPlugin.showDialog(n,function(e){t({message:e})},function(e){v("Got FB share error:",e),r({error:e})})};var oe=function(){deltadna.registerPushCallback(se)},ae=function(e){v("[DeltaDNA] error: "+e)},se=function(e){return b()&&e.payload&&e.payload.url&&!e.foreground?P(e.payload.url):S()&&e.url?P(e.url):void 0},ue=function(){var e={},t={},r=function(r){w("[CodePush] syncStatus: "+e.syncStatus[r]),t[r]&&Array===t[r].constructor&&t[r].forEach(function(e){e(r)})};e.syncStatus={0:"UP_TO_DATE",1:"UPDATE_INSTALLED",2:"UPDATE_IGNORED",3:"ERROR",4:"IN_PROGRESS",5:"CHECKING_FOR_UPDATE",6:"AWAITING_USER_ACTION",7:"DOWNLOADING_PACKAGE",8:"INSTALLING_UPDATE",AWAITING_USER_ACTION:6,CHECKING_FOR_UPDATE:5,DOWNLOADING_PACKAGE:7,ERROR:3,INSTALLING_UPDATE:8,IN_PROGRESS:4,UPDATE_IGNORED:2,UPDATE_INSTALLED:1,UP_TO_DATE:0},e.registerForNotification=function(e,r){return e?"function"!=typeof r?(v("[CodePush] registerForNotification: callback is not a function"),!1):(t[e]||(t[e]=[]),t[e].push(r),!0):(v("[CodePush] registerForNotification: undefined status requested"),!1)};var n=function(e){e&&w("[CodePush] Downloading "+e.receivedBytes+" of "+e.totalBytes)};return e.initialize=function(){return"undefined"==typeof window.codePush?(v("[CodePush] missing cordova plugin!"),!1):(e.syncStatus=window.SyncStatus,void window.codePush.sync(r,null,n))},e}(),ce=function(){var e,t={},r={};return t.init=function(){if(!window.plugins||!window.plugins.appsFlyer)return v("[appsflyer] missing cordova plugin");if("undefined"==typeof H.appstore_appid)return v("[appsflyer] missing manifest configuration: appstore_appid");if("undefined"==typeof H.appsflyer_devkey)return v("[appsflyer] missing manifest configuration: appsflyer_devkey");var t=[H.appsflyer_devkey];S()&&t.push(H.appstore_appid),document.addEventListener("onInstallConversionDataLoaded",function(t){if(r=t.detail,"function"!=typeof e)return w("[appsflyer] callback not set!");try{e(r),w("[appsflyer] parameters sent to webapp callback: "+JSON.stringify(r))}catch(n){v("[appsflyer] callback error: "+n,n)}},!1),window.plugins.appsFlyer.initSdk(t)},t.setCallback=function(t){e=t},t}();s.setConversionDataCallback=function(e){ce.setCallback(e)};var le=function(){var e,t={};return t.track=function(t){if("function"!=typeof e)return w("[analytics] callback not set!");try{e(t)}catch(r){v("[analytics] callback error: "+r,r)}},t.setCallback=function(t){e=t},t}();s.setAnalyticsCallback=function(e){le.setCallback(e)};var de={AdMobSupport:!1,MoPubSupport:!1,AdPosition:{NO_CHANGE:0,TOP_LEFT:1,TOP_CENTER:2,TOP_RIGHT:3,LEFT:4,CENTER:5,RIGHT:6,BOTTOM_LEFT:7,BOTTOM_CENTER:8,BOTTOM_RIGHT:9,POS_XY:10},AdSize:{SMART_BANNER:"SMART_BANNER",BANNER:"BANNER",MEDIUM_RECTANGLE:"MEDIUM_RECTANGLE",FULL_BANNER:"FULL_BANNER",LEADERBOARD:"LEADERBOARD",SKYSCRAPER:"SKYSCRAPER"},DefaultOptions:null,initialize:function(e,t,r){return e&&(de.DefaultOptions=e),AdMob&&(de.AdMobSupport=!0,de.initAdMob(e,t,r)),MoPub&&(de.MoPubSupport=!0),!0},isAdMobSupported:function(){return de.AdMobSupport},isMoPubSupported:function(){return de.MoPubSupport},getUserAgent:function(){return/(android)/i.test(navigator.userAgent)?"android":/(ipod|iphone|ipad)/i.test(navigator.userAgent)?"ios":"other"},initAdMob:function(e,t,r){var n={adSize:"BANNER",position:8,bgColor:"black",isTesting:!1,autoShow:!0};AdMob.setOptions(n,t,r)},registerAdEvents:function(e){document.addEventListener("onAdFailLoad",e),document.addEventListener("onAdLoaded",e),document.addEventListener("onAdPresent",e),document.addEventListener("onAdLeaveApp",e),document.addEventListener("onAdDismiss",e)},manageAdEvents:function(e){console.log("error: "+e.error+", reason: "+e.reason+", adNetwork:"+e.adNetwork+", adType:"+e.adType+", adEvent:"+e.adEvent)},createBanner:function(e,t,r){var n={},i=[],o=de.getUserAgent();e||de.isObjEmpty(de.DefaultOptions)||(e=de.DefaultOptions),Array.isArray(e)?i=e:i.push(e),i.forEach(function(e){if("default"==e.device||e.device==o){var i=de.getAdSize().toLowerCase();e.overlap&&(n.overlap=e.overlap),e.offsetTopBar&&(n.offsetTopBar=e.offsetTopBar),n.adSize=de.getAdSize(),i&&(n.adId=e[i]),e.position&&(n.position=de.AdPosition[e.position]),e.width&&(n.width=e.width),e.height&&(n.height=e.height),e.autoShow&&(n.autoShow=e.autoShow),"admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?(e.width&&e.height&&(n.adSize="CUSTOM"),AdMob.createBanner(n,t,r)):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.createBanner(n,t,r)}})},showBannerAtSelectedPosition:function(e){var t=[],r=de.getUserAgent();e||de.isObjEmpty(de.DefaultOptions)||(e=de.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){("default"==e.device||e.device==r)&&("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showBanner(e.position):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showBanner(e.position))})},showBannerAtGivenXY:function(e){var t=[],r=de.getUserAgent();e||de.isObjEmpty(de.DefaultOptions)||(e=de.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){("default"==e.device||e.device==r)&&("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showBannerAtXY(e.x,e.y):"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showBannerAtXY(e.x,e.y))})},hideBanner:function(e){var t=[],r=de.getUserAgent();e||de.isObjEmpty(de.DefaultOptions)||(e=de.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){("default"==e.device||e.device==r)&&("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.hideBanner():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.hideBanner())})},removeBanner:function(e){var t=[],r=de.getUserAgent();e||de.isObjEmpty(de.DefaultOptions)||(e=de.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){("default"==e.device||e.device==r)&&("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.removeBanner():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.removeBanner())})},prepareInterstitial:function(e,t,r){var n={},i=[],o=de.getUserAgent();e||de.isObjEmpty(de.DefaultOptions)||(e=de.DefaultOptions),Array.isArray(e)?i=e:i.push(e),i.forEach(function(e){("default"==e.device||e.device==o)&&(e.interstitial&&(n.adId=e.interstitial),e.autoShow&&(n.autoShow=e.autoShow),"admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.prepareInterstitial(n):"mopub"==e.network.toLowerCase()&&MoPub.prepareInterstitial(n,t,r))})},showInterstitial:function(e){var t=[],r=de.getUserAgent();e||de.isObjEmpty(de.DefaultOptions)||(e=de.DefaultOptions),Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){("default"==e.device||e.device==r)&&("admob"==e.network.toLowerCase()||"dfp"==e.network.toLowerCase()?AdMob.showInterstitial():"mopub"==e.network.toLowerCase().toLowerCase()&&MoPub.showInterstitial())})},isObjEmpty:function(e){return 0===Object.keys(e).length},getAdSize:function(){var e=screen.height,t=screen.width;return t>=728&&e>=90?de.AdSize.LEADERBOARD:t>=468&&e>=60?de.AdSize.BANNER:t>=320&&e>=50?de.AdSize.BANNER:void 0}};return s.game=u.game._public,s.file=u.file,s.AdManager=u.AdManager,s});