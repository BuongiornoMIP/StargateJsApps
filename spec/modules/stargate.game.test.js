/**
 * Created by pasquale on 01/02/16.
 */
function isRunningOnIos(){
	return window.device.platform.toLowerCase() == "ios";
}

function isRunningOnAndroid(){
	return window.device.platform.toLowerCase() == "android";
}

var cartoon_race = {"id":"4964643bb3ba4a9b7a22955abfcdee4c","title":"Cartoon Race","description":"You are the World best F1 driver but now you also have to count with gingermen, yetis y devils. Will you finish #1 in all races?\n","publisher":{"title_publisher":"happylander","url_publisher":"#!/publisher/happylander"},"description_short":"You are the World best F1 driver but now you also have to count with gingermen, yetis y devils. W...","images":{"screenshot":["http://s2.motime.com/p/bcontents/absimageappscreenshot0_8/h[HSIZE]/w[WSIZE]/xx_gameasy/mnt/alfresco_content_prod/contentstore/2014/12/18/17/33/19b7144b-c110-498e-b65c-0c51bb66bc27/cartoon-race.bin?v=1464691130","http://s2.motime.com/p/bcontents/absimageappscreenshot0_8/h[HSIZE]/w[WSIZE]/xx_gameasy/mnt/alfresco_content_prod/contentstore/2014/12/18/17/33/5cd65906-25b5-4183-96f1-628e8c75ef8f/cartoon-race.bin?v=1464691130","http://s2.motime.com/p/bcontents/absimageappscreenshot0_8/h[HSIZE]/w[WSIZE]/xx_gameasy/mnt/alfresco_content_prod/contentstore/2014/12/18/17/33/1c517390-34b5-48af-9704-01669b83aba0/cartoon-race.bin?v=1464691130"],"cover":{"ratio_0_7":"http://s2.motime.com/p/bcontents/absimageapp0_7/h[HSIZE]/w[WSIZE]/xx_gameasy/mnt/alfresco_content_prod/contentstore/2014/12/18/17/33/fbf82f17-58d7-4514-9776-83b08c7e18f1/cartoon-race.bin?v=1464691130","ratio_1_4":"http://s2.motime.com/p/bcontents/absimageapp1_4/h[HSIZE]/w[WSIZE]/xx_gameasy/mnt/alfresco_content_prod/contentstore/2014/12/18/17/33/0878054e-51b6-4ef9-ba03-ca6cd827b1d5/cartoon-race.bin?v=1464691130","ratio_1":"http://s2.motime.com/p/bcontents/absimageapp1/h[HSIZE]/w[WSIZE]/xx_gameasy/mnt/alfresco_content_prod/contentstore/2014/12/18/17/33/dd35229e-2f04-4afb-ada5-765acb1648f5/cartoon-race.bin?v=1464691130","ratio_2":"http://s2.motime.com/p/bcontents/absimageapp2/h[HSIZE]/w[WSIZE]/xx_gameasy/mnt/alfresco_content_prod/contentstore/2014/12/18/17/33/3b89fb73-0f78-488c-b03b-690843103755/cartoon-race.bin?v=1464691130","ratio_1_5":"http://s2.motime.com/p/bcontents/absimageapp1_5/h[HSIZE]/w[WSIZE]/xx_gameasy/mnt/alfresco_content_prod/contentstore/2014/12/18/17/33/7d37d45d-8393-423e-9c6f-ebbf2a53e599/cartoon-race.bin?v=1464691130"},"icon":"http://s2.motime.com/p/bcontents/absimageappicon/h[HSIZE]/w[WSIZE]/xx_gameasy/mnt/alfresco_content_prod/contentstore/2014/12/18/17/33/16cdaf6a-0707-4b43-9bc5-a1223bb3e5a6/cartoon-race.bin?v=1464691130"},"category":{"id_category":"11d0daee0c60f48ade3f90f85f36c425","name_category":"Sports","cs_id":"3dc7cd69-9035-4faf-b688-8683a697fe79","born_date_category":"Mon, 16 Nov 2015 10:58:46 -0000","inserted_date_category":"Fri, 11 Dec 2015 14:17:07 -0000","source_id":"alfresco_xx_gameasy_Sports","supplier_id":"alfresco","url_cover":"http://s2.motime.com/p/bcontents/absimageappraw/h1/w1/xx_gameasy/mnt/alfresco_content_prod/contentstore/2016/2/15/12/53/67082bf4-1cb2-4bc4-8594-fc49cb3ee557/sports.bin?v=1464687804","url_category":"#!/category/11d0daee0c60f48ade3f90f85f36c425/Sports","url_leaf_engine_subscription_category":"","url_preview_big_category":"","url_preview_small_category":""},"url_zoom":"http://www2.gameasy.com/ww-it/#!/games/cartoon-race_4964643bb3ba4a9b7a22955abfcdee4c","url_zoom_simple":"cartoon-race_4964643bb3ba4a9b7a22955abfcdee4c","img_qrcode":"http://www2.gameasy.com/ww-it/qrcode?text=http%3A%2F%2Fwww2.gameasy.com%2Fww-it%2Fsetwelcome%3Freturn_url%3Dhttp%253A%252F%252Fwww2.gameasy.com%252Fww-it%252F%2523%2521%252Fgames%252Fcartoon-race_4964643bb3ba4a9b7a22955abfcdee4c","url_share":"http://www2.gameasy.com/ww-it/share/games/cartoon-race_4964643bb3ba4a9b7a22955abfcdee4c.html","url_leaf_engine_subscription":"http://www2.gameasy.com/ww-it/subscribe/content/4964643bb3ba4a9b7a22955abfcdee4c","url_api_dld":"http://www2.gameasy.com/ww-it/v01/contents/4964643bb3ba4a9b7a22955abfcdee4c/download?formats=html5applications","size":"7,96 MB","compatibility":true,"alfresco_id":"HA990001723","counters_matches":1,"counters_favourites":0,"cs_id":"HA990001723","url_play":"http://www2.gameasy.com/ww-it/html5gameplay/4964643bb3ba4a9b7a22955abfcdee4c/game/cartoon-race","has_sdk":true,"format":"html5applications","access_type":{"guest":false,"free":false,"premium":true},"offline_available":true,
response_api_dld:{
status: 200,
url_download: "http://www2.gameasy.com/ww-it/html5gameplay/49/64/4964643bb3ba4a9b7a22955abfcdee4c/xx_gameasy/game/cartoonRace_index.htm",
binary_url: "http://s2.motime.com/p/bcontents/appsdownload/xx_gameasy/2015/11/23/11/34/1bbd3e42-f44d-4af0-be49-3bce44c49783/cartoon-race.bin?v=1464691130",
binary_md5: "2602e681e5062a7f66ff7588f36a745c",
message: "WEBAPP_CONTENT_DOWNLOAD_STARTED"
}};


var conf = {
	bundle_games:
	[
		"7329ebbdf49065552dac00f4f6e1be10",
		"fd9ac2e5c1aeba0b89270688569d8f6e",
		"4cf74f31e3cf4f75d33d191b78639a57"
	],
	sdk_url:"http://s2.motime.com/js/wl/webstore_html5game/gfsdk/dist/gfsdk.js"+"?timestamp=" + Date.now(),
	dixie_url:"http://s2.motime.com/tbr/dixie.js?country=it-igames"+"&timestamp=" + Date.now(),
	ga_for_game_url:"http://www2.gameasy.com/ww-it/ga_for_games.js",
	gamifive_info_api:"http://www2.gameasy.com/ww-it/v01/gameplay_proxy",
	api:"http://resources2.buongiorno.com/lapis/apps/contents.getList"
};

var GAMES_DIR = "";

var userjson = {"data_iscr":"2016-03-11","modo_billing":null,"destinatario":"+12345678","numero":"+12345678","phone_company":"fake.xx","crediti_nonpremium":10,"crediti_nonpremium_extra":null,"data_scadenza_abb":"2016-04-18","premium_extra":null,"crediti_premium1":null,"crediti_nonpremium_rimasti":null,"points":null,"sweeps_opt_in":null,"subscription_start_date":null,"data_prossimo_rinnovo":"2016-03-18","operator":"fake.xx","mlist":null,"email":null,"privacy_agreed":false,"date_privacy_cookie_agree":null,"date_privacy_cookie_disagree":null,"data_ultimo_billing":"2016-03-11","downloads":null,"capid":null,"creativityid":null,"subscription_profile":"","chk":"","livello_utente":false,"stato_utente":1,"crediti_premium2":0,"id_operatore":0,"canDownload":true,"crediti_token_abbonamento_rimasti":10,"data_scadenza_abbonamento":"2016-03-18","data_iscr_utc":1457654400,"data_scadenza_abb_utc":1458259200,"data_prossimo_rinnovo_utc":1458259200,"data_ultimo_billing_utc":1457654400,"data_scadenza_abbonamento_utc":1458259200,"data_iscr_GMDATE":"2016-03-11T00:00:00+00:00","data_iscr_DATE":"2016-03-11T00:00:00+00:00","data_iscr_YEAR":2016,"data_iscr_HH":0,"data_iscr_MM":0,"data_iscr_SS":0,"data_iscr_MONTH":3,"data_iscr_DAY":11,"data_iscr_CDAY":11,"data_iscr_CMONTH":null,"data_iscr_postDate":"2016-03-11","data_iscr_postTime":"00:00:00","data_iscr_postSince":"10  ","data_iscr_formatted":"11  2016","data_iscr_numeric_formatted":"11\/3\/2016","data_scadenza_abb_GMDATE":"2016-03-18T00:00:00+00:00","data_scadenza_abb_DATE":"2016-03-18T00:00:00+00:00","data_scadenza_abb_YEAR":2016,"data_scadenza_abb_HH":0,"data_scadenza_abb_MM":0,"data_scadenza_abb_SS":0,"data_scadenza_abb_MONTH":3,"data_scadenza_abb_DAY":18,"data_scadenza_abb_CDAY":18,"data_scadenza_abb_CMONTH":null,"data_scadenza_abb_postDate":"2016-03-18","data_scadenza_abb_postTime":"00:00:00","data_scadenza_abb_postSince":"1  ","data_scadenza_abb_formatted":"18  2016","data_scadenza_abb_numeric_formatted":"18\/3\/2016","data_prossimo_rinnovo_GMDATE":"2016-03-18T00:00:00+00:00","data_prossimo_rinnovo_DATE":"2016-03-18T00:00:00+00:00","data_prossimo_rinnovo_YEAR":2016,"data_prossimo_rinnovo_HH":0,"data_prossimo_rinnovo_MM":0,"data_prossimo_rinnovo_SS":0,"data_prossimo_rinnovo_MONTH":3,"data_prossimo_rinnovo_DAY":18,"data_prossimo_rinnovo_CDAY":18,"data_prossimo_rinnovo_CMONTH":null,"data_prossimo_rinnovo_postDate":"2016-03-18","data_prossimo_rinnovo_postTime":"00:00:00","data_prossimo_rinnovo_postSince":"1  ","data_prossimo_rinnovo_formatted":"18  2016","data_prossimo_rinnovo_numeric_formatted":"18\/3\/2016","data_ultimo_billing_GMDATE":"2016-03-11T00:00:00+00:00","data_ultimo_billing_DATE":"2016-03-11T00:00:00+00:00","data_ultimo_billing_YEAR":2016,"data_ultimo_billing_HH":0,"data_ultimo_billing_MM":0,"data_ultimo_billing_SS":0,"data_ultimo_billing_MONTH":3,"data_ultimo_billing_DAY":11,"data_ultimo_billing_CDAY":11,"data_ultimo_billing_CMONTH":null,"data_ultimo_billing_postDate":"2016-03-11","data_ultimo_billing_postTime":"00:00:00","data_ultimo_billing_postSince":"10  ","data_ultimo_billing_formatted":"11  2016","data_ultimo_billing_numeric_formatted":"11\/3\/2016","data_scadenza_abbonamento_GMDATE":"2016-03-18T00:00:00+00:00","data_scadenza_abbonamento_DATE":"2016-03-18T00:00:00+00:00","data_scadenza_abbonamento_YEAR":2016,"data_scadenza_abbonamento_HH":0,"data_scadenza_abbonamento_MM":0,"data_scadenza_abbonamento_SS":0,"data_scadenza_abbonamento_MONTH":3,"data_scadenza_abbonamento_DAY":18,"data_scadenza_abbonamento_CDAY":18,"data_scadenza_abbonamento_CMONTH":null,"data_scadenza_abbonamento_postDate":"2016-03-18","data_scadenza_abbonamento_postTime":"00:00:00","data_scadenza_abbonamento_postSince":"1  ","data_scadenza_abbonamento_formatted":"18  2016","data_scadenza_abbonamento_numeric_formatted":"18\/3\/2016","user_billed_":true,"checkmail":0,"user":"903833c2c35a11e589cb005056b60712","msisdn":"+12345678","description_remaining_credits":"","mipuser_email":null,"fb_name":null,"auth_id":null,"nickname":"psql","avatar":"virgilio.png","subscribed":true,"logged":1,
ponyUrl:"&_PONY=13-b0c925a4c405718e7ba731340c018044000719127.000.000.0017VRNi9swEP0tq4MP22yRLH9IAV8KZVko3UKvATOWxo2ILRlZLkmX%2FPfKdja5pH%2BgrW8z8zTz5r3Bb8TY1tVTQBuQbAnNxgDhPVGxRHnUJph68NibqU8rmmgIUJtR%2BSqlrHii%2FImxxOjaDejjW48RM%2BydxVq5fgB7qlo44Mfj8drMOnvpV7FLv1GBRvsLamiaW1%2BRaByDsRHhjas%2BsJRneVGKxE49elddY7U%2FVDktKdc5SJ1q2fJCZkiZarkuCqpTkZMN0aDBYphG9MuyoFtv0Oqxnteexsg8dLqKVGEK%2Bzq4A9rq4fHb6%2FPzy%2Bvjw9uOzE9f9I5sd%2BR9%2BI5sdiSmfxqFl9K88CWzVOOK%2BH1qomZmCMbZBXRT74r5AmP4ZLrO2B9%2FgnzF432IuDvps9X3YIN3relwKS2Jd%2FOu9KNfK9KsbGX81k0XpVYFlkQk5CHGF3XqJrLDdeppAay2z08YPc%2Bxm2zwpwUxTzknCrvuZqYbbhcTfVVCKFmy6GILIKmQOedKZ1wURUt1SaOvyxHPTcjWTl23Gj3iOEYFotElZ5hKmWeoVQucpyVkIk8hizmtKMYOdUO2QhQZlYzTDRnAQ1%2BD93CKi%2F2%2Fm7%2F5bv6Vn19vhssBS8pF1CJVPAfGMBdSNZTmNC%2BagpYsJefzbw%3D%3DEND"
};

var dictjson = {};
var configjson = {
	MOA_API_APPLICATION_OBJECTS_GET:"http://resources.buongiorno.com/lapis/apps/application-object.get?external_token=:EXTERNAL_TOKEN&access_token=:ACCESS_TOKEN&collection=:COLLECTION&id=:ID&query=:QUERY&white_label=xx_gameasy&fw=gameasy&vh=ww.gameasy.com",
	MOA_API_APPLICATION_OBJECTS_SET:"http://resources.buongiorno.com/lapis/apps/application-object.set?external_token=:EXTERNAL_TOKEN&access_token=:ACCESS_TOKEN&collection=:COLLECTION&id=:ID&white_label=xx_gameasy&fw=gameasy&vh=ww.gameasy.com"
};

var cookiejson = {"_ga":"GA1.2.1113339269.1453287779","trkdada":"fwAAAVaeSdR7HHxvAwNKAg==","prvcflag":1,"newton-session":"%229HiA%3D1v)*ErJ%22","operator":"fake.it","mipuser":"aac3121ebf5111e5a728005056b60712","_gat":1,"b_test_id":"10003220160310_ff916827ad09d6ff90896fa27af347f0"};
function writeJson(name, object){
	return stargateModules.file.createFile(cordova.file.applicationStorageDirectory, name)
		.then(function(result){
			return stargateModules.file.write(result.path,JSON.stringify(object))
		});
}

var juicy =
{
	"id":"4de756a55ac71f45c5b7b4211b71219e",
	"title":"Fruit Slicer",
	"description":"Slice fruits, make combos & break records!",
	"publisher":{
		"title_publisher":"alexanderPorubov",
		"url_publisher":"#!\/publisher\/alexanderPorubov"
	},
	"description_short":"Slice fruits, make combos & break records!",
	"images":{
		"screenshot":[
			"http:\/\/s2.motime.com\/p\/bcontents\/absimageappscreenshot0_8\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/27\/16\/44\/bc3519c2-38d3-4378-a23d-fe06396b3932\/fruit-slicer.bin?v=1455555646",
			"http:\/\/s2.motime.com\/p\/bcontents\/absimageappscreenshot0_8\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/27\/16\/44\/546e2a1e-d52d-4983-973d-71babf723107\/fruit-slicer.bin?v=1455555646",
			"http:\/\/s2.motime.com\/p\/bcontents\/absimageappscreenshot0_8\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/27\/16\/44\/cc67c3ba-a2d7-4b17-abb7-01f2b885b744\/fruit-slicer.bin?v=1455555646"
		],
		"cover":{
			"ratio_1_4":"http:\/\/s2.motime.com\/p\/bcontents\/absimageapp1_4\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/27\/16\/44\/c5e35302-5776-4a9d-bf4c-3501e2dce850\/fruit-slicer.bin?v=1455555646",
			"ratio_0_7":"http:\/\/s2.motime.com\/p\/bcontents\/absimageapp0_7\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/27\/16\/44\/7a02027e-7998-4d86-82ac-4e035cb495db\/fruit-slicer.bin?v=1455555646",
			"ratio_1":"http:\/\/s2.motime.com\/p\/bcontents\/absimageapp1\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/27\/16\/44\/bb9ce100-9250-4875-8db7-8d72628f0d51\/fruit-slicer.bin?v=1455555646",
			"ratio_2":"http:\/\/s2.motime.com\/p\/bcontents\/absimageapp2\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/27\/16\/44\/4d9f5cc2-35ac-4da1-98c6-464afd7d84dd\/fruit-slicer.bin?v=1455555646",
			"ratio_1_5":"http:\/\/s2.motime.com\/p\/bcontents\/absimageapp1_5\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/27\/16\/44\/9b26ea5e-874b-4137-9c12-8ed66e54cf8d\/fruit-slicer.bin?v=1455555646"
		},
		"icon":"http:\/\/s2.motime.com\/p\/bcontents\/absimageappicon\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/27\/16\/44\/3a87847e-b08a-4c6f-822b-8e9bd1314e23\/fruit-slicer.bin?v=1455555646"
	},
	"category":{
		"id_category":"0ea1cbfb288aee1a1cc1579f97696dc7",
		"name_category":"Beat the score",
		"cs_id":"0eea88cf-d140-461e-98eb-62735f12d75e",
		"born_date_category":"Mon, 16 Nov 2015 10:58:45 -0000",
		"inserted_date_category":"Fri, 11 Dec 2015 14:17:05 -0000",
		"source_id":"alfresco_xx_gameasy_Beat the score",
		"supplier_id":"alfresco",
		"url_cover":"http:\/\/s2.motime.com\/p\/bcontents\/absimageappraw\/h1\/w1\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2016\/2\/15\/12\/53\/0576ffb9-f5ab-438d-8752-ff460752c68a\/beat-the-score.bin?v=1455555402",
		"url_category":"#!\/category\/0ea1cbfb288aee1a1cc1579f97696dc7\/Beat+the+score",
		"url_leaf_engine_subscription_category":"",
		"url_preview_big_category":"",
		"url_preview_small_category":""
	},
	"url_zoom":"#!\/games\/fruit-slicer_4de756a55ac71f45c5b7b4211b71219e",
	"url_zoom_simple":"fruit-slicer_4de756a55ac71f45c5b7b4211b71219e",
	"img_qrcode":"\/qrcode?text=%2Fsetwelcome%3Freturn_url%3D%252F%2523%2521%252Fgames%252Ffruit-slicer_HA990001689",
	"url_share":"\/share\/games\/fruit-slicer_HA990001689",
	"url_leaf_engine_subscription":"\/subscribe\/content\/HA990001689",
	"url_api_dld":"\/v01\/contents\/4de756a55ac71f45c5b7b4211b71219e\/download?formats=html5applications",
	"size":"7,17 MB",
	"alfresco_id":"HA990001689",
	"counters_matches":91,
	"counters_favourites":0,
	"cs_id":"HA990001689",
	"url_play":"\/html5gameplay\/4de756a55ac71f45c5b7b4211b71219e\/game\/fruit-slicer",
	"has_sdk":true,
	"format":"html5applications",
	"access_type":{
		"guest":false,
		"free":false,
		"premium":true
	},
	"offline_available":true,
	response_api_dld: {
		"status":200,
		"url_download":"http:\/\/www2.gameasy.com\/ww\/html5gameplay\/01\/93\/019315303f5014ee53877ca1ff9d96b3\/xx_gameasy\/game\/Juicy_dash_boungourno\/juicy_dash_index.html",
		"binary_url":"http:\/\/s2.motime.com\/p\/bcontents\/appsdownload\/xx_gameasy\/2015\/10\/22\/13\/2\/1086a078-207c-41a8-b24f-9ed1afd17176\/juicy-dash.bin?v="+Date.now(),
		"binary_md5":"e8a852d5b1cee637d5b17ce813113083",
		"message":"WEBAPP_CONTENT_DOWNLOAD_STARTED"
	}
};

var impossible = {"id":"5ae518927ae19093dc6363f812c62c58","title":"Impossible Super Ninja","description":"The most intense one-button game.","publisher":{"title_publisher":"doubleSmith","url_publisher":"#!\/publisher\/doubleSmith"},"description_short":"The most intense one-button game.","images":{"screenshot":["http:\/\/s2.motime.com\/p\/bcontents\/absimageappscreenshot0_8\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2015\/12\/21\/13\/7\/7da71cbe-52a0-4e72-958f-1fe95311ac94\/impossible-super-ninja.bin?v=1459902869","http:\/\/s2.motime.com\/p\/bcontents\/absimageappscreenshot0_8\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2015\/12\/21\/13\/7\/7f6bcaf9-9d2b-47be-b9fe-8f6ccd0eb887\/impossible-super-ninja.bin?v=1459902869","http:\/\/s2.motime.com\/p\/bcontents\/absimageappscreenshot0_8\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2015\/12\/21\/13\/7\/79998eda-b548-47ff-ac7a-e0bbefed36dd\/impossible-super-ninja.bin?v=1459902869"],"cover":{"ratio_0_7":"http:\/\/s2.motime.com\/p\/bcontents\/absimageapp0_7\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2015\/12\/21\/13\/7\/df4c2944-6e19-4fd3-bb35-16d25aecdc18\/impossible-super-ninja.bin?v=1459902869","ratio_1_4":"http:\/\/s2.motime.com\/p\/bcontents\/absimageapp1_4\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2015\/12\/21\/13\/7\/11a3ef3c-382a-4cb0-88eb-dfab685d32ef\/impossible-super-ninja.bin?v=1459902869","ratio_1":"http:\/\/s2.motime.com\/p\/bcontents\/absimageapp1\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2015\/12\/21\/13\/7\/2dffd5c8-3563-4ea2-af3f-d55669e58b79\/impossible-super-ninja.bin?v=1459902869","ratio_2":"http:\/\/s2.motime.com\/p\/bcontents\/absimageapp2\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2015\/12\/21\/13\/7\/0346e797-9453-440f-8eb5-10d3dbf53808\/impossible-super-ninja.bin?v=1459902869","ratio_1_5":"http:\/\/s2.motime.com\/p\/bcontents\/absimageapp1_5\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2015\/12\/21\/13\/7\/81ab50e0-aa7b-4723-a3e0-b4036c6f24ef\/impossible-super-ninja.bin?v=1459902869"},"icon":"http:\/\/s2.motime.com\/p\/bcontents\/absimageappicon\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2015\/12\/21\/13\/7\/b85bb5ca-8c41-4501-aaa3-1469c57d834f\/impossible-super-ninja.bin?v=1459902869"},"category":{"id_category":"5bfa4fcff1f05613b419ebb072035925","name_category":"Adventure","cs_id":"60e9cc48-2662-4ad7-9e1d-dc27b9e5b3d3","born_date_category":"Thu, 26 Nov 2015 08:17:47 -0000","inserted_date_category":"Fri, 11 Dec 2015 14:17:05 -0000","source_id":"alfresco_xx_gameasy_Adventure","supplier_id":"alfresco","url_cover":"http:\/\/s2.motime.com\/p\/bcontents\/absimageappraw\/h1\/w1\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2016\/2\/15\/12\/53\/c710daba-eab8-4a49-9dcf-e1e29a2e2fa2\/adventure.bin?v=1460361489","url_category":"#!\/category\/5bfa4fcff1f05613b419ebb072035925\/Adventure","url_leaf_engine_subscription_category":"","url_preview_big_category":"","url_preview_small_category":""},"url_zoom":"#!\/games\/impossible-super-ninja_5ae518927ae19093dc6363f812c62c58","url_zoom_simple":"impossible-super-ninja_5ae518927ae19093dc6363f812c62c58","img_qrcode":"\/qrcode?text=%2Fsetwelcome%3Freturn_url%3D%252F%2523%2521%252Fgames%252Fimpossible-super-ninja_HA990001809","url_share":"\/share\/games\/impossible-super-ninja_HA990001809","url_leaf_engine_subscription":"\/subscribe\/content\/HA990001809","url_api_dld":"http:\/\/www.gameasy.com\/ww\/\/v01\/contents\/5ae518927ae19093dc6363f812c62c58\/download?formats=html5applications","size":"6,57 MB","compatibility":true,"alfresco_id":"HA990001809","counters_matches":0,"counters_favourites":0,"cs_id":"HA990001809","url_play":"\/html5gameplay\/5ae518927ae19093dc6363f812c62c58\/game\/impossible-super-ninja","has_sdk":true,"format":"html5applications","access_type":{"guest":false,"free":false,"premium":true},"offline_available":true,
	response_api_dld:{
	status: 200,
		url_download: "http://www2.gameasy.com/ww/html5gameplay/5a/e5/5ae518927ae19093dc6363f812c62c58/xx_gameasy/game/impossiblesuperninja_index.html",
	binary_url: "http://s2.motime.com/p/bcontents/appsdownload/xx_gameasy/2016/2/5/8/54/9618d49c-8c89-4805-b66f-47a5ba15ae1d/impossible-super-ninja.bin?v=1459902869",
	binary_md5: "d7dc7fee91c10b15fd75ab32d5964aa4",
	message: "WEBAPP_CONTENT_DOWNLOAD_STARTED"
}};

var majong = {
	"id": "74990332995a695e0dba36441ff7f631",
	"title": "Monsterjong",
	"description": "Be the best Mahjong player ever while defating epic monsters",
	"publisher": {
	"title_publisher": "konstantinBoronenkov",
		"url_publisher": "#!\/publisher\/konstantinBoronenkov"
},
	"description_short": "Be the best Mahjong player ever while defating epic monsters",
	"images": {
	"screenshot": ["http:\/\/s.motime.com\/p\/bcontents\/absimageappscreenshot0_8\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/26\/11\/25\/a88be4e2-2fc3-4838-9083-31a67a241196\/monsterjong.bin?v=1458093862", "http:\/\/s.motime.com\/p\/bcontents\/absimageappscreenshot0_8\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/26\/11\/25\/ca5cf1f4-dcb4-4670-8279-a3dec5b4eff2\/monsterjong.bin?v=1458093862", "http:\/\/s.motime.com\/p\/bcontents\/absimageappscreenshot0_8\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/26\/11\/25\/986eafbf-5ffe-4b5f-89c2-afc595480bdf\/monsterjong.bin?v=1458093862"],
		"cover": {
		"ratio_0_7": "http:\/\/s.motime.com\/p\/bcontents\/absimageapp0_7\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/26\/11\/24\/78fa9c26-d04d-45c9-9b51-7a333695e2c5\/monsterjong.bin?v=1458093862",
			"ratio_1_4": "http:\/\/s.motime.com\/p\/bcontents\/absimageapp1_4\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/26\/11\/23\/97b9e366-7ab1-458c-9f7e-20826d39b7af\/monsterjong.bin?v=1458093862",
			"ratio_1": "http:\/\/s.motime.com\/p\/bcontents\/absimageapp1\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/26\/11\/24\/7ca50dc0-4dba-401b-9a1f-f0b49fca0048\/monsterjong.bin?v=1458093862",
			"ratio_2": "http:\/\/s.motime.com\/p\/bcontents\/absimageapp2\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/26\/11\/24\/3eaa528f-01f8-4fa6-99b0-cfce1d992806\/monsterjong.bin?v=1458093862",
			"ratio_1_5": "http:\/\/s.motime.com\/p\/bcontents\/absimageapp1_5\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/26\/11\/24\/a41df621-32de-41d9-a5d9-2df7890b0060\/monsterjong.bin?v=1458093862"
	},
	"icon": "http:\/\/s.motime.com\/p\/bcontents\/absimageappicon\/h[HSIZE]\/w[WSIZE]\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2014\/8\/26\/11\/24\/c5ba2fdf-62a3-4234-8620-fc908451c8f3\/monsterjong.bin?v=1458093862"
},
	"category": {
	"id_category": "d9fb770158b841958e1c868c1c410fe8",
		"name_category": "Puzzle",
		"cs_id": "60353c07-2b2e-40ef-9959-b448c20e7f9c",
		"born_date_category": "Mon, 16 Nov 2015 10:58:45 -0000",
		"inserted_date_category": "Tue, 02 Feb 2016 10:02:08 -0000",
		"source_id": "alfresco_xx_gameasy_Puzzle",
		"supplier_id": "alfresco",
		"url_cover": "http:\/\/s.motime.com\/p\/bcontents\/absimageappraw\/h1\/w1\/xx_gameasy\/mnt\/alfresco_content_prod\/contentstore\/2016\/2\/15\/12\/53\/a543605c-db28-4c87-a6c3-1e0dce0b268a\/puzzle.bin?v=1458558446",
		"url_category": "#!\/category\/d9fb770158b841958e1c868c1c410fe8\/Puzzle",
		"url_leaf_engine_subscription_category": "",
		"url_preview_big_category": "",
		"url_preview_small_category": ""
},
	"url_zoom": "#!\/games\/monsterjong_74990332995a695e0dba36441ff7f631",
	"url_zoom_simple": "monsterjong_74990332995a695e0dba36441ff7f631",
	"img_qrcode": "http:\/\/www.gameasy.com\/ww\/\/qrcode?text=http%3A%2F%2Fwww.gameasy.com%2Fww%2F%2Fsetwelcome%3Freturn_url%3Dhttp%253A%252F%252Fwww.gameasy.com%252Fww%252F%252F%2523%2521%252Fgames%252Fmonsterjong_HA990001690",
	"url_share": "http:\/\/www.gameasy.com\/ww\/\/share\/games\/monsterjong_HA990001690",
	"url_leaf_engine_subscription": "http:\/\/www.gameasy.com\/ww\/\/subscribe\/content\/HA990001690",
	"url_api_dld": "http:\/\/www.gameasy.com\/ww\/\/v01\/contents\/74990332995a695e0dba36441ff7f631\/download?formats=html5applications",
	"size": "7,23 MB",
	"compatibility": true,
	"alfresco_id": "HA990001690",
	"counters_matches": 0,
	"counters_favourites": 0,
	"cs_id": "HA990001690",
	"url_play": "http:\/\/www.gameasy.com\/ww\/\/html5gameplay\/74990332995a695e0dba36441ff7f631\/game\/monsterjong",
	"has_sdk": true,
	"format": "html5applications",
	"access_type": {
	"guest": false,
		"free": false,
		"premium": true
},
	"offline_available": true,
	"response_api_dld": {
	"status": 200,
		"url_download": "http://www.gameasy.com/ww/html5gameplay/74/99/74990332995a695e0dba36441ff7f631/xx_gameasy/game/monsterjong_index.html",
		"binary_url": "http://s.motime.com/p/bcontents/appsdownload/xx_gameasy/2015/11/10/12/26/c14dc898-672a-46a1-9d01-17249d9067d2/monsterjong.bin?v=1458698711",
		"binary_md5": "1d699f60ff43bdc0e60e14296941e71f",
		"message": "WEBAPP_CONTENT_DOWNLOAD_STARTED"
}
};

function createFolder(where, name){
	return new Promise(function(resolve,reject){
		window.resolveLocalFileSystemURL(where,
			function(dirEntry){
				dirEntry.getDirectory(name, {create:true},
					function(entry){
						resolve(entry);
					}, function(err){
						reject(err);
					}
				);
			},
			function(err){
				reject(err);
			});
	});
}

function mock_file_download_success(url, filepath, saveAsName, _onProgress){
	console.log("DOWNLOAD MOCK", url, filepath, saveAsName, _onProgress);
	var transformedObj = {
		path:filepath + saveAsName,
		internalURL:"cdv:xxx",
		isFile:true,
		isDirectory:false
	};
	return Promise.resolve(new Array(transformedObj));
}

function promResolvedWith(obj){
	return function(){
		return Promise.resolve(obj);
	}
}

function promRejectWith(obj){
	return Promise.reject(obj);
}

function fileExists(url){
	return new Promise(function(resolve){
		window.resolveLocalFileSystemURL(url, function(entry){

			resolve(entry.isFile);

		}, function(fileError){
			resolve(fileError.code !== 1);
		});
	});
}

function dirExists(url){
	return new Promise(function(resolve){
		window.resolveLocalFileSystemURL(url, function(entry){

			resolve(entry.isDirectory);

		}, function(fileError){
			resolve(fileError.code !== 1);
		});
	});
}

function readDir(url){
	return new Promise(function(resolve, reject){
		window.resolveLocalFileSystemURL(url, function(dirEntry){
				var reader = dirEntry.createReader();
				reader.readEntries(function(entries){
					resolve(entries);
				}, reject);
		}, reject);
	});
}

function removeFolders(paths){
	return new Promise(function(resolve, reject){

		var counter = 0;
		for(var i = 0; i < paths.length;i++){
			console.log("Deleting...", paths[i]);
			window.resolveLocalFileSystemURL(paths[i], function(entry){
				entry.removeRecursively(function(result){
					console.log("Cleaned", result);
					counter += 1;
					if(counter == paths.length){
						console.log("Now i'm finished");
						resolve(paths);
					}
				},function(err){
					console.error(err);
					reject(err);
				});
			},function(err){
				console.error(err);
				reject(err);
			});
		}
	});
}

var deviceReady;
function waitDeviceReady(){

	if(deviceReady){return deviceReady;}
	deviceReady = new Promise(function(resolve, reject){
		document.addEventListener("deviceready", resolve);
		setTimeout(reject,50000);
	});
	return deviceReady;
}

game = stargateModules.game._public;
game.initialize = stargateModules.game._protected.initialize;
var STORAGE_DIR,
	SDK_DIR,
	GAMEOVER_DIR,
	deviceReady;

fdescribe("Game module tests", function() {

	beforeAll(function(done){
		console.log("beforeAll");
		deviceReady = waitDeviceReady();
		deviceReady.then(function(readyEvent){
				STORAGE_DIR = cordova.file.applicationStorageDirectory;
				if(isRunningOnIos()){ STORAGE_DIR += "Documents/"; }
				SDK_DIR = STORAGE_DIR + "scripts/";
				GAMES_DIR = STORAGE_DIR + "games/";
				GAMEOVER_DIR = STORAGE_DIR + "gameover_template";
				console.log("Ready!",readyEvent, SDK_DIR, GAMES_DIR, GAMEOVER_DIR);
				done();
			});
	});

	beforeEach(function(){

	});

	afterEach(function(){
	});

	it("Game should exists", function(done) {
		expect(game).toBeDefined();
		done();
	});

	it("Game should return already initialized if called twice", function(done) {
		var first = game.initialize({});
		var second = game.initialize({});
		second.then(function(result){
			expect(result).toEqual("AlreadyInitialized");
			done();
		});
	});

	it("Should expose BASE_DIR and OFFLINE_INDEX", function(done){
		var afterInit = game.initialize({});
		afterInit.then(function(results){
			expect(stargateModules.game._public.BASE_DIR).toBeDefined();
			expect(stargateModules.game._public.OFFLINE_INDEX).toBeDefined();
			done();
		});
	});

	it("AbortDownload should not to abort if is not downloading", function(done){
		var afterInit = game.initialize({});
		afterInit.then(function(){
			var res = game.abortDownload();
			expect(res).toBe(false);
			done();
		}).catch(function(){
			done();
		});

	});

	it("AbortDownload should abort downloading", function(done){
		var afterInit = game.initialize({});
		var _onCatch = jasmine.createSpy('_onCatch');
		afterInit.then(function(){

			game.download(juicy)
				.then(function(results){
					console.log("Download test results", results);
				})
				.catch(function(reason){
					console.log("Download test catch", reason);
				});

			setTimeout(function(){
				var res = game.abortDownload();
				expect(res).toBe(true);
				done();
			},1000);

		}).catch(function(reason){
			console.log(reason);
			expect(true).toBe(false);
			done();
		});

	});

	it("Test download game already exists", function(done){
		function check(reason){
			console.log(reason);
			expect(reason).toEqual({12:"AlreadyExists", gameID:juicy.id});
			done();
		}

		var afterInit = game.initialize({});
		afterInit.then(function(results){
				return createFolder(GAMES_DIR, juicy.id);
			})
			.then(function(result){
				return game.download(juicy);
			})
			.catch(check);
	});

	it("Test removeAll games", function(done){
		var afterInit = game.initialize({});
		afterInit.then(function(results){
				return game.removeAll();
			})
			.then(function(result){
				expect(result).toBeDefined();
				expect(result.path).toBeDefined();
				expect(result.path.indexOf(GAMES_DIR)).not.toEqual(-1);
				done();
			}).catch(function(){
				expect(true).toBeFalsy();
				done();
			});
	});

	it("Download Bundle games", function(done){
		var afterInit = game.initialize(conf);
		afterInit
			.then(function(){
				return game.getBundleGameObjects();
			})
			.then(function(results){
				expect(results[0]["response_api_dld"]).toBeDefined();
				expect(results[0]["response_api_dld"]["status"]).toEqual(200);
				done();
			})
			.catch(function(reason){
				console.log(reason);
				expect(true).toBeFalsy();
				done();
			});
	});
});

function clean(){
	return removeFolders([GAMES_DIR, GAMEOVER_DIR, SDK_DIR]);
}

function manualDownload(gameObject){
	var cbks = {
		onStart:console.log.bind(console),
		onProgress:console.log.bind(console),
		onEnd:console.log.bind(console)
	};
	stargateModules.game._protected.initialize(conf)
		.then(console.log.bind(console))
		.then(function(){
			return stargateModules.game._public.download(gameObject, cbks);
		})
		.then(function(){
			return Promise.all([
				writeJson("cookie.json", cookiejson),
				writeJson("user.json", userjson),
				writeJson("config.json", configjson),
				writeJson("dict.json", dictjson)
			]);
		}).catch(console.error.bind(console));
}